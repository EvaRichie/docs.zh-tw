---
title: 執行緒與執行緒處理
description: 瞭解執行緒（例如進程 & 執行緒）、使用多個執行緒的時機，& 如何在 .NET 中使用多執行緒來增加回應性或輸送量。
ms.date: 11/08/2018
ms.technology: dotnet-standard
helpviewer_keywords:
- multiple threads
- threading [.NET]
- threading [.NET], multiple threads
ms.assetid: 5baac3aa-e603-4fa6-9f89-0f2c1084e6b1
ms.openlocfilehash: b332db80069e18d3b52cd03eef4995eaad3fda7b
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/09/2020
ms.locfileid: "84583397"
---
# <a name="threads-and-threading"></a><span data-ttu-id="3bce7-103">執行緒與執行緒處理</span><span class="sxs-lookup"><span data-stu-id="3bce7-103">Threads and threading</span></span>

<span data-ttu-id="3bce7-104">多執行緒處理可讓您提高應用程式的回應能力，如果應用程式在多處理器或多核心系統上執行，也可提高其輸送量。</span><span class="sxs-lookup"><span data-stu-id="3bce7-104">Multithreading allows you to increase the responsiveness of your application and, if your application runs on a multiprocessor or multi-core system, increase its throughput.</span></span>

## <a name="processes-and-threads"></a><span data-ttu-id="3bce7-105">處理序和執行緒</span><span class="sxs-lookup"><span data-stu-id="3bce7-105">Processes and threads</span></span>

<span data-ttu-id="3bce7-106">「處理序」\*\* 是正在執行的程式。</span><span class="sxs-lookup"><span data-stu-id="3bce7-106">A *process* is an executing program.</span></span> <span data-ttu-id="3bce7-107">作業系統使用處理序來分隔正在執行的應用程式。</span><span class="sxs-lookup"><span data-stu-id="3bce7-107">An operating system uses processes to separate the applications that are being executed.</span></span> <span data-ttu-id="3bce7-108">「執行緒」\*\* 是要作業系統配置處理器時間的基本單位。</span><span class="sxs-lookup"><span data-stu-id="3bce7-108">A *thread* is the basic unit to which an operating system allocates processor time.</span></span> <span data-ttu-id="3bce7-109">每個執行緒都有[排程優先順序](scheduling-threads.md)，並保有系統在執行緒執行暫停時用來儲存執行緒內容的一組結構。</span><span class="sxs-lookup"><span data-stu-id="3bce7-109">Each thread has a [scheduling priority](scheduling-threads.md) and maintains a set of structures the system uses to save the thread context when the thread's execution is paused.</span></span> <span data-ttu-id="3bce7-110">執行緒內容包括執行緒順暢繼續執行所需的所有資訊，包括執行緒的一組 CPU 暫存器和堆疊。</span><span class="sxs-lookup"><span data-stu-id="3bce7-110">The thread context includes all the information the thread needs to seamlessly resume execution, including the thread's set of CPU registers and stack.</span></span> <span data-ttu-id="3bce7-111">多個執行緒可在一個處理序中執行。</span><span class="sxs-lookup"><span data-stu-id="3bce7-111">Multiple threads can run in the context of a process.</span></span> <span data-ttu-id="3bce7-112">一個處理序的所有執行緒都共用該處理序的虛擬位址空間。</span><span class="sxs-lookup"><span data-stu-id="3bce7-112">All threads of a process share its virtual address space.</span></span> <span data-ttu-id="3bce7-113">執行緒可以執行任一部分的程式碼，包括另一個執行緒目前正在執行的部分。</span><span class="sxs-lookup"><span data-stu-id="3bce7-113">A thread can execute any part of the program code, including parts currently being executed by another thread.</span></span>

> [!NOTE]
> <span data-ttu-id="3bce7-114">.NET Framework 提供使用「應用程式定義域」\*\* 來隔離處理序內應用程式的方式 </span><span class="sxs-lookup"><span data-stu-id="3bce7-114">The .NET Framework provides a way to isolate applications within a process with the use of *application domains*.</span></span> <span data-ttu-id="3bce7-115">（應用程式域無法在 .NET Core 上使用）。如需詳細資訊，請參閱[應用程式域](../../framework/app-domains/application-domains.md)一文的[應用程式域和執行緒](../../framework/app-domains/application-domains.md#application-domains-and-threads)一節。</span><span class="sxs-lookup"><span data-stu-id="3bce7-115">(Application domains are not available on .NET Core.) For more information, see the [Application domains and threads](../../framework/app-domains/application-domains.md#application-domains-and-threads) section of the [Application domains](../../framework/app-domains/application-domains.md) article.</span></span>

<span data-ttu-id="3bce7-116">根據預設，.NET 程式會從單一執行緒開始，通常稱為「主」\*\* 執行緒。</span><span class="sxs-lookup"><span data-stu-id="3bce7-116">By default, a .NET program is started with a single thread, often called the *primary* thread.</span></span> <span data-ttu-id="3bce7-117">不過，它可以建立額外的執行緒與主執行緒平行或同時執行程式碼。</span><span class="sxs-lookup"><span data-stu-id="3bce7-117">However, it can create additional threads to execute code in parallel or concurrently with the primary thread.</span></span> <span data-ttu-id="3bce7-118">這些執行緒通常稱為背景*工作*執行緒。</span><span class="sxs-lookup"><span data-stu-id="3bce7-118">These threads are often called *worker* threads.</span></span>

## <a name="when-to-use-multiple-threads"></a><span data-ttu-id="3bce7-119">使用多執行緒的時機</span><span class="sxs-lookup"><span data-stu-id="3bce7-119">When to use multiple threads</span></span>

<span data-ttu-id="3bce7-120">多執行緒可讓您用來提高應用程式的回應能力，並利用多處理器或多核心系統來提高應用程式的輸送量。</span><span class="sxs-lookup"><span data-stu-id="3bce7-120">You use multiple threads to increase the responsiveness of your application and to take advantage of a multiprocessor or multi-core system to increase the application's throughput.</span></span>

<span data-ttu-id="3bce7-121">請想一想傳統型應用程式，主執行緒負責處理使用者介面項目和回應使用者動作。</span><span class="sxs-lookup"><span data-stu-id="3bce7-121">Consider a desktop application, in which the primary thread is responsible for user interface elements and responds to user actions.</span></span> <span data-ttu-id="3bce7-122">背景工作執行緒可用來執行耗時的作業，否則這些作業會佔用主執行緒，而導致使用者介面沒有回應。</span><span class="sxs-lookup"><span data-stu-id="3bce7-122">Use worker threads to perform time-consuming operations that, otherwise, would occupy the primary thread and make the user interface non-responsive.</span></span> <span data-ttu-id="3bce7-123">您也可以使用專用的執行緒來進行網路或裝置通訊，以回應傳入訊息或事件。</span><span class="sxs-lookup"><span data-stu-id="3bce7-123">You can also use a dedicated thread for network or device communication to be more responsive to incoming messages or events.</span></span>

<span data-ttu-id="3bce7-124">如果您的程式執行可平行完成的作業，那麼在個別執行緒中執行這些作業，並在多處理器或多核心系統上執行程式可減少總執行時間。</span><span class="sxs-lookup"><span data-stu-id="3bce7-124">If your program performs operations that can be done in parallel, the total execution time can be decreased by performing those operations in separate threads and running the program on a multiprocessor or multi-core system.</span></span> <span data-ttu-id="3bce7-125">在這類系統上，使用多執行緒處理可提高輸送量及回應能力。</span><span class="sxs-lookup"><span data-stu-id="3bce7-125">On such a system, use of multithreading might increase throughput along with the increased responsiveness.</span></span>

## <a name="how-to-use-multithreading-in-net"></a><span data-ttu-id="3bce7-126">如何在 .NET 中使用多執行緒處理。</span><span class="sxs-lookup"><span data-stu-id="3bce7-126">How to use multithreading in .NET</span></span>

<span data-ttu-id="3bce7-127">從 .NET Framework 4 開始，建議使用[工作平行程式庫 (TPL)](../parallel-programming/task-parallel-library-tpl.md) 和[平行 LINQ (PLINQ)](../parallel-programming/introduction-to-plinq.md) 來利用多執行緒處理。</span><span class="sxs-lookup"><span data-stu-id="3bce7-127">Starting with the .NET Framework 4, the recommended way to utilize multithreading is to use [Task Parallel Library (TPL)](../parallel-programming/task-parallel-library-tpl.md) and [Parallel LINQ (PLINQ)](../parallel-programming/introduction-to-plinq.md).</span></span> <span data-ttu-id="3bce7-128">如需詳細資訊，請參閱[平行程式設計](../parallel-programming/index.md)。</span><span class="sxs-lookup"><span data-stu-id="3bce7-128">For more information, see [Parallel programming](../parallel-programming/index.md).</span></span>

<span data-ttu-id="3bce7-129">TPL 和 PLINQ 都憑藉 <xref:System.Threading.ThreadPool> 執行緒來運作。</span><span class="sxs-lookup"><span data-stu-id="3bce7-129">Both TPL and PLINQ rely on the <xref:System.Threading.ThreadPool> threads.</span></span> <span data-ttu-id="3bce7-130"><xref:System.Threading.ThreadPool?displayProperty=nameWithType> 類別會為 .NET 應用程式提供背景工作執行緒集區。</span><span class="sxs-lookup"><span data-stu-id="3bce7-130">The <xref:System.Threading.ThreadPool?displayProperty=nameWithType> class provides a .NET application with a pool of worker threads.</span></span> <span data-ttu-id="3bce7-131">您也可以使用執行緒集區執行緒。</span><span class="sxs-lookup"><span data-stu-id="3bce7-131">You can also use thread pool threads.</span></span> <span data-ttu-id="3bce7-132">如需詳細資訊，請參閱[受控執行緒集區](the-managed-thread-pool.md)。</span><span class="sxs-lookup"><span data-stu-id="3bce7-132">For more information, see [The managed thread pool](the-managed-thread-pool.md).</span></span>

<span data-ttu-id="3bce7-133">最後，您可以使用 <xref:System.Threading.Thread?displayProperty=nameWithType> 代表受控執行緒的類別。</span><span class="sxs-lookup"><span data-stu-id="3bce7-133">At last, you can use the <xref:System.Threading.Thread?displayProperty=nameWithType> class that represents a managed thread.</span></span> <span data-ttu-id="3bce7-134">如需詳細資訊，請參閱[使用執行緒和執行緒處理](using-threads-and-threading.md)。</span><span class="sxs-lookup"><span data-stu-id="3bce7-134">For more information, see [Using threads and threading](using-threads-and-threading.md).</span></span>

<span data-ttu-id="3bce7-135">多個執行緒可能需要存取共用資源。</span><span class="sxs-lookup"><span data-stu-id="3bce7-135">Multiple threads might need to access a shared resource.</span></span> <span data-ttu-id="3bce7-136">為了讓資源保持在未損毀的狀態並避免競爭條件，您必須同步對該資源的執行緒存取。</span><span class="sxs-lookup"><span data-stu-id="3bce7-136">To keep the resource in a uncorrupted state and avoid race conditions, you must synchronize the thread access to it.</span></span> <span data-ttu-id="3bce7-137">您也可能想要協調多個執行緒的互動。</span><span class="sxs-lookup"><span data-stu-id="3bce7-137">You also might want to coordinate the interaction of multiple threads.</span></span> <span data-ttu-id="3bce7-138">.NET 提供可用來同步對共用資源的存取或協調執行緒互動的一系列類型。</span><span class="sxs-lookup"><span data-stu-id="3bce7-138">.NET provides a range of types that you can use to synchronize access to a shared resource or coordinate thread interaction.</span></span> <span data-ttu-id="3bce7-139">如需詳細資訊，請參閱[同步處理原始物件概觀](overview-of-synchronization-primitives.md)。</span><span class="sxs-lookup"><span data-stu-id="3bce7-139">For more information, see [Overview of synchronization primitives](overview-of-synchronization-primitives.md).</span></span>

<span data-ttu-id="3bce7-140">請務必處理執行緒中的例外狀況。</span><span class="sxs-lookup"><span data-stu-id="3bce7-140">Do handle exceptions in threads.</span></span> <span data-ttu-id="3bce7-141">執行緒中未處理的例外狀況一般會終止處理序。</span><span class="sxs-lookup"><span data-stu-id="3bce7-141">Unhandled exceptions in threads generally terminate the process.</span></span> <span data-ttu-id="3bce7-142">如需詳細資訊，請參閱[受控執行緒中的例外狀況](exceptions-in-managed-threads.md)。</span><span class="sxs-lookup"><span data-stu-id="3bce7-142">For more information, see [Exceptions in managed threads](exceptions-in-managed-threads.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="3bce7-143">請參閱</span><span class="sxs-lookup"><span data-stu-id="3bce7-143">See also</span></span>

- [<span data-ttu-id="3bce7-144">執行緒物件和功能</span><span class="sxs-lookup"><span data-stu-id="3bce7-144">Threading objects and features</span></span>](threading-objects-and-features.md)
- [<span data-ttu-id="3bce7-145">受控執行緒處理最佳做法</span><span class="sxs-lookup"><span data-stu-id="3bce7-145">Managed threading best practices</span></span>](managed-threading-best-practices.md)
- [<span data-ttu-id="3bce7-146">.NET 中的平行處理、並行和非同步程式設計</span><span class="sxs-lookup"><span data-stu-id="3bce7-146">Parallel Processing, Concurrency, and Async Programming in .NET</span></span>](../parallel-processing-and-concurrency.md)
- [<span data-ttu-id="3bce7-147">關於處理序和執行緒</span><span class="sxs-lookup"><span data-stu-id="3bce7-147">About Processes and Threads</span></span>](/windows/desktop/procthread/about-processes-and-threads)
