---
title: 使用執行緒和執行緒處理
description: 瞭解如何在 .NET 中使用執行緒和執行緒，讓您可以撰寫應用程式來同時執行許多作業（多執行緒）。
ms.date: 08/08/2018
ms.technology: dotnet-standard
helpviewer_keywords:
- threading [.NET Framework], about threading
- managed threading
ms.assetid: 9b5ec2cd-121b-4d49-b075-222cf26f2344
ms.openlocfilehash: c092994818c9105a555acaf63ceba4b8e99bcada
ms.sourcegitcommit: 7137e12f54c4e83a94ae43ec320f8cf59c1772ea
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/10/2020
ms.locfileid: "84663027"
---
# <a name="using-threads-and-threading"></a><span data-ttu-id="de5da-103">使用執行緒和執行緒處理</span><span class="sxs-lookup"><span data-stu-id="de5da-103">Using threads and threading</span></span>

<span data-ttu-id="de5da-104">使用 .NET，您可以撰寫同時執行多項作業的應用程式。</span><span class="sxs-lookup"><span data-stu-id="de5da-104">With .NET, you can write applications that perform multiple operations at the same time.</span></span> <span data-ttu-id="de5da-105">可能妨礙其他作業的作業可以在另外的執行緒上執行，這類處理序稱為「多執行緒」\*\* 或「無限制執行緒」\*\*。</span><span class="sxs-lookup"><span data-stu-id="de5da-105">Operations with the potential of holding up other operations can execute on separate threads, a process known as *multithreading* or *free threading*.</span></span>  
  
<span data-ttu-id="de5da-106">使用多執行緒的應用程式回應使用者輸入會更快，因為當處理器密集工作在另外的執行緒上執行時，使用者介面會保持使用中。</span><span class="sxs-lookup"><span data-stu-id="de5da-106">Applications that use multithreading are more responsive to user input because the user interface stays active as processor-intensive tasks execute on separate threads.</span></span> <span data-ttu-id="de5da-107">當您建立可擴充的應用程式時，多執行緒也很有幫助，因為您可以隨著工作負載增加而新增執行緒。</span><span class="sxs-lookup"><span data-stu-id="de5da-107">Multithreading is also useful when you create scalable applications, because you can add threads as the workload increases.</span></span>

> [!NOTE]
> <span data-ttu-id="de5da-108">如果您需要對應用程式執行緒行為有更大的掌控力，您可以自行管理執行緒。</span><span class="sxs-lookup"><span data-stu-id="de5da-108">If you need more control over the behavior of the application's threads, you can manage the threads yourself.</span></span> <span data-ttu-id="de5da-109">但是，從 .NET Framework 4 開始，多執行緒的程式設計已透過 <xref:System.Threading.Tasks.Parallel?displayProperty=nameWithType> 和 <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> 類別、[平行 LINQ (PLINQ)](../parallel-programming/introduction-to-plinq.md)、<xref:System.Collections.Concurrent?displayProperty=nameWithType> 命名空間中的新並行集合類別，以及以工作 (而非執行緒) 概念為基礎的新程式設計模型，而做出簡化。</span><span class="sxs-lookup"><span data-stu-id="de5da-109">However, starting with the .NET Framework 4, multithreaded programming is greatly simplified with the <xref:System.Threading.Tasks.Parallel?displayProperty=nameWithType> and <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> classes, [Parallel LINQ (PLINQ)](../parallel-programming/introduction-to-plinq.md), new concurrent collection classes in the <xref:System.Collections.Concurrent?displayProperty=nameWithType> namespace, and a new programming model that is based on the concept of tasks rather than threads.</span></span> <span data-ttu-id="de5da-110">如需詳細資訊，請參閱[平行程式設計](../parallel-programming/index.md)和[工作平行程式庫 (TPL)](../parallel-programming/task-parallel-library-tpl.md)。</span><span class="sxs-lookup"><span data-stu-id="de5da-110">For more information, see [Parallel Programming](../parallel-programming/index.md) and [Task Parallel Library (TPL)](../parallel-programming/task-parallel-library-tpl.md).</span></span>

## <a name="how-to-create-and-start-a-new-thread"></a><span data-ttu-id="de5da-111">如何：建立及啟動新的執行緒</span><span class="sxs-lookup"><span data-stu-id="de5da-111">How to: Create and start a new thread</span></span>

<span data-ttu-id="de5da-112">您可以透過建立 <xref:System.Threading.Thread?displayProperty=nameWithType> 類別的新執行個體，並將您希望在新的執行緒上執行的方法名稱提供給建構函式，來建立新的執行緒。</span><span class="sxs-lookup"><span data-stu-id="de5da-112">You create a new thread by creating a new instance of the <xref:System.Threading.Thread?displayProperty=nameWithType> class and providing the name of the method that you want to execute on a new thread to the constructor.</span></span> <span data-ttu-id="de5da-113">若要啟動已建立的執行緒，請呼叫 <xref:System.Threading.Thread.Start%2A?displayProperty=nameWithType> 方法。</span><span class="sxs-lookup"><span data-stu-id="de5da-113">To start a created thread, call the <xref:System.Threading.Thread.Start%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="de5da-114">如需詳細資訊和範例，請參閱[建立執行緒並在啟動時傳遞資料](creating-threads-and-passing-data-at-start-time.md)一文和 <xref:System.Threading.Thread> API 參考。</span><span class="sxs-lookup"><span data-stu-id="de5da-114">For more information and examples, see the [Creating threads and passing data at start time](creating-threads-and-passing-data-at-start-time.md) article and the <xref:System.Threading.Thread> API reference.</span></span>

## <a name="how-to-stop-a-thread"></a><span data-ttu-id="de5da-115">如何：停止執行緒</span><span class="sxs-lookup"><span data-stu-id="de5da-115">How to: Stop a thread</span></span>

<span data-ttu-id="de5da-116">若要終止執行緒的執行，請使用 <xref:System.Threading.CancellationToken?displayProperty=nameWithType> 。</span><span class="sxs-lookup"><span data-stu-id="de5da-116">To terminate the execution of a thread, use the <xref:System.Threading.CancellationToken?displayProperty=nameWithType>.</span></span> <span data-ttu-id="de5da-117">它提供統一的方式來停止執行緒的合作。</span><span class="sxs-lookup"><span data-stu-id="de5da-117">It provides a unified way to stop threads cooperatively.</span></span> <span data-ttu-id="de5da-118">如需詳細資訊，請參閱[managed 執行緒中的取消](cancellation-in-managed-threads.md)。</span><span class="sxs-lookup"><span data-stu-id="de5da-118">For more information, see [Cancellation in managed threads](cancellation-in-managed-threads.md).</span></span>

<span data-ttu-id="de5da-119">有時候，無法以合作方式停止執行緒，因為它會執行協力廠商程式碼，而不是針對合作取消所設計。</span><span class="sxs-lookup"><span data-stu-id="de5da-119">Sometimes it is not possible to stop a thread cooperatively, because it runs third-party code not designed for cooperative cancellation.</span></span> <span data-ttu-id="de5da-120">在此情況下，您可能會想要強制終止其執行。</span><span class="sxs-lookup"><span data-stu-id="de5da-120">In this case, you might want to terminate its execution forcibly.</span></span> <span data-ttu-id="de5da-121">若要強制終止執行執行緒，請在 .NET Framework 中，您可以使用 <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> 方法。</span><span class="sxs-lookup"><span data-stu-id="de5da-121">To terminate the execution of a thread forcibly, in .NET Framework you can use the <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="de5da-122">該方法會在叫用該方法的執行緒上引發 <xref:System.Threading.ThreadAbortException>。</span><span class="sxs-lookup"><span data-stu-id="de5da-122">That method raises a <xref:System.Threading.ThreadAbortException> on the thread on which it's invoked.</span></span> <span data-ttu-id="de5da-123">如需詳細資訊，請參閱[終結執行緒](destroying-threads.md)。</span><span class="sxs-lookup"><span data-stu-id="de5da-123">For more information, see [Destroying threads](destroying-threads.md).</span></span> <span data-ttu-id="de5da-124"><xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType>.Net Core 不支援方法。</span><span class="sxs-lookup"><span data-stu-id="de5da-124">The <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> method is not supported in .NET Core.</span></span> <span data-ttu-id="de5da-125">如果您需要終止在 .NET Core 中強制執行協力廠商程式碼，請在個別進程中執行它，然後使用 <xref:System.Diagnostics.Process.Kill%2A?displayProperty=nameWithType> 。</span><span class="sxs-lookup"><span data-stu-id="de5da-125">If you need to terminate the execution of third-party code forcibly in .NET Core, run it in the separate process and use <xref:System.Diagnostics.Process.Kill%2A?displayProperty=nameWithType>.</span></span>

<span data-ttu-id="de5da-126"><xref:System.Threading.CancellationToken?displayProperty=nameWithType>.NET Framework 4 之前無法使用。</span><span class="sxs-lookup"><span data-stu-id="de5da-126">The <xref:System.Threading.CancellationToken?displayProperty=nameWithType> is not available before .NET Framework 4.</span></span> <span data-ttu-id="de5da-127">若要停止舊版 .NET Framework 版本中的執行緒，您應該使用執行緒同步處理技術來手動執行合作取消。</span><span class="sxs-lookup"><span data-stu-id="de5da-127">To stop a thread in older .NET Framework versions, you should implement the cooperative cancellation manually using the thread synchronization techniques.</span></span> <span data-ttu-id="de5da-128">例如，您可以建立 volatile 布林值欄位 `shouldStop` ，並用它來要求要停止的執行緒所執行的程式碼。</span><span class="sxs-lookup"><span data-stu-id="de5da-128">For example, you can create the volatile boolean field `shouldStop` and use it to request the code executed by the thread to stop.</span></span> <span data-ttu-id="de5da-129">如需詳細資訊，請參閱[volatile](../../csharp/language-reference/keywords/volatile.md) In c # 參考和 <xref:System.Threading.Volatile?displayProperty=nameWithType> 。</span><span class="sxs-lookup"><span data-stu-id="de5da-129">For more information, see [volatile](../../csharp/language-reference/keywords/volatile.md) in C# Reference and <xref:System.Threading.Volatile?displayProperty=nameWithType>.</span></span>

<span data-ttu-id="de5da-130">使用 <xref:System.Threading.Thread.Join%2A?displayProperty=nameWithType> 方法，讓呼叫執行緒等候停止的執行緒終止。</span><span class="sxs-lookup"><span data-stu-id="de5da-130">Use the <xref:System.Threading.Thread.Join%2A?displayProperty=nameWithType> method to make the calling thread wait for the termination of the thread being stopped.</span></span>

## <a name="how-to-pause-or-interrupt-a-thread"></a><span data-ttu-id="de5da-131">如何：暫停或插斷執行緒</span><span class="sxs-lookup"><span data-stu-id="de5da-131">How to: Pause or interrupt a thread</span></span>

<span data-ttu-id="de5da-132">您可以使用 <xref:System.Threading.Thread.Sleep%2A?displayProperty=nameWithType> 方法在指定的時間內暫停目前的執行緒。</span><span class="sxs-lookup"><span data-stu-id="de5da-132">You use the <xref:System.Threading.Thread.Sleep%2A?displayProperty=nameWithType> method to pause the current thread for a specified amount of time.</span></span> <span data-ttu-id="de5da-133">您可以透過呼叫 <xref:System.Threading.Thread.Interrupt%2A?displayProperty=nameWithType> 方法來插斷封鎖的執行緒。</span><span class="sxs-lookup"><span data-stu-id="de5da-133">You can interrupt a blocked thread by calling the <xref:System.Threading.Thread.Interrupt%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="de5da-134">如需詳細資訊，請參閱[暫停及插斷執行緒](pausing-and-resuming-threads.md)。</span><span class="sxs-lookup"><span data-stu-id="de5da-134">For more information, see [Pausing and interrupting threads](pausing-and-resuming-threads.md).</span></span>

## <a name="thread-properties"></a><span data-ttu-id="de5da-135">執行緒屬性</span><span class="sxs-lookup"><span data-stu-id="de5da-135">Thread properties</span></span>

<span data-ttu-id="de5da-136">下表列出 <xref:System.Threading.Thread>屬性的一部分：</span><span class="sxs-lookup"><span data-stu-id="de5da-136">The following table presents some of the <xref:System.Threading.Thread> properties:</span></span>  
  
|<span data-ttu-id="de5da-137">屬性</span><span class="sxs-lookup"><span data-stu-id="de5da-137">Property</span></span>|<span data-ttu-id="de5da-138">說明</span><span class="sxs-lookup"><span data-stu-id="de5da-138">Description</span></span>|  
|--------------|-----------|  
|<xref:System.Threading.Thread.IsAlive%2A>|<span data-ttu-id="de5da-139">若執行緒已啟動且尚未正常終止或中止，則傳回 `true`。</span><span class="sxs-lookup"><span data-stu-id="de5da-139">Returns `true` if a thread has been started and has not yet terminated normally or aborted.</span></span>|  
|<xref:System.Threading.Thread.IsBackground%2A>|<span data-ttu-id="de5da-140">取得或設定布林值，指出執行緒是否為背景執行緒。</span><span class="sxs-lookup"><span data-stu-id="de5da-140">Gets or sets a Boolean that indicates if a thread is a background thread.</span></span> <span data-ttu-id="de5da-141">背景執行緒與前景執行緒相似，但背景執行緒不會防止處理序停止。</span><span class="sxs-lookup"><span data-stu-id="de5da-141">Background threads are like foreground threads, but a background thread doesn't prevent a process from stopping.</span></span> <span data-ttu-id="de5da-142">一旦屬於處理程序的所有前景執行緒停止，通用語言執行平台會呼叫背景執行緒上仍在執行的 <xref:System.Threading.Thread.Abort%2A> 方法來結束處理程序。</span><span class="sxs-lookup"><span data-stu-id="de5da-142">Once all foreground threads that belong to a process have stopped, the common language runtime ends the process by calling the <xref:System.Threading.Thread.Abort%2A> method on background threads that are still alive.</span></span> <span data-ttu-id="de5da-143">如需詳細資訊，請參閱[前景與背景執行緒](foreground-and-background-threads.md)。</span><span class="sxs-lookup"><span data-stu-id="de5da-143">For more information, see [Foreground and Background Threads](foreground-and-background-threads.md).</span></span>|  
|<xref:System.Threading.Thread.Name%2A>|<span data-ttu-id="de5da-144">取得或設定執行緒名稱。</span><span class="sxs-lookup"><span data-stu-id="de5da-144">Gets or sets the name of a thread.</span></span> <span data-ttu-id="de5da-145">最常用於在偵錯時探索個別執行緒。</span><span class="sxs-lookup"><span data-stu-id="de5da-145">Most frequently used to discover individual threads when you debug.</span></span>|  
|<xref:System.Threading.Thread.Priority%2A>|<span data-ttu-id="de5da-146">取得或設定作業系統使用的 <xref:System.Threading.ThreadPriority> 值，以設定執行緒排程的優先權。</span><span class="sxs-lookup"><span data-stu-id="de5da-146">Gets or sets a <xref:System.Threading.ThreadPriority> value that is used by the operating system to prioritize thread scheduling.</span></span> <span data-ttu-id="de5da-147">如需詳細資訊，請參閱[排程執行緒](scheduling-threads.md)和 <xref:System.Threading.ThreadPriority> 參考。</span><span class="sxs-lookup"><span data-stu-id="de5da-147">For more information, see [Scheduling threads](scheduling-threads.md) and the <xref:System.Threading.ThreadPriority> reference.</span></span>|  
|<xref:System.Threading.Thread.ThreadState%2A>|<span data-ttu-id="de5da-148">取得包含執行緒目前狀態的 <xref:System.Threading.ThreadState> 值。</span><span class="sxs-lookup"><span data-stu-id="de5da-148">Gets a <xref:System.Threading.ThreadState> value containing the current states of a thread.</span></span>|  

## <a name="see-also"></a><span data-ttu-id="de5da-149">另請參閱</span><span class="sxs-lookup"><span data-stu-id="de5da-149">See also</span></span>

- <xref:System.Threading.Thread?displayProperty=nameWithType>
- [<span data-ttu-id="de5da-150">執行緒和執行緒處理</span><span class="sxs-lookup"><span data-stu-id="de5da-150">Threads and Threading</span></span>](threads-and-threading.md)
- [<span data-ttu-id="de5da-151">平行程式設計</span><span class="sxs-lookup"><span data-stu-id="de5da-151">Parallel Programming</span></span>](../parallel-programming/index.md)
