---
title: 在 .NET 中顯示和保存格式化資料的最佳作法
description: 瞭解如何在 .NET 應用程式中有效地顯示和保存數值和日期資料。
ms.date: 05/01/2019
dev_langs:
- csharp
- vb
ms.openlocfilehash: 1748363089a80538a19e91b1955fe9257de39a4e
ms.sourcegitcommit: 965a5af7918acb0a3fd3baf342e15d511ef75188
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/18/2020
ms.locfileid: "94825139"
---
# <a name="best-practices-for-displaying-and-persisting-formatted-data"></a><span data-ttu-id="33184-103">顯示和保存格式化資料的最佳作法</span><span class="sxs-lookup"><span data-stu-id="33184-103">Best practices for displaying and persisting formatted data</span></span>

<span data-ttu-id="33184-104">本文將檢查格式化資料（例如數值資料和日期和時間資料）如何針對顯示和儲存進行處理。</span><span class="sxs-lookup"><span data-stu-id="33184-104">This article examines how formatted data, such as numeric data and date-and-time data, is handled for display and for storage.</span></span>

<span data-ttu-id="33184-105">當您使用 .NET 進行開發時，請使用區分文化特性的格式，在使用者介面中顯示非字串資料，例如數位和日期。</span><span class="sxs-lookup"><span data-stu-id="33184-105">When you develop with .NET, use culture-sensitive formatting to display non-string data, such as numbers and dates, in a user interface.</span></span> <span data-ttu-id="33184-106">使用不因 [文化](xref:System.Globalization.CultureInfo.InvariantCulture) 特性而異的格式，以字串形式保存非字串資料。</span><span class="sxs-lookup"><span data-stu-id="33184-106">Use formatting with the [invariant culture](xref:System.Globalization.CultureInfo.InvariantCulture) to persist non-string data in string form.</span></span> <span data-ttu-id="33184-107">請勿使用區分文化特性的格式來保存字串格式的數值或日期和時間資料。</span><span class="sxs-lookup"><span data-stu-id="33184-107">Do not use culture-sensitive formatting to persist numeric or date-and-time data in string form.</span></span>

## <a name="displaying-formatted-data"></a><span data-ttu-id="33184-108">顯示格式化的資料</span><span class="sxs-lookup"><span data-stu-id="33184-108">Displaying formatted data</span></span>

<span data-ttu-id="33184-109">當您向使用者顯示非字串資料 (例如數字及日期和時間) 時，請採用使用者的文化特性設定進行格式化。</span><span class="sxs-lookup"><span data-stu-id="33184-109">When you display non-string data such as numbers and dates and times to users, format them by using the user's cultural settings.</span></span> <span data-ttu-id="33184-110">根據預設，下列所有項目都會在格式化作業中使用目前執行緒文化特性：</span><span class="sxs-lookup"><span data-stu-id="33184-110">By default, the following all use the current thread culture in formatting operations:</span></span>

- <span data-ttu-id="33184-111">[C#](../../csharp/language-reference/tokens/interpolated.md) 和 [Visual Basic](../../visual-basic/programming-guide/language-features/strings/interpolated-strings.md) 編譯器支援的插入字串。</span><span class="sxs-lookup"><span data-stu-id="33184-111">Interpolated strings supported by the [C#](../../csharp/language-reference/tokens/interpolated.md) and [Visual Basic](../../visual-basic/programming-guide/language-features/strings/interpolated-strings.md) compilers.</span></span>
- <span data-ttu-id="33184-112">使用 [C#](../../csharp/language-reference/operators/addition-operator.md#string-concatenation) 或 [Visual Basic](../../visual-basic/programming-guide/language-features/operators-and-expressions/concatenation-operators.md) 串連運算子或直接呼叫 <xref:System.String.Concat%2A?displayProperty=nameWithType> 方法的字串串連作業。</span><span class="sxs-lookup"><span data-stu-id="33184-112">String concatenation operations that use the [C#](../../csharp/language-reference/operators/addition-operator.md#string-concatenation) or [Visual Basic](../../visual-basic/programming-guide/language-features/operators-and-expressions/concatenation-operators.md) concatenation operators or that call the <xref:System.String.Concat%2A?displayProperty=nameWithType> method directly.</span></span>
- <span data-ttu-id="33184-113"><xref:System.String.Format%2A?displayProperty=nameWithType> 方法</span><span class="sxs-lookup"><span data-stu-id="33184-113">The <xref:System.String.Format%2A?displayProperty=nameWithType> method.</span></span>
- <span data-ttu-id="33184-114">數值類型以及日期和時間類型的 `ToString` 方法。</span><span class="sxs-lookup"><span data-stu-id="33184-114">The `ToString` methods of the numeric types and the date and time types.</span></span>

<span data-ttu-id="33184-115">若要明確指定應使用指定的文化特性慣例或[不因文化特性而異](xref:System.Globalization.CultureInfo.InvariantCulture)來格式化字串，您可以執行下列動作：</span><span class="sxs-lookup"><span data-stu-id="33184-115">To explicitly specify that a string should be formatted by using the conventions of a designated culture or the [invariant culture](xref:System.Globalization.CultureInfo.InvariantCulture), you can do the following:</span></span>

- <span data-ttu-id="33184-116">使用 <xref:System.String.Format%2A?displayProperty=nameWithType> 和 `ToString` 方法時，呼叫具有 `provider` 參數的多載 (例如 <xref:System.String.Format%28System.IFormatProvider%2CSystem.String%2CSystem.Object%5B%5D%29?displayProperty=nameWithType> 或 <xref:System.DateTime.ToString%28System.IFormatProvider%29?displayProperty=nameWithType>)，並為該多載傳遞給 <xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=nameWithType> 屬性 (表示所需文化特性的 <xref:System.Globalization.CultureInfo> 執行個體) 或 <xref:System.Globalization.CultureInfo.InvariantCulture?displayProperty=nameWithType> 屬性。</span><span class="sxs-lookup"><span data-stu-id="33184-116">When using the <xref:System.String.Format%2A?displayProperty=nameWithType> and `ToString` methods, call an overload that has a `provider` parameter, such as <xref:System.String.Format%28System.IFormatProvider%2CSystem.String%2CSystem.Object%5B%5D%29?displayProperty=nameWithType> or <xref:System.DateTime.ToString%28System.IFormatProvider%29?displayProperty=nameWithType>, and pass it the <xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=nameWithType> property, a <xref:System.Globalization.CultureInfo> instance that represents the desired culture, or the <xref:System.Globalization.CultureInfo.InvariantCulture?displayProperty=nameWithType> property.</span></span>

- <span data-ttu-id="33184-117">針對字串串連，不允許編譯器執行任何隱含的轉換。</span><span class="sxs-lookup"><span data-stu-id="33184-117">For string concatenation, do not allow the compiler to perform any implicit conversions.</span></span> <span data-ttu-id="33184-118">反之，藉由呼叫具有 `provider` 參數的 `ToString` 多載來執行明確轉換。</span><span class="sxs-lookup"><span data-stu-id="33184-118">Instead, perform an explicit conversion by calling a `ToString` overload that has a `provider` parameter.</span></span> <span data-ttu-id="33184-119">例如，在 <xref:System.Double> 下列程式碼中將值轉換成字串時，編譯器會隱含地使用目前的文化特性：</span><span class="sxs-lookup"><span data-stu-id="33184-119">For example, the compiler implicitly uses the current culture when converting a <xref:System.Double> value to a string in the following code:</span></span>

  [!code-csharp[Implicit String Conversion](./snippets/best-practices-strings/csharp/tostring/Program.cs#1)]
  [!code-vb[Implicit String Conversion](./snippets/best-practices-strings/vb/tostring/Program.vb#1)]

  <span data-ttu-id="33184-120">相反地，您可以藉由呼叫方法，明確地指定要在轉換中使用其格式化慣例的文化特性 <xref:System.Double.ToString(System.IFormatProvider)?displayProperty=nameWithType> ，如下列程式碼所示：</span><span class="sxs-lookup"><span data-stu-id="33184-120">Instead, you can explicitly specify the culture whose formatting conventions are used in the conversion by calling the <xref:System.Double.ToString(System.IFormatProvider)?displayProperty=nameWithType> method, as the following code does:</span></span>

  [!code-csharp[Explicit String Conversion](./snippets/best-practices-strings/csharp/tostring/Program.cs#2)]
  [!code-vb[Implicit String Conversion](./snippets/best-practices-strings/vb/tostring/Program.vb#2)]

- <span data-ttu-id="33184-121">針對字串內插補點，請將插入字串指派給 <xref:System.FormattableString> 執行個體，而非 <xref:System.String>。</span><span class="sxs-lookup"><span data-stu-id="33184-121">For string interpolation, rather than assigning an interpolated string to a <xref:System.String> instance, assign it to a <xref:System.FormattableString>.</span></span> <span data-ttu-id="33184-122">接著，您可以呼叫其 <xref:System.FormattableString.ToString?displayProperty=nameWithType> 方法產生會反映目前文化特性慣例的結果字串，也可以呼叫 <xref:System.FormattableString.ToString(System.IFormatProvider)?displayProperty=nameWithType> 方法產生會反映指定文化特性慣例的結果字串。</span><span class="sxs-lookup"><span data-stu-id="33184-122">You can then call its <xref:System.FormattableString.ToString?displayProperty=nameWithType> method produce a result string that reflects the conventions of the current culture, or you can call the <xref:System.FormattableString.ToString(System.IFormatProvider)?displayProperty=nameWithType> method to produce a result string that reflects the conventions of a specified culture.</span></span> <span data-ttu-id="33184-123">您也可以將可格式化字串傳遞給靜態的 <xref:System.FormattableString.Invariant%2A?displayProperty=nameWithType> 方法，以產生會反映不因文化特性而異之慣例的結果字串。</span><span class="sxs-lookup"><span data-stu-id="33184-123">You can also pass the formattable string to the static <xref:System.FormattableString.Invariant%2A?displayProperty=nameWithType> method to produce a result string that reflects the conventions of the invariant culture.</span></span> <span data-ttu-id="33184-124">下列範例將示範這個方法。</span><span class="sxs-lookup"><span data-stu-id="33184-124">The following example illustrates this approach.</span></span> <span data-ttu-id="33184-125">(此範例的輸出反映 en-US 目前文化特性。)</span><span class="sxs-lookup"><span data-stu-id="33184-125">(The output from the example reflects a current culture of en-US.)</span></span>

  [!code-csharp[String interpolation](./snippets/best-practices-strings/csharp/formattable/Program.cs)]
  [!code-vb[String interpolation](./snippets/best-practices-strings/vb/formattable/Program.vb)]

## <a name="persisting-formatted-data"></a><span data-ttu-id="33184-126">保存格式化的資料</span><span class="sxs-lookup"><span data-stu-id="33184-126">Persisting formatted data</span></span>

<span data-ttu-id="33184-127">您可將非字串資料保存為二進位資料或格式化的資料。</span><span class="sxs-lookup"><span data-stu-id="33184-127">You can persist non-string data either as binary data or as formatted data.</span></span> <span data-ttu-id="33184-128">如果您選擇將它儲存為格式化的資料，您應該呼叫包含 `provider` 參數之格式化方法的多載，並將 <xref:System.Globalization.CultureInfo.InvariantCulture%2A?displayProperty=nameWithType> 屬性傳遞給它。</span><span class="sxs-lookup"><span data-stu-id="33184-128">If you choose to save it as formatted data, you should call a formatting method overload that includes a `provider` parameter and pass it the <xref:System.Globalization.CultureInfo.InvariantCulture%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="33184-129">針對獨立於文化特性和機器的格式化資料，不因國別而異的文化特性可提供一致的格式。</span><span class="sxs-lookup"><span data-stu-id="33184-129">The invariant culture provides a consistent format for formatted data that is independent of culture and machine.</span></span> <span data-ttu-id="33184-130">相較之下，如果資料並非使用不因國別而異的文化特性，而是使用其他文化特性來進行格式化，這類資料的保存會有許多限制：</span><span class="sxs-lookup"><span data-stu-id="33184-130">In contrast, persisting data that is formatted by using cultures other than the invariant culture has a number of limitations:</span></span>

- <span data-ttu-id="33184-131">如果在具有不同文化特性的系統上擷取資料，或者，目前系統的使用者變更目前的文化特性，並嘗試擷取資料時，該資料可能會無法使用。</span><span class="sxs-lookup"><span data-stu-id="33184-131">The data is likely to be unusable if it is retrieved on a system that has a different culture, or if the user of the current system changes the current culture and tries to retrieve the data.</span></span>
- <span data-ttu-id="33184-132">特定電腦上的文化特性屬性可能不同於標準值。</span><span class="sxs-lookup"><span data-stu-id="33184-132">The properties of a culture on a specific computer can differ from standard values.</span></span> <span data-ttu-id="33184-133">使用者可以隨時自訂區分文化特性的顯示設定。</span><span class="sxs-lookup"><span data-stu-id="33184-133">At any time, a user can customize culture-sensitive display settings.</span></span> <span data-ttu-id="33184-134">因為這個緣故，使用者自訂文化特性設定之後，可能無法讀取系統上儲存的格式化資料。</span><span class="sxs-lookup"><span data-stu-id="33184-134">Because of this, formatted data that is saved on a system may not be readable after the user customizes cultural settings.</span></span> <span data-ttu-id="33184-135">格式化資料在電腦之間的可攜性可能會有更多限制。</span><span class="sxs-lookup"><span data-stu-id="33184-135">The portability of formatted data across computers is likely to be even more limited.</span></span>
- <span data-ttu-id="33184-136">當數字或日期和時間格式的規範標準 (不論全球、地區或國際標準) 隨著時間變更時，這些變更會併入 Windows 作業系統更新當中。</span><span class="sxs-lookup"><span data-stu-id="33184-136">International, regional, or national standards that govern the formatting of numbers or dates and times change over time, and these changes are incorporated into Windows operating system updates.</span></span> <span data-ttu-id="33184-137">當格式化慣例改變時，使用先前慣例來格式化的資料可能會變成無法讀取。</span><span class="sxs-lookup"><span data-stu-id="33184-137">When formatting conventions change, data that was formatted by using the previous conventions may become unreadable.</span></span>

<span data-ttu-id="33184-138">下列範例說明使用區分文化特性的格式來保存資料時產生的可攜性限制。</span><span class="sxs-lookup"><span data-stu-id="33184-138">The following example illustrates the limited portability that results from using culture-sensitive formatting to persist data.</span></span> <span data-ttu-id="33184-139">此範例會將日期和時間值陣列儲存至檔案。</span><span class="sxs-lookup"><span data-stu-id="33184-139">The example saves an array of date and time values to a file.</span></span> <span data-ttu-id="33184-140">這些值是使用英文 (美國) 文化特性的慣例來進行格式化。</span><span class="sxs-lookup"><span data-stu-id="33184-140">These are formatted by using the conventions of the English (United States) culture.</span></span> <span data-ttu-id="33184-141">當應用程式將目前執行緒文化特性變更為法文 (瑞士) 後，它會嘗試使用目前文化特性的格式化慣例來讀取儲存的值。</span><span class="sxs-lookup"><span data-stu-id="33184-141">After the application changes the current thread culture to French (Switzerland), it tries to read the saved values by using the formatting conventions of the current culture.</span></span> <span data-ttu-id="33184-142">嘗試讀取這兩樣資料項目後，會擲回 <xref:System.FormatException> 例外狀況，且日期陣列現在會包含兩個等於 <xref:System.DateTime.MinValue>的不正確項目。</span><span class="sxs-lookup"><span data-stu-id="33184-142">The attempt to read two of the data items throws a <xref:System.FormatException> exception, and the array of dates now contains two incorrect elements that are equal to <xref:System.DateTime.MinValue>.</span></span>

[!code-csharp[Conceptual.Strings.BestPractices#21](~/samples/snippets/csharp/VS_Snippets_CLR/conceptual.strings.bestpractices/cs/persistence.cs#21)]
[!code-vb[Conceptual.Strings.BestPractices#21](~/samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.strings.bestpractices/vb/persistence.vb#21)]

<span data-ttu-id="33184-143">但是，如果您將的 <xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=nameWithType> 屬性取代 <xref:System.Globalization.CultureInfo.InvariantCulture%2A?displayProperty=nameWithType> 為對和的 <xref:System.DateTime.ToString%28System.String%2CSystem.IFormatProvider%29?displayProperty=nameWithType> 呼叫 <xref:System.DateTime.Parse%28System.String%2CSystem.IFormatProvider%29?displayProperty=nameWithType> ，則會成功還原持續性的日期和時間資料，如下列輸出所示：</span><span class="sxs-lookup"><span data-stu-id="33184-143">However, if you replace the <xref:System.Globalization.CultureInfo.CurrentCulture%2A?displayProperty=nameWithType> property with <xref:System.Globalization.CultureInfo.InvariantCulture%2A?displayProperty=nameWithType> in the calls to <xref:System.DateTime.ToString%28System.String%2CSystem.IFormatProvider%29?displayProperty=nameWithType> and <xref:System.DateTime.Parse%28System.String%2CSystem.IFormatProvider%29?displayProperty=nameWithType>, the persisted date and time data is successfully restored, as the following output shows:</span></span>

```console
06.05.1758 21:26
05.05.1818 07:19
22.04.1870 23:54
08.09.1890 06:47
18.02.1905 15:12
```
