---
title: 引發的集合
ms.date: 03/30/2017
helpviewer_keywords:
- garbage collection, forced
ms.assetid: 019008fe-4708-4e65-bebf-04fd9941e149
ms.openlocfilehash: 637ba9b3b73d685ee2263315a08f982d862efb35
ms.sourcegitcommit: 965a5af7918acb0a3fd3baf342e15d511ef75188
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/18/2020
ms.locfileid: "94827720"
---
# <a name="induced-collections"></a><span data-ttu-id="cd2b5-102">引發的集合</span><span class="sxs-lookup"><span data-stu-id="cd2b5-102">Induced Collections</span></span>
<span data-ttu-id="cd2b5-103">大部分情況下，記憶體回收行程會判斷執行回收的最佳時間，請讓記憶體回收行程獨立執行。</span><span class="sxs-lookup"><span data-stu-id="cd2b5-103">In most cases, the garbage collector can determine the best time to perform a collection, and you should let it run independently.</span></span> <span data-ttu-id="cd2b5-104">在罕見的情況下，強制回收可能會改善您應用程式的效能。</span><span class="sxs-lookup"><span data-stu-id="cd2b5-104">There are rare situations when a forced collection might improve your application's performance.</span></span> <span data-ttu-id="cd2b5-105">在這些情況下，您可以使用 <xref:System.GC.Collect%2A?displayProperty=nameWithType> 方法強制進行記憶體回收，來引發記憶體回收。</span><span class="sxs-lookup"><span data-stu-id="cd2b5-105">In these cases, you can induce garbage collection by using the <xref:System.GC.Collect%2A?displayProperty=nameWithType> method to force a garbage collection.</span></span>  
  
 <span data-ttu-id="cd2b5-106">在應用程式碼特定位置所使用的記憶體數量大幅下降時，請使用 <xref:System.GC.Collect%2A?displayProperty=nameWithType> 方法。</span><span class="sxs-lookup"><span data-stu-id="cd2b5-106">Use the <xref:System.GC.Collect%2A?displayProperty=nameWithType> method when there is a significant reduction in the amount of memory being used at a specific point in your application's code.</span></span> <span data-ttu-id="cd2b5-107">例如，如果您的應用程式使用具有數個控制項的複雜對話方塊，則在關閉對話方塊時呼叫 <xref:System.GC.Collect%2A> 可透過立即回收對話方塊所使用的記憶體來改善效能。</span><span class="sxs-lookup"><span data-stu-id="cd2b5-107">For example, if your application uses a complex dialog box that has several controls, calling <xref:System.GC.Collect%2A> when the dialog box is closed could improve performance by immediately reclaiming the memory used by the dialog box.</span></span> <span data-ttu-id="cd2b5-108">請確定您的應用程式沒有太頻繁地進行記憶體回收，原因是如果記憶體回收行程嘗試在非最佳時間回收物件，則這樣可能會降低效能。</span><span class="sxs-lookup"><span data-stu-id="cd2b5-108">Be sure that your application is not inducing garbage collection too frequently, because that can decrease performance if the garbage collector is trying to reclaim objects at non-optimal times.</span></span> <span data-ttu-id="cd2b5-109">您可以將 <xref:System.GCCollectionMode.Optimized?displayProperty=nameWithType> 列舉值提供給 <xref:System.GC.Collect%2A> 方法，只在回收具備生產力時才進行回收 (如下節所討論)。</span><span class="sxs-lookup"><span data-stu-id="cd2b5-109">You can supply a <xref:System.GCCollectionMode.Optimized?displayProperty=nameWithType> enumeration value to the <xref:System.GC.Collect%2A> method to collect only when collection would be productive, as discussed in the next section.</span></span>  
  
## <a name="gc-collection-mode"></a><span data-ttu-id="cd2b5-110">GC 收集模式</span><span class="sxs-lookup"><span data-stu-id="cd2b5-110">GC collection mode</span></span>  
 <span data-ttu-id="cd2b5-111">您可以使用其中一個 <xref:System.GC.Collect%2A?displayProperty=nameWithType> 方法多載，其包含 <xref:System.GCCollectionMode> 值來指定強制回收行為，如下所示。</span><span class="sxs-lookup"><span data-stu-id="cd2b5-111">You can use one of the <xref:System.GC.Collect%2A?displayProperty=nameWithType> method overloads that includes a <xref:System.GCCollectionMode> value to specify the behavior for a forced collection as follows.</span></span>  
  
|<span data-ttu-id="cd2b5-112">`GCCollectionMode` 值</span><span class="sxs-lookup"><span data-stu-id="cd2b5-112">`GCCollectionMode` value</span></span>|<span data-ttu-id="cd2b5-113">描述</span><span class="sxs-lookup"><span data-stu-id="cd2b5-113">Description</span></span>|  
|------------------------------|-----------------|  
|<xref:System.GCCollectionMode.Default>|<span data-ttu-id="cd2b5-114">使用 .NET 執行版本的預設記憶體回收設定。</span><span class="sxs-lookup"><span data-stu-id="cd2b5-114">Uses the default garbage collection setting for the running version of .NET.</span></span>|  
|<xref:System.GCCollectionMode.Forced>|<span data-ttu-id="cd2b5-115">強制立即進行記憶體回收。</span><span class="sxs-lookup"><span data-stu-id="cd2b5-115">Forces garbage collection to occur immediately.</span></span> <span data-ttu-id="cd2b5-116">這等於呼叫 <xref:System.GC.Collect?displayProperty=nameWithType> 多載。</span><span class="sxs-lookup"><span data-stu-id="cd2b5-116">This is equivalent to calling the <xref:System.GC.Collect?displayProperty=nameWithType> overload.</span></span> <span data-ttu-id="cd2b5-117">它會導致完整封鎖回收所有層代。</span><span class="sxs-lookup"><span data-stu-id="cd2b5-117">It results in a full blocking collection of all generations.</span></span><br /><br /> <span data-ttu-id="cd2b5-118">您也可以在強制執行立即的完整區塊記憶體回收之前，透過將 <xref:System.Runtime.GCSettings.LargeObjectHeapCompactionMode%2A?displayProperty=nameWithType> 屬性設定為 <xref:System.Runtime.GCLargeObjectHeapCompactionMode.CompactOnce?displayProperty=nameWithType> 來壓縮大型物件。</span><span class="sxs-lookup"><span data-stu-id="cd2b5-118">You can also compact the large object heap by setting the <xref:System.Runtime.GCSettings.LargeObjectHeapCompactionMode%2A?displayProperty=nameWithType> property to <xref:System.Runtime.GCLargeObjectHeapCompactionMode.CompactOnce?displayProperty=nameWithType> before forcing an immediate full blocking garbage collection.</span></span>|  
|<xref:System.GCCollectionMode.Optimized>|<span data-ttu-id="cd2b5-119">可讓記憶體回收行程判斷目前時間是否最適合回收物件。</span><span class="sxs-lookup"><span data-stu-id="cd2b5-119">Enables the garbage collector to determine whether the current time is optimal to reclaim objects.</span></span><br /><br /> <span data-ttu-id="cd2b5-120">記憶體回收行程可能會判斷回收的生產力不足無法進行調整，在此情況下會返回，而不是回收物件。</span><span class="sxs-lookup"><span data-stu-id="cd2b5-120">The garbage collector could determine that a collection would not be productive enough to be justified, in which case it will return without reclaiming objects.</span></span>|  
  
## <a name="background-or-blocking-collections"></a><span data-ttu-id="cd2b5-121">背景或封鎖回收</span><span class="sxs-lookup"><span data-stu-id="cd2b5-121">Background or blocking collections</span></span>  
 <span data-ttu-id="cd2b5-122">您可以呼叫 <xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29?displayProperty=nameWithType> 方法多載，來指定是否封鎖引發的回收。</span><span class="sxs-lookup"><span data-stu-id="cd2b5-122">You can call the <xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29?displayProperty=nameWithType> method overload to specify whether an induced collection is blocking or not.</span></span> <span data-ttu-id="cd2b5-123">執行的回收類型取決於方法的 `mode` 與 `blocking` 參數組合。</span><span class="sxs-lookup"><span data-stu-id="cd2b5-123">The type of collection performed depends on a combination of the method's `mode` and `blocking` parameters.</span></span> <span data-ttu-id="cd2b5-124">`mode` 不是 <xref:System.GCCollectionMode> 列舉的成員，且 `blocking` 為 <xref:System.Boolean> 值。</span><span class="sxs-lookup"><span data-stu-id="cd2b5-124">`mode` is a member of the <xref:System.GCCollectionMode> enumeration, and `blocking` is a <xref:System.Boolean> value.</span></span> <span data-ttu-id="cd2b5-125">下表摘要說明 `mode` 和 `blocking` 引數的互動。</span><span class="sxs-lookup"><span data-stu-id="cd2b5-125">The following table summarizes the interaction of the `mode` and `blocking` arguments.</span></span>  
  
|`mode`|`blocking` = `true`|`blocking` = `false`|  
|------------|--------------------------|---------------------------|  
|<span data-ttu-id="cd2b5-126"><xref:System.GCCollectionMode.Forced> 或 <xref:System.GCCollectionMode.Default></span><span class="sxs-lookup"><span data-stu-id="cd2b5-126"><xref:System.GCCollectionMode.Forced> or <xref:System.GCCollectionMode.Default></span></span>|<span data-ttu-id="cd2b5-127">會盡快執行封鎖回收。</span><span class="sxs-lookup"><span data-stu-id="cd2b5-127">A blocking collection is performed as soon as possible.</span></span> <span data-ttu-id="cd2b5-128">如果正在進行背景回收，而且層代是 0 或 1，則 <xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29> 方法會立即觸發封鎖回收，並在回收完成時返回。</span><span class="sxs-lookup"><span data-stu-id="cd2b5-128">If a background collection is in progress and generation is 0 or 1, the <xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29> method immediately triggers a blocking collection and returns when the collection is finished.</span></span> <span data-ttu-id="cd2b5-129">如果正在進行背景回收，而且 `generation` 參數是 2，則方法會等到背景回收完成，並觸發封鎖層代 2 回收，然後返回。</span><span class="sxs-lookup"><span data-stu-id="cd2b5-129">If a background collection is in progress and the `generation` parameter is 2, the method waits until the background collection is finished, triggers a blocking generation 2 collection, and then returns.</span></span>|<span data-ttu-id="cd2b5-130">會盡快執行回收。</span><span class="sxs-lookup"><span data-stu-id="cd2b5-130">A collection is performed as soon as possible.</span></span> <span data-ttu-id="cd2b5-131"><xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29> 方法會要求背景集合，但不保證可取得。視情況而定，可能仍會執行封鎖集合。</span><span class="sxs-lookup"><span data-stu-id="cd2b5-131">The <xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29> method requests a background collection, but this is not guaranteed; depending on the circumstances, a blocking collection may still be performed.</span></span> <span data-ttu-id="cd2b5-132">如果已在進行背景回收，則這個方法會立即返回。</span><span class="sxs-lookup"><span data-stu-id="cd2b5-132">If a background collection is already in progress, the method returns immediately.</span></span>|  
|<xref:System.GCCollectionMode.Optimized>|<span data-ttu-id="cd2b5-133">可能會因記憶體回收行程和 `generation` 參數的狀態而執行封鎖集合。</span><span class="sxs-lookup"><span data-stu-id="cd2b5-133">A blocking collection may be performed, depending on the state of the garbage collector and the `generation` parameter.</span></span> <span data-ttu-id="cd2b5-134">記憶體回收行程會嘗試提供最佳效能。</span><span class="sxs-lookup"><span data-stu-id="cd2b5-134">The garbage collector tries to provide optimal performance.</span></span>|<span data-ttu-id="cd2b5-135">根據記憶體回收行程的狀態，可能會執行回收。</span><span class="sxs-lookup"><span data-stu-id="cd2b5-135">A collection may be performed, depending on the state of the garbage collector.</span></span> <span data-ttu-id="cd2b5-136"><xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29> 方法會要求背景集合，但不保證可取得。視情況而定，可能仍會執行封鎖集合。</span><span class="sxs-lookup"><span data-stu-id="cd2b5-136">The <xref:System.GC.Collect%28System.Int32%2CSystem.GCCollectionMode%2CSystem.Boolean%29> method requests a background collection, but this is not guaranteed; depending on the circumstances, a blocking collection may still be performed.</span></span> <span data-ttu-id="cd2b5-137">記憶體回收行程會嘗試提供最佳效能。</span><span class="sxs-lookup"><span data-stu-id="cd2b5-137">The garbage collector tries to provide optimal performance.</span></span> <span data-ttu-id="cd2b5-138">如果已在進行背景回收，則這個方法會立即返回。</span><span class="sxs-lookup"><span data-stu-id="cd2b5-138">If a background collection is already in progress, the method returns immediately.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="cd2b5-139">請參閱</span><span class="sxs-lookup"><span data-stu-id="cd2b5-139">See also</span></span>

- [<span data-ttu-id="cd2b5-140">延遲模式</span><span class="sxs-lookup"><span data-stu-id="cd2b5-140">Latency Modes</span></span>](latency.md)
- [<span data-ttu-id="cd2b5-141">記憶體回收</span><span class="sxs-lookup"><span data-stu-id="cd2b5-141">Garbage Collection</span></span>](index.md)
