---
title: .NET Portability Analyzer - .NET
description: 了解如何使用.NET Portability Analyzer 工具來評估程式碼移植到不同 .NET 實作之間的可行性，包括 .NET Core、.NET Standard、UWP 和 Xamarin。
ms.date: 09/13/2019
ms.technology: dotnet-standard
ms.assetid: 0375250f-5704-4993-a6d5-e21c499cea1e
ms.openlocfilehash: 7fe5aafe1ad8bf87883ebe27f2aa4fb102a01e45
ms.sourcegitcommit: da21fc5a8cce1e028575acf31974681a1bc5aeed
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/08/2020
ms.locfileid: "84501792"
---
# <a name="the-net-portability-analyzer"></a><span data-ttu-id="e02ef-103">.NET Portability Analyzer</span><span class="sxs-lookup"><span data-stu-id="e02ef-103">The .NET Portability Analyzer</span></span>

<span data-ttu-id="e02ef-104">要讓您的程式庫支援多平台？</span><span class="sxs-lookup"><span data-stu-id="e02ef-104">Want to make your libraries support multi-platform?</span></span> <span data-ttu-id="e02ef-105">想要查看需要多少工作才能讓您的 .NET Framework 應用程式在 .NET Core 上執行？</span><span class="sxs-lookup"><span data-stu-id="e02ef-105">Want to see how much work is required to make your .NET Framework application run on .NET Core?</span></span> <span data-ttu-id="e02ef-106">[.Net 可攜性分析器](https://github.com/microsoft/dotnet-apiport)是一種工具，可分析元件，並提供有關 .net api 的詳細報表，這些應用程式或程式庫在您指定的目標 .net 平臺上是可移植的。</span><span class="sxs-lookup"><span data-stu-id="e02ef-106">The [.NET Portability Analyzer](https://github.com/microsoft/dotnet-apiport) is a tool that analyzes assemblies and provides a detailed report on .NET APIs that are missing for the applications or libraries to be portable on your specified targeted .NET platforms.</span></span> <span data-ttu-id="e02ef-107">可攜性分析器以[Visual Studio 延伸](https://marketplace.visualstudio.com/items?itemName=ConnieYau.NETPortabilityAnalyzer)模組的形式提供，它會分析每個專案的一個元件，並作為[ApiPort 主控台應用程式](https://aka.ms/apiportdownload)，以根據指定的檔案或目錄來分析元件。</span><span class="sxs-lookup"><span data-stu-id="e02ef-107">The Portability Analyzer is offered as a [Visual Studio Extension](https://marketplace.visualstudio.com/items?itemName=ConnieYau.NETPortabilityAnalyzer), which analyzes one assembly per project, and as a [ApiPort console app](https://aka.ms/apiportdownload), which analyzes assemblies by specified files or directory.</span></span>

<span data-ttu-id="e02ef-108">當您將專案轉換成以新平臺（例如 .NET Core）為目標時，您可以使用以 Roslyn 為基礎的[Api 分析器工具](api-analyzer.md)來識別引發 <xref:System.PlatformNotSupportedException> 例外狀況和其他相容性問題的 api。</span><span class="sxs-lookup"><span data-stu-id="e02ef-108">Once you've converted your project to target the new platform, like .NET Core, you can use the Roslyn-based [API Analyzer tool](api-analyzer.md) to identify APIs throwing <xref:System.PlatformNotSupportedException> exceptions and other compatibility issues.</span></span>

## <a name="common-targets"></a><span data-ttu-id="e02ef-109">常見目標</span><span class="sxs-lookup"><span data-stu-id="e02ef-109">Common targets</span></span>

- <span data-ttu-id="e02ef-110">[.Net Core](../../core/index.yml)：具有模組化的設計，支援並存安裝，並以跨平臺案例為目標。</span><span class="sxs-lookup"><span data-stu-id="e02ef-110">[.NET Core](../../core/index.yml): Has a modular design, supports side-by-side installation, and targets cross-platform scenarios.</span></span> <span data-ttu-id="e02ef-111">並存安裝可讓您採用新的 .NET Core 版本，而不會中斷其他應用程式。</span><span class="sxs-lookup"><span data-stu-id="e02ef-111">Side-by-side installation allows you to adopt new .NET Core versions without breaking other apps.</span></span> <span data-ttu-id="e02ef-112">如果您的目標是要將您的應用程式移植到 .NET Core 並支援多個平臺，這是建議的目標。</span><span class="sxs-lookup"><span data-stu-id="e02ef-112">If your goal is to port your app to .NET Core and support multiple platforms, this is the recommended target.</span></span>
- <span data-ttu-id="e02ef-113">.[NET Standard](../net-standard.md)：包含適用于所有 .net 部署的 .NET Standard api。</span><span class="sxs-lookup"><span data-stu-id="e02ef-113">.[NET Standard](../net-standard.md): Includes the .NET Standard APIs available on all .NET implementations.</span></span> <span data-ttu-id="e02ef-114">如果您的目標是要讓您的程式庫在所有 .NET 支援的平臺上執行，建議使用目標。</span><span class="sxs-lookup"><span data-stu-id="e02ef-114">If your goal is to make your library run on all .NET supported platforms, this is recommended target.</span></span>
- <span data-ttu-id="e02ef-115">[ASP.NET Core](/aspnet/core)：以 .Net Core 為基礎的新式 web 架構。</span><span class="sxs-lookup"><span data-stu-id="e02ef-115">[ASP.NET Core](/aspnet/core): A modern web-framework built on .NET Core.</span></span> <span data-ttu-id="e02ef-116">如果您的目標，是要將 Web 應用程式移植到 .NET Core 來支援多平台，這是建議的目標。</span><span class="sxs-lookup"><span data-stu-id="e02ef-116">If your goal is to port your web app to .NET Core to support multiple platforms, this is the recommended target.</span></span>
- <span data-ttu-id="e02ef-117">.NET Core +[平臺延伸](../../core/porting/windows-compat-pack.md)模組：除了 Windows 相容性套件以外，還包含 .Net core api，提供許多可用的 .NET Framework 技術。</span><span class="sxs-lookup"><span data-stu-id="e02ef-117">.NET Core + [Platform Extensions](../../core/porting/windows-compat-pack.md): Includes the .NET Core APIs in addition to the Windows Compatibility Pack, which provides many of the .NET Framework available technologies.</span></span> <span data-ttu-id="e02ef-118">如需將您的應用程式從 .NET Framework 移植到 Windows 上的 .NET Core，這是建議的目標。</span><span class="sxs-lookup"><span data-stu-id="e02ef-118">This is a recommended target for porting your app from .NET Framework to .NET Core on Windows.</span></span>
- <span data-ttu-id="e02ef-119">.NET Standard +[平臺擴充](../../core/porting/windows-compat-pack.md)功能：除了 Windows 相容性套件以外，還包括 .NET Standard api，其提供許多 .NET Framework 可用的技術。</span><span class="sxs-lookup"><span data-stu-id="e02ef-119">.NET Standard + [Platform Extensions](../../core/porting/windows-compat-pack.md): Includes the .NET Standard APIs in addition to the Windows Compatibility Pack, which provides many of the .NET Framework available technologies.</span></span> <span data-ttu-id="e02ef-120">如需將您的程式庫從 .NET Framework 移植到 Windows 上的 .NET Core，這是建議的目標。</span><span class="sxs-lookup"><span data-stu-id="e02ef-120">This is a recommended target for porting your library from .NET Framework to .NET Core on Windows.</span></span>

## <a name="how-to-use-the-net-portability-analyzer"></a><span data-ttu-id="e02ef-121">如何使用 .NET 可攜性分析器</span><span class="sxs-lookup"><span data-stu-id="e02ef-121">How to use the .NET Portability Analyzer</span></span>

<span data-ttu-id="e02ef-122">若要開始在 Visual Studio 中使用 .NET 可攜性分析器，您必須從 [Visual Studio Marketplace](https://marketplace.visualstudio.com/items?itemName=ConnieYau.NETPortabilityAnalyzer) 下載及安裝此延伸模組。</span><span class="sxs-lookup"><span data-stu-id="e02ef-122">To begin using the .NET Portability Analyzer in Visual Studio, you first need to download and install the extension from the [Visual Studio Marketplace](https://marketplace.visualstudio.com/items?itemName=ConnieYau.NETPortabilityAnalyzer).</span></span> <span data-ttu-id="e02ef-123">它適用於 Visual Studio 2017 和更新版本。</span><span class="sxs-lookup"><span data-stu-id="e02ef-123">It works on Visual Studio 2017 and later versions.</span></span> <span data-ttu-id="e02ef-124">在 Visual Studio 透過分析可**Analyze**  >  **移植性分析器設定**來進行設定，並選取您的目標平臺，這是您想要評估與目前元件建立所在平臺/版本相比較的可攜性差距的 .net 平臺/版本。</span><span class="sxs-lookup"><span data-stu-id="e02ef-124">Configure it in Visual Studio via **Analyze** > **Portability Analyzer Settings** and select your Target Platforms, which are the .NET platforms/versions that you want to evaluate the portability gaps comparing with the platform/version that your current assembly is built with.</span></span>

![可攜性分析器的螢幕擷取畫面。](./media/portability-analyzer/portability-screenshot.png)

<span data-ttu-id="e02ef-126">您也可以使用 ApiPort 主控台應用程式，可從 [ApiPort 存放庫](https://aka.ms/apiportdownload)下載。</span><span class="sxs-lookup"><span data-stu-id="e02ef-126">You can also use the ApiPort console application, download it from [ApiPort repository](https://aka.ms/apiportdownload).</span></span> <span data-ttu-id="e02ef-127">您可以使用 `listTargets` 命令選項來顯示可用的目標清單，然後指定 `-t` 或 `--target` 命令選項來挑選目標平台。</span><span class="sxs-lookup"><span data-stu-id="e02ef-127">You can use `listTargets` command option to display the available target list, then pick target platforms by specifying `-t` or `--target` command option.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="e02ef-128">如果在執行此工具時沒有任何結果，則預設目標可能無法使用。</span><span class="sxs-lookup"><span data-stu-id="e02ef-128">If there are no results when running the tool, the default targets may not be available.</span></span> <span data-ttu-id="e02ef-129">如果您遇到這種情況，請務必新增明確的目標。</span><span class="sxs-lookup"><span data-stu-id="e02ef-129">If you encounter this, please ensure to add explicit targets.</span></span>

### <a name="solution-wide-view"></a><span data-ttu-id="e02ef-130">全解決方案的視圖</span><span class="sxs-lookup"><span data-stu-id="e02ef-130">Solution wide view</span></span>

<span data-ttu-id="e02ef-131">分析具有許多專案之方案的一個有用步驟，就是將相依性視覺化，以瞭解元件的哪個子集取決於什麼。</span><span class="sxs-lookup"><span data-stu-id="e02ef-131">A useful step in analyzing a solution with many projects would be to visualize the dependencies to understand which subset of assemblies depend on what.</span></span> <span data-ttu-id="e02ef-132">一般建議是從相依性圖形中的分葉節點開始，以自下而上的方法來套用分析的結果。</span><span class="sxs-lookup"><span data-stu-id="e02ef-132">The general recommendation is to apply the results of the analysis in a bottom-up approach starting with the leaf nodes in a dependency graph.</span></span>

<span data-ttu-id="e02ef-133">若要取得此內容，您可以執行下列命令：</span><span class="sxs-lookup"><span data-stu-id="e02ef-133">To retrieve this, you may run the following command:</span></span>

```
ApiPort.exe analyze -r DGML -f [directory or file]
```

<span data-ttu-id="e02ef-134">在 Visual Studio 中開啟時，其結果會如下所示：</span><span class="sxs-lookup"><span data-stu-id="e02ef-134">A result of this would look like the following when opened in Visual Studio:</span></span>

![DGML 分析的螢幕擷取畫面。](./media/portability-analyzer/dgml-example.png)

### <a name="analyze-portability"></a><span data-ttu-id="e02ef-136">分析可攜性</span><span class="sxs-lookup"><span data-stu-id="e02ef-136">Analyze portability</span></span>
<span data-ttu-id="e02ef-137">若要在 Visual Studio 中分析整個專案，在 [方案總管]\*\*\*\* 中以滑鼠右鍵按一下您的專案，然後選取 [分析組件可攜性]\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="e02ef-137">To analyze your entire project in Visual Studio, right-click on your project in **Solution Explorer** and select **Analyze Assembly Portability**.</span></span> <span data-ttu-id="e02ef-138">否則，請移至 [分析]\*\*\*\* 功能表，然後選取 [Analyze Assembly Portability] (分析組件可攜性)\*\*\*\*。</span><span class="sxs-lookup"><span data-stu-id="e02ef-138">Otherwise, go to the **Analyze** menu and select **Analyze Assembly Portability**.</span></span> <span data-ttu-id="e02ef-139">從該處選取您專案的可執行檔或 DLL。</span><span class="sxs-lookup"><span data-stu-id="e02ef-139">From there, select your project's executable or DLL.</span></span>

![方案總管的可攜性分析器螢幕擷取畫面。](./media/portability-analyzer/portability-solution-explorer.png)

<span data-ttu-id="e02ef-141">您也可以使用 [ApiPort 主控台應用程式](https://aka.ms/apiportdownload)。</span><span class="sxs-lookup"><span data-stu-id="e02ef-141">You can also use the [ApiPort console app](https://aka.ms/apiportdownload).</span></span>

- <span data-ttu-id="e02ef-142">輸入下列命令分析目前的目錄︰`ApiPort.exe analyze -f .`</span><span class="sxs-lookup"><span data-stu-id="e02ef-142">Type the following command to analyze the current directory: `ApiPort.exe analyze -f .`</span></span>
- <span data-ttu-id="e02ef-143">若要分析特定的 .dll 檔案清單，請輸入下列命令︰`ApiPort.exe analyze -f first.dll -f second.dll -f third.dll`</span><span class="sxs-lookup"><span data-stu-id="e02ef-143">To analyze a specific list of .dll files, type the following command: `ApiPort.exe analyze -f first.dll -f second.dll -f third.dll`</span></span>
- <span data-ttu-id="e02ef-144">執行 `ApiPort.exe -?` 以取得詳細說明</span><span class="sxs-lookup"><span data-stu-id="e02ef-144">Run `ApiPort.exe -?` to get more help</span></span>

<span data-ttu-id="e02ef-145">建議您納入所有您擁有並想要移植的相關 exe 與 dll 檔案，並排除應用程式所依賴，但您未擁有也無法移植的檔案。</span><span class="sxs-lookup"><span data-stu-id="e02ef-145">It is recommended that you include all the related exe and dll files that you own and want to port, and exclude the files that your app depends on, but you don't own and can't port.</span></span> <span data-ttu-id="e02ef-146">這會提供您最相關的可攜性報告。</span><span class="sxs-lookup"><span data-stu-id="e02ef-146">This will give you most relevant portability report.</span></span>

### <a name="view-and-interpret-portability-result"></a><span data-ttu-id="e02ef-147">檢視並解譯可攜性結果</span><span class="sxs-lookup"><span data-stu-id="e02ef-147">View and interpret portability result</span></span>

<span data-ttu-id="e02ef-148">只有目標平台不支援的 API 會顯示在報表中。</span><span class="sxs-lookup"><span data-stu-id="e02ef-148">Only APIs that are unsupported by a Target Platform appear in the report.</span></span>
<span data-ttu-id="e02ef-149">在 Visual Studio 執行分析之後，您會看到 .NET 可攜性報表檔案連結。</span><span class="sxs-lookup"><span data-stu-id="e02ef-149">After running the analysis in Visual Studio, you'll see your .NET Portability report file link pops up.</span></span> <span data-ttu-id="e02ef-150">如果您使用 [ApiPort 主控台應用程式](https://aka.ms/apiportdownload)，您的 .NET 可攜性報表會儲存為您指定格式的檔案。</span><span class="sxs-lookup"><span data-stu-id="e02ef-150">If you used the [ApiPort console app](https://aka.ms/apiportdownload), your .NET Portability report is saved as a file in the format you specified.</span></span> <span data-ttu-id="e02ef-151">預設會在您目前的目錄中儲存為 Excel 檔案 (*.xlsx*)。</span><span class="sxs-lookup"><span data-stu-id="e02ef-151">The default is in an Excel file (*.xlsx*) in your current directory.</span></span>

#### <a name="portability-summary"></a><span data-ttu-id="e02ef-152">可攜性摘要</span><span class="sxs-lookup"><span data-stu-id="e02ef-152">Portability Summary</span></span>

![可攜性摘要的螢幕擷取畫面。](./media/portability-analyzer/api-catalog-portablility-summary.png)

<span data-ttu-id="e02ef-154">此報表顯示的可攜性摘要區段，會顯示該次執行中每個組件的可攜性百分比。</span><span class="sxs-lookup"><span data-stu-id="e02ef-154">The Portability Summary section of the report shows the portability percentage for each assembly included in the run.</span></span> <span data-ttu-id="e02ef-155">在上述範例中，71.24% 用於 `svcutil` 應用程式中的 .NET Framework API 可在 .NET Core + 平台延伸模組中取得。</span><span class="sxs-lookup"><span data-stu-id="e02ef-155">In the previous example, 71.24% of the .NET Framework APIs used in the `svcutil` app are available in .NET Core + Platform Extensions.</span></span> <span data-ttu-id="e02ef-156">如果您對多個組件執行 .NET 可攜性分析工具，每個組件都應該在可攜性摘要報告中具有一個資料列。</span><span class="sxs-lookup"><span data-stu-id="e02ef-156">If you run the .NET Portability Analyzer tool against multiple assemblies, each assembly should have a row in the Portability Summary report.</span></span>

#### <a name="details"></a><span data-ttu-id="e02ef-157">詳細資料</span><span class="sxs-lookup"><span data-stu-id="e02ef-157">Details</span></span>

![可攜性詳細資料的螢幕擷取畫面。](./media/portability-analyzer/api-catalog-portablility-details.png)

<span data-ttu-id="e02ef-159">報表的 [**詳細資料**] 區段會列出任何選取的**目標平臺**中遺失的 api。</span><span class="sxs-lookup"><span data-stu-id="e02ef-159">The **Details** section of the report lists the APIs missing from any of the selected **Targeted Platforms**.</span></span>

- <span data-ttu-id="e02ef-160">目標類型：類型缺少目標平台的 API</span><span class="sxs-lookup"><span data-stu-id="e02ef-160">Target type: the type has missing API from a Target Platform</span></span>
- <span data-ttu-id="e02ef-161">目標成員：目標平台缺少方法</span><span class="sxs-lookup"><span data-stu-id="e02ef-161">Target member: the method is missing from a Target Platform</span></span>
- <span data-ttu-id="e02ef-162">組件名稱：缺少之 API 所在的 .NET Framework 組件。</span><span class="sxs-lookup"><span data-stu-id="e02ef-162">Assembly name: the .NET Framework assembly that the missing API lives in.</span></span>
- <span data-ttu-id="e02ef-163">每個選取的目標平臺都是一個資料行，例如「.NET Core」：「不支援」的值表示此目標平臺不支援此 API。</span><span class="sxs-lookup"><span data-stu-id="e02ef-163">Each of the selected Target Platforms is one column, such as ".NET Core": "Not supported" value means the API is not supported on this Target Platform.</span></span>
- <span data-ttu-id="e02ef-164">建議的變更：要變更為的建議 API 或技術。</span><span class="sxs-lookup"><span data-stu-id="e02ef-164">Recommended Changes: the recommended API or technology to change to.</span></span> <span data-ttu-id="e02ef-165">目前，許多 Api 的此欄位是空的或過期的。</span><span class="sxs-lookup"><span data-stu-id="e02ef-165">Currently, this field is empty or out of date for many APIs.</span></span> <span data-ttu-id="e02ef-166">由於有大量的 Api，我們有很大的挑戰讓它保持在最新狀態。</span><span class="sxs-lookup"><span data-stu-id="e02ef-166">Due to the large number of APIs, we have a significant challenge to keep it up to date.</span></span> <span data-ttu-id="e02ef-167">我們正在探討可提供實用資訊給客戶的替代解決方案。</span><span class="sxs-lookup"><span data-stu-id="e02ef-167">We're looking at alternative solutions to provide helpful information to customers.</span></span>

#### <a name="missing-assemblies"></a><span data-ttu-id="e02ef-168">缺少的組件</span><span class="sxs-lookup"><span data-stu-id="e02ef-168">Missing Assemblies</span></span>

![遺漏元件的螢幕擷取畫面。](./media/portability-analyzer/api-catalog-missing-assemblies.png)

<span data-ttu-id="e02ef-170">您可在報表中找到缺少的組件區段。</span><span class="sxs-lookup"><span data-stu-id="e02ef-170">You may find a Missing Assemblies section in your report.</span></span> <span data-ttu-id="e02ef-171">此區段包含已分析元件所參考且未分析之元件的清單。</span><span class="sxs-lookup"><span data-stu-id="e02ef-171">This section contains a list of assemblies that are referenced by your analyzed assemblies and were not analyzed.</span></span> <span data-ttu-id="e02ef-172">如果它是您擁有的元件，請將它包含在 API 可攜性分析器執行中，以便您可以取得詳細的 API 層級的可攜性報告。</span><span class="sxs-lookup"><span data-stu-id="e02ef-172">If it's an assembly that you own, include it in the API portability analyzer run so that you can get a detailed, API-level portability report for it.</span></span> <span data-ttu-id="e02ef-173">如果是協力廠商程式庫，請檢查是否有支援目標平臺的較新版本，並考慮移至較新的版本。</span><span class="sxs-lookup"><span data-stu-id="e02ef-173">If it's a third-party library, check if there is a newer version that supports your target platform, and consider moving to the newer version.</span></span> <span data-ttu-id="e02ef-174">最後，此清單應該包含您的應用程式所相依的所有協力廠商元件，其版本支援您的目標平臺。</span><span class="sxs-lookup"><span data-stu-id="e02ef-174">Eventually, the list should include all the third-party assemblies that your app depends on that have a version supporting your target platform.</span></span>

<span data-ttu-id="e02ef-175">如需 .NET Portability Analyzer 的詳細資訊，請瀏覽 [GitHub 文件](https://github.com/Microsoft/dotnet-apiport#documentation)和 Channel 9 影片 [Brief Look at the .NET Portability Analyzer](https://channel9.msdn.com/Blogs/Seth-Juarez/A-Brief-Look-at-the-NET-Portability-Analyzer) (.NET Portability Analyzer 簡介)。</span><span class="sxs-lookup"><span data-stu-id="e02ef-175">For more information on the .NET Portability Analyzer, visit the [GitHub documentation](https://github.com/Microsoft/dotnet-apiport#documentation) and [A Brief Look at the .NET Portability Analyzer](https://channel9.msdn.com/Blogs/Seth-Juarez/A-Brief-Look-at-the-NET-Portability-Analyzer) Channel 9 video.</span></span>
