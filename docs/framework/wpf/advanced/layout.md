---
title: 版面配置
description: 瞭解版面配置計算在 Windows Presentation Foundation 版面配置系統中的發生方式和時機。
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WPF layout system [WPF]
- controls [WPF], layout system
- layout system [WPF]
ms.assetid: 3eecdced-3623-403a-a077-7595453a9221
ms.openlocfilehash: 0db3f2a6cbabc610362435d64de3fc970f01a73c
ms.sourcegitcommit: 87cfeb69226fef01acb17c56c86f978f4f4a13db
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/24/2020
ms.locfileid: "87164772"
---
# <a name="layout"></a><span data-ttu-id="55407-103">版面配置</span><span class="sxs-lookup"><span data-stu-id="55407-103">Layout</span></span>

<span data-ttu-id="55407-104">本主題描述 Windows Presentation Foundation （WPF）版面配置系統。</span><span class="sxs-lookup"><span data-stu-id="55407-104">This topic describes the Windows Presentation Foundation (WPF) layout system.</span></span> <span data-ttu-id="55407-105">瞭解版面配置計算的發生方式和時機，是在 WPF 中建立使用者介面的必要條件。</span><span class="sxs-lookup"><span data-stu-id="55407-105">Understanding how and when layout calculations occur is essential for creating user interfaces in WPF.</span></span>

<span data-ttu-id="55407-106">本主題包含下列幾節：</span><span class="sxs-lookup"><span data-stu-id="55407-106">This topic contains the following sections:</span></span>

- [<span data-ttu-id="55407-107">項目週框方塊</span><span class="sxs-lookup"><span data-stu-id="55407-107">Element Bounding Boxes</span></span>](#LayoutSystem_BoundingBox)

- [<span data-ttu-id="55407-108">配置系統</span><span class="sxs-lookup"><span data-stu-id="55407-108">The Layout System</span></span>](#LayoutSystem_Overview)

- [<span data-ttu-id="55407-109">測量和排列子系</span><span class="sxs-lookup"><span data-stu-id="55407-109">Measuring and Arranging Children</span></span>](#LayoutSystem_Measure_Arrange)

- [<span data-ttu-id="55407-110">面板項目和自訂版面配置行為</span><span class="sxs-lookup"><span data-stu-id="55407-110">Panel Elements and Custom Layout Behaviors</span></span>](#LayoutSystem_PanelsCustom)

- [<span data-ttu-id="55407-111">版面配置效能考量</span><span class="sxs-lookup"><span data-stu-id="55407-111">Layout Performance Considerations</span></span>](#LayoutSystem_Performance)

- [<span data-ttu-id="55407-112">子像素轉譯和版面配置進位</span><span class="sxs-lookup"><span data-stu-id="55407-112">Sub-pixel Rendering and Layout Rounding</span></span>](#LayoutSystem_LayoutRounding)

- [<span data-ttu-id="55407-113">下一步</span><span class="sxs-lookup"><span data-stu-id="55407-113">What's Next</span></span>](#LayoutSystem_whatsnext)

<a name="LayoutSystem_BoundingBox"></a>

## <a name="element-bounding-boxes"></a><span data-ttu-id="55407-114">項目週框方塊</span><span class="sxs-lookup"><span data-stu-id="55407-114">Element Bounding Boxes</span></span>

<span data-ttu-id="55407-115">考慮 WPF 中的版面配置時，請務必瞭解環繞所有元素的周框方塊。</span><span class="sxs-lookup"><span data-stu-id="55407-115">When thinking about layout in WPF, it is important to understand the bounding box that surrounds all elements.</span></span> <span data-ttu-id="55407-116">配置系統所取用的每一個都 <xref:System.Windows.FrameworkElement> 可以被視為一個矩形，做為版面配置的一周框。</span><span class="sxs-lookup"><span data-stu-id="55407-116">Each <xref:System.Windows.FrameworkElement> consumed by the layout system can be thought of as a rectangle that is slotted into the layout.</span></span> <span data-ttu-id="55407-117">類別會傳回 <xref:System.Windows.Controls.Primitives.LayoutInformation> 元素的版面配置分配或位置的界限。</span><span class="sxs-lookup"><span data-stu-id="55407-117">The <xref:System.Windows.Controls.Primitives.LayoutInformation> class returns the boundaries of an element's layout allocation, or slot.</span></span> <span data-ttu-id="55407-118">矩形的大小取決於計算可用的螢幕空間、任何條件約束的大小、版面配置特有的屬性（例如邊界和填補），以及父元素的個別行為 <xref:System.Windows.Controls.Panel> 。</span><span class="sxs-lookup"><span data-stu-id="55407-118">The size of the rectangle is determined by calculating the available screen space, the size of any constraints, layout-specific properties (such as margin and padding), and the individual behavior of the parent <xref:System.Windows.Controls.Panel> element.</span></span> <span data-ttu-id="55407-119">處理此資料時，配置系統能夠計算特定的所有子系的位置 <xref:System.Windows.Controls.Panel> 。</span><span class="sxs-lookup"><span data-stu-id="55407-119">Processing this data, the layout system is able to calculate the position of all the children of a particular <xref:System.Windows.Controls.Panel>.</span></span> <span data-ttu-id="55407-120">請務必記住，父元素上定義的調整大小特性（例如 <xref:System.Windows.Controls.Border> ）會影響其子系。</span><span class="sxs-lookup"><span data-stu-id="55407-120">It is important to remember that sizing characteristics defined on the parent element, such as a <xref:System.Windows.Controls.Border>, affect its children.</span></span>

<span data-ttu-id="55407-121">下圖顯示簡單的版面配置。</span><span class="sxs-lookup"><span data-stu-id="55407-121">The following illustration shows a simple layout.</span></span>

![顯示一般方格的螢幕擷取畫面，沒有迭迭的周框方塊。](./media/layout/grid-no-bounding-box-superimpose.png)

<span data-ttu-id="55407-123">使用下列 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 可達成這個版面配置。</span><span class="sxs-lookup"><span data-stu-id="55407-123">This layout can be achieved by using the following [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)].</span></span>

[!code-xaml[LayoutInformation#1](~/samples/snippets/csharp/VS_Snippets_Wpf/LayoutInformation/CSharp/Window1.xaml#1)]

<span data-ttu-id="55407-124">單一 <xref:System.Windows.Controls.TextBlock> 元素裝載于內 <xref:System.Windows.Controls.Grid> 。</span><span class="sxs-lookup"><span data-stu-id="55407-124">A single <xref:System.Windows.Controls.TextBlock> element is hosted within a <xref:System.Windows.Controls.Grid>.</span></span> <span data-ttu-id="55407-125">當文字只填滿第一個資料行的左上角時，為配置的空間 <xref:System.Windows.Controls.TextBlock> 其實會大得多。</span><span class="sxs-lookup"><span data-stu-id="55407-125">While the text fills only the upper-left corner of the first column, the allocated space for the <xref:System.Windows.Controls.TextBlock> is actually much larger.</span></span> <span data-ttu-id="55407-126">您可以使用方法來抓取任何的周框方塊 <xref:System.Windows.FrameworkElement> <xref:System.Windows.Controls.Primitives.LayoutInformation.GetLayoutSlot%2A> 。</span><span class="sxs-lookup"><span data-stu-id="55407-126">The bounding box of any <xref:System.Windows.FrameworkElement> can be retrieved by using the <xref:System.Windows.Controls.Primitives.LayoutInformation.GetLayoutSlot%2A> method.</span></span> <span data-ttu-id="55407-127">下圖顯示元素的周框方塊 <xref:System.Windows.Controls.TextBlock> 。</span><span class="sxs-lookup"><span data-stu-id="55407-127">The following illustration shows the bounding box for the <xref:System.Windows.Controls.TextBlock> element.</span></span>

![螢幕擷取畫面：顯示 [TextBlock 周框] 方塊現在是可見的。](./media/layout/visible-textblock-bounding-box.png)

<span data-ttu-id="55407-129">如黃色矩形所示，元素的已配置空間 <xref:System.Windows.Controls.TextBlock> 實際上遠大於顯示。</span><span class="sxs-lookup"><span data-stu-id="55407-129">As shown by the yellow rectangle, the allocated space for the <xref:System.Windows.Controls.TextBlock> element is actually much larger than it appears.</span></span> <span data-ttu-id="55407-130">當其他元素加入至時 <xref:System.Windows.Controls.Grid> ，此配置可能會縮小或展開，視新增的專案類型和大小而定。</span><span class="sxs-lookup"><span data-stu-id="55407-130">As additional elements are added to the <xref:System.Windows.Controls.Grid>, this allocation could shrink or expand, depending on the type and size of elements that are added.</span></span>

<span data-ttu-id="55407-131">的版面配置位置 <xref:System.Windows.Controls.TextBlock> 會使用方法轉譯成 <xref:System.Windows.Shapes.Path> <xref:System.Windows.Controls.Primitives.LayoutInformation.GetLayoutSlot%2A> 。</span><span class="sxs-lookup"><span data-stu-id="55407-131">The layout slot of the <xref:System.Windows.Controls.TextBlock> is translated into a <xref:System.Windows.Shapes.Path> by using the <xref:System.Windows.Controls.Primitives.LayoutInformation.GetLayoutSlot%2A> method.</span></span> <span data-ttu-id="55407-132">這種方式可用於顯示項目的週框方塊。</span><span class="sxs-lookup"><span data-stu-id="55407-132">This technique can be useful for displaying the bounding box of an element.</span></span>

[!code-csharp[LayoutInformation#2](~/samples/snippets/csharp/VS_Snippets_Wpf/LayoutInformation/CSharp/Window1.xaml.cs#2)]
[!code-vb[LayoutInformation#2](~/samples/snippets/visualbasic/VS_Snippets_Wpf/LayoutInformation/VisualBasic/Window1.xaml.vb#2)]

<a name="LayoutSystem_Overview"></a>

## <a name="the-layout-system"></a><span data-ttu-id="55407-133">配置系統</span><span class="sxs-lookup"><span data-stu-id="55407-133">The Layout System</span></span>

<span data-ttu-id="55407-134">簡單來說，版面配置是可調整項目大小、定位項目並在螢幕上繪製項目的遞迴系統。</span><span class="sxs-lookup"><span data-stu-id="55407-134">At its simplest, layout is a recursive system that leads to an element being sized, positioned, and drawn.</span></span> <span data-ttu-id="55407-135">更明確地說，版面配置會描述測量和排列專案集合成員的進程 <xref:System.Windows.Controls.Panel> <xref:System.Windows.Controls.Panel.Children%2A> 。</span><span class="sxs-lookup"><span data-stu-id="55407-135">More specifically, layout describes the process of measuring and arranging the members of a <xref:System.Windows.Controls.Panel> element's <xref:System.Windows.Controls.Panel.Children%2A> collection.</span></span> <span data-ttu-id="55407-136">版面配置是需要大量處理的程序。</span><span class="sxs-lookup"><span data-stu-id="55407-136">Layout is an intensive process.</span></span> <span data-ttu-id="55407-137"><xref:System.Windows.Controls.Panel.Children%2A>集合越大，必須進行的計算次數就愈大。</span><span class="sxs-lookup"><span data-stu-id="55407-137">The larger the <xref:System.Windows.Controls.Panel.Children%2A> collection, the greater the number of calculations that must be made.</span></span> <span data-ttu-id="55407-138">也可以根據擁有集合的元素所定義的版面配置行為來導入複雜性 <xref:System.Windows.Controls.Panel> 。</span><span class="sxs-lookup"><span data-stu-id="55407-138">Complexity can also be introduced based on the layout behavior defined by the <xref:System.Windows.Controls.Panel> element that owns the collection.</span></span> <span data-ttu-id="55407-139">相較于更複雜的效能（例如），相當簡單的（ <xref:System.Windows.Controls.Panel> 例如 <xref:System.Windows.Controls.Canvas> ）可能會明顯比更好 <xref:System.Windows.Controls.Panel> <xref:System.Windows.Controls.Grid> 。</span><span class="sxs-lookup"><span data-stu-id="55407-139">A relatively simple <xref:System.Windows.Controls.Panel>, such as <xref:System.Windows.Controls.Canvas>, can have significantly better performance than a more complex <xref:System.Windows.Controls.Panel>, such as <xref:System.Windows.Controls.Grid>.</span></span>

<span data-ttu-id="55407-140">每次子系 <xref:System.Windows.UIElement> 變更其位置時，就有可能會由配置系統觸發新的傳遞。</span><span class="sxs-lookup"><span data-stu-id="55407-140">Each time that a child <xref:System.Windows.UIElement> changes its position, it has the potential to trigger a new pass by the layout system.</span></span> <span data-ttu-id="55407-141">因此，請務必了解可叫用配置系統的事件，因為不必要的叫用可能會導致不良的應用程式效能。</span><span class="sxs-lookup"><span data-stu-id="55407-141">Therefore, it is important to understand the events that can invoke the layout system, as unnecessary invocation can lead to poor application performance.</span></span> <span data-ttu-id="55407-142">下列描述在叫用配置系統時所發生的程序。</span><span class="sxs-lookup"><span data-stu-id="55407-142">The following describes the process that occurs when the layout system is invoked.</span></span>

1. <span data-ttu-id="55407-143">子系會 <xref:System.Windows.UIElement> 先將其核心屬性測量，以開始配置處理常式。</span><span class="sxs-lookup"><span data-stu-id="55407-143">A child <xref:System.Windows.UIElement> begins the layout process by first having its core properties measured.</span></span>

2. <span data-ttu-id="55407-144">會評估定義于的大小調整屬性 <xref:System.Windows.FrameworkElement> ，例如 <xref:System.Windows.FrameworkElement.Width%2A> 、 <xref:System.Windows.FrameworkElement.Height%2A> 和 <xref:System.Windows.FrameworkElement.Margin%2A> 。</span><span class="sxs-lookup"><span data-stu-id="55407-144">Sizing properties defined on <xref:System.Windows.FrameworkElement> are evaluated, such as <xref:System.Windows.FrameworkElement.Width%2A>, <xref:System.Windows.FrameworkElement.Height%2A>, and <xref:System.Windows.FrameworkElement.Margin%2A>.</span></span>

3. <span data-ttu-id="55407-145"><xref:System.Windows.Controls.Panel>-會套用特定的邏輯，例如 <xref:System.Windows.Controls.Dock> 方向或堆疊 <xref:System.Windows.Controls.StackPanel.Orientation%2A> 。</span><span class="sxs-lookup"><span data-stu-id="55407-145"><xref:System.Windows.Controls.Panel>-specific logic is applied, such as <xref:System.Windows.Controls.Dock> direction or stacking <xref:System.Windows.Controls.StackPanel.Orientation%2A>.</span></span>

4. <span data-ttu-id="55407-146">測量所有子系之後，會排列內容。</span><span class="sxs-lookup"><span data-stu-id="55407-146">Content is arranged after all children have been measured.</span></span>

5. <span data-ttu-id="55407-147"><xref:System.Windows.Controls.Panel.Children%2A>集合會在螢幕上繪製。</span><span class="sxs-lookup"><span data-stu-id="55407-147">The <xref:System.Windows.Controls.Panel.Children%2A> collection is drawn on the screen.</span></span>

6. <span data-ttu-id="55407-148">如果將額外的 <xref:System.Windows.Controls.Panel.Children%2A> 新增至集合、套用 <xref:System.Windows.FrameworkElement.LayoutTransform%2A> ，或呼叫方法，則會再次叫用進程 <xref:System.Windows.UIElement.UpdateLayout%2A> 。</span><span class="sxs-lookup"><span data-stu-id="55407-148">The process is invoked again if additional <xref:System.Windows.Controls.Panel.Children%2A> are added to the collection, a <xref:System.Windows.FrameworkElement.LayoutTransform%2A> is applied, or the <xref:System.Windows.UIElement.UpdateLayout%2A> method is called.</span></span>

<span data-ttu-id="55407-149">下列各節會詳述定義此程序和其叫用方式。</span><span class="sxs-lookup"><span data-stu-id="55407-149">This process and how it is invoked are defined in more detail in the following sections.</span></span>

<a name="LayoutSystem_Measure_Arrange"></a>

## <a name="measuring-and-arranging-children"></a><span data-ttu-id="55407-150">測量和排列子系</span><span class="sxs-lookup"><span data-stu-id="55407-150">Measuring and Arranging Children</span></span>

<span data-ttu-id="55407-151">版面配置系統會針對集合的每個成員 <xref:System.Windows.Controls.Panel.Children%2A> 、量值傳遞和排列行程完成兩次傳遞。</span><span class="sxs-lookup"><span data-stu-id="55407-151">The layout system completes two passes for each member of the <xref:System.Windows.Controls.Panel.Children%2A> collection, a measure pass and an arrange pass.</span></span> <span data-ttu-id="55407-152">每個子系都提供自己的 <xref:System.Windows.Controls.Panel> <xref:System.Windows.FrameworkElement.MeasureOverride%2A> 和 <xref:System.Windows.FrameworkElement.ArrangeOverride%2A> 方法，以達成自己的特定版面配置行為。</span><span class="sxs-lookup"><span data-stu-id="55407-152">Each child <xref:System.Windows.Controls.Panel> provides its own <xref:System.Windows.FrameworkElement.MeasureOverride%2A> and <xref:System.Windows.FrameworkElement.ArrangeOverride%2A> methods to achieve its own specific layout behavior.</span></span>

<span data-ttu-id="55407-153">在量值傳遞期間，會評估集合的每個成員 <xref:System.Windows.Controls.Panel.Children%2A> 。</span><span class="sxs-lookup"><span data-stu-id="55407-153">During the measure pass, each member of the <xref:System.Windows.Controls.Panel.Children%2A> collection is evaluated.</span></span> <span data-ttu-id="55407-154">進程一開始會呼叫 <xref:System.Windows.UIElement.Measure%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="55407-154">The process begins with a call to the <xref:System.Windows.UIElement.Measure%2A> method.</span></span> <span data-ttu-id="55407-155">這個方法會在父元素的執行中呼叫 <xref:System.Windows.Controls.Panel> ，而且不需要明確呼叫，就能進行版面配置。</span><span class="sxs-lookup"><span data-stu-id="55407-155">This method is called within the implementation of the parent <xref:System.Windows.Controls.Panel> element, and does not have to be called explicitly for layout to occur.</span></span>

<span data-ttu-id="55407-156">首先，會評估的原生大小屬性 <xref:System.Windows.UIElement> ，例如 <xref:System.Windows.UIElement.Clip%2A> 和 <xref:System.Windows.UIElement.Visibility%2A> 。</span><span class="sxs-lookup"><span data-stu-id="55407-156">First, native size properties of the <xref:System.Windows.UIElement> are evaluated, such as <xref:System.Windows.UIElement.Clip%2A> and <xref:System.Windows.UIElement.Visibility%2A>.</span></span> <span data-ttu-id="55407-157">這會產生名為 `constraintSize` 的值，並將它傳遞給 <xref:System.Windows.FrameworkElement.MeasureCore%2A> 。</span><span class="sxs-lookup"><span data-stu-id="55407-157">This generates a value named `constraintSize` that is passed to <xref:System.Windows.FrameworkElement.MeasureCore%2A>.</span></span>

<span data-ttu-id="55407-158">其次，會處理定義于的 framework 屬性 <xref:System.Windows.FrameworkElement> ，這會影響的值 `constraintSize` 。</span><span class="sxs-lookup"><span data-stu-id="55407-158">Secondly, framework properties defined on <xref:System.Windows.FrameworkElement> are processed, which affects the value of `constraintSize`.</span></span> <span data-ttu-id="55407-159">這些屬性通常會描述基礎的調整大小特性 <xref:System.Windows.UIElement> ，例如它的 <xref:System.Windows.FrameworkElement.Height%2A> 、 <xref:System.Windows.FrameworkElement.Width%2A> 、 <xref:System.Windows.FrameworkElement.Margin%2A> 和 <xref:System.Windows.FrameworkElement.Style%2A> 。</span><span class="sxs-lookup"><span data-stu-id="55407-159">These properties generally describe the sizing characteristics of the underlying <xref:System.Windows.UIElement>, such as its <xref:System.Windows.FrameworkElement.Height%2A>, <xref:System.Windows.FrameworkElement.Width%2A>, <xref:System.Windows.FrameworkElement.Margin%2A>, and <xref:System.Windows.FrameworkElement.Style%2A>.</span></span> <span data-ttu-id="55407-160">所有這些屬性都可以變更顯示項目所需的空間。</span><span class="sxs-lookup"><span data-stu-id="55407-160">Each of these properties can change the space that is necessary to display the element.</span></span> <span data-ttu-id="55407-161"><xref:System.Windows.FrameworkElement.MeasureOverride%2A>接著會使用 `constraintSize` 做為參數來呼叫。</span><span class="sxs-lookup"><span data-stu-id="55407-161"><xref:System.Windows.FrameworkElement.MeasureOverride%2A> is then called with `constraintSize` as a parameter.</span></span>

> [!NOTE]
> <span data-ttu-id="55407-162">和的屬性和和之間的差異 <xref:System.Windows.FrameworkElement.Height%2A> <xref:System.Windows.FrameworkElement.Width%2A> <xref:System.Windows.FrameworkElement.ActualHeight%2A> <xref:System.Windows.FrameworkElement.ActualWidth%2A> 。</span><span class="sxs-lookup"><span data-stu-id="55407-162">There is a difference between the properties of <xref:System.Windows.FrameworkElement.Height%2A> and <xref:System.Windows.FrameworkElement.Width%2A> and <xref:System.Windows.FrameworkElement.ActualHeight%2A> and <xref:System.Windows.FrameworkElement.ActualWidth%2A>.</span></span> <span data-ttu-id="55407-163">例如， <xref:System.Windows.FrameworkElement.ActualHeight%2A> 屬性是以其他高度輸入和版面配置系統為基礎的計算值。</span><span class="sxs-lookup"><span data-stu-id="55407-163">For example, the <xref:System.Windows.FrameworkElement.ActualHeight%2A> property is a calculated value based on other height inputs and the layout system.</span></span> <span data-ttu-id="55407-164">根據實際的轉譯行程，此值是由配置系統本身設定，因此可能會稍微落後屬性的設定值（例如 <xref:System.Windows.FrameworkElement.Height%2A> ，這是輸入變更的基礎）。</span><span class="sxs-lookup"><span data-stu-id="55407-164">The value is set by the layout system itself, based on an actual rendering pass, and may therefore lag slightly behind the set value of properties, such as <xref:System.Windows.FrameworkElement.Height%2A>, that are the basis of the input change.</span></span>
>
> <span data-ttu-id="55407-165">因為 <xref:System.Windows.FrameworkElement.ActualHeight%2A> 是一個計算值，所以您應該注意，由於版面配置系統的各種作業，可能會有多個或累加的報告變更。</span><span class="sxs-lookup"><span data-stu-id="55407-165">Because <xref:System.Windows.FrameworkElement.ActualHeight%2A> is a calculated value, you should be aware that there could be multiple or incremental reported changes to it as a result of various operations by the layout system.</span></span> <span data-ttu-id="55407-166">配置系統可能會計算子項目所需的測量空間、父項目的條件約束，依此類推。</span><span class="sxs-lookup"><span data-stu-id="55407-166">The layout system may be calculating required measure space for child elements, constraints by the parent element, and so on.</span></span>

<span data-ttu-id="55407-167">量值傳遞的最終目標是讓子系判斷其 <xref:System.Windows.UIElement.DesiredSize%2A> ，這會在呼叫期間發生 <xref:System.Windows.FrameworkElement.MeasureCore%2A> 。</span><span class="sxs-lookup"><span data-stu-id="55407-167">The ultimate goal of the measure pass is for the child to determine its <xref:System.Windows.UIElement.DesiredSize%2A>, which occurs during the <xref:System.Windows.FrameworkElement.MeasureCore%2A> call.</span></span> <span data-ttu-id="55407-168"><xref:System.Windows.UIElement.DesiredSize%2A>值是由儲存， <xref:System.Windows.UIElement.Measure%2A> 以便在內容排列階段期間使用。</span><span class="sxs-lookup"><span data-stu-id="55407-168">The <xref:System.Windows.UIElement.DesiredSize%2A> value is stored by <xref:System.Windows.UIElement.Measure%2A> for use during the content arrange pass.</span></span>

<span data-ttu-id="55407-169">「排列」傳遞會從方法的呼叫開始 <xref:System.Windows.UIElement.Arrange%2A> 。</span><span class="sxs-lookup"><span data-stu-id="55407-169">The arrange pass begins with a call to the <xref:System.Windows.UIElement.Arrange%2A> method.</span></span> <span data-ttu-id="55407-170">在排列階段期間，父 <xref:System.Windows.Controls.Panel> 元素會產生代表子系界限的矩形。</span><span class="sxs-lookup"><span data-stu-id="55407-170">During the arrange pass, the parent <xref:System.Windows.Controls.Panel> element generates a rectangle that represents the bounds of the child.</span></span> <span data-ttu-id="55407-171">這個值會傳遞至 <xref:System.Windows.FrameworkElement.ArrangeCore%2A> 方法以進行處理。</span><span class="sxs-lookup"><span data-stu-id="55407-171">This value is passed to the <xref:System.Windows.FrameworkElement.ArrangeCore%2A> method for processing.</span></span>

<span data-ttu-id="55407-172"><xref:System.Windows.FrameworkElement.ArrangeCore%2A>方法會評估子系的， <xref:System.Windows.UIElement.DesiredSize%2A> 並評估可能影響元素轉譯大小的任何其他邊界。</span><span class="sxs-lookup"><span data-stu-id="55407-172">The <xref:System.Windows.FrameworkElement.ArrangeCore%2A> method evaluates the <xref:System.Windows.UIElement.DesiredSize%2A> of the child and evaluates any additional margins that may affect the rendered size of the element.</span></span> <span data-ttu-id="55407-173"><xref:System.Windows.FrameworkElement.ArrangeCore%2A>產生 `arrangeSize` ，其會傳遞至的 <xref:System.Windows.FrameworkElement.ArrangeOverride%2A> 方法 <xref:System.Windows.Controls.Panel> 做為參數。</span><span class="sxs-lookup"><span data-stu-id="55407-173"><xref:System.Windows.FrameworkElement.ArrangeCore%2A> generates an `arrangeSize`, which is passed to the <xref:System.Windows.FrameworkElement.ArrangeOverride%2A> method of the <xref:System.Windows.Controls.Panel> as a parameter.</span></span> <span data-ttu-id="55407-174"><xref:System.Windows.FrameworkElement.ArrangeOverride%2A>產生子系的 `finalSize` 。</span><span class="sxs-lookup"><span data-stu-id="55407-174"><xref:System.Windows.FrameworkElement.ArrangeOverride%2A> generates the `finalSize` of the child.</span></span> <span data-ttu-id="55407-175">最後， <xref:System.Windows.FrameworkElement.ArrangeCore%2A> 方法會對 offset 屬性進行最後的評估（例如邊界和對齊），並將子系放在其版面配置位置。</span><span class="sxs-lookup"><span data-stu-id="55407-175">Finally, the <xref:System.Windows.FrameworkElement.ArrangeCore%2A> method does a final evaluation of offset properties, such as margin and alignment, and puts the child within its layout slot.</span></span> <span data-ttu-id="55407-176">子系不需要 (通常也不會) 填入整個已配置的空間。</span><span class="sxs-lookup"><span data-stu-id="55407-176">The child does not have to (and frequently does not) fill the entire allocated space.</span></span> <span data-ttu-id="55407-177">控制項接著會傳回父代 <xref:System.Windows.Controls.Panel> ，而且版面配置程式已完成。</span><span class="sxs-lookup"><span data-stu-id="55407-177">Control is then returned to the parent <xref:System.Windows.Controls.Panel> and the layout process is complete.</span></span>

<a name="LayoutSystem_PanelsCustom"></a>

## <a name="panel-elements-and-custom-layout-behaviors"></a><span data-ttu-id="55407-178">面板項目和自訂版面配置行為</span><span class="sxs-lookup"><span data-stu-id="55407-178">Panel Elements and Custom Layout Behaviors</span></span>

<span data-ttu-id="55407-179">WPF 包含一個衍生自的元素群組 <xref:System.Windows.Controls.Panel> 。</span><span class="sxs-lookup"><span data-stu-id="55407-179">WPF includes a group of elements that derive from <xref:System.Windows.Controls.Panel>.</span></span> <span data-ttu-id="55407-180">這些 <xref:System.Windows.Controls.Panel> 元素可啟用許多複雜的版面配置。</span><span class="sxs-lookup"><span data-stu-id="55407-180">These <xref:System.Windows.Controls.Panel> elements enable many complex layouts.</span></span> <span data-ttu-id="55407-181">例如，您可以使用專案輕鬆地完成堆疊專案 <xref:System.Windows.Controls.StackPanel> ，而更複雜且可用的流動版面配置則是使用 <xref:System.Windows.Controls.Canvas> 。</span><span class="sxs-lookup"><span data-stu-id="55407-181">For example, stacking elements can easily be achieved by using the <xref:System.Windows.Controls.StackPanel> element, while more complex and free flowing layouts are possible by using a <xref:System.Windows.Controls.Canvas>.</span></span>

<span data-ttu-id="55407-182">下表摘要說明可用的版面配置 <xref:System.Windows.Controls.Panel> 元素。</span><span class="sxs-lookup"><span data-stu-id="55407-182">The following table summarizes the available layout <xref:System.Windows.Controls.Panel> elements.</span></span>

|<span data-ttu-id="55407-183">面板名稱</span><span class="sxs-lookup"><span data-stu-id="55407-183">Panel name</span></span>|<span data-ttu-id="55407-184">描述</span><span class="sxs-lookup"><span data-stu-id="55407-184">Description</span></span>|
|----------------|-----------------|
|<xref:System.Windows.Controls.Canvas>|<span data-ttu-id="55407-185">定義一個區域，您可以在其中以相對於區域的座標，明確地定位子項目 <xref:System.Windows.Controls.Canvas> 。</span><span class="sxs-lookup"><span data-stu-id="55407-185">Defines an area within which you can explicitly position child elements by coordinates relative to the <xref:System.Windows.Controls.Canvas> area.</span></span>|
|<xref:System.Windows.Controls.DockPanel>|<span data-ttu-id="55407-186">定義一個區域，可供您在其中以子元素彼此間相對的水平或垂直方式排列子元素。</span><span class="sxs-lookup"><span data-stu-id="55407-186">Defines an area within which you can arrange child elements either horizontally or vertically, relative to each other.</span></span>|
|<xref:System.Windows.Controls.Grid>|<span data-ttu-id="55407-187">定義彈性的格線區域，由欄與列組成。</span><span class="sxs-lookup"><span data-stu-id="55407-187">Defines a flexible grid area that consists of columns and rows.</span></span>|
|<xref:System.Windows.Controls.StackPanel>|<span data-ttu-id="55407-188">將子元素排成單一行，以水平或垂直方式排列。</span><span class="sxs-lookup"><span data-stu-id="55407-188">Arranges child elements into a single line that can be oriented horizontally or vertically.</span></span>|
|<xref:System.Windows.Controls.VirtualizingPanel>|<span data-ttu-id="55407-189">提供 <xref:System.Windows.Controls.Panel> 項目的架構，這些項目會虛擬化其子資料集合。</span><span class="sxs-lookup"><span data-stu-id="55407-189">Provides a framework for <xref:System.Windows.Controls.Panel> elements that virtualize their child data collection.</span></span> <span data-ttu-id="55407-190">這是 abstract 類別。</span><span class="sxs-lookup"><span data-stu-id="55407-190">This is an abstract class.</span></span>|
|<xref:System.Windows.Controls.WrapPanel>|<span data-ttu-id="55407-191">將子項目置放於由左至右的連續位置，其中會在包含方塊的邊緣將內容換至下一行。</span><span class="sxs-lookup"><span data-stu-id="55407-191">Positions child elements in sequential position from left to right, breaking content to the next line at the edge of the containing box.</span></span> <span data-ttu-id="55407-192">後續順序會依照屬性的值，從上到下或由右至左順序進行 <xref:System.Windows.Controls.WrapPanel.Orientation%2A> 。</span><span class="sxs-lookup"><span data-stu-id="55407-192">Subsequent ordering occurs sequentially from top to bottom or right to left, depending on the value of the <xref:System.Windows.Controls.WrapPanel.Orientation%2A> property.</span></span>|

<span data-ttu-id="55407-193">對於需要使用任何預先定義之元素無法進行配置的應用程式 <xref:System.Windows.Controls.Panel> ，可以藉由繼承自 <xref:System.Windows.Controls.Panel> 並覆寫 <xref:System.Windows.FrameworkElement.MeasureOverride%2A> 和方法，來達成自訂配置行為 <xref:System.Windows.FrameworkElement.ArrangeOverride%2A> 。</span><span class="sxs-lookup"><span data-stu-id="55407-193">For applications that require a layout that is not possible by using any of the predefined <xref:System.Windows.Controls.Panel> elements, custom layout behaviors can be achieved by inheriting from <xref:System.Windows.Controls.Panel> and overriding the <xref:System.Windows.FrameworkElement.MeasureOverride%2A> and <xref:System.Windows.FrameworkElement.ArrangeOverride%2A> methods.</span></span>

<a name="LayoutSystem_Performance"></a>

## <a name="layout-performance-considerations"></a><span data-ttu-id="55407-194">版面配置效能考量</span><span class="sxs-lookup"><span data-stu-id="55407-194">Layout Performance Considerations</span></span>

<span data-ttu-id="55407-195">版面配置是遞迴程序。</span><span class="sxs-lookup"><span data-stu-id="55407-195">Layout is a recursive process.</span></span> <span data-ttu-id="55407-196">集合中的每個子專案都會 <xref:System.Windows.Controls.Panel.Children%2A> 在配置系統的每次調用期間處理。</span><span class="sxs-lookup"><span data-stu-id="55407-196">Each child element in a <xref:System.Windows.Controls.Panel.Children%2A> collection gets processed during each invocation of the layout system.</span></span> <span data-ttu-id="55407-197">因此，不需要時，應該避免觸發配置系統。</span><span class="sxs-lookup"><span data-stu-id="55407-197">As a result, triggering the layout system should be avoided when it is not necessary.</span></span> <span data-ttu-id="55407-198">下列考量可協助您達到更佳的效能。</span><span class="sxs-lookup"><span data-stu-id="55407-198">The following considerations can help you achieve better performance.</span></span>

- <span data-ttu-id="55407-199">請注意哪些屬性值變更將會由配置系統強制遞迴更新。</span><span class="sxs-lookup"><span data-stu-id="55407-199">Be aware of which property value changes will force a recursive update by the layout system.</span></span>

  <span data-ttu-id="55407-200">使用公用旗標，可標記其值可以初始化配置系統的相依性屬性。</span><span class="sxs-lookup"><span data-stu-id="55407-200">Dependency properties whose values can cause the layout system to be initialized are marked with public flags.</span></span> <span data-ttu-id="55407-201"><xref:System.Windows.FrameworkPropertyMetadata.AffectsMeasure%2A>和 <xref:System.Windows.FrameworkPropertyMetadata.AffectsArrange%2A> 會提供有用的線索，以供配置系統強制執行遞迴更新的屬性值變更。</span><span class="sxs-lookup"><span data-stu-id="55407-201"><xref:System.Windows.FrameworkPropertyMetadata.AffectsMeasure%2A> and <xref:System.Windows.FrameworkPropertyMetadata.AffectsArrange%2A> provide useful clues as to which property value changes will force a recursive update by the layout system.</span></span> <span data-ttu-id="55407-202">一般而言，任何可能影響專案周框方塊大小的屬性，都應該將 <xref:System.Windows.FrameworkPropertyMetadata.AffectsMeasure%2A> 旗標設定為 true。</span><span class="sxs-lookup"><span data-stu-id="55407-202">In general, any property that can affect the size of an element's bounding box should have a <xref:System.Windows.FrameworkPropertyMetadata.AffectsMeasure%2A> flag set to true.</span></span> <span data-ttu-id="55407-203">如需詳細資訊，請參閱[相依性屬性概觀](dependency-properties-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="55407-203">For more information, see [Dependency Properties Overview](dependency-properties-overview.md).</span></span>

- <span data-ttu-id="55407-204">可能的話，請使用， <xref:System.Windows.UIElement.RenderTransform%2A> 而不是 <xref:System.Windows.FrameworkElement.LayoutTransform%2A> 。</span><span class="sxs-lookup"><span data-stu-id="55407-204">When possible, use a <xref:System.Windows.UIElement.RenderTransform%2A> instead of a <xref:System.Windows.FrameworkElement.LayoutTransform%2A>.</span></span>

  <span data-ttu-id="55407-205"><xref:System.Windows.FrameworkElement.LayoutTransform%2A>對於會影響的內容，可能是非常有用的方式 [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)] 。</span><span class="sxs-lookup"><span data-stu-id="55407-205">A <xref:System.Windows.FrameworkElement.LayoutTransform%2A> can be a very useful way to affect the content of a [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)].</span></span> <span data-ttu-id="55407-206">不過，如果轉換的效果不需要影響其他元素的位置，最好改為使用 <xref:System.Windows.UIElement.RenderTransform%2A> ，因為不會叫用 <xref:System.Windows.UIElement.RenderTransform%2A> 版面配置系統。</span><span class="sxs-lookup"><span data-stu-id="55407-206">However, if the effect of the transform does not have to impact the position of other elements, it is best to use a <xref:System.Windows.UIElement.RenderTransform%2A> instead, because <xref:System.Windows.UIElement.RenderTransform%2A> does not invoke the layout system.</span></span> <span data-ttu-id="55407-207"><xref:System.Windows.FrameworkElement.LayoutTransform%2A>套用其轉換並強制遞迴配置更新，以考慮受影響專案的新位置。</span><span class="sxs-lookup"><span data-stu-id="55407-207"><xref:System.Windows.FrameworkElement.LayoutTransform%2A> applies its transformation and forces a recursive layout update to account for the new position of the affected element.</span></span>

- <span data-ttu-id="55407-208">避免不必要的呼叫 <xref:System.Windows.UIElement.UpdateLayout%2A> 。</span><span class="sxs-lookup"><span data-stu-id="55407-208">Avoid unnecessary calls to <xref:System.Windows.UIElement.UpdateLayout%2A>.</span></span>

  <span data-ttu-id="55407-209"><xref:System.Windows.UIElement.UpdateLayout%2A>方法會強制執行遞迴版面配置更新，而且通常不是必要的。</span><span class="sxs-lookup"><span data-stu-id="55407-209">The <xref:System.Windows.UIElement.UpdateLayout%2A> method forces a recursive layout update, and is frequently not necessary.</span></span> <span data-ttu-id="55407-210">除非您確定需要完整更新，否則請依賴配置系統來呼叫此方法。</span><span class="sxs-lookup"><span data-stu-id="55407-210">Unless you are sure that a full update is required, rely on the layout system to call this method for you.</span></span>

- <span data-ttu-id="55407-211">使用大型 <xref:System.Windows.Controls.Panel.Children%2A> 集合時，請考慮使用， <xref:System.Windows.Controls.VirtualizingStackPanel> 而不是一般 <xref:System.Windows.Controls.StackPanel> 。</span><span class="sxs-lookup"><span data-stu-id="55407-211">When working with a large <xref:System.Windows.Controls.Panel.Children%2A> collection, consider using a <xref:System.Windows.Controls.VirtualizingStackPanel> instead of a regular <xref:System.Windows.Controls.StackPanel>.</span></span>

  <span data-ttu-id="55407-212">藉由虛擬化子集合， <xref:System.Windows.Controls.VirtualizingStackPanel> 只會將物件保留在目前位於父系之區的記憶體中。</span><span class="sxs-lookup"><span data-stu-id="55407-212">By virtualizing the child collection, the <xref:System.Windows.Controls.VirtualizingStackPanel> only keeps objects in memory that are currently within the parent's ViewPort.</span></span> <span data-ttu-id="55407-213">因此，在大部分情況下，都可以大幅改善效能。</span><span class="sxs-lookup"><span data-stu-id="55407-213">As a result, performance is substantially improved in most scenarios.</span></span>

<a name="LayoutSystem_LayoutRounding"></a>

## <a name="sub-pixel-rendering-and-layout-rounding"></a><span data-ttu-id="55407-214">子像素轉譯和版面配置進位</span><span class="sxs-lookup"><span data-stu-id="55407-214">Sub-pixel Rendering and Layout Rounding</span></span>

<span data-ttu-id="55407-215">WPF 圖形系統使用裝置獨立單位來啟用解析度和裝置獨立性。</span><span class="sxs-lookup"><span data-stu-id="55407-215">The WPF graphics system uses device-independent units to enable resolution and device independence.</span></span> <span data-ttu-id="55407-216">每個與裝置無關的圖元都會自動以系統的每英寸（DPI）設定來調整。</span><span class="sxs-lookup"><span data-stu-id="55407-216">Each device independent pixel automatically scales with the system's dots per inch (dpi) setting.</span></span> <span data-ttu-id="55407-217">這會為 WPF 應用程式提供適當的調整，以進行不同的 DPI 設定，並讓應用程式自動感知 DPI。</span><span class="sxs-lookup"><span data-stu-id="55407-217">This provides WPF applications proper scaling for different dpi settings and makes the application automatically dpi-aware.</span></span>

<span data-ttu-id="55407-218">不過，此 DPI 獨立性可能會因為消除鋸齒而建立不規則的邊緣轉譯。</span><span class="sxs-lookup"><span data-stu-id="55407-218">However, this dpi independence can create irregular edge rendering because of anti-aliasing.</span></span> <span data-ttu-id="55407-219">如果邊緣位置落在裝置像素中間，而不是裝置像素之間，則這些成品一般會看起來模糊或具有半透明邊緣。</span><span class="sxs-lookup"><span data-stu-id="55407-219">These artifacts, typically seen as blurry or semi-transparent edges, can occur when the location of an edge falls in the middle of a device pixel instead of between device pixels.</span></span> <span data-ttu-id="55407-220">配置系統提供一種方式，利用版面配置來進行這項的調整。</span><span class="sxs-lookup"><span data-stu-id="55407-220">The layout system provides a way to adjust for this with layout rounding.</span></span> <span data-ttu-id="55407-221">版面配置進位是配置系統會在版面配置階段期間將任何非整數像素值四捨五入。</span><span class="sxs-lookup"><span data-stu-id="55407-221">Layout rounding is where the layout system rounds any non-integral pixel values during the layout pass.</span></span>

<span data-ttu-id="55407-222">預設會停用版面配置進位。</span><span class="sxs-lookup"><span data-stu-id="55407-222">Layout rounding is disabled by default.</span></span> <span data-ttu-id="55407-223">若要啟用版面配置舍入，請將 <xref:System.Windows.FrameworkElement.UseLayoutRounding%2A> 屬性設定為 `true` on any <xref:System.Windows.FrameworkElement> 。</span><span class="sxs-lookup"><span data-stu-id="55407-223">To enable layout rounding, set the <xref:System.Windows.FrameworkElement.UseLayoutRounding%2A> property to `true` on any <xref:System.Windows.FrameworkElement>.</span></span> <span data-ttu-id="55407-224">因為這是相依性屬性，所以值將會傳播到視覺樹狀結構中的所有子系。</span><span class="sxs-lookup"><span data-stu-id="55407-224">Because it is a dependency property, the value will propagate to all the children in the visual tree.</span></span> <span data-ttu-id="55407-225">若要啟用整個 UI 的版面配置進位，請將 <xref:System.Windows.FrameworkElement.UseLayoutRounding%2A> `true` 根容器上的設定為。</span><span class="sxs-lookup"><span data-stu-id="55407-225">To enable layout rounding for the entire UI, set <xref:System.Windows.FrameworkElement.UseLayoutRounding%2A> to `true` on the root container.</span></span> <span data-ttu-id="55407-226">如需範例，請參閱 <xref:System.Windows.FrameworkElement.UseLayoutRounding%2A>。</span><span class="sxs-lookup"><span data-stu-id="55407-226">For an example, see <xref:System.Windows.FrameworkElement.UseLayoutRounding%2A>.</span></span>

<a name="LayoutSystem_whatsnext"></a>

## <a name="whats-next"></a><span data-ttu-id="55407-227">後續步驟</span><span class="sxs-lookup"><span data-stu-id="55407-227">What's Next</span></span>

<span data-ttu-id="55407-228">了解如何測量和排列項目是了解版面配置的第一個步驟。</span><span class="sxs-lookup"><span data-stu-id="55407-228">Understanding how elements are measured and arranged is the first step in understanding layout.</span></span> <span data-ttu-id="55407-229">如需可用元素的詳細資訊 <xref:System.Windows.Controls.Panel> ，請參閱[面板總覽](../controls/panels-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="55407-229">For more information about the available <xref:System.Windows.Controls.Panel> elements, see [Panels Overview](../controls/panels-overview.md).</span></span> <span data-ttu-id="55407-230">若要進一步了解會影響版面配置的各種定位屬性，請參閱[對齊、邊界和填補概觀](alignment-margins-and-padding-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="55407-230">To better understand the various positioning properties that can affect layout, see [Alignment, Margins, and Padding Overview](alignment-margins-and-padding-overview.md).</span></span> <span data-ttu-id="55407-231">當您準備好將它全部放在輕量應用程式中時，請參閱[逐步解說：我的第一個 WPF 桌面應用程式](../getting-started/walkthrough-my-first-wpf-desktop-application.md)。</span><span class="sxs-lookup"><span data-stu-id="55407-231">When you are ready to put it all together in a lightweight application, see [Walkthrough: My first WPF desktop application](../getting-started/walkthrough-my-first-wpf-desktop-application.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="55407-232">另請參閱</span><span class="sxs-lookup"><span data-stu-id="55407-232">See also</span></span>

- <xref:System.Windows.FrameworkElement>
- <xref:System.Windows.UIElement>
- [<span data-ttu-id="55407-233">面板概觀</span><span class="sxs-lookup"><span data-stu-id="55407-233">Panels Overview</span></span>](../controls/panels-overview.md)
- [<span data-ttu-id="55407-234">對齊、邊界和填補概觀</span><span class="sxs-lookup"><span data-stu-id="55407-234">Alignment, Margins, and Padding Overview</span></span>](alignment-margins-and-padding-overview.md)
- [<span data-ttu-id="55407-235">版面配置與設計</span><span class="sxs-lookup"><span data-stu-id="55407-235">Layout and Design</span></span>](optimizing-performance-layout-and-design.md)
