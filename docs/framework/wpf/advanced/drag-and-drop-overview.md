---
title: 拖放概觀
description: 瞭解 Windows Presentation Foundation 應用程式中的拖放支援，可讓使用者將物件拖曳至使用者介面中的區域。
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- drag-and-drop [WPF], implementing
- drag sources [WPF], drag-and-drop
- data transfer [WPF], drag-and-drop
- drag-and-drop [WPF], about
- drag-and-drop [WPF], events
- drop targets [WPF], drag-and-drop
ms.assetid: 1a5b27b0-0ac5-4cdf-86c0-86ac0271fa64
ms.openlocfilehash: 63384e79d8a198e4cc9507ca3266c484c0506e2c
ms.sourcegitcommit: 87cfeb69226fef01acb17c56c86f978f4f4a13db
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/24/2020
ms.locfileid: "87168066"
---
# <a name="drag-and-drop-overview"></a><span data-ttu-id="b1211-103">拖放概觀</span><span class="sxs-lookup"><span data-stu-id="b1211-103">Drag and Drop Overview</span></span>
<span data-ttu-id="b1211-104">本主題提供 [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] 應用程式中的拖放功能支援概觀。</span><span class="sxs-lookup"><span data-stu-id="b1211-104">This topic provides an overview of drag-and-drop support in [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] applications.</span></span> <span data-ttu-id="b1211-105">拖放功能一般是指資料傳送的方法，這種方法需要使用滑鼠 (或其他一些指標裝置) 選取一或多個物件，將這些物件拖曳到 [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)] 中一些想要的置放目標上，然後置放這些物件。</span><span class="sxs-lookup"><span data-stu-id="b1211-105">Drag-and-drop commonly refers to a method of data transfer that involves using a mouse (or some other pointing device) to select one or more objects, dragging these objects over some desired drop target in the [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)], and dropping them.</span></span>  

<a name="Drag_and_Drop_Support"></a>
## <a name="drag-and-drop-support-in-wpf"></a><span data-ttu-id="b1211-106">WPF 中的拖放功能支援</span><span class="sxs-lookup"><span data-stu-id="b1211-106">Drag-and-Drop Support in WPF</span></span>  
 <span data-ttu-id="b1211-107">拖放作業通常涉及兩方：一方是拖曳之物件所源自的拖曳來源，另一方是接收置放之物件的置放目標。</span><span class="sxs-lookup"><span data-stu-id="b1211-107">Drag-and-drop operations typically involve two parties: a drag source from which the dragged object originates and a drop target which receives the dropped object.</span></span>  <span data-ttu-id="b1211-108">拖曳來源和置放目標可能是相同應用程式或不同應用程式中的 UI 項目。</span><span class="sxs-lookup"><span data-stu-id="b1211-108">The drag source and drop target may be UI elements in the same application or a different application.</span></span>  
  
 <span data-ttu-id="b1211-109">您可以透過拖放功能，操作任意類型和數目的物件。</span><span class="sxs-lookup"><span data-stu-id="b1211-109">The type and number of objects that can be manipulated with drag-and-drop is completely arbitrary.</span></span> <span data-ttu-id="b1211-110">例如，檔案、資料夾和選取的內容是一些可透過拖放作業來操作的較常見物件。</span><span class="sxs-lookup"><span data-stu-id="b1211-110">For example, files, folders, and selections of content are some of the more common objects manipulated through drag-and-drop operations.</span></span>  
  
 <span data-ttu-id="b1211-111">拖放作業期間所執行的特定動作是針對應用程式的動作，而且這些動作通常會取決於內容。</span><span class="sxs-lookup"><span data-stu-id="b1211-111">The particular actions performed during a drag-and-drop operation are application specific, and often determined by context.</span></span>  <span data-ttu-id="b1211-112">例如，將選取的檔案從某個資料夾拖曳至相同儲存裝置上的另一個資料夾時，預設會移動檔案，而從通用命名慣例（UNC）共用將檔案拖曳到本機資料夾，預設會複製檔案。</span><span class="sxs-lookup"><span data-stu-id="b1211-112">For example, dragging a selection of files from one folder to another on the same storage device moves the files by default, whereas dragging files from a Universal Naming Convention (UNC) share to a local folder copies the files by default.</span></span>  
  
 <span data-ttu-id="b1211-113">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 所提供的拖放功能是為了提高彈性和可自訂性所設計，以便支援各種拖放案例。</span><span class="sxs-lookup"><span data-stu-id="b1211-113">The drag-and-drop facilities provided by [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] are designed to be highly flexible and customizable to support a wide variety of drag-and-drop scenarios.</span></span>  <span data-ttu-id="b1211-114">拖放功能支援在單一應用程式中，或在不同的應用程式之間操作物件；</span><span class="sxs-lookup"><span data-stu-id="b1211-114">Drag-and-drop supports manipulating objects within a single application, or between different applications.</span></span> <span data-ttu-id="b1211-115">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]同時也完全支援應用程式與其他 Windows 應用程式之間的拖放。</span><span class="sxs-lookup"><span data-stu-id="b1211-115">Dragging-and-dropping between [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] applications and other Windows applications is also fully supported.</span></span>  
  
 <span data-ttu-id="b1211-116">在 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 中，任何 <xref:System.Windows.UIElement> 或 <xref:System.Windows.ContentElement> 都可以參與拖放。</span><span class="sxs-lookup"><span data-stu-id="b1211-116">In [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], any <xref:System.Windows.UIElement> or <xref:System.Windows.ContentElement> can participate in drag-and-drop.</span></span> <span data-ttu-id="b1211-117">拖放作業所需的事件和方法會在 <xref:System.Windows.DragDrop> 類別中定義。</span><span class="sxs-lookup"><span data-stu-id="b1211-117">The events and methods required for drag-and-drop operations are defined in the <xref:System.Windows.DragDrop> class.</span></span> <span data-ttu-id="b1211-118"><xref:System.Windows.UIElement> 和 <xref:System.Windows.ContentElement> 類別包含 <xref:System.Windows.DragDrop> 附加事件的別名，因此當繼承 <xref:System.Windows.UIElement> 或 <xref:System.Windows.ContentElement> 做為基底項目時，便會在類別成員清單中顯示這些事件。</span><span class="sxs-lookup"><span data-stu-id="b1211-118">The <xref:System.Windows.UIElement> and <xref:System.Windows.ContentElement> classes contain aliases for the <xref:System.Windows.DragDrop> attached events so that the events appear in the class members list when a <xref:System.Windows.UIElement> or <xref:System.Windows.ContentElement> is inherited as a base element.</span></span> <span data-ttu-id="b1211-119">附加至這些事件的事件處理常式會附加至基礎 <xref:System.Windows.DragDrop> 附加事件，並接收相同的事件資料執行個體。</span><span class="sxs-lookup"><span data-stu-id="b1211-119">Event handlers that are attached to these events are attached to the underlying <xref:System.Windows.DragDrop> attached event and receive the same event data instance.</span></span> <span data-ttu-id="b1211-120">如需詳細資訊，請參閱 <xref:System.Windows.UIElement.Drop?displayProperty=nameWithType> 事件。</span><span class="sxs-lookup"><span data-stu-id="b1211-120">For more information, see the <xref:System.Windows.UIElement.Drop?displayProperty=nameWithType> event.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="b1211-121">您無法在網際網路區域中執行 OLE 拖放作業。</span><span class="sxs-lookup"><span data-stu-id="b1211-121">OLE drag-and-drop does not work while in the Internet zone.</span></span>  
  
<a name="Data_Transfer"></a>
## <a name="data-transfer"></a><span data-ttu-id="b1211-122">資料轉送</span><span class="sxs-lookup"><span data-stu-id="b1211-122">Data Transfer</span></span>  
 <span data-ttu-id="b1211-123">拖放功能是範圍較廣之資料傳輸的一部分。</span><span class="sxs-lookup"><span data-stu-id="b1211-123">Drag-and-drop is part of the more general area of data transfer.</span></span> <span data-ttu-id="b1211-124">資料傳輸包括拖放以及複製和貼上作業。</span><span class="sxs-lookup"><span data-stu-id="b1211-124">Data transfer includes drag-and-drop and copy-and-paste operations.</span></span> <span data-ttu-id="b1211-125">拖放作業類似複製和貼上或剪下和貼上作業，後者使用系統剪貼簿，將資料從某個物件或應用程式傳送到另一個物件或應用程式。</span><span class="sxs-lookup"><span data-stu-id="b1211-125">A drag-and-drop operation is analogous to a copy-and-paste or cut-and-paste operation that is used to transfer data from one object or application to another by using the system clipboard.</span></span> <span data-ttu-id="b1211-126">這兩種作業類型都需要：</span><span class="sxs-lookup"><span data-stu-id="b1211-126">Both types of operations require:</span></span>  
  
- <span data-ttu-id="b1211-127">提供資料來源物件。</span><span class="sxs-lookup"><span data-stu-id="b1211-127">A source object that provides the data.</span></span>  
  
- <span data-ttu-id="b1211-128">暫時儲存所傳送之資料的方式。</span><span class="sxs-lookup"><span data-stu-id="b1211-128">A way to temporarily store the transferred data.</span></span>  
  
- <span data-ttu-id="b1211-129">接收資料的目標物件。</span><span class="sxs-lookup"><span data-stu-id="b1211-129">A target object that receives the data.</span></span>  
  
 <span data-ttu-id="b1211-130">在複製和貼上作業中，會使用系統剪貼簿來暫時儲存所傳送的資料；在拖放作業中，會使用 <xref:System.Windows.DataObject> 來儲存資料。</span><span class="sxs-lookup"><span data-stu-id="b1211-130">In a copy-and-paste operation, the system clipboard is used to temporarily store the transferred data; in a drag-and-drop operation, a <xref:System.Windows.DataObject> is used to store the data.</span></span> <span data-ttu-id="b1211-131">資料物件在概念上是由一或多組 <xref:System.Object> (其中包含實際資料) 和對應的資料格式識別項所組成。</span><span class="sxs-lookup"><span data-stu-id="b1211-131">Conceptually, a data object consists of one or more pairs of an <xref:System.Object> that contains the actual data, and a corresponding data format identifier.</span></span>  
  
 <span data-ttu-id="b1211-132">拖曳來源會呼叫靜態 <xref:System.Windows.DragDrop.DoDragDrop%2A?displayProperty=nameWithType> 方法，並將所傳送的資料傳遞給該方法，來啟始拖放作業。</span><span class="sxs-lookup"><span data-stu-id="b1211-132">The drag source initiates a drag-and-drop operation by calling the static <xref:System.Windows.DragDrop.DoDragDrop%2A?displayProperty=nameWithType> method and passing the transferred data to it.</span></span> <span data-ttu-id="b1211-133"><xref:System.Windows.DragDrop.DoDragDrop%2A> 方法會視需要自動將資料包裝在 <xref:System.Windows.DataObject> 中。</span><span class="sxs-lookup"><span data-stu-id="b1211-133">The <xref:System.Windows.DragDrop.DoDragDrop%2A> method will automatically wrap the data in a <xref:System.Windows.DataObject> if necessary.</span></span> <span data-ttu-id="b1211-134">為了進一步控制資料格式，您可以將資料包裝在 <xref:System.Windows.DataObject> 中，再傳遞給 <xref:System.Windows.DragDrop.DoDragDrop%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="b1211-134">For greater control over the data format, you can wrap the data in a <xref:System.Windows.DataObject> before passing it to the <xref:System.Windows.DragDrop.DoDragDrop%2A> method.</span></span> <span data-ttu-id="b1211-135">置放目標負責從 <xref:System.Windows.DataObject> 擷取資料。</span><span class="sxs-lookup"><span data-stu-id="b1211-135">The drop target is responsible for extracting the data from the <xref:System.Windows.DataObject>.</span></span> <span data-ttu-id="b1211-136">如需使用資料物件的詳細資訊，請參閱[資料和資料物件](data-and-data-objects.md)。</span><span class="sxs-lookup"><span data-stu-id="b1211-136">For more information about working with data objects, see [Data and Data Objects](data-and-data-objects.md).</span></span>  
  
 <span data-ttu-id="b1211-137">拖放作業的來源和目標是 UI 項目；不過，實際上要傳送的資料通常並沒有視覺表示。</span><span class="sxs-lookup"><span data-stu-id="b1211-137">The source and target of a drag-and-drop operation are UI elements; however, the data that is actually being transferred typically does not have a visual representation.</span></span> <span data-ttu-id="b1211-138">您可以撰寫程式碼，提供拖曳之資料的視覺表示，例如在 Windows 檔案總管中拖曳檔案時所發生的視覺表示。</span><span class="sxs-lookup"><span data-stu-id="b1211-138">You can write code to provide a visual representation of the data that is dragged, such as occurs when dragging files in Windows Explorer.</span></span> <span data-ttu-id="b1211-139">根據預設，當變更游標時，系統會提供回饋給使用者，以表示這項拖放作業會對資料產生何種效果，例如是否要移動或複製資料。</span><span class="sxs-lookup"><span data-stu-id="b1211-139">By default, feedback is provided to the user by changing the cursor to represent the effect that the drag-and-drop operation will have on the data, such as whether the data will be moved or copied.</span></span>  
  
### <a name="drag-and-drop-effects"></a><span data-ttu-id="b1211-140">拖放效果</span><span class="sxs-lookup"><span data-stu-id="b1211-140">Drag-and-Drop Effects</span></span>  
 <span data-ttu-id="b1211-141">拖放作業對傳送的資料可以有不同的效果。</span><span class="sxs-lookup"><span data-stu-id="b1211-141">Drag-and-drop operations can have different effects on the transferred data.</span></span> <span data-ttu-id="b1211-142">例如，您可以複製或移動資料。</span><span class="sxs-lookup"><span data-stu-id="b1211-142">For example, you can copy the data or you can move the data.</span></span> [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <span data-ttu-id="b1211-143">定義 <xref:System.Windows.DragDropEffects> 列舉，可供您用來指定拖放作業的效果。</span><span class="sxs-lookup"><span data-stu-id="b1211-143">defines a <xref:System.Windows.DragDropEffects> enumeration that you can use to specify the effect of a drag-and-drop operation.</span></span> <span data-ttu-id="b1211-144">在拖曳來源中，您可以指定來源將在 <xref:System.Windows.DragDrop.DoDragDrop%2A> 方法中允許的效果。</span><span class="sxs-lookup"><span data-stu-id="b1211-144">In the drag source, you can specify the effects that the source will allow in the <xref:System.Windows.DragDrop.DoDragDrop%2A> method.</span></span> <span data-ttu-id="b1211-145">在置放目標中，您可以指定目標預期用於 <xref:System.Windows.DragEventArgs.Effects%2A> 類別之 <xref:System.Windows.DragEventArgs> 屬性的效果。</span><span class="sxs-lookup"><span data-stu-id="b1211-145">In the drop target, you can specify the effect that the target intends in the <xref:System.Windows.DragEventArgs.Effects%2A> property of the <xref:System.Windows.DragEventArgs> class.</span></span> <span data-ttu-id="b1211-146">當置放目標在 <xref:System.Windows.DragDrop.DragOver> 事件中指定其預期效果時，該資訊會在 <xref:System.Windows.DragDrop.GiveFeedback> 事件中傳回拖曳來源。</span><span class="sxs-lookup"><span data-stu-id="b1211-146">When the drop target specifies its intended effect in the <xref:System.Windows.DragDrop.DragOver> event, that information is passed back to the drag source in the <xref:System.Windows.DragDrop.GiveFeedback> event.</span></span> <span data-ttu-id="b1211-147">拖曳來源會使用這項資訊，來通知使用者置放目標預期用於資料的效果。</span><span class="sxs-lookup"><span data-stu-id="b1211-147">The drag source uses this information to inform the user what effect the drop target intends to have on the data.</span></span> <span data-ttu-id="b1211-148">置放資料之後，置放目標會在 <xref:System.Windows.DragDrop.Drop> 事件中指定其實際效果。</span><span class="sxs-lookup"><span data-stu-id="b1211-148">When the data is dropped, the drop target specifies its actual effect in the <xref:System.Windows.DragDrop.Drop> event.</span></span> <span data-ttu-id="b1211-149">該資訊會當做 <xref:System.Windows.DragDrop.DoDragDrop%2A> 方法的傳回值傳回拖曳來源。</span><span class="sxs-lookup"><span data-stu-id="b1211-149">That information is passed back to the drag source as the return value of the <xref:System.Windows.DragDrop.DoDragDrop%2A> method.</span></span> <span data-ttu-id="b1211-150">如果置放目標傳回的效果不在 `allowedEffects` 的拖曳來源清單中，則會取消拖放作業，而不傳送任何資料。</span><span class="sxs-lookup"><span data-stu-id="b1211-150">If the drop target returns an effect that is not in the drag sources list of `allowedEffects`, the drag-and-drop operation is cancelled without any data transfer occurring.</span></span>  
  
 <span data-ttu-id="b1211-151">請務必記住，在 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 中，<xref:System.Windows.DragDropEffects> 值只能用來提供拖曳來源和置放目標之間有關拖放作業效果的通訊。</span><span class="sxs-lookup"><span data-stu-id="b1211-151">It is important to remember that in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], the <xref:System.Windows.DragDropEffects> values are only used to provide communication between the drag source and the drop target regarding the effects of the drag-and-drop operation.</span></span> <span data-ttu-id="b1211-152">拖放作業的實際效果取決於您在應用程式中撰寫的適當程式碼。</span><span class="sxs-lookup"><span data-stu-id="b1211-152">The actual effect of the drag-and-drop operation depends on you to write the appropriate code in your application.</span></span>  
  
 <span data-ttu-id="b1211-153">例如，置放目標可能指定資料資料的效果是移動資料。</span><span class="sxs-lookup"><span data-stu-id="b1211-153">For example, the drop target might specify that the effect of dropping data on it is to move the data.</span></span> <span data-ttu-id="b1211-154">不過，若要移動資料，該資料必須同時加入目標項目並從來源項目中移除。</span><span class="sxs-lookup"><span data-stu-id="b1211-154">However, to move the data, it must be both added to the target element and removed from the source element.</span></span> <span data-ttu-id="b1211-155">來源項目可能指定允許移動資料，但如果您未提供將資料從來源項目中移除的程式碼，最後結果會是複製資料，而不是移動資料。</span><span class="sxs-lookup"><span data-stu-id="b1211-155">The source element might indicate that it allows moving the data, but if you do not provide the code to remove the data from the source element, the end result will be that the data is copied, and not moved.</span></span>  
  
<a name="Drag_and_Drop_Events"></a>
## <a name="drag-and-drop-events"></a><span data-ttu-id="b1211-156">拖放事件</span><span class="sxs-lookup"><span data-stu-id="b1211-156">Drag-and-Drop Events</span></span>  
 <span data-ttu-id="b1211-157">拖放作業支援事件驅動模型。</span><span class="sxs-lookup"><span data-stu-id="b1211-157">Drag-and-drop operations support an event driven model.</span></span>  <span data-ttu-id="b1211-158">拖曳來源和置放目標都是使用一組標準的事件來處理拖放作業。</span><span class="sxs-lookup"><span data-stu-id="b1211-158">Both the drag source and the drop target use a standard set of events to handle drag-and-drop operations.</span></span>  <span data-ttu-id="b1211-159">下表摘要說明這些標準的拖放事件。</span><span class="sxs-lookup"><span data-stu-id="b1211-159">The following tables summarize the standard drag-and-drop events.</span></span> <span data-ttu-id="b1211-160">這些事件是 <xref:System.Windows.DragDrop> 類別上的附加事件。</span><span class="sxs-lookup"><span data-stu-id="b1211-160">These are attached events on the <xref:System.Windows.DragDrop> class.</span></span> <span data-ttu-id="b1211-161">如需附加事件的詳細資訊，請參閱[附加事件概觀](attached-events-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="b1211-161">For more information about attached events, see [Attached Events Overview](attached-events-overview.md).</span></span>  
  
### <a name="drag-source-events"></a><span data-ttu-id="b1211-162">拖曳來源事件</span><span class="sxs-lookup"><span data-stu-id="b1211-162">Drag Source Events</span></span>  
  
|<span data-ttu-id="b1211-163">事件</span><span class="sxs-lookup"><span data-stu-id="b1211-163">Event</span></span>|<span data-ttu-id="b1211-164">摘要</span><span class="sxs-lookup"><span data-stu-id="b1211-164">Summary</span></span>|  
|-----------|-------------|  
|<xref:System.Windows.DragDrop.GiveFeedback>|<span data-ttu-id="b1211-165">這個事件會在拖放作業期間持續發生，並可讓拖曳來源提供回饋資訊給使用者。</span><span class="sxs-lookup"><span data-stu-id="b1211-165">This event occurs continuously during a drag-and-drop operation, and enables the drop source to give feedback information to the user.</span></span> <span data-ttu-id="b1211-166">當變更滑鼠指標的外觀以表示置放目標所允許的效果時，通常會提供這個回饋。</span><span class="sxs-lookup"><span data-stu-id="b1211-166">This feedback is commonly given by changing the appearance of the mouse pointer to indicate the effects allowed by the drop target.</span></span>  <span data-ttu-id="b1211-167">這是反昇事件。</span><span class="sxs-lookup"><span data-stu-id="b1211-167">This is a bubbling event.</span></span>|  
|<xref:System.Windows.DragDrop.QueryContinueDrag>|<span data-ttu-id="b1211-168">這個事件會在拖曳作業期間鍵盤或滑鼠按鈕狀態變更時發生，並可讓拖曳來源根據按鍵/按鈕狀態來取消拖放作業。</span><span class="sxs-lookup"><span data-stu-id="b1211-168">This event occurs when there is a change in the keyboard or mouse button states during a drag-and-drop operation, and enables the drop source to cancel the drag-and-drop operation depending on the key/button states.</span></span> <span data-ttu-id="b1211-169">這是反昇事件。</span><span class="sxs-lookup"><span data-stu-id="b1211-169">This is a bubbling event.</span></span>|  
|<xref:System.Windows.DragDrop.PreviewGiveFeedback>|<span data-ttu-id="b1211-170"><xref:System.Windows.DragDrop.GiveFeedback> 的通道版本。</span><span class="sxs-lookup"><span data-stu-id="b1211-170">Tunneling version of <xref:System.Windows.DragDrop.GiveFeedback>.</span></span>|  
|<xref:System.Windows.DragDrop.PreviewQueryContinueDrag>|<span data-ttu-id="b1211-171"><xref:System.Windows.DragDrop.QueryContinueDrag> 的通道版本。</span><span class="sxs-lookup"><span data-stu-id="b1211-171">Tunneling version of <xref:System.Windows.DragDrop.QueryContinueDrag>.</span></span>|  
  
### <a name="drop-target-events"></a><span data-ttu-id="b1211-172">置放目標事件</span><span class="sxs-lookup"><span data-stu-id="b1211-172">Drop Target Events</span></span>  
  
|<span data-ttu-id="b1211-173">事件</span><span class="sxs-lookup"><span data-stu-id="b1211-173">Event</span></span>|<span data-ttu-id="b1211-174">摘要</span><span class="sxs-lookup"><span data-stu-id="b1211-174">Summary</span></span>|  
|-----------|-------------|  
|<xref:System.Windows.DragDrop.DragEnter>|<span data-ttu-id="b1211-175">這個事件會在將物件拖曳到置放目標的界限內時發生。</span><span class="sxs-lookup"><span data-stu-id="b1211-175">This event occurs when an object is dragged into the drop target's boundary.</span></span> <span data-ttu-id="b1211-176">這是反昇事件。</span><span class="sxs-lookup"><span data-stu-id="b1211-176">This is a bubbling event.</span></span>|  
|<xref:System.Windows.DragDrop.DragLeave>|<span data-ttu-id="b1211-177">這個事件會在將物件拖曳出置放目標的界限時發生。</span><span class="sxs-lookup"><span data-stu-id="b1211-177">This event occurs when an object is dragged out of the drop target's boundary.</span></span>  <span data-ttu-id="b1211-178">這是反昇事件。</span><span class="sxs-lookup"><span data-stu-id="b1211-178">This is a bubbling event.</span></span>|  
|<xref:System.Windows.DragDrop.DragOver>|<span data-ttu-id="b1211-179">這個事件會在將物件拖曳 (移動) 到置放目標的界限內時持續發生。</span><span class="sxs-lookup"><span data-stu-id="b1211-179">This event occurs continuously while an object is dragged (moved) within the drop target's boundary.</span></span> <span data-ttu-id="b1211-180">這是反昇事件。</span><span class="sxs-lookup"><span data-stu-id="b1211-180">This is a bubbling event.</span></span>|  
|<xref:System.Windows.DragDrop.Drop>|<span data-ttu-id="b1211-181">這個事件會在將物件置放到置放目標上時發生。</span><span class="sxs-lookup"><span data-stu-id="b1211-181">This event occurs when an object is dropped on the drop target.</span></span>  <span data-ttu-id="b1211-182">這是反昇事件。</span><span class="sxs-lookup"><span data-stu-id="b1211-182">This is a bubbling event.</span></span>|  
|<xref:System.Windows.DragDrop.PreviewDragEnter>|<span data-ttu-id="b1211-183"><xref:System.Windows.DragDrop.DragEnter> 的通道版本。</span><span class="sxs-lookup"><span data-stu-id="b1211-183">Tunneling version of <xref:System.Windows.DragDrop.DragEnter>.</span></span>|  
|<xref:System.Windows.DragDrop.PreviewDragLeave>|<span data-ttu-id="b1211-184"><xref:System.Windows.DragDrop.DragLeave> 的通道版本。</span><span class="sxs-lookup"><span data-stu-id="b1211-184">Tunneling version of <xref:System.Windows.DragDrop.DragLeave>.</span></span>|  
|<xref:System.Windows.DragDrop.PreviewDragOver>|<span data-ttu-id="b1211-185"><xref:System.Windows.DragDrop.DragOver> 的通道版本。</span><span class="sxs-lookup"><span data-stu-id="b1211-185">Tunneling version of <xref:System.Windows.DragDrop.DragOver>.</span></span>|  
|<xref:System.Windows.DragDrop.PreviewDrop>|<span data-ttu-id="b1211-186"><xref:System.Windows.DragDrop.Drop> 的通道版本。</span><span class="sxs-lookup"><span data-stu-id="b1211-186">Tunneling version of <xref:System.Windows.DragDrop.Drop>.</span></span>|  
  
 <span data-ttu-id="b1211-187">若要處理物件執行個體的拖放事件，請針對上表所列的事件加入處理常式。</span><span class="sxs-lookup"><span data-stu-id="b1211-187">To handle drag-and-drop events for instances of an object, add handlers for the events listed in the preceding tables.</span></span> <span data-ttu-id="b1211-188">若要在類別層級處理拖放事件，請覆寫對應的虛擬 On\*Event 和 On\*PreviewEvent 方法。</span><span class="sxs-lookup"><span data-stu-id="b1211-188">To handle drag-and-drop events at the class level, override the corresponding virtual On\*Event and On\*PreviewEvent methods.</span></span> <span data-ttu-id="b1211-189">如需詳細資訊，請參閱[控制項基底類別的路由事件類別處理](marking-routed-events-as-handled-and-class-handling.md#Class_Handling_of_Routed_Events)。</span><span class="sxs-lookup"><span data-stu-id="b1211-189">For more information, see [Class Handling of Routed Events by Control Base Classes](marking-routed-events-as-handled-and-class-handling.md#Class_Handling_of_Routed_Events).</span></span>  
  
<a name="Implementing_Drag_And_Drop"></a>
## <a name="implementing-drag-and-drop"></a><span data-ttu-id="b1211-190">實作拖放功能</span><span class="sxs-lookup"><span data-stu-id="b1211-190">Implementing Drag-and-Drop</span></span>  
 <span data-ttu-id="b1211-191">UI 項目可以是拖曳來源和 (或) 置放目標。</span><span class="sxs-lookup"><span data-stu-id="b1211-191">A UI element can be a drag source, a drop target, or both.</span></span> <span data-ttu-id="b1211-192">若要實作基本拖放功能，您可以撰寫程式碼來啟始拖放作業並處理置放的資料。</span><span class="sxs-lookup"><span data-stu-id="b1211-192">To implement basic drag-and-drop, you write code to initiate the drag-and-drop operation and to process the dropped data.</span></span> <span data-ttu-id="b1211-193">您可以藉由處理選擇性拖放事件，來增強拖放體驗。</span><span class="sxs-lookup"><span data-stu-id="b1211-193">You can enhance the drag-and-drop experience by handling optional drag-and-drop events.</span></span>  
  
 <span data-ttu-id="b1211-194">若要實作基本拖放功能，您將完成下列工作：</span><span class="sxs-lookup"><span data-stu-id="b1211-194">To implement basic drag-and-drop, you will complete the following tasks:</span></span>  
  
- <span data-ttu-id="b1211-195">識別將做為拖曳來源的項目。</span><span class="sxs-lookup"><span data-stu-id="b1211-195">Identify the element that will be a drag source.</span></span> <span data-ttu-id="b1211-196">拖曳來源可以是 <xref:System.Windows.UIElement> 或 <xref:System.Windows.ContentElement>。</span><span class="sxs-lookup"><span data-stu-id="b1211-196">A drag source can be a <xref:System.Windows.UIElement> or a <xref:System.Windows.ContentElement>.</span></span>  
  
- <span data-ttu-id="b1211-197">在要啟始拖放作業的拖曳來源上建立事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="b1211-197">Create an event handler on the drag source that will initiate the drag-and-drop operation.</span></span> <span data-ttu-id="b1211-198">這個事件通常是 <xref:System.Windows.UIElement.MouseMove> 事件。</span><span class="sxs-lookup"><span data-stu-id="b1211-198">The event is typically the <xref:System.Windows.UIElement.MouseMove> event.</span></span>  
  
- <span data-ttu-id="b1211-199">在拖曳來源事件處理常式中，呼叫 <xref:System.Windows.DragDrop.DoDragDrop%2A> 方法來啟始拖放作業。</span><span class="sxs-lookup"><span data-stu-id="b1211-199">In the drag source event handler, call the <xref:System.Windows.DragDrop.DoDragDrop%2A> method to initiate the drag-and-drop operation.</span></span> <span data-ttu-id="b1211-200">在 <xref:System.Windows.DragDrop.DoDragDrop%2A> 呼叫中，指定拖曳來源、要傳送的資料和允許的效果。</span><span class="sxs-lookup"><span data-stu-id="b1211-200">In the <xref:System.Windows.DragDrop.DoDragDrop%2A> call, specify the drag source, the data to be transferred, and the allowed effects.</span></span>  
  
- <span data-ttu-id="b1211-201">識別將做為置放目標的項目。</span><span class="sxs-lookup"><span data-stu-id="b1211-201">Identify the element that will be a drop target.</span></span> <span data-ttu-id="b1211-202">置放目標可以是 <xref:System.Windows.UIElement> 或 <xref:System.Windows.ContentElement>。</span><span class="sxs-lookup"><span data-stu-id="b1211-202">A drop target can be <xref:System.Windows.UIElement> or a <xref:System.Windows.ContentElement>.</span></span>  
  
- <span data-ttu-id="b1211-203">在置放目標上，將 <xref:System.Windows.UIElement.AllowDrop%2A> 屬性設定為 `true`。</span><span class="sxs-lookup"><span data-stu-id="b1211-203">On the drop target, set the <xref:System.Windows.UIElement.AllowDrop%2A> property to `true`.</span></span>  
  
- <span data-ttu-id="b1211-204">在置放目標上，建立 <xref:System.Windows.DragDrop.Drop> 事件處理常式來處理置放的資料。</span><span class="sxs-lookup"><span data-stu-id="b1211-204">In the drop target, create a <xref:System.Windows.DragDrop.Drop> event handler to process the dropped data.</span></span>  
  
- <span data-ttu-id="b1211-205">在 <xref:System.Windows.DragDrop.Drop> 事件處理常式中，使用 <xref:System.Windows.DragEventArgs> 和 <xref:System.Windows.DataObject.GetDataPresent%2A> 方法從 <xref:System.Windows.DataObject.GetData%2A> 擷取資料。</span><span class="sxs-lookup"><span data-stu-id="b1211-205">In the <xref:System.Windows.DragDrop.Drop> event handler, extract the data from the <xref:System.Windows.DragEventArgs> by using the <xref:System.Windows.DataObject.GetDataPresent%2A> and <xref:System.Windows.DataObject.GetData%2A> methods.</span></span>  
  
- <span data-ttu-id="b1211-206">在 <xref:System.Windows.DragDrop.Drop> 事件處理常式中，使用資料來執行所需的拖放作業。</span><span class="sxs-lookup"><span data-stu-id="b1211-206">In the <xref:System.Windows.DragDrop.Drop> event handler, use the data to perform the desired drag-and-drop operation.</span></span>  
  
 <span data-ttu-id="b1211-207">您可以建立自訂 <xref:System.Windows.DataObject>，並處理選擇性拖曳來源和置放目標事件，來增強您的拖放功能實作，如下列工作所示：</span><span class="sxs-lookup"><span data-stu-id="b1211-207">You can enhance your drag-and-drop implementation by creating a custom <xref:System.Windows.DataObject> and by handling optional drag source and drop target events, as shown in the following tasks:</span></span>  
  
- <span data-ttu-id="b1211-208">若要傳送自訂資料或多個資料項目，請建立 <xref:System.Windows.DataObject> 以傳遞給 <xref:System.Windows.DragDrop.DoDragDrop%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="b1211-208">To transfer custom data or multiple data items, create a <xref:System.Windows.DataObject> to pass to the <xref:System.Windows.DragDrop.DoDragDrop%2A> method.</span></span>  
  
- <span data-ttu-id="b1211-209">若要在拖曳期間執行其他動作，請處理置放目標上的 <xref:System.Windows.DragDrop.DragEnter>、<xref:System.Windows.DragDrop.DragOver> 和  <xref:System.Windows.DragDrop.DragLeave> 事件。</span><span class="sxs-lookup"><span data-stu-id="b1211-209">To perform additional actions during a drag, handle the <xref:System.Windows.DragDrop.DragEnter>, <xref:System.Windows.DragDrop.DragOver>, and <xref:System.Windows.DragDrop.DragLeave> events on the drop target.</span></span>  
  
- <span data-ttu-id="b1211-210">若要變更滑鼠指標的外觀，請處理拖曳來源上的 <xref:System.Windows.DragDrop.GiveFeedback>  事件。</span><span class="sxs-lookup"><span data-stu-id="b1211-210">To change the appearance of the mouse pointer, handle the <xref:System.Windows.DragDrop.GiveFeedback> event on the drag source.</span></span>  
  
- <span data-ttu-id="b1211-211">若要變更拖放作業的取消方式，請處理拖曳來源上的 <xref:System.Windows.DragDrop.QueryContinueDrag> 事件。</span><span class="sxs-lookup"><span data-stu-id="b1211-211">To change how the drag-and-drop operation is canceled, handle the <xref:System.Windows.DragDrop.QueryContinueDrag> event on the drag source.</span></span>  
  
<a name="Drag_And_Drop_Example"></a>
## <a name="drag-and-drop-example"></a><span data-ttu-id="b1211-212">拖放功能範例</span><span class="sxs-lookup"><span data-stu-id="b1211-212">Drag-and-Drop Example</span></span>  
 <span data-ttu-id="b1211-213">本節說明如何實作 <xref:System.Windows.Shapes.Ellipse> 項目的拖放功能。</span><span class="sxs-lookup"><span data-stu-id="b1211-213">This section describes how to implement drag-and-drop for an <xref:System.Windows.Shapes.Ellipse> element.</span></span> <span data-ttu-id="b1211-214"><xref:System.Windows.Shapes.Ellipse> 同時為拖曳來源和置放目標。</span><span class="sxs-lookup"><span data-stu-id="b1211-214">The <xref:System.Windows.Shapes.Ellipse> is both a drag source and a drop target.</span></span> <span data-ttu-id="b1211-215">傳送的資料是橢圓形之 <xref:System.Windows.Shapes.Shape.Fill%2A> 屬性的字串表示。</span><span class="sxs-lookup"><span data-stu-id="b1211-215">The transferred data is the string representation of the ellipse’s <xref:System.Windows.Shapes.Shape.Fill%2A> property.</span></span> <span data-ttu-id="b1211-216">下列 XAML 顯示 <xref:System.Windows.Shapes.Ellipse> 項目及其處理的拖放相關事件。</span><span class="sxs-lookup"><span data-stu-id="b1211-216">The following XAML shows the <xref:System.Windows.Shapes.Ellipse> element and the drag-and-drop related events that it handles.</span></span> <span data-ttu-id="b1211-217">如需如何實作拖放功能的完整步驟，請參閱[逐步解說：在使用者控制項上啟用拖放功能](walkthrough-enabling-drag-and-drop-on-a-user-control.md)。</span><span class="sxs-lookup"><span data-stu-id="b1211-217">For complete steps on how to implement drag-and-drop, see [Walkthrough: Enabling Drag and Drop on a User Control](walkthrough-enabling-drag-and-drop-on-a-user-control.md).</span></span>  
  
 [!code-xaml[DragDropSnippets#EllipseXaml](~/samples/snippets/csharp/VS_Snippets_Wpf/dragdropsnippets/cs/mainwindow.xaml#ellipsexaml)]  
  
### <a name="enabling-an-element-to-be-a-drag-source"></a><span data-ttu-id="b1211-218">使某個項目成為拖曳來源</span><span class="sxs-lookup"><span data-stu-id="b1211-218">Enabling an Element to be a Drag Source</span></span>  
 <span data-ttu-id="b1211-219">拖曳來源物件負責：</span><span class="sxs-lookup"><span data-stu-id="b1211-219">An object that is a drag source is responsible for:</span></span>  
  
- <span data-ttu-id="b1211-220">識別何時發生拖曳。</span><span class="sxs-lookup"><span data-stu-id="b1211-220">Identifying when a drag occurs.</span></span>  
  
- <span data-ttu-id="b1211-221">啟始拖放作業。</span><span class="sxs-lookup"><span data-stu-id="b1211-221">Initiating the drag-and-drop operation.</span></span>  
  
- <span data-ttu-id="b1211-222">識別要傳送的資料。</span><span class="sxs-lookup"><span data-stu-id="b1211-222">Identifying the data to be transferred.</span></span>  
  
- <span data-ttu-id="b1211-223">指定傳送的資料允許的拖放作業效果。</span><span class="sxs-lookup"><span data-stu-id="b1211-223">Specifying the effects that the drag-and-drop operation is allowed to have on the transferred data.</span></span>  
  
 <span data-ttu-id="b1211-224">不論允許的動作為何 (移動、複製、無)，拖曳來源也會提供回饋給使用者，並可根據其他使用者輸入 (例如在拖曳時按 ESC 鍵) 來取消拖放作業。</span><span class="sxs-lookup"><span data-stu-id="b1211-224">The drag source may also give feedback to the user regarding the allowed actions (move, copy, none), and can cancel the drag-and-drop operation based on additional user input, such as pressing the ESC key during the drag.</span></span>  
  
 <span data-ttu-id="b1211-225">您的應用程式會負責判斷何時發生拖曳，然後再呼叫 <xref:System.Windows.DragDrop.DoDragDrop%2A> 方法啟始拖放作業。</span><span class="sxs-lookup"><span data-stu-id="b1211-225">It is the responsibility of your application to determine when a drag occurs, and then initiate the drag-and-drop operation by calling the <xref:System.Windows.DragDrop.DoDragDrop%2A> method.</span></span> <span data-ttu-id="b1211-226">一般而言，這會是在項目上按下滑鼠按鈕拖曳時所發生的 <xref:System.Windows.UIElement.MouseMove> 事件。</span><span class="sxs-lookup"><span data-stu-id="b1211-226">Typically, this is when a <xref:System.Windows.UIElement.MouseMove> event occurs over the element to be dragged while a mouse button is pressed.</span></span> <span data-ttu-id="b1211-227">下列範例示範如何從 <xref:System.Windows.UIElement.MouseMove> 項目的 <xref:System.Windows.Shapes.Ellipse> 事件處理常式啟始拖放作業，使該項目成為拖曳來源。</span><span class="sxs-lookup"><span data-stu-id="b1211-227">The following example shows how to initiate a drag-and-drop operation from the <xref:System.Windows.UIElement.MouseMove> event handler of an <xref:System.Windows.Shapes.Ellipse> element to make it a drag source.</span></span> <span data-ttu-id="b1211-228">傳送的資料是橢圓形之 <xref:System.Windows.Shapes.Shape.Fill%2A> 屬性的字串表示。</span><span class="sxs-lookup"><span data-stu-id="b1211-228">The transferred data is the string representation of the ellipse’s <xref:System.Windows.Shapes.Shape.Fill%2A> property.</span></span>  
  
 [!code-csharp[DragDropSnippets#DoDragDrop](~/samples/snippets/csharp/VS_Snippets_Wpf/dragdropsnippets/cs/mainwindow.xaml.cs#dodragdrop)]
 [!code-vb[DragDropSnippets#DoDragDrop](~/samples/snippets/visualbasic/VS_Snippets_Wpf/dragdropsnippets/vb/mainwindow.xaml.vb#dodragdrop)]  
  
 <span data-ttu-id="b1211-229">在 <xref:System.Windows.UIElement.MouseMove> 事件處理常式中，呼叫 <xref:System.Windows.DragDrop.DoDragDrop%2A> 方法來啟始拖放作業。</span><span class="sxs-lookup"><span data-stu-id="b1211-229">Inside of the <xref:System.Windows.UIElement.MouseMove> event handler, call the <xref:System.Windows.DragDrop.DoDragDrop%2A> method to initiate the drag-and-drop operation.</span></span> <span data-ttu-id="b1211-230"><xref:System.Windows.DragDrop.DoDragDrop%2A> 方法採用三個參數：</span><span class="sxs-lookup"><span data-stu-id="b1211-230">The <xref:System.Windows.DragDrop.DoDragDrop%2A> method takes three parameters:</span></span>  
  
- <span data-ttu-id="b1211-231">`dragSource` - 所傳送之資料來源的相依性物件參考，通常是 <xref:System.Windows.UIElement.MouseMove> 事件的來源。</span><span class="sxs-lookup"><span data-stu-id="b1211-231">`dragSource` – A reference to the dependency object that is the source of the transferred data; this is typically the source of the <xref:System.Windows.UIElement.MouseMove> event.</span></span>  
  
- <span data-ttu-id="b1211-232">`data` - 包含所傳送之資料的物件，該資料會包裝在 <xref:System.Windows.DataObject> 中。</span><span class="sxs-lookup"><span data-stu-id="b1211-232">`data` - An object that contains the transferred data, wrapped in a <xref:System.Windows.DataObject>.</span></span>  
  
- <span data-ttu-id="b1211-233">`allowedEffects` - <xref:System.Windows.DragDropEffects> 列舉值之一，指定允許的拖放作業效果。</span><span class="sxs-lookup"><span data-stu-id="b1211-233">`allowedEffects` - One of the <xref:System.Windows.DragDropEffects> enumeration values that specifies the permitted effects of the drag-and-drop operation.</span></span>  
  
 <span data-ttu-id="b1211-234">所有可序列化的物件都可以 `data` 參數傳遞。</span><span class="sxs-lookup"><span data-stu-id="b1211-234">Any serializable object can be passed in the `data` parameter.</span></span> <span data-ttu-id="b1211-235">如果資料尚未包裝在 <xref:System.Windows.DataObject>  中，則會自動包裝在新的 <xref:System.Windows.DataObject> 中。</span><span class="sxs-lookup"><span data-stu-id="b1211-235">If the data is not already wrapped in a <xref:System.Windows.DataObject>, it will automatically be wrapped in a new <xref:System.Windows.DataObject>.</span></span> <span data-ttu-id="b1211-236">若要傳遞多個資料項目，您必須自行建立 <xref:System.Windows.DataObject>，並傳遞給 <xref:System.Windows.DragDrop.DoDragDrop%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="b1211-236">To pass multiple data items, you must create the <xref:System.Windows.DataObject> yourself, and pass it to the <xref:System.Windows.DragDrop.DoDragDrop%2A> method.</span></span> <span data-ttu-id="b1211-237">如需詳細資訊，請參閱[資料和資料物件](data-and-data-objects.md)。</span><span class="sxs-lookup"><span data-stu-id="b1211-237">For more information, see [Data and Data Objects](data-and-data-objects.md).</span></span>  
  
 <span data-ttu-id="b1211-238">`allowedEffects` 參數可用來指定拖曳來源允許置放目標對所傳送的資料執行的動作。</span><span class="sxs-lookup"><span data-stu-id="b1211-238">The `allowedEffects` parameter is used to specify what the drag source will allow the drop target to do with the transferred data.</span></span> <span data-ttu-id="b1211-239">拖曳來源的常見值包括 <xref:System.Windows.DragDropEffects.Copy>、<xref:System.Windows.DragDropEffects.Move> 和  <xref:System.Windows.DragDropEffects.All>。</span><span class="sxs-lookup"><span data-stu-id="b1211-239">The common values for a drag source are <xref:System.Windows.DragDropEffects.Copy>, <xref:System.Windows.DragDropEffects.Move>, and <xref:System.Windows.DragDropEffects.All>.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="b1211-240">您也可以使用置放目標，來指定預期要回應置放資料的效果。</span><span class="sxs-lookup"><span data-stu-id="b1211-240">The drop target is also able to specify what effects it intends in response to the dropped data.</span></span> <span data-ttu-id="b1211-241">例如，如果置放目標無法辨識要置放的資料類型，可透過將其允許的效果設定為 <xref:System.Windows.DragDropEffects.None> 來拒絕資料。</span><span class="sxs-lookup"><span data-stu-id="b1211-241">For example, if the drop target does not recognize the data type to be dropped, it can refuse the data by setting its allowed effects to <xref:System.Windows.DragDropEffects.None>.</span></span> <span data-ttu-id="b1211-242">通常會在 <xref:System.Windows.DragDrop.DragOver> 事件處理常式中執行這項作業。</span><span class="sxs-lookup"><span data-stu-id="b1211-242">It typically does this in its <xref:System.Windows.DragDrop.DragOver> event handler.</span></span>  
  
 <span data-ttu-id="b1211-243">拖曳來源可選擇性地處理 <xref:System.Windows.DragDrop.GiveFeedback> 和 <xref:System.Windows.DragDrop.QueryContinueDrag> 事件。</span><span class="sxs-lookup"><span data-stu-id="b1211-243">A drag source can optionally handle the <xref:System.Windows.DragDrop.GiveFeedback> and <xref:System.Windows.DragDrop.QueryContinueDrag> events.</span></span> <span data-ttu-id="b1211-244">除非您將事件標記為已處理，否則這些事件會使用預設處理常式。</span><span class="sxs-lookup"><span data-stu-id="b1211-244">These events have default handlers that are used unless you mark the events as handled.</span></span> <span data-ttu-id="b1211-245">除非您有變更其預設行為的特定需求，否則通常會忽略這些事件。</span><span class="sxs-lookup"><span data-stu-id="b1211-245">You will typically ignore these events unless you have a specific need to change their default behavior.</span></span>  
  
 <span data-ttu-id="b1211-246">在拖曳來源被拖曳的期間，會持續引發 <xref:System.Windows.DragDrop.GiveFeedback> 事件。</span><span class="sxs-lookup"><span data-stu-id="b1211-246">The <xref:System.Windows.DragDrop.GiveFeedback> event is raised continuously while the drag source is being dragged.</span></span> <span data-ttu-id="b1211-247">這個事件的預設處理常式會檢查拖曳來源是否在有效的置放目標上。</span><span class="sxs-lookup"><span data-stu-id="b1211-247">The default handler for this event checks whether the drag source is over a valid drop target.</span></span> <span data-ttu-id="b1211-248">如果是，則會檢查允許的置放目標效果。</span><span class="sxs-lookup"><span data-stu-id="b1211-248">If it is, it checks the allowed effects of the drop target.</span></span> <span data-ttu-id="b1211-249">然後將允許的置放效果回饋給使用者。</span><span class="sxs-lookup"><span data-stu-id="b1211-249">It then gives feedback to the end user regarding the allowed drop effects.</span></span> <span data-ttu-id="b1211-250">透過將滑鼠游標變更為不置放、複製或移動游標，通常可以完成這項作業。</span><span class="sxs-lookup"><span data-stu-id="b1211-250">This is typically done by changing the mouse cursor to a no-drop, copy, or move cursor.</span></span> <span data-ttu-id="b1211-251">只有在需要使用自訂游標提供回饋給使用者時，才應該處理這個事件。</span><span class="sxs-lookup"><span data-stu-id="b1211-251">You should only handle this event if you need to use custom cursors to provide feedback to the user.</span></span> <span data-ttu-id="b1211-252">如果您處理這個事件，請務必將它標記為已處理，如此一來，預設處理常式便不會覆寫您的處理常式。</span><span class="sxs-lookup"><span data-stu-id="b1211-252">If you handle this event, be sure to mark it as handled so that the default handler does not override your handler.</span></span>  
  
 <span data-ttu-id="b1211-253">在拖曳來源被拖曳的期間，會持續引發 <xref:System.Windows.DragDrop.QueryContinueDrag> 事件。</span><span class="sxs-lookup"><span data-stu-id="b1211-253">The <xref:System.Windows.DragDrop.QueryContinueDrag> event is raised continuously while the drag source is being dragged.</span></span> <span data-ttu-id="b1211-254">您可以處理這個事件，根據 ESC、SHIFT、CTRL 鍵和 ALT 鍵的狀態，以及滑鼠按鈕的狀態，來決定拖放作業的結束動作。</span><span class="sxs-lookup"><span data-stu-id="b1211-254">You can handle this event to determine what action ends the drag-and-drop operation based on the state of the ESC, SHIFT, CTRL, and ALT keys, as well as the state of the mouse buttons.</span></span> <span data-ttu-id="b1211-255">這個事件的預設處理常式會在按下 ESC 鍵時取消拖放作業，並在放開滑鼠按鈕時置放資料。</span><span class="sxs-lookup"><span data-stu-id="b1211-255">The default handler for this event cancels the drag-and-drop operation if the ESC key is pressed, and drops the data if the mouse button is released.</span></span>  
  
> [!CAUTION]
> <span data-ttu-id="b1211-256">在拖放作業期間，會持續引發這些事件。</span><span class="sxs-lookup"><span data-stu-id="b1211-256">These events are raised continuously during the drag-and-drop operation.</span></span> <span data-ttu-id="b1211-257">因此，您應該避免事件處理常式有需要大量資源的工作。</span><span class="sxs-lookup"><span data-stu-id="b1211-257">Therefore, you should avoid resource-intensive tasks in the event handlers.</span></span>  <span data-ttu-id="b1211-258">例如，使用快取資料指標，而不是每次引發 <xref:System.Windows.DragDrop.GiveFeedback> 事件都建立新的資料指標。</span><span class="sxs-lookup"><span data-stu-id="b1211-258">For example, use a cached cursor instead of creating a new cursor each time the <xref:System.Windows.DragDrop.GiveFeedback> event is raised.</span></span>  
  
### <a name="enabling-an-element-to-be-a-drop-target"></a><span data-ttu-id="b1211-259">使某個項目成為置放目標</span><span class="sxs-lookup"><span data-stu-id="b1211-259">Enabling an Element to be a Drop Target</span></span>  
 <span data-ttu-id="b1211-260">置放目標物件負責：</span><span class="sxs-lookup"><span data-stu-id="b1211-260">An object that is a drop target is responsible for:</span></span>  
  
- <span data-ttu-id="b1211-261">指出它是有效的置放目標。</span><span class="sxs-lookup"><span data-stu-id="b1211-261">Specifying that it is a valid drop target.</span></span>  
  
- <span data-ttu-id="b1211-262">在拖曳來源被拖曳到目標上時回應拖曳來源。</span><span class="sxs-lookup"><span data-stu-id="b1211-262">Responding to the drag source when it drags over the target.</span></span>  
  
- <span data-ttu-id="b1211-263">檢查傳送的資料格式是可接收的格式。</span><span class="sxs-lookup"><span data-stu-id="b1211-263">Checking that the transferred data is in a format that it can receive.</span></span>  
  
- <span data-ttu-id="b1211-264">處理置放的資料。</span><span class="sxs-lookup"><span data-stu-id="b1211-264">Processing the dropped data.</span></span>  
  
 <span data-ttu-id="b1211-265">若要指定某個項目做為置放目標，您可以將其 <xref:System.Windows.UIElement.AllowDrop%2A> 屬性設定為 `true`。</span><span class="sxs-lookup"><span data-stu-id="b1211-265">To specify that an element is a drop target, you set its <xref:System.Windows.UIElement.AllowDrop%2A> property to `true`.</span></span> <span data-ttu-id="b1211-266">接著會在項目上引發置放目標事件，以便您處理這些事件。</span><span class="sxs-lookup"><span data-stu-id="b1211-266">The drop target events will then be raised on the element so that you can handle them.</span></span> <span data-ttu-id="b1211-267">在拖放作業期間，置放目標上會發生以下一連串事件：</span><span class="sxs-lookup"><span data-stu-id="b1211-267">During a drag-and-drop operation, the following sequence of events occurs on the drop target:</span></span>  
  
1. <xref:System.Windows.DragDrop.DragEnter>  
  
2. <xref:System.Windows.DragDrop.DragOver>  
  
3. <span data-ttu-id="b1211-268"><xref:System.Windows.DragDrop.DragLeave> 或 <xref:System.Windows.DragDrop.Drop></span><span class="sxs-lookup"><span data-stu-id="b1211-268"><xref:System.Windows.DragDrop.DragLeave> or <xref:System.Windows.DragDrop.Drop></span></span>  
  
 <span data-ttu-id="b1211-269"><xref:System.Windows.DragDrop.DragEnter> 事件會在將資料拖曳到置放目標的界限內時發生。</span><span class="sxs-lookup"><span data-stu-id="b1211-269">The <xref:System.Windows.DragDrop.DragEnter> event occurs when the data is dragged into the drop target's boundary.</span></span> <span data-ttu-id="b1211-270">您通常會處理這個事件來預覽拖放作業的效果 (如果適用於應用程式的話)。</span><span class="sxs-lookup"><span data-stu-id="b1211-270">You typically handle this event to provide a preview of the effects of the drag-and-drop operation, if appropriate for your application.</span></span> <span data-ttu-id="b1211-271">請勿在 <xref:System.Windows.DragEventArgs.Effects%2A?displayProperty=nameWithType> 事件中設定 <xref:System.Windows.DragDrop.DragEnter> 屬性，因為它會在 <xref:System.Windows.DragDrop.DragOver> 事件中遭到覆寫。</span><span class="sxs-lookup"><span data-stu-id="b1211-271">Do not set the <xref:System.Windows.DragEventArgs.Effects%2A?displayProperty=nameWithType> property in the <xref:System.Windows.DragDrop.DragEnter> event, as it will be overwritten in the <xref:System.Windows.DragDrop.DragOver> event.</span></span>  
  
 <span data-ttu-id="b1211-272">下列範例示範 <xref:System.Windows.DragDrop.DragEnter> 項目的 <xref:System.Windows.Shapes.Ellipse> 事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="b1211-272">The following example shows the <xref:System.Windows.DragDrop.DragEnter> event handler for an <xref:System.Windows.Shapes.Ellipse> element.</span></span> <span data-ttu-id="b1211-273">這個程式碼會儲存目前的 <xref:System.Windows.Shapes.Shape.Fill%2A> 筆刷，來預覽拖放作業的效果。</span><span class="sxs-lookup"><span data-stu-id="b1211-273">This code previews the effects of the drag-and-drop operation by saving the current <xref:System.Windows.Shapes.Shape.Fill%2A> brush.</span></span> <span data-ttu-id="b1211-274">接著它會使用 <xref:System.Windows.DataObject.GetDataPresent%2A> 方法來檢查是否將 <xref:System.Windows.DataObject> 拖曳到橢圓形上，該橢圓形包含可轉換成 <xref:System.Windows.Media.Brush> 的字串資料。</span><span class="sxs-lookup"><span data-stu-id="b1211-274">It then uses the <xref:System.Windows.DataObject.GetDataPresent%2A> method to check whether the <xref:System.Windows.DataObject> being dragged over the ellipse contains string data that can be converted to a <xref:System.Windows.Media.Brush>.</span></span> <span data-ttu-id="b1211-275">如果是，則會使用 <xref:System.Windows.DataObject.GetData%2A> 方法擷取資料。</span><span class="sxs-lookup"><span data-stu-id="b1211-275">If so, the data is extracted using the <xref:System.Windows.DataObject.GetData%2A> method.</span></span> <span data-ttu-id="b1211-276">接著它會轉換成 <xref:System.Windows.Media.Brush> 並套用至橢圓形。</span><span class="sxs-lookup"><span data-stu-id="b1211-276">It is then converted to a <xref:System.Windows.Media.Brush> and applied to the ellipse.</span></span> <span data-ttu-id="b1211-277">這項變更會在 <xref:System.Windows.DragDrop.DragLeave> 事件處理常式中還原。</span><span class="sxs-lookup"><span data-stu-id="b1211-277">The change is reverted in the <xref:System.Windows.DragDrop.DragLeave> event handler.</span></span> <span data-ttu-id="b1211-278">如果無法將資料轉換成 <xref:System.Windows.Media.Brush>，則不會執行任何動作。</span><span class="sxs-lookup"><span data-stu-id="b1211-278">If the data cannot be converted to a <xref:System.Windows.Media.Brush>, no action is performed.</span></span>  
  
 [!code-csharp[DragDropSnippets#DragEnter](~/samples/snippets/csharp/VS_Snippets_Wpf/dragdropsnippets/cs/mainwindow.xaml.cs#dragenter)]
 [!code-vb[DragDropSnippets#DragEnter](~/samples/snippets/visualbasic/VS_Snippets_Wpf/dragdropsnippets/vb/mainwindow.xaml.vb#dragenter)]  
  
 <span data-ttu-id="b1211-279"><xref:System.Windows.DragDrop.DragOver> 事件會在將資料拖曳到置放目標上時持續發生。</span><span class="sxs-lookup"><span data-stu-id="b1211-279">The <xref:System.Windows.DragDrop.DragOver> event occurs continuously while the data is dragged over the drop target.</span></span> <span data-ttu-id="b1211-280">這個事件會搭配拖曳來源上的 <xref:System.Windows.DragDrop.GiveFeedback> 事件。</span><span class="sxs-lookup"><span data-stu-id="b1211-280">This event is paired with the <xref:System.Windows.DragDrop.GiveFeedback> event on the drag source.</span></span> <span data-ttu-id="b1211-281">在 <xref:System.Windows.DragDrop.DragOver> 事件處理常式中，您通常會使用 <xref:System.Windows.DataObject.GetDataPresent%2A> 和 <xref:System.Windows.DataObject.GetData%2A> 方法來檢查傳送的資料格式是否為置放目標可以處理的格式。</span><span class="sxs-lookup"><span data-stu-id="b1211-281">In the <xref:System.Windows.DragDrop.DragOver> event handler, you typically use the <xref:System.Windows.DataObject.GetDataPresent%2A> and <xref:System.Windows.DataObject.GetData%2A> methods to check whether the transferred data is in a format that the drop target can process.</span></span> <span data-ttu-id="b1211-282">您也可以檢查是否按下任何輔助按鍵，這通常會指出使用者是否想要移動或複製動作。</span><span class="sxs-lookup"><span data-stu-id="b1211-282">You can also check whether any modifier keys are pressed, which will typically indicate whether the user intends a move or copy action.</span></span> <span data-ttu-id="b1211-283">執行這些檢查之後，您可以設定 <xref:System.Windows.DragEventArgs.Effects%2A?displayProperty=nameWithType> 屬性，以通知拖曳來源有關置放資料的效果。</span><span class="sxs-lookup"><span data-stu-id="b1211-283">After these checks are performed, you set the <xref:System.Windows.DragEventArgs.Effects%2A?displayProperty=nameWithType> property to notify the drag source what effect dropping the data will have.</span></span> <span data-ttu-id="b1211-284">拖曳來源會以 <xref:System.Windows.DragDrop.GiveFeedback> 事件引數接收這項資訊，並可設定適當的資料指標來提供回饋給使用者。</span><span class="sxs-lookup"><span data-stu-id="b1211-284">The drag source receives this information in the <xref:System.Windows.DragDrop.GiveFeedback> event args, and can set an appropriate cursor to give feedback to the user.</span></span>  
  
 <span data-ttu-id="b1211-285">下列範例示範 <xref:System.Windows.DragDrop.DragOver> 項目的 <xref:System.Windows.Shapes.Ellipse> 事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="b1211-285">The following example shows the <xref:System.Windows.DragDrop.DragOver> event handler for an <xref:System.Windows.Shapes.Ellipse> element.</span></span> <span data-ttu-id="b1211-286">這個程式碼會檢查是否要將 <xref:System.Windows.DataObject> 拖曳到橢圓形上，該橢圓形包含可轉換成 <xref:System.Windows.Media.Brush> 的字串資料。</span><span class="sxs-lookup"><span data-stu-id="b1211-286">This code checks to see if the <xref:System.Windows.DataObject> being dragged over the ellipse contains string data that can be converted to a <xref:System.Windows.Media.Brush>.</span></span> <span data-ttu-id="b1211-287">如果是，則會將 <xref:System.Windows.DragEventArgs.Effects%2A?displayProperty=nameWithType> 屬性設定為 <xref:System.Windows.DragDropEffects.Copy>。</span><span class="sxs-lookup"><span data-stu-id="b1211-287">If so, it sets the <xref:System.Windows.DragEventArgs.Effects%2A?displayProperty=nameWithType> property to <xref:System.Windows.DragDropEffects.Copy>.</span></span> <span data-ttu-id="b1211-288">這會向拖曳來源表示資料可以複製到橢圓形。</span><span class="sxs-lookup"><span data-stu-id="b1211-288">This indicates to the drag source that the data can be copied to the ellipse.</span></span> <span data-ttu-id="b1211-289">如果無法將資料轉換成 <xref:System.Windows.Media.Brush>，則會將 <xref:System.Windows.DragEventArgs.Effects%2A?displayProperty=nameWithType> 屬性設定為 <xref:System.Windows.DragDropEffects.None>。</span><span class="sxs-lookup"><span data-stu-id="b1211-289">If the data cannot be converted to a <xref:System.Windows.Media.Brush>, the <xref:System.Windows.DragEventArgs.Effects%2A?displayProperty=nameWithType> property is set to <xref:System.Windows.DragDropEffects.None>.</span></span> <span data-ttu-id="b1211-290">這會向拖曳來源表示橢圓形不是資料的有效置放目標。</span><span class="sxs-lookup"><span data-stu-id="b1211-290">This indicates to the drag source that the ellipse is not a valid drop target for the data.</span></span>  
  
 [!code-csharp[DragDropSnippets#DragOver](~/samples/snippets/csharp/VS_Snippets_Wpf/dragdropsnippets/cs/mainwindow.xaml.cs#dragover)]
 [!code-vb[DragDropSnippets#DragOver](~/samples/snippets/visualbasic/VS_Snippets_Wpf/dragdropsnippets/vb/mainwindow.xaml.vb#dragover)]  
  
 <span data-ttu-id="b1211-291"><xref:System.Windows.DragDrop.DragLeave> 事件會在將資料拖曳出目標的界限但未置放時發生。</span><span class="sxs-lookup"><span data-stu-id="b1211-291">The <xref:System.Windows.DragDrop.DragLeave> event occurs when the data is dragged out of the target's boundary without being dropped.</span></span> <span data-ttu-id="b1211-292">您可以處理這個事件，以復原您在 <xref:System.Windows.DragDrop.DragEnter> 事件處理常式中執行的任何動作。</span><span class="sxs-lookup"><span data-stu-id="b1211-292">You handle this event to undo anything that you did in the <xref:System.Windows.DragDrop.DragEnter> event handler.</span></span>  
  
 <span data-ttu-id="b1211-293">下列範例示範 <xref:System.Windows.DragDrop.DragLeave> 項目的 <xref:System.Windows.Shapes.Ellipse> 事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="b1211-293">The following example shows the <xref:System.Windows.DragDrop.DragLeave> event handler for an <xref:System.Windows.Shapes.Ellipse> element.</span></span> <span data-ttu-id="b1211-294">這個程式碼透過將儲存的 <xref:System.Windows.Media.Brush> 套用至橢圓形，來復原在 <xref:System.Windows.DragDrop.DragEnter> 事件處理常式中執行的預覽。</span><span class="sxs-lookup"><span data-stu-id="b1211-294">This code undoes the preview performed in the <xref:System.Windows.DragDrop.DragEnter> event handler by applying the saved <xref:System.Windows.Media.Brush> to the ellipse.</span></span>  
  
 [!code-csharp[DragDropSnippets#DragLeave](~/samples/snippets/csharp/VS_Snippets_Wpf/dragdropsnippets/cs/mainwindow.xaml.cs#dragleave)]
 [!code-vb[DragDropSnippets#DragLeave](~/samples/snippets/visualbasic/VS_Snippets_Wpf/dragdropsnippets/vb/mainwindow.xaml.vb#dragleave)]  
  
 <span data-ttu-id="b1211-295"><xref:System.Windows.DragDrop.Drop> 事件會在將資料置放到置放目標上時發生；根據預設，當放開滑鼠按鈕時，就會發生這個事件。</span><span class="sxs-lookup"><span data-stu-id="b1211-295">The <xref:System.Windows.DragDrop.Drop> event occurs when the data is dropped over the drop target; by default, this happens when the mouse button is released.</span></span> <span data-ttu-id="b1211-296">在 <xref:System.Windows.DragDrop.Drop> 事件處理常式中，您可以使用 <xref:System.Windows.DataObject.GetData%2A> 方法從 <xref:System.Windows.DataObject> 擷取傳送的資料，並執行應用程式所需的任何資料處理。</span><span class="sxs-lookup"><span data-stu-id="b1211-296">In the <xref:System.Windows.DragDrop.Drop> event handler, you use the <xref:System.Windows.DataObject.GetData%2A> method to extract the transferred data from the <xref:System.Windows.DataObject> and perform any data processing that your application requires.</span></span> <span data-ttu-id="b1211-297"><xref:System.Windows.DragDrop.Drop> 事件會結束拖放作業。</span><span class="sxs-lookup"><span data-stu-id="b1211-297">The <xref:System.Windows.DragDrop.Drop> event ends the drag-and-drop operation.</span></span>  
  
 <span data-ttu-id="b1211-298">下列範例示範 <xref:System.Windows.DragDrop.Drop> 項目的 <xref:System.Windows.Shapes.Ellipse> 事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="b1211-298">The following example shows the <xref:System.Windows.DragDrop.Drop> event handler for an <xref:System.Windows.Shapes.Ellipse> element.</span></span> <span data-ttu-id="b1211-299">這個程式碼會套用拖放作業的效果，類似 <xref:System.Windows.DragDrop.DragEnter> 事件處理常式中的程式碼。</span><span class="sxs-lookup"><span data-stu-id="b1211-299">This code applies the effects of the drag-and-drop operation, and is similar to the code in the <xref:System.Windows.DragDrop.DragEnter> event handler.</span></span> <span data-ttu-id="b1211-300">它會檢查是否要將 <xref:System.Windows.DataObject> 拖曳到橢圓形上，該橢圓形包含可轉換成 <xref:System.Windows.Media.Brush> 的字串資料。</span><span class="sxs-lookup"><span data-stu-id="b1211-300">It checks to see if the <xref:System.Windows.DataObject> being dragged over the ellipse contains string data that can be converted to a <xref:System.Windows.Media.Brush>.</span></span> <span data-ttu-id="b1211-301">如果是，則會將 <xref:System.Windows.Media.Brush> 套用至橢圓形。</span><span class="sxs-lookup"><span data-stu-id="b1211-301">If so, the <xref:System.Windows.Media.Brush> is applied to the ellipse.</span></span> <span data-ttu-id="b1211-302">如果無法將資料轉換成 <xref:System.Windows.Media.Brush>，則不會執行任何動作。</span><span class="sxs-lookup"><span data-stu-id="b1211-302">If the data cannot be converted to a <xref:System.Windows.Media.Brush>, no action is performed.</span></span>  
  
 [!code-csharp[DragDropSnippets#Drop](~/samples/snippets/csharp/VS_Snippets_Wpf/dragdropsnippets/cs/mainwindow.xaml.cs#drop)]
 [!code-vb[DragDropSnippets#Drop](~/samples/snippets/visualbasic/VS_Snippets_Wpf/dragdropsnippets/vb/mainwindow.xaml.vb#drop)]  
  
## <a name="see-also"></a><span data-ttu-id="b1211-303">另請參閱</span><span class="sxs-lookup"><span data-stu-id="b1211-303">See also</span></span>

- <xref:System.Windows.Clipboard>
- [<span data-ttu-id="b1211-304">逐步解說：在使用者控制項上啟用拖放功能</span><span class="sxs-lookup"><span data-stu-id="b1211-304">Walkthrough: Enabling Drag and Drop on a User Control</span></span>](walkthrough-enabling-drag-and-drop-on-a-user-control.md)
- [<span data-ttu-id="b1211-305">操作說明主題</span><span class="sxs-lookup"><span data-stu-id="b1211-305">How-to Topics</span></span>](drag-and-drop-how-to-topics.md)
- [<span data-ttu-id="b1211-306">拖放功能</span><span class="sxs-lookup"><span data-stu-id="b1211-306">Drag and Drop</span></span>](drag-and-drop.md)
