---
title: 活動定義範圍和可視性
ms.date: 03/30/2017
ms.assetid: ccdffa07-9503-4eea-a61b-17f1564368b7
ms.openlocfilehash: c7f656fee4960a8c43ac58abafba400ed9b35bc1
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/26/2020
ms.locfileid: "96289161"
---
# <a name="activity-definition-scoping-and-visibility"></a><span data-ttu-id="74221-102">活動定義範圍和可視性</span><span class="sxs-lookup"><span data-stu-id="74221-102">Activity Definition Scoping and Visibility</span></span>

<span data-ttu-id="74221-103">就像物件的範圍和可視性一樣，活動定義範圍和可視性是其他物件或活動存取活動成員的能力。</span><span class="sxs-lookup"><span data-stu-id="74221-103">Activity definition scoping and visibility, just like scoping and visibility of an object, is the ability of other objects or activities to access members of the activity.</span></span> <span data-ttu-id="74221-104">活動定義是由下列實作所執行：</span><span class="sxs-lookup"><span data-stu-id="74221-104">Activity definition is performed by the following implementations:</span></span>  
  
1. <span data-ttu-id="74221-105">決定活動公開給其使用者的成員 (<xref:System.Activities.Argument>、<xref:System.Activities.Variable> 和 <xref:System.Activities.ActivityDelegate> 物件及子活動)。</span><span class="sxs-lookup"><span data-stu-id="74221-105">Determining the members (<xref:System.Activities.Argument>, <xref:System.Activities.Variable>, and <xref:System.Activities.ActivityDelegate> objects, and child activities) an activity exposes to its users.</span></span>  
  
2. <span data-ttu-id="74221-106">實作活動的執行邏輯</span><span class="sxs-lookup"><span data-stu-id="74221-106">Implementing the execution logic of the activity</span></span>  
  
 <span data-ttu-id="74221-107">此實作所牽涉到的成員可能未公開給活動的消費者，但是為實作的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="74221-107">The implementation may involve members that are not exposed to consumers of the activity, but are rather details of the implementation.</span></span>  <span data-ttu-id="74221-108">與型別定義類似，活動模型允許作者限定有關所定義之活動定義的活動成員可視性。</span><span class="sxs-lookup"><span data-stu-id="74221-108">Similar to type definition, the activity model allows an author to qualify the visibility of an activity member regarding the definition of the activity being defined.</span></span>  <span data-ttu-id="74221-109">此可視性會控管成員使用的層面，例如資料範圍。</span><span class="sxs-lookup"><span data-stu-id="74221-109">This visibility governs aspects of member usage, such as data scoping.</span></span>  
  
## <a name="scope"></a><span data-ttu-id="74221-110">影響範圍</span><span class="sxs-lookup"><span data-stu-id="74221-110">Scope</span></span>  

 <span data-ttu-id="74221-111">除了資料範圍以外，活動模型可視性也可以限制存取活動的其他層面，例如驗證、偵錯或追蹤。</span><span class="sxs-lookup"><span data-stu-id="74221-111">In addition to data scoping, activity model visibility can restrict access to other aspects of the activity, such as validation, debugging, tracking, or tracing.</span></span> <span data-ttu-id="74221-112">執行屬性會使用可視性與範圍，將執行特性限制為特定的定義範圍。</span><span class="sxs-lookup"><span data-stu-id="74221-112">Execution properties use visibility and scoping for constraining execution characteristics to a particular scope of definition.</span></span> <span data-ttu-id="74221-113">次要根項目會使用可視性與範圍，將 <xref:System.Activities.Statements.CompensableActivity> 所擷取的狀態限制為使用可補償之活動的定義範圍。</span><span class="sxs-lookup"><span data-stu-id="74221-113">Secondary roots use visibility and scoping to constrain the state captured by a <xref:System.Activities.Statements.CompensableActivity> to the scope of definition in which the compensable activities are used.</span></span>  
  
## <a name="definition-and-usage"></a><span data-ttu-id="74221-114">定義與使用</span><span class="sxs-lookup"><span data-stu-id="74221-114">Definition and usage</span></span>  

 <span data-ttu-id="74221-115">工作流程的撰寫方式是藉由繼承自基底活動類別，以及使用 [內建活動程式庫中](net-framework-4-5-built-in-activity-library.md)的活動來撰寫新的活動。</span><span class="sxs-lookup"><span data-stu-id="74221-115">A workflow is written by authoring new activities by inheriting from base activity classes, and by using activities from the [Built-In Activity Library](net-framework-4-5-built-in-activity-library.md).</span></span> <span data-ttu-id="74221-116">為了能夠使用活動，活動作者必須設定其定義之每一個元件的可視性。</span><span class="sxs-lookup"><span data-stu-id="74221-116">In order to use an activity, the activity author must configure the visibility of each component of its definition.</span></span>  
  
### <a name="activity-members"></a><span data-ttu-id="74221-117">活動成員</span><span class="sxs-lookup"><span data-stu-id="74221-117">Activity Members</span></span>  

 <span data-ttu-id="74221-118">活動模型會定義該活動提供給消費者使用的引數、變數、委派和子活動。</span><span class="sxs-lookup"><span data-stu-id="74221-118">The activity model defines the arguments, variables, delegates, and child activities that the activity makes available to consumers.</span></span> <span data-ttu-id="74221-119">這些成員的每一個都可以宣告為 `public` 或 `private`。</span><span class="sxs-lookup"><span data-stu-id="74221-119">Each of these members can be declared as `public` or `private`.</span></span> <span data-ttu-id="74221-120">Public 成員是由活動的消費者所設定，而 `private` 成員則會使用活動作者所固定的實作。</span><span class="sxs-lookup"><span data-stu-id="74221-120">Public members are configured by the consumer of the activity, whereas `private` members use an implementation fixed by the author of the activity.</span></span> <span data-ttu-id="74221-121">資料範圍的可視性規則如下所示：</span><span class="sxs-lookup"><span data-stu-id="74221-121">The visibility rules for data scoping are as follows:</span></span>  
  
1. <span data-ttu-id="74221-122">Public 成員以及 Public 子活動的 Public 成員可以參考 Public 變數。</span><span class="sxs-lookup"><span data-stu-id="74221-122">Public members and the public members of public child activities can reference public variables.</span></span>  
  
2. <span data-ttu-id="74221-123">Private 成員以及 public 子活動的 public 成員可以參考引數和 private 變數。</span><span class="sxs-lookup"><span data-stu-id="74221-123">Private members and the public members of public child activities can reference arguments and private variables.</span></span>  
  
 <span data-ttu-id="74221-124">可由活動的消費者所設定的成員絕對不能為 private。</span><span class="sxs-lookup"><span data-stu-id="74221-124">A member that can be set by the consumer of an activity should never be made private.</span></span>  
  
### <a name="authoring-models"></a><span data-ttu-id="74221-125">撰寫模型</span><span class="sxs-lookup"><span data-stu-id="74221-125">Authoring Models</span></span>  

 <span data-ttu-id="74221-126">自訂活動是使用 <xref:System.Activities.NativeActivity>、<xref:System.Activities.Activity>、<xref:System.Activities.CodeActivity> 或 <xref:System.Activities.AsyncCodeActivity> 所定義。</span><span class="sxs-lookup"><span data-stu-id="74221-126">Custom activities are defined by using <xref:System.Activities.NativeActivity>, <xref:System.Activities.Activity>, <xref:System.Activities.CodeActivity>, or <xref:System.Activities.AsyncCodeActivity>.</span></span> <span data-ttu-id="74221-127">衍生自這些類別的活動可以公開具有不同可視性的不同成員型別。</span><span class="sxs-lookup"><span data-stu-id="74221-127">Activities that derive from these classes can expose different member types with different visibilities.</span></span>  
  
#### <a name="nativeactivity"></a><span data-ttu-id="74221-128">NativeActivity</span><span class="sxs-lookup"><span data-stu-id="74221-128">NativeActivity</span></span>  

 <span data-ttu-id="74221-129">衍生自 <xref:System.Activities.NativeActivity> 的活動擁有以命令性程式碼所撰寫的行為，而且可以選擇使用現有的活動加以定義。</span><span class="sxs-lookup"><span data-stu-id="74221-129">Activities that derive from <xref:System.Activities.NativeActivity> have behavior that is written in imperative code, and can optionally be defined by using existing activities.</span></span> <span data-ttu-id="74221-130">從 <xref:System.Activities.NativeActivity> 衍生活動會授與執行階段所公開之所有功能的存取權。</span><span class="sxs-lookup"><span data-stu-id="74221-130">Deriving activities from <xref:System.Activities.NativeActivity> grants access to all of the features exposed by the runtime.</span></span> <span data-ttu-id="74221-131">這類活動的任何成員都可以使用 public 或 private 可視性加以定義，但是只能宣告為 `public` 的引數除外。</span><span class="sxs-lookup"><span data-stu-id="74221-131">Any member of such an activity can be defined by using either public or private visibility, except arguments, which can only be declared as `public`.</span></span>  
  
 <span data-ttu-id="74221-132">衍生自 <xref:System.Activities.NativeActivity> 的類別成員會宣告給執行階段，其方式是使用傳遞給 <xref:System.Activities.NativeActivityMetadata> 方法的 <xref:System.Activities.NativeActivity.CacheMetadata%2A> Struct。</span><span class="sxs-lookup"><span data-stu-id="74221-132">Members of classes derived from <xref:System.Activities.NativeActivity> are declared to the runtime using the <xref:System.Activities.NativeActivityMetadata> struct passed to the <xref:System.Activities.NativeActivity.CacheMetadata%2A> method.</span></span>  
  
#### <a name="activity"></a><span data-ttu-id="74221-133">活動</span><span class="sxs-lookup"><span data-stu-id="74221-133">Activity</span></span>  

 <span data-ttu-id="74221-134">使用 <xref:System.Activities.Activity> 建立的活動所擁有的行為，只會透過撰寫其他活動加以設計。</span><span class="sxs-lookup"><span data-stu-id="74221-134">Activities created by using <xref:System.Activities.Activity> have behavior that is designed strictly through composing other activities.</span></span> <span data-ttu-id="74221-135"><xref:System.Activities.Activity> 類別有一個子活動實作，這是由執行階段使用 <xref:System.Activities.Activity.Implementation%2A> 所取得。</span><span class="sxs-lookup"><span data-stu-id="74221-135">The <xref:System.Activities.Activity> class has one implementation child activity, obtained by the runtime using <xref:System.Activities.Activity.Implementation%2A>.</span></span> <span data-ttu-id="74221-136">衍生自 <xref:System.Activities.Activity> 的活動可以定義 public 引數、public 變數、匯入的 ActivityDelegates 和匯入的 Activities。</span><span class="sxs-lookup"><span data-stu-id="74221-136">An activity deriving from <xref:System.Activities.Activity> can define public arguments, public variables, imported ActivityDelegates, and imported Activities.</span></span>  
  
 <span data-ttu-id="74221-137">匯入的 ActivityDelegates 和 Activities 會宣告為活動的 public 子系，但是不能由活動直接排程。</span><span class="sxs-lookup"><span data-stu-id="74221-137">Imported ActivityDelegates and Activities are declared as public children of the activity, but cannot be directly scheduled by the activity.</span></span> <span data-ttu-id="74221-138">驗證期間會使用這項資訊，以避免在絕對不會執行活動的位置執行面對父系的驗證。</span><span class="sxs-lookup"><span data-stu-id="74221-138">This information is used during validation to avoid running parent-facing validations at locations where the activity will never execute.</span></span> <span data-ttu-id="74221-139">此外，活動的實作也可以參考和排程匯入的子系，就像 public 子系一樣。</span><span class="sxs-lookup"><span data-stu-id="74221-139">Also, imported children, just like public children, can be referenced and scheduled by the activity’s implementation.</span></span> <span data-ttu-id="74221-140">這表示，匯入名為 Activity1 之活動的某項活動可以在排程 Activity1 的實作中包含 <xref:System.Activities.Statements.Sequence>。</span><span class="sxs-lookup"><span data-stu-id="74221-140">This means that an activity which imports an activity called Activity1 can contain a <xref:System.Activities.Statements.Sequence> in its implementation which schedules Activity1.</span></span>  
  
#### <a name="codeactivity-asynccodeactivity"></a><span data-ttu-id="74221-141">CodeActivity/ AsyncCodeActivity</span><span class="sxs-lookup"><span data-stu-id="74221-141">CodeActivity/ AsyncCodeActivity</span></span>  

 <span data-ttu-id="74221-142">此基底類別會在命令式程式碼中用來撰寫行為。</span><span class="sxs-lookup"><span data-stu-id="74221-142">This base class is used for authoring behavior in imperative code.</span></span> <span data-ttu-id="74221-143">衍生自這個類別的活動只能存取其所公開的引數。</span><span class="sxs-lookup"><span data-stu-id="74221-143">Activities that derive from this class only have access to the arguments they expose.</span></span> <span data-ttu-id="74221-144">這表示，只有這些活動可以公開的成員才是 public 引數。</span><span class="sxs-lookup"><span data-stu-id="74221-144">This means that the only members that these activities can expose are public arguments.</span></span> <span data-ttu-id="74221-145">沒有其他成員或可視性會套用到這些活動。</span><span class="sxs-lookup"><span data-stu-id="74221-145">No other members or visibilities apply to these activities.</span></span>  
  
#### <a name="summary-of-visibilities"></a><span data-ttu-id="74221-146">可視性摘要</span><span class="sxs-lookup"><span data-stu-id="74221-146">Summary of visibilities</span></span>  

 <span data-ttu-id="74221-147">下表摘要列出本章節稍早的資訊。</span><span class="sxs-lookup"><span data-stu-id="74221-147">The following table summarizes the information earlier in this section.</span></span>  
  
|<span data-ttu-id="74221-148">成員類型</span><span class="sxs-lookup"><span data-stu-id="74221-148">Member Type</span></span>|<span data-ttu-id="74221-149">NativeActivity</span><span class="sxs-lookup"><span data-stu-id="74221-149">NativeActivity</span></span>|<span data-ttu-id="74221-150">活動</span><span class="sxs-lookup"><span data-stu-id="74221-150">Activity</span></span>|<span data-ttu-id="74221-151">CodeActivity/ AsyncCodeActivity</span><span class="sxs-lookup"><span data-stu-id="74221-151">CodeActivity/ AsyncCodeActivity</span></span>|  
|-----------------|--------------------|--------------|--------------------------------------|  
|<span data-ttu-id="74221-152">引數</span><span class="sxs-lookup"><span data-stu-id="74221-152">Arguments</span></span>|<span data-ttu-id="74221-153">Public/ Private</span><span class="sxs-lookup"><span data-stu-id="74221-153">Public/ Private</span></span>|<span data-ttu-id="74221-154">公開</span><span class="sxs-lookup"><span data-stu-id="74221-154">Public</span></span>|<span data-ttu-id="74221-155">不適用</span><span class="sxs-lookup"><span data-stu-id="74221-155">not applicable</span></span>|  
|<span data-ttu-id="74221-156">變數</span><span class="sxs-lookup"><span data-stu-id="74221-156">Variables</span></span>|<span data-ttu-id="74221-157">Public/ Private</span><span class="sxs-lookup"><span data-stu-id="74221-157">Public/ Private</span></span>|<span data-ttu-id="74221-158">公開</span><span class="sxs-lookup"><span data-stu-id="74221-158">Public</span></span>|<span data-ttu-id="74221-159">不適用</span><span class="sxs-lookup"><span data-stu-id="74221-159">not applicable</span></span>|  
|<span data-ttu-id="74221-160">Child Activities</span><span class="sxs-lookup"><span data-stu-id="74221-160">Child Activities</span></span>|<span data-ttu-id="74221-161">Public/ Private</span><span class="sxs-lookup"><span data-stu-id="74221-161">Public/ Private</span></span>|<span data-ttu-id="74221-162">Public，實作中定義的一個固定 private 子系。</span><span class="sxs-lookup"><span data-stu-id="74221-162">Public, one fixed private child defined in Implementation.</span></span>|<span data-ttu-id="74221-163">不適用</span><span class="sxs-lookup"><span data-stu-id="74221-163">not applicable</span></span>|  
|<span data-ttu-id="74221-164">ActivityDelegates</span><span class="sxs-lookup"><span data-stu-id="74221-164">ActivityDelegates</span></span>|<span data-ttu-id="74221-165">Public/ Private</span><span class="sxs-lookup"><span data-stu-id="74221-165">Public/ Private</span></span>|<span data-ttu-id="74221-166">公開</span><span class="sxs-lookup"><span data-stu-id="74221-166">Public</span></span>|<span data-ttu-id="74221-167">不適用</span><span class="sxs-lookup"><span data-stu-id="74221-167">not applicable</span></span>|  
  
 <span data-ttu-id="74221-168">一般來說，活動的消費者所無法設定的成員不能為 public。</span><span class="sxs-lookup"><span data-stu-id="74221-168">In general, a member that cannot be set by the consumer of an activity should not be made public.</span></span>  
  
### <a name="execution-properties"></a><span data-ttu-id="74221-169">執行屬性</span><span class="sxs-lookup"><span data-stu-id="74221-169">Execution Properties</span></span>  

 <span data-ttu-id="74221-170">在某些情況下，將特定執行屬性的範圍設定為活動的 public 子系會很實用。</span><span class="sxs-lookup"><span data-stu-id="74221-170">In some scenarios, it is useful to scope a particular execution property to the public children of an activity.</span></span> <span data-ttu-id="74221-171"><xref:System.Activities.ExecutionProperties> 集合會將 <xref:System.Activities.ExecutionProperties.Add%2A> 方法提供給這項功能。</span><span class="sxs-lookup"><span data-stu-id="74221-171">The <xref:System.Activities.ExecutionProperties> collection provides this capability with the <xref:System.Activities.ExecutionProperties.Add%2A> method.</span></span> <span data-ttu-id="74221-172">這個方法有一個布林參數，可指示特定屬性的範圍為所有子系還是 public 子系。</span><span class="sxs-lookup"><span data-stu-id="74221-172">This method has a Boolean parameter indicating whether a particular property is scoped to all children, or just those that are public.</span></span> <span data-ttu-id="74221-173">如果這個參數設定為 `true`，此屬性只能讓 public 成員以及其 public 子系的 public 成員看到。</span><span class="sxs-lookup"><span data-stu-id="74221-173">If this parameter is set to `true`, the property will only be visible to public members and the public members of their public children.</span></span>  
  
### <a name="secondary-roots"></a><span data-ttu-id="74221-174">次要根項目</span><span class="sxs-lookup"><span data-stu-id="74221-174">Secondary Roots</span></span>  

 <span data-ttu-id="74221-175">次要根項目是執行階段的內部機制，可管理補償活動的狀態。</span><span class="sxs-lookup"><span data-stu-id="74221-175">A secondary root is the runtime’s internal mechanism for managing state for compensation activities.</span></span> <span data-ttu-id="74221-176">當 <xref:System.Activities.Statements.CompensableActivity> 執行完之後，不會立即清除它的狀態。</span><span class="sxs-lookup"><span data-stu-id="74221-176">When a <xref:System.Activities.Statements.CompensableActivity> has finished running, its state is not cleaned up immediately.</span></span> <span data-ttu-id="74221-177">該狀態會由執行階段的次要根項目所維護，直到補償時段完成為止。</span><span class="sxs-lookup"><span data-stu-id="74221-177">Instead, the state is maintained by the runtime in a secondary root until the compensation episode has completed.</span></span> <span data-ttu-id="74221-178">使用次要根項目所擷取的位置環境會對應到使用可補償活動的定義範圍。</span><span class="sxs-lookup"><span data-stu-id="74221-178">The location environments captured with the secondary root correspond to the scope of definition in which the Compensable activity is used.</span></span>
