---
title: 作法：匯入自訂原則判斷提示
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 1f41d787-accb-4a10-bfc6-a807671d1581
ms.openlocfilehash: fb5e3ba5faca1b32eef63ac174bcd7731ee50771
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/26/2020
ms.locfileid: "96249146"
---
# <a name="how-to-import-custom-policy-assertions"></a><span data-ttu-id="6099b-102">作法：匯入自訂原則判斷提示</span><span class="sxs-lookup"><span data-stu-id="6099b-102">How to: Import Custom Policy Assertions</span></span>

<span data-ttu-id="6099b-103">原則判斷提示描述服務端點的功能與需求。</span><span class="sxs-lookup"><span data-stu-id="6099b-103">Policy assertions describe the capabilities and requirements of a service endpoint.</span></span>  <span data-ttu-id="6099b-104">用戶端應用程式可使用服務中繼資料中的原則判斷提示，來設定用戶端繫結或自訂服務端點的服務合約。</span><span class="sxs-lookup"><span data-stu-id="6099b-104">Client applications can use policy assertions in service metadata to configure the client binding or to customize the service contract for a service endpoint.</span></span>  
  
 <span data-ttu-id="6099b-105">您可以藉由實作 <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> 介面並將該物件傳遞至中繼資料系統，或藉由在應用程式組態檔中註冊實作類型，來匯入自訂原則判斷提示。</span><span class="sxs-lookup"><span data-stu-id="6099b-105">Custom policy assertions are imported by implementing the <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> interface and passing that object to the metadata system or by registering the implementation type in your application configuration file.</span></span>  <span data-ttu-id="6099b-106">介面的實現 <xref:System.ServiceModel.Description.IPolicyImportExtension> 必須提供無參數的函式。</span><span class="sxs-lookup"><span data-stu-id="6099b-106">Implementations of the <xref:System.ServiceModel.Description.IPolicyImportExtension> interface must provide a parameterless constructor.</span></span>  
  
### <a name="to-import-custom-policy-assertions"></a><span data-ttu-id="6099b-107">若要匯入自訂原則判斷提示</span><span class="sxs-lookup"><span data-stu-id="6099b-107">To import custom policy assertions</span></span>  
  
1. <span data-ttu-id="6099b-108">在類別上實作 <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> 介面。</span><span class="sxs-lookup"><span data-stu-id="6099b-108">Implement the <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> interface on a class.</span></span> <span data-ttu-id="6099b-109">請參閱下列程序。</span><span class="sxs-lookup"><span data-stu-id="6099b-109">See the following procedures.</span></span>  
  
2. <span data-ttu-id="6099b-110">透過以下方式插入自訂原則匯入工具：</span><span class="sxs-lookup"><span data-stu-id="6099b-110">Insert the custom policy importer either by:</span></span>  
  
3. <span data-ttu-id="6099b-111">使用組態檔。</span><span class="sxs-lookup"><span data-stu-id="6099b-111">Using a configuration file.</span></span> <span data-ttu-id="6099b-112">請參閱下列程序。</span><span class="sxs-lookup"><span data-stu-id="6099b-112">See the following procedures.</span></span>  
  
4. <span data-ttu-id="6099b-113">使用設定檔搭配 [System.servicemodel 中繼資料公用程式工具 ( # A0) ](../servicemodel-metadata-utility-tool-svcutil-exe.md)。</span><span class="sxs-lookup"><span data-stu-id="6099b-113">Using a configuration file with [ServiceModel Metadata Utility Tool (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md).</span></span> <span data-ttu-id="6099b-114">請參閱下列程序。</span><span class="sxs-lookup"><span data-stu-id="6099b-114">See the following procedures.</span></span>  
  
5. <span data-ttu-id="6099b-115">以程式設計方式插入原則匯入工具。</span><span class="sxs-lookup"><span data-stu-id="6099b-115">Programmatically inserting the policy importer.</span></span> <span data-ttu-id="6099b-116">請參閱下列程序。</span><span class="sxs-lookup"><span data-stu-id="6099b-116">See the following procedures.</span></span>  
  
### <a name="to-implement-the-systemservicemodeldescriptionipolicyimportextension-interface-on-any-class"></a><span data-ttu-id="6099b-117">實作任何類別上的 System.ServiceModel.Description.IPolicyImportExtension 介面</span><span class="sxs-lookup"><span data-stu-id="6099b-117">To implement the System.ServiceModel.Description.IPolicyImportExtension interface on any class</span></span>  
  
1. <span data-ttu-id="6099b-118">在 <xref:System.ServiceModel.Description.IPolicyImportExtension.ImportPolicy%2A?displayProperty=nameWithType> 方法中，對於每個您感興趣的原則主體，在傳遞至方法的 <xref:System.ServiceModel.Description.PolicyConversionContext?displayProperty=nameWithType> 物件上呼叫適當的方法 (視您要的判斷提示範圍而定) 來尋找您要匯入的原則判斷提示。</span><span class="sxs-lookup"><span data-stu-id="6099b-118">In the <xref:System.ServiceModel.Description.IPolicyImportExtension.ImportPolicy%2A?displayProperty=nameWithType> method, for each policy subject that you are interested in, find the policy assertions that you want to import by calling the appropriate method (depending upon the scope of the assertion that you want) on the <xref:System.ServiceModel.Description.PolicyConversionContext?displayProperty=nameWithType> object passed to the method.</span></span> <span data-ttu-id="6099b-119">下列程式碼範例說明如何使用 <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> 方法找到自訂原則判斷提示，並用一個步驟將它從集合中移除。</span><span class="sxs-lookup"><span data-stu-id="6099b-119">The following code example shows how to use the <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> method to locate the custom policy assertion and remove it from the collection in one step.</span></span> <span data-ttu-id="6099b-120">如果您使用移除方法找到並移除判斷提示，就不必執行步驟 4。</span><span class="sxs-lookup"><span data-stu-id="6099b-120">If you use the remove method to locate and remove the assertion, you do not have to perform step 4.</span></span>  
  
     [!code-csharp[CustomPolicySample#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/custompolicysample/cs/policyimporter.cs#9)]
     [!code-vb[CustomPolicySample#9](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/custompolicysample/vb/policyimporter.vb#9)]  
  
2. <span data-ttu-id="6099b-121">處理原則判斷提示。</span><span class="sxs-lookup"><span data-stu-id="6099b-121">Process the policy assertions.</span></span> <span data-ttu-id="6099b-122">請注意，原則系統不會正規化巢狀原則和 `wsp:optional`。</span><span class="sxs-lookup"><span data-stu-id="6099b-122">Note that the policy system does not normalize nested policies and `wsp:optional`.</span></span> <span data-ttu-id="6099b-123">您必須在原則匯入延伸實作中處理這些建構函式。</span><span class="sxs-lookup"><span data-stu-id="6099b-123">You must process these constructs in your policy import extension implementation.</span></span>  
  
3. <span data-ttu-id="6099b-124">對支援原則判斷提示所指定能力或需求的繫結程序或合約執行自訂。</span><span class="sxs-lookup"><span data-stu-id="6099b-124">Perform the customization to the binding or contract that supports the capability or requirement specified by the policy assertion.</span></span> <span data-ttu-id="6099b-125">判斷提示通常會指出繫結需要特別的組態或特定的繫結項目。</span><span class="sxs-lookup"><span data-stu-id="6099b-125">Typically assertions indicate that a binding requires a particular configuration or a specific binding element.</span></span> <span data-ttu-id="6099b-126">透過存取 <xref:System.ServiceModel.Description.PolicyConversionContext.BindingElements%2A?displayProperty=nameWithType> 屬性進行這些修改。</span><span class="sxs-lookup"><span data-stu-id="6099b-126">Make these modifications by accessing the <xref:System.ServiceModel.Description.PolicyConversionContext.BindingElements%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="6099b-127">其他判斷提示需要您修改合約。</span><span class="sxs-lookup"><span data-stu-id="6099b-127">Other assertions require that you modify the contract.</span></span>  <span data-ttu-id="6099b-128">您可以使用 <xref:System.ServiceModel.Description.PolicyConversionContext.Contract%2A?displayProperty=nameWithType> 屬性存取和修改合約。</span><span class="sxs-lookup"><span data-stu-id="6099b-128">You can access and modify the contract using the <xref:System.ServiceModel.Description.PolicyConversionContext.Contract%2A?displayProperty=nameWithType> property.</span></span>  <span data-ttu-id="6099b-129">請注意，您的原則匯入工具可以為同樣的繫結和合約呼叫多次，但如果無法匯入原則替代選項，則會以不同的原則替代。</span><span class="sxs-lookup"><span data-stu-id="6099b-129">Note that your policy importer may get called multiple times for the same binding and contract, but different policy alternatives if importing a policy alternative fails.</span></span> <span data-ttu-id="6099b-130">您的程式碼應回復到此行為。</span><span class="sxs-lookup"><span data-stu-id="6099b-130">Your code should be resilient to this behavior.</span></span>  
  
4. <span data-ttu-id="6099b-131">從判斷提示集合移除自訂原則判斷提示。</span><span class="sxs-lookup"><span data-stu-id="6099b-131">Remove the custom policy assertion from the assertion collection.</span></span> <span data-ttu-id="6099b-132">如果您沒有移除判斷提示 Windows Communication Foundation (WCF) 會假設原則匯入失敗，而且不會匯入相關聯的系結。</span><span class="sxs-lookup"><span data-stu-id="6099b-132">If you do not remove the assertion Windows Communication Foundation (WCF) assumes that the policy import was unsuccessful and does not import the associated binding.</span></span> <span data-ttu-id="6099b-133">如果您使用 <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> 方法找到自訂原則判斷提示，並用一個步驟將它從集合中移除，就不必執行這個步驟。</span><span class="sxs-lookup"><span data-stu-id="6099b-133">If you used the <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> method to locate the custom policy assertion and remove it from the collection in one step you do not have to perform this step.</span></span>  
  
### <a name="to-insert-the-custom-policy-importer-into-the-metadata-system-using-a-configuration-file"></a><span data-ttu-id="6099b-134">若要使用組態檔將自訂原則匯入工具插入中繼資料系統</span><span class="sxs-lookup"><span data-stu-id="6099b-134">To insert the custom policy importer into the metadata System using a configuration file</span></span>  
  
1. <span data-ttu-id="6099b-135">將匯入工具類型新增至 `<extensions>` [\<policyImporters>](../../configure-apps/file-schema/wcf/policyimporters.md) 用戶端設定檔中專案內的元素。</span><span class="sxs-lookup"><span data-stu-id="6099b-135">Add the importer type to the `<extensions>` element inside the [\<policyImporters>](../../configure-apps/file-schema/wcf/policyimporters.md) element in the client configuration file.</span></span>  
  
     [!code-xml[CustomPolicySample#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/custompolicysample/cs/client.exe.config#7)]
  
2. <span data-ttu-id="6099b-136">在用戶端應用程式中，使用 <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType> 或 <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType> 來解析中繼資料，匯入工具會自動叫用。</span><span class="sxs-lookup"><span data-stu-id="6099b-136">In the client application, use the <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType> to resolve the metadata and the importer is invoked automatically.</span></span>  
  
     [!code-csharp[CustomPolicySample#10](../../../../samples/snippets/csharp/VS_Snippets_CFX/custompolicysample/cs/client.cs#10)]
     [!code-vb[CustomPolicySample#10](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/custompolicysample/vb/client.vb#10)]  
  
### <a name="to-insert-the-custom-policy-importer-into-the-metadata-system-using-svcutilexe"></a><span data-ttu-id="6099b-137">若要使用 Svcutil.exe 將自訂原則匯入工具插入中繼資料系統</span><span class="sxs-lookup"><span data-stu-id="6099b-137">To insert the custom policy importer into the metadata system using Svcutil.exe</span></span>  
  
1. <span data-ttu-id="6099b-138">將匯入工具類型新增至 `<extensions>` [\<policyImporters>](../../configure-apps/file-schema/wcf/policyimporters.md) Svcutil.exe.config 設定檔中專案內的元素。</span><span class="sxs-lookup"><span data-stu-id="6099b-138">Add the importer type to the `<extensions>` element inside the [\<policyImporters>](../../configure-apps/file-schema/wcf/policyimporters.md) element in the Svcutil.exe.config configuration file.</span></span> <span data-ttu-id="6099b-139">您也可以使用 `/svcutilConfig` 選項指示 Svcutil.exe 載入在不同組態檔中註冊的原則匯入工具。</span><span class="sxs-lookup"><span data-stu-id="6099b-139">You can also point Svcutil.exe to load policy importer types registered in a different configuration file by using the `/svcutilConfig` option.</span></span>  
  
2. <span data-ttu-id="6099b-140">使用 [System.servicemodel 中繼資料公用程式工具 ( # A0) ](../servicemodel-metadata-utility-tool-svcutil-exe.md) 匯入中繼資料，並自動叫用匯入工具。</span><span class="sxs-lookup"><span data-stu-id="6099b-140">Use [ServiceModel Metadata Utility Tool (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md) to import the metadata and the importer is invoked automatically.</span></span>  
  
### <a name="to-insert-the-custom-policy-importer-into-the-metadata-system-programmatically"></a><span data-ttu-id="6099b-141">若要以程式設計方式將自訂原則匯入工具插入中繼資料系統</span><span class="sxs-lookup"><span data-stu-id="6099b-141">To insert the custom policy importer into the metadata system programmatically</span></span>  
  
1. <span data-ttu-id="6099b-142">先將匯入工具新增至 <xref:System.ServiceModel.Description.MetadataImporter.PolicyImportExtensions%2A?displayProperty=nameWithType> 屬性 (例如，如果您目前使用的是 <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType>)，再匯入中繼資料。</span><span class="sxs-lookup"><span data-stu-id="6099b-142">Add the importer to the <xref:System.ServiceModel.Description.MetadataImporter.PolicyImportExtensions%2A?displayProperty=nameWithType> property (for example, if you are using the <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType>) prior to importing the metadata.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="6099b-143">另請參閱</span><span class="sxs-lookup"><span data-stu-id="6099b-143">See also</span></span>

- <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType>
- <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType>
- <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType>
- [<span data-ttu-id="6099b-144">擴充中繼資料系統</span><span class="sxs-lookup"><span data-stu-id="6099b-144">Extending the Metadata System</span></span>](extending-the-metadata-system.md)
