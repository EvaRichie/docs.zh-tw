---
title: 資料合約代理
ms.date: 03/30/2017
helpviewer_keywords:
- data contracts [WCF], surrogates
ms.assetid: 8c31134c-46c5-4ed7-94af-bab0ac0dfce5
ms.openlocfilehash: e33a487c03bbf87666d517040e00131f5482be6f
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/26/2020
ms.locfileid: "96251512"
---
# <a name="data-contract-surrogates"></a><span data-ttu-id="6b93c-102">資料合約代理</span><span class="sxs-lookup"><span data-stu-id="6b93c-102">Data Contract Surrogates</span></span>

<span data-ttu-id="6b93c-103">資料合約 *代理* 是建立在資料合約模型上的先進功能。</span><span class="sxs-lookup"><span data-stu-id="6b93c-103">The data contract *surrogate* is an advanced feature built upon the Data Contract model.</span></span> <span data-ttu-id="6b93c-104">這項功能是專為在使用者想要變更型別序列化、還原序列化或投射至中繼資料的方式時，用來自訂和替換型別所設計。</span><span class="sxs-lookup"><span data-stu-id="6b93c-104">This feature is designed to be used for type customization and substitution in situations where users want to change how a type is serialized, deserialized or projected into metadata.</span></span> <span data-ttu-id="6b93c-105">某些可能使用代理的情況包括：尚未指定型別的資料合約、欄位和屬性 (Property) 尚未以 <xref:System.Runtime.Serialization.DataMemberAttribute> 屬性 (Attribute) 標記，或是使用者希望動態建立結構描述變形時。</span><span class="sxs-lookup"><span data-stu-id="6b93c-105">Some scenarios where a surrogate may be used is when a data contract has not been specified for the type, fields and properties are not marked with the <xref:System.Runtime.Serialization.DataMemberAttribute> attribute or users wish to dynamically create schema variations.</span></span>  
  
 <span data-ttu-id="6b93c-106">序列化和還原序列化是在使用 <xref:System.Runtime.Serialization.DataContractSerializer> 從 .NET Framework 轉換為適合的格式 (例如 XML) 時，使用資料合約代理完成。</span><span class="sxs-lookup"><span data-stu-id="6b93c-106">Serialization and deserialization are accomplished with the data contract surrogate when using <xref:System.Runtime.Serialization.DataContractSerializer> to convert from .NET Framework to a suitable format, such as XML.</span></span> <span data-ttu-id="6b93c-107">資料合約代理也可以在產生中繼資料表示 (例如 XML 結構描述文件，XSD) 時，用來修改針對型別匯出的中繼資料。</span><span class="sxs-lookup"><span data-stu-id="6b93c-107">Data contract surrogate can also be used to modify the metadata exported for types, when producing metadata representations such as XML Schema Documents (XSD).</span></span> <span data-ttu-id="6b93c-108">匯入時，程式碼會從中繼資料建立，而代理同樣可以在這種情況下用來自訂產生的程式碼。</span><span class="sxs-lookup"><span data-stu-id="6b93c-108">Upon import, code is created from metadata and the surrogate can be used in this case to customize the generated code as well.</span></span>  
  
## <a name="how-the-surrogate-works"></a><span data-ttu-id="6b93c-109">代理的運作方式</span><span class="sxs-lookup"><span data-stu-id="6b93c-109">How the Surrogate Works</span></span>  

 <span data-ttu-id="6b93c-110">代理是藉由對應一種型別 (「原始」型別) 到另一種型別 (「代理」型別) 的方式運作。</span><span class="sxs-lookup"><span data-stu-id="6b93c-110">A surrogate works by mapping one type (the "original" type) to another type (the "surrogated" type).</span></span> <span data-ttu-id="6b93c-111">下列範例示範原始型別 `Inventory` 和新的代理 `InventorySurrogated` 型別。</span><span class="sxs-lookup"><span data-stu-id="6b93c-111">The following example shows the original type `Inventory` and a new surrogate `InventorySurrogated` type.</span></span> <span data-ttu-id="6b93c-112">`Inventory` 型別無法序列化，但是 `InventorySurrogated` 型別可以序列化。</span><span class="sxs-lookup"><span data-stu-id="6b93c-112">The `Inventory` type is not serializable but the `InventorySurrogated` type is:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#1)]  
  
 <span data-ttu-id="6b93c-113">由於尚未定義這個類別的資料合約，因此請使用資料合約將這個類別轉換成代理類別。</span><span class="sxs-lookup"><span data-stu-id="6b93c-113">Because a data contract has not been defined for this class, convert the class to a surrogate class with a data contract.</span></span> <span data-ttu-id="6b93c-114">下列範例會顯示代理的類別：</span><span class="sxs-lookup"><span data-stu-id="6b93c-114">The surrogated class is shown in the following example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#2)]  
  
## <a name="implementing-the-idatacontractsurrogate"></a><span data-ttu-id="6b93c-115">實作 IDataContractSurrogate</span><span class="sxs-lookup"><span data-stu-id="6b93c-115">Implementing the IDataContractSurrogate</span></span>  

 <span data-ttu-id="6b93c-116">若要使用資料合約代理，請實作 <xref:System.Runtime.Serialization.IDataContractSurrogate> 介面。</span><span class="sxs-lookup"><span data-stu-id="6b93c-116">To use the data contract surrogate, implement the <xref:System.Runtime.Serialization.IDataContractSurrogate> interface.</span></span>  
  
 <span data-ttu-id="6b93c-117">下列是每種 <xref:System.Runtime.Serialization.IDataContractSurrogate> 方法的概觀，包括可能的實作。</span><span class="sxs-lookup"><span data-stu-id="6b93c-117">The following is an overview of each method of <xref:System.Runtime.Serialization.IDataContractSurrogate> with a possible implementation.</span></span>  
  
### <a name="getdatacontracttype"></a><span data-ttu-id="6b93c-118">GetDataContractType</span><span class="sxs-lookup"><span data-stu-id="6b93c-118">GetDataContractType</span></span>  

 <span data-ttu-id="6b93c-119"><xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> 方法會將一種型別對應到另一種。</span><span class="sxs-lookup"><span data-stu-id="6b93c-119">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method maps one type to another.</span></span> <span data-ttu-id="6b93c-120">這個方法為序列化、還原序列化、匯入和匯出時所需。</span><span class="sxs-lookup"><span data-stu-id="6b93c-120">This method is required for serialization, deserialization, import, and export.</span></span>  
  
 <span data-ttu-id="6b93c-121">第一項工作是定義要對應到其他型別的型別。</span><span class="sxs-lookup"><span data-stu-id="6b93c-121">The first task is defining what types will be mapped to other types.</span></span> <span data-ttu-id="6b93c-122">例如：</span><span class="sxs-lookup"><span data-stu-id="6b93c-122">For example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#3)]  
  
- <span data-ttu-id="6b93c-123">在序列化過程中，這個方法傳回的對應會接著藉由呼叫 <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> 方法，將原始執行個體轉換成代理執行個體。</span><span class="sxs-lookup"><span data-stu-id="6b93c-123">On serialization, the mapping returned by this method is subsequently used to transform the original instance to a surrogated instance by calling the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method.</span></span>  
  
- <span data-ttu-id="6b93c-124">在還原序列化的過程中，這個方法傳回的對應會由序列化程式用來還原序列化為代理型別的執行個體。</span><span class="sxs-lookup"><span data-stu-id="6b93c-124">On deserialization, the mapping returned by this method is used by the serializer to deserialize into an instance of the surrogate type.</span></span> <span data-ttu-id="6b93c-125">接著它會呼叫 <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDeserializedObject%2A> 將代理執行個體轉換成原始型別的執行個體。</span><span class="sxs-lookup"><span data-stu-id="6b93c-125">It subsequently calls <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDeserializedObject%2A> to transform the surrogated instance into an instance of the original type.</span></span>  
  
- <span data-ttu-id="6b93c-126">在匯出過程中，這個方法傳回的代理型別會加以反映，以便將資料合約用於產生中繼資料。</span><span class="sxs-lookup"><span data-stu-id="6b93c-126">On export, the surrogate type returned by this method is reflected to get the data contract to use for generating metadata.</span></span>  
  
- <span data-ttu-id="6b93c-127">在匯入過程中，初始型別會變更為反映的代理型別，以便將資料合約用於參考支援這類目的。</span><span class="sxs-lookup"><span data-stu-id="6b93c-127">On import, the initial type is changed to a surrogate type that is reflected to get the data contract to use for purposes like referencing support.</span></span>  
  
 <span data-ttu-id="6b93c-128"><xref:System.Type> 參數屬於要序列化、還原序列化、匯入或匯出的物件型別。</span><span class="sxs-lookup"><span data-stu-id="6b93c-128">The <xref:System.Type> parameter is the type of the object that is being serialized, deserialized, imported, or exported.</span></span> <span data-ttu-id="6b93c-129">如果代理不處理型別，則 <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> 方法必須傳回輸入型別。</span><span class="sxs-lookup"><span data-stu-id="6b93c-129">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method must return the input type if the surrogate does not handle the type.</span></span> <span data-ttu-id="6b93c-130">否則會傳回適當的代理型別。</span><span class="sxs-lookup"><span data-stu-id="6b93c-130">Otherwise, return the appropriate surrogated type.</span></span> <span data-ttu-id="6b93c-131">如果有數個代理型別存在，則可以在這個方法中定義許多對應。</span><span class="sxs-lookup"><span data-stu-id="6b93c-131">If several surrogate types exist, numerous mappings can be defined in this method.</span></span>  
  
 <span data-ttu-id="6b93c-132"><xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> 方法不會針對內建的資料合約基本型別呼叫，例如 <xref:System.Int32> 或 <xref:System.String>。</span><span class="sxs-lookup"><span data-stu-id="6b93c-132">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method is not called for built-in data contract primitives, such as <xref:System.Int32> or <xref:System.String>.</span></span> <span data-ttu-id="6b93c-133">對於其他型別，例如陣列、使用者定義的型別，以及其他資料結構等，都會呼叫這個方法。</span><span class="sxs-lookup"><span data-stu-id="6b93c-133">For other types, such as arrays, user-defined types, and other data structures, this method will be called for each type.</span></span>  
  
 <span data-ttu-id="6b93c-134">在之前的範例中，方法會檢查 `type` 參數和 `Inventory` 是否可以比較。</span><span class="sxs-lookup"><span data-stu-id="6b93c-134">In the previous example, the method checks if the `type` parameter and `Inventory` are comparable.</span></span> <span data-ttu-id="6b93c-135">如果可以的話，方法就會將它對應到 `InventorySurrogated`。</span><span class="sxs-lookup"><span data-stu-id="6b93c-135">If so, the method maps it to `InventorySurrogated`.</span></span> <span data-ttu-id="6b93c-136">無論是呼叫序列化、還原序列化、匯入結構描述或匯出結構描述，都會先呼叫這個函式以判斷型別之間的對應。</span><span class="sxs-lookup"><span data-stu-id="6b93c-136">Whenever a serialization, deserialization, import schema, or export schema is called, this function is called first to determine the mapping between types.</span></span>  
  
### <a name="getobjecttoserialize-method"></a><span data-ttu-id="6b93c-137">GetObjectToSerialize 方法</span><span class="sxs-lookup"><span data-stu-id="6b93c-137">GetObjectToSerialize Method</span></span>  

 <span data-ttu-id="6b93c-138"><xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> 方法會將原始型別執行個體轉換成代理型別執行個體。</span><span class="sxs-lookup"><span data-stu-id="6b93c-138">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method converts the original type instance to the surrogated type instance.</span></span> <span data-ttu-id="6b93c-139">這是序列化需要的方法。</span><span class="sxs-lookup"><span data-stu-id="6b93c-139">The method is required for serialization.</span></span>  
  
 <span data-ttu-id="6b93c-140">下一個步驟是定義實體資料藉由實作 <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> 方法，從原始執行個體對應到代理的方式。</span><span class="sxs-lookup"><span data-stu-id="6b93c-140">The next step is to define the way the physical data will be mapped from the original instance to the surrogate by implementing the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method.</span></span> <span data-ttu-id="6b93c-141">例如：</span><span class="sxs-lookup"><span data-stu-id="6b93c-141">For example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#4)]  
  
 <span data-ttu-id="6b93c-142"><xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> 方法會在序列化物件時呼叫。</span><span class="sxs-lookup"><span data-stu-id="6b93c-142">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetObjectToSerialize%2A> method is called when an object is serialized.</span></span> <span data-ttu-id="6b93c-143">這個方法會將資料從原始型別傳輸至代理型別的欄位。</span><span class="sxs-lookup"><span data-stu-id="6b93c-143">This method transfers data from the original type to the fields of the surrogated type.</span></span> <span data-ttu-id="6b93c-144">欄位可以直接對應到代理欄位，或是原始資料的管理可以儲存在代理中。</span><span class="sxs-lookup"><span data-stu-id="6b93c-144">Fields can be directly mapped to surrogate fields, or manipulations of the original data may be stored in the surrogate.</span></span> <span data-ttu-id="6b93c-145">一些可能的用法包括：直接對應欄位、在要儲存到代理欄位中的資料上執行作業，或是將原始型別的 XML 儲存到代理欄位中。</span><span class="sxs-lookup"><span data-stu-id="6b93c-145">Some possible uses include: directly mapping the fields, performing operations on the data to be stored in the surrogated fields, or storing the XML of the original type in the surrogated field.</span></span>  
  
 <span data-ttu-id="6b93c-146">`targetType` 參數會參考宣告的成員型別。</span><span class="sxs-lookup"><span data-stu-id="6b93c-146">The `targetType` parameter refers to the declared type of the member.</span></span> <span data-ttu-id="6b93c-147">這個參數是由 <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> 方法傳回的代理型別。</span><span class="sxs-lookup"><span data-stu-id="6b93c-147">This parameter is the surrogated type returned by the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDataContractType%2A> method.</span></span> <span data-ttu-id="6b93c-148">序列化程式不會強制傳回的物件必須能夠指派給這個型別。</span><span class="sxs-lookup"><span data-stu-id="6b93c-148">The serializer does not enforce that the object returned is assignable to this type.</span></span> <span data-ttu-id="6b93c-149">`obj`參數是要序列化的物件，必要時將會轉換為其代理。</span><span class="sxs-lookup"><span data-stu-id="6b93c-149">The `obj` parameter is the object to serialize, and will be converted to its surrogate if necessary.</span></span> <span data-ttu-id="6b93c-150">如果代理的物件不會處理該物件的話，這個方法就必須傳回輸入物件。</span><span class="sxs-lookup"><span data-stu-id="6b93c-150">This method must return the input object if the surrogated does not handle the object.</span></span> <span data-ttu-id="6b93c-151">否則將傳回新的代理物件。</span><span class="sxs-lookup"><span data-stu-id="6b93c-151">Otherwise, the new surrogate object will be returned.</span></span> <span data-ttu-id="6b93c-152">如果物件為 null，則不會呼叫代理。</span><span class="sxs-lookup"><span data-stu-id="6b93c-152">The surrogate is not called if the object is null.</span></span> <span data-ttu-id="6b93c-153">這個物件內可定義許多不同執行個體的代理對應。</span><span class="sxs-lookup"><span data-stu-id="6b93c-153">Numerous surrogate mappings for different instances may be defined within this method.</span></span>  
  
 <span data-ttu-id="6b93c-154">建立 <xref:System.Runtime.Serialization.DataContractSerializer> 時，您可以指示它保留物件參考 </span><span class="sxs-lookup"><span data-stu-id="6b93c-154">When creating a <xref:System.Runtime.Serialization.DataContractSerializer>, you can instruct it to preserve object references.</span></span> <span data-ttu-id="6b93c-155"> (如需詳細資訊，請參閱 [序列化和還原序列化](../feature-details/serialization-and-deserialization.md)。 ) 這是藉由將它的函式 `preserveObjectReferences` 中的參數設定為來 `true` 完成。</span><span class="sxs-lookup"><span data-stu-id="6b93c-155">(For more information, see [Serialization and Deserialization](../feature-details/serialization-and-deserialization.md).) This is done by setting the `preserveObjectReferences` parameter in its constructor to `true`.</span></span> <span data-ttu-id="6b93c-156">在這個情況下，只會呼叫物件的代理一次，因為後續的所有序列化會直接將參考寫入資料流中。</span><span class="sxs-lookup"><span data-stu-id="6b93c-156">In that case, the surrogate is called only once for an object since all subsequent serializations just write the reference into the stream.</span></span> <span data-ttu-id="6b93c-157">如果 `preserveObjectReferences` 設為 `false`，則會在每次遇到執行個體時呼叫代理。</span><span class="sxs-lookup"><span data-stu-id="6b93c-157">If `preserveObjectReferences` is set to `false`, then the surrogate is called every time an instance is encountered.</span></span>  
  
 <span data-ttu-id="6b93c-158">如果序列化的執行個體型別與宣告的型別不同，則型別資訊會寫入資料流中 (例如 `xsi:type`)，讓執行個體能夠在另一端還原序列化。</span><span class="sxs-lookup"><span data-stu-id="6b93c-158">If the type of the instance serialized differs from the declared type, type information is written into the stream, for example, `xsi:type` to allow the instance to be deserialized at the other end.</span></span> <span data-ttu-id="6b93c-159">這項程序無論物件是否為代理都會發生。</span><span class="sxs-lookup"><span data-stu-id="6b93c-159">This process occurs whether the object is surrogated or not.</span></span>  
  
 <span data-ttu-id="6b93c-160">上面的範例會將 `Inventory` 執行個體的資料轉換成 `InventorySurrogated` 的資料。</span><span class="sxs-lookup"><span data-stu-id="6b93c-160">The example above converts the data of the `Inventory` instance to that of `InventorySurrogated`.</span></span> <span data-ttu-id="6b93c-161">它會檢查物件的型別並且執行必要的管理，以轉換成代理型別。</span><span class="sxs-lookup"><span data-stu-id="6b93c-161">It checks the type of the object and performs the necessary manipulations to convert to the surrogated type.</span></span> <span data-ttu-id="6b93c-162">在這個案例中，`Inventory` 類別的欄位會直接複製到 `InventorySurrogated` 類別的欄位中。</span><span class="sxs-lookup"><span data-stu-id="6b93c-162">In this case, the fields of the `Inventory` class are directly copied over to the `InventorySurrogated` class fields.</span></span>  
  
### <a name="getdeserializedobject-method"></a><span data-ttu-id="6b93c-163">GetDeserializedObject 方法</span><span class="sxs-lookup"><span data-stu-id="6b93c-163">GetDeserializedObject Method</span></span>  

 <span data-ttu-id="6b93c-164"><xref:System.Runtime.Serialization.IDataContractSurrogate.GetDeserializedObject%2A> 方法會將代理型別執行個體轉換成原始型別執行個體。</span><span class="sxs-lookup"><span data-stu-id="6b93c-164">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetDeserializedObject%2A> method converts the surrogated type instance to the original type instance.</span></span> <span data-ttu-id="6b93c-165">這是還原序列化所需的程序。</span><span class="sxs-lookup"><span data-stu-id="6b93c-165">It is required for deserialization.</span></span>  
  
 <span data-ttu-id="6b93c-166">下一項工作是定義將實體資料從代理執行個體對應到原始執行個體的方式。</span><span class="sxs-lookup"><span data-stu-id="6b93c-166">The next task is to define the way the physical data will be mapped from the surrogate instance to the original.</span></span> <span data-ttu-id="6b93c-167">例如：</span><span class="sxs-lookup"><span data-stu-id="6b93c-167">For example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#5)]  
  
 <span data-ttu-id="6b93c-168">這個方法只會在物件的還原序列化期間呼叫。</span><span class="sxs-lookup"><span data-stu-id="6b93c-168">This method is called only during the deserialization of an object.</span></span> <span data-ttu-id="6b93c-169">它會為還原序列化提供反向資料對應，也就是從代理型別到原始型別。</span><span class="sxs-lookup"><span data-stu-id="6b93c-169">It provides reverse data mapping for the deserialization from the surrogate type back to its original type.</span></span> <span data-ttu-id="6b93c-170">與 `GetObjectToSerialize` 方法相似的是，某些可能的用法為直接交換欄位資料、在資料上執行作業，以及儲存 XML 資料。</span><span class="sxs-lookup"><span data-stu-id="6b93c-170">Similar to the `GetObjectToSerialize` method, some possible uses may be to directly exchange field data, perform operations on the data, and store XML data.</span></span> <span data-ttu-id="6b93c-171">還原序列化時，由於資料轉換的操作方式不同，因此不一定會從原始型別取得確實的資料值。</span><span class="sxs-lookup"><span data-stu-id="6b93c-171">When  deserializing, you may not always obtain the exact data values from original due to manipulations in the data conversion.</span></span>  
  
 <span data-ttu-id="6b93c-172">`targetType` 參數會參考宣告的成員型別。</span><span class="sxs-lookup"><span data-stu-id="6b93c-172">The `targetType` parameter refers to the declared type of the member.</span></span> <span data-ttu-id="6b93c-173">這個參數是由 `GetDataContractType` 方法傳回的代理型別。</span><span class="sxs-lookup"><span data-stu-id="6b93c-173">This parameter is the surrogated type returned by the `GetDataContractType` method.</span></span> <span data-ttu-id="6b93c-174">`obj`參數會參考已還原序列化的物件。</span><span class="sxs-lookup"><span data-stu-id="6b93c-174">The `obj` parameter refers to the object that has been deserialized.</span></span> <span data-ttu-id="6b93c-175">如果物件為代理的話，則可以轉換回原始型別。</span><span class="sxs-lookup"><span data-stu-id="6b93c-175">The object can be converted back to its original type if it is surrogated.</span></span> <span data-ttu-id="6b93c-176">如果代理不會處理輸入物件的話，這個方法就會傳回該物件。</span><span class="sxs-lookup"><span data-stu-id="6b93c-176">This method returns the input object if the surrogate does not handle the object.</span></span> <span data-ttu-id="6b93c-177">否則，在轉換完成之後就會傳回還原的物件。</span><span class="sxs-lookup"><span data-stu-id="6b93c-177">Otherwise, the deserialized object will be returned once its conversion has been completed.</span></span> <span data-ttu-id="6b93c-178">如果有數個代理型別存在，您可以藉由指示每個型別及其轉換的方式，為每個型別提供從代理到主要型別的資料轉換。</span><span class="sxs-lookup"><span data-stu-id="6b93c-178">If several surrogate types exist, you may provide data conversion from surrogate to primary type for each by indicating each type and its conversion.</span></span>  
  
 <span data-ttu-id="6b93c-179">傳回物件時，會以這個代理傳回的物件更新內部物件表格。</span><span class="sxs-lookup"><span data-stu-id="6b93c-179">When returning an object, the internal object tables are updated with the object returned by this surrogate.</span></span> <span data-ttu-id="6b93c-180">後續任何執行個體的參考都將從物件表格取得代理執行個體。</span><span class="sxs-lookup"><span data-stu-id="6b93c-180">Any subsequent references to an instance will obtain the surrogated instance from the object tables.</span></span>  
  
 <span data-ttu-id="6b93c-181">之前的範例會將 `InventorySurrogated` 型別的物件轉換回初始型別 `Inventory`。</span><span class="sxs-lookup"><span data-stu-id="6b93c-181">The previous example converts objects of type `InventorySurrogated` back to the initial type `Inventory`.</span></span> <span data-ttu-id="6b93c-182">在這個案例中，資料是從 `InventorySurrogated` 直接傳輸回 `Inventory` 中對應的欄位。</span><span class="sxs-lookup"><span data-stu-id="6b93c-182">In this case, data is directly transferred back from `InventorySurrogated` to its corresponding fields in `Inventory`.</span></span> <span data-ttu-id="6b93c-183">由於沒有資料管理，因此每個成員欄位都會包含與序列化之前相同的值。</span><span class="sxs-lookup"><span data-stu-id="6b93c-183">Because there are no data manipulations, the each of the member fields will contain the same values as before the serialization.</span></span>  
  
### <a name="getcustomdatatoexport-method"></a><span data-ttu-id="6b93c-184">GetCustomDataToExport 方法</span><span class="sxs-lookup"><span data-stu-id="6b93c-184">GetCustomDataToExport Method</span></span>  

 <span data-ttu-id="6b93c-185">匯出結構描述時，<xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%2A> 方法是選擇性的。</span><span class="sxs-lookup"><span data-stu-id="6b93c-185">When exporting a schema, the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%2A> method is optional.</span></span> <span data-ttu-id="6b93c-186">這個方法是用來將額外的資料或提示插入匯出的結構描述中。</span><span class="sxs-lookup"><span data-stu-id="6b93c-186">It is used to insert additional data or hints into the exported schema.</span></span> <span data-ttu-id="6b93c-187">額外的資料可在成員層級或型別層級插入。</span><span class="sxs-lookup"><span data-stu-id="6b93c-187">Additional data can be inserted at the member level or type level.</span></span> <span data-ttu-id="6b93c-188">例如：</span><span class="sxs-lookup"><span data-stu-id="6b93c-188">For example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#6)]  
  
 <span data-ttu-id="6b93c-189">這個方法 (包含兩個多載) 可以在成員或型別層級將額外的資訊加入中繼資料。</span><span class="sxs-lookup"><span data-stu-id="6b93c-189">This method (with two overloads) enables the inclusion of extra information into the metadata either at the member or type level.</span></span> <span data-ttu-id="6b93c-190">另外還可以加入有關成員為公用或私用的提示，以及會在結構描述的整個匯出和匯入過程中保留的註解。</span><span class="sxs-lookup"><span data-stu-id="6b93c-190">It is possible to include hints about whether a member is public or private, and comments which would be preserved throughout the export and import of the schema.</span></span> <span data-ttu-id="6b93c-191">如果沒有這個方法，這類資訊可能會遺失。</span><span class="sxs-lookup"><span data-stu-id="6b93c-191">Such information would be lost without this method.</span></span> <span data-ttu-id="6b93c-192">這個方法不會造成插入或刪除成員或型別，而是在其中一個層級中將額外的資料加入至結構描述。</span><span class="sxs-lookup"><span data-stu-id="6b93c-192">This method does not cause the insertion or deletion of members or types, but rather adds additional data to the schemas at either of these levels.</span></span>  
  
 <span data-ttu-id="6b93c-193">這個方法為多載，而且可以採用 `Type` (`clrtype` 參數) 或 <xref:System.Reflection.MemberInfo> (`memberInfo` 參數)。</span><span class="sxs-lookup"><span data-stu-id="6b93c-193">The method is overloaded and can take either a `Type` (`clrtype` parameter) or <xref:System.Reflection.MemberInfo> (`memberInfo` parameter).</span></span> <span data-ttu-id="6b93c-194">第二個參數固定為 `Type` (`dataContractType` 參數)。</span><span class="sxs-lookup"><span data-stu-id="6b93c-194">The second parameter is always a `Type` (`dataContractType` parameter).</span></span> <span data-ttu-id="6b93c-195">這個方法會針對 `dataContractType` 代理型別的每一個成員和型別呼叫。</span><span class="sxs-lookup"><span data-stu-id="6b93c-195">This method is called for every member and type of the surrogated `dataContractType` type.</span></span>  
  
 <span data-ttu-id="6b93c-196">其中任一個多載必須傳回 `null` 或可序列化的物件。</span><span class="sxs-lookup"><span data-stu-id="6b93c-196">Either of these overloads must return either `null` or a serializable object.</span></span> <span data-ttu-id="6b93c-197">非 null 的物件將做為附註序列化成匯出的結構描述。</span><span class="sxs-lookup"><span data-stu-id="6b93c-197">A non-null object will be serialized as annotation into the exported schema.</span></span> <span data-ttu-id="6b93c-198">若為 `Type` 多載，匯出至結構描述的每個型別會隨著代理類別傳送到這個方法的第一個參數中做為 `dataContractType` 參數。</span><span class="sxs-lookup"><span data-stu-id="6b93c-198">For the `Type` overload, each type that is exported to schema is sent to this method in the first parameter along with the surrogated type as the `dataContractType` parameter.</span></span> <span data-ttu-id="6b93c-199">若為 `MemberInfo` 多載，則匯出至結構描述的每個成員都會傳送其資訊，做為第二個參數中代理型別的 `memberInfo` 參數。</span><span class="sxs-lookup"><span data-stu-id="6b93c-199">For the `MemberInfo` overload, each member that is exported to schema sends its information as the `memberInfo` parameter with the surrogated type in the second parameter.</span></span>  
  
#### <a name="getcustomdatatoexport-method-type-type"></a><span data-ttu-id="6b93c-200">GetCustomDataToExport 方法 (Type, Type)</span><span class="sxs-lookup"><span data-stu-id="6b93c-200">GetCustomDataToExport Method (Type, Type)</span></span>  

 <span data-ttu-id="6b93c-201"><xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%28System.Type%2CSystem.Type%29?displayProperty=nameWithType> 方法會在針對每一個型別定義匯出結構描述的期間呼叫。</span><span class="sxs-lookup"><span data-stu-id="6b93c-201">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%28System.Type%2CSystem.Type%29?displayProperty=nameWithType> method is called during schema export for every type definition.</span></span> <span data-ttu-id="6b93c-202">這個方法會在匯出時，將資訊加入至結構描述內的型別。</span><span class="sxs-lookup"><span data-stu-id="6b93c-202">The method adds information to the types within the schema when exporting.</span></span> <span data-ttu-id="6b93c-203">定義的每個型別都會傳送至這個方法，以判斷是否有任何額外的資訊需要加入結構描述中。</span><span class="sxs-lookup"><span data-stu-id="6b93c-203">Each type defined is sent to this method to determine whether there is any additional data that needs to be included in the schema.</span></span>  
  
#### <a name="getcustomdatatoexport-method-memberinfo-type"></a><span data-ttu-id="6b93c-204">GetCustomDataToExport 方法 (MemberInfo, Type)</span><span class="sxs-lookup"><span data-stu-id="6b93c-204">GetCustomDataToExport Method (MemberInfo, Type)</span></span>  

 <span data-ttu-id="6b93c-205"><xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%28System.Reflection.MemberInfo%2CSystem.Type%29?displayProperty=nameWithType> 會在匯出已匯出的型別中每一個成員時呼叫。</span><span class="sxs-lookup"><span data-stu-id="6b93c-205">The <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%28System.Reflection.MemberInfo%2CSystem.Type%29?displayProperty=nameWithType> is called during export for every member in the types that are exported.</span></span> <span data-ttu-id="6b93c-206">這個函式可讓您自訂匯出時，將加入結構描述中之成員的任何註解。</span><span class="sxs-lookup"><span data-stu-id="6b93c-206">This function enables you to customize any comments for the members that will be included in the schema upon export.</span></span> <span data-ttu-id="6b93c-207">類別內每一個成員的資訊都會傳送至這個方法，以檢查是否有任何額外的資料需要加入結構描述中。</span><span class="sxs-lookup"><span data-stu-id="6b93c-207">The information for every member within the class is sent to this method to check whether any additional data need to be added in the schema.</span></span>  
  
 <span data-ttu-id="6b93c-208">上面的範例會搜尋 `dataContractType` 中是否有代理的每個成員。</span><span class="sxs-lookup"><span data-stu-id="6b93c-208">The example above searches through the `dataContractType` for each member of the surrogate.</span></span> <span data-ttu-id="6b93c-209">然後為每個欄位傳回適當的存取修飾詞。</span><span class="sxs-lookup"><span data-stu-id="6b93c-209">It then returns the appropriate access modifier for each field.</span></span> <span data-ttu-id="6b93c-210">如果沒有這個自訂程序，存取修飾詞的預設值就會是公用。</span><span class="sxs-lookup"><span data-stu-id="6b93c-210">Without this customization, the default value for access modifiers is public.</span></span> <span data-ttu-id="6b93c-211">因此，無論實際的存取限制為何，所有成員在使用匯出的結構描述產生的程式碼中，都會定義為公用。</span><span class="sxs-lookup"><span data-stu-id="6b93c-211">Therefore, all members would be defined as public in the code generated using the exported schema no matter what their actual access restrictions are.</span></span> <span data-ttu-id="6b93c-212">而沒有使用這個實作時，即使 `numpens` 成員在代理中定義為私用，在匯出的結構描述中仍會是公用。</span><span class="sxs-lookup"><span data-stu-id="6b93c-212">When not using this implementation, the member `numpens` would be public in the exported schema even though it was defined in the surrogate as private.</span></span> <span data-ttu-id="6b93c-213">透過使用這個方法，存取修飾詞在匯出的結構描述中就可以產生為私用。</span><span class="sxs-lookup"><span data-stu-id="6b93c-213">Through the use of this method, in the exported schema, the access modifier can be generated as private.</span></span>  
  
### <a name="getreferencedtypeonimport-method"></a><span data-ttu-id="6b93c-214">GetReferencedTypeOnImport 方法</span><span class="sxs-lookup"><span data-stu-id="6b93c-214">GetReferencedTypeOnImport Method</span></span>  

 <span data-ttu-id="6b93c-215">這個方法會將代理的 <xref:System.Type> 對應到原始型別。</span><span class="sxs-lookup"><span data-stu-id="6b93c-215">This method maps the <xref:System.Type> of the surrogate to the original type.</span></span> <span data-ttu-id="6b93c-216">這個方法對於結構描述的匯入作業來說是選擇性的。</span><span class="sxs-lookup"><span data-stu-id="6b93c-216">This method is optional for schema importation.</span></span>  
  
 <span data-ttu-id="6b93c-217">當建立匯入結構描述及產生其程式碼的代理時，下一項工作就是將代理執行個體的型別定義為其原始型別。</span><span class="sxs-lookup"><span data-stu-id="6b93c-217">When creating a surrogate that imports a schema and generates code for it, the next task is to define the type of a surrogate instance to its original type.</span></span>  
  
 <span data-ttu-id="6b93c-218">如果產生的程式碼需要參考現有的使用者型別，可藉由實作 <xref:System.Runtime.Serialization.IDataContractSurrogate.GetReferencedTypeOnImport%2A> 方法達到這個目的。</span><span class="sxs-lookup"><span data-stu-id="6b93c-218">If the generated code needs to reference an existing user type, this is done by implementing the <xref:System.Runtime.Serialization.IDataContractSurrogate.GetReferencedTypeOnImport%2A> method.</span></span>  
  
 <span data-ttu-id="6b93c-219">匯入結構描述時，會針對每一個型別宣告呼叫這個方法，以便將代理資料合約對應到型別。</span><span class="sxs-lookup"><span data-stu-id="6b93c-219">When importing a schema, this method is called for every type declaration to map the surrogated data contract to a type.</span></span> <span data-ttu-id="6b93c-220">字串參數 `typeName` 和 `typeNamespace` 會定義代理型別的名稱和命名空間。</span><span class="sxs-lookup"><span data-stu-id="6b93c-220">The string parameters `typeName` and `typeNamespace` define the name and namespace of the surrogated type.</span></span> <span data-ttu-id="6b93c-221"><xref:System.Runtime.Serialization.IDataContractSurrogate.GetReferencedTypeOnImport%2A> 的傳回值則用來判斷是否需要產生新型別。</span><span class="sxs-lookup"><span data-stu-id="6b93c-221">The return value for <xref:System.Runtime.Serialization.IDataContractSurrogate.GetReferencedTypeOnImport%2A> is used to determine whether a new type needs to be generated.</span></span> <span data-ttu-id="6b93c-222">這個方法必須傳回有效的型別或 null。</span><span class="sxs-lookup"><span data-stu-id="6b93c-222">This method must return either a valid type or null.</span></span> <span data-ttu-id="6b93c-223">若為有效型別，傳回的型別將用來做為所產生程式碼中的參考型別。</span><span class="sxs-lookup"><span data-stu-id="6b93c-223">For valid types, the type returned will be used as a referenced type in the generated code.</span></span> <span data-ttu-id="6b93c-224">如果傳回 null，則不會參考任何型別，而且必須建立新型別。</span><span class="sxs-lookup"><span data-stu-id="6b93c-224">If null is returned, no type will be referenced and a new type must be created.</span></span> <span data-ttu-id="6b93c-225">如果有數個代理存在，則可以將每個代理型別對應回其初始型別。</span><span class="sxs-lookup"><span data-stu-id="6b93c-225">If several surrogates exist, it is possible to perform the mapping for each surrogate type back to its initial type.</span></span>  
  
 <span data-ttu-id="6b93c-226">`customData` 參數是原本從 <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%2A> 傳回的物件。</span><span class="sxs-lookup"><span data-stu-id="6b93c-226">The `customData` parameter is the object originally returned from <xref:System.Runtime.Serialization.IDataContractSurrogate.GetCustomDataToExport%2A>.</span></span> <span data-ttu-id="6b93c-227">這個 `customData` 會在代理的作者想要在匯入以產生程式碼期間，將額外的資料/提示插入要使用的中繼資料時使用。</span><span class="sxs-lookup"><span data-stu-id="6b93c-227">This `customData` is used when surrogate authors want to insert extra data/hints into the metadata to use during import to generate code.</span></span>  
  
### <a name="processimportedtype-method"></a><span data-ttu-id="6b93c-228">ProcessImportedType 方法</span><span class="sxs-lookup"><span data-stu-id="6b93c-228">ProcessImportedType Method</span></span>  

 <span data-ttu-id="6b93c-229"><xref:System.Runtime.Serialization.IDataContractSurrogate.ProcessImportedType%2A> 方法會自訂任何從結構描述匯入作業建立的型別。</span><span class="sxs-lookup"><span data-stu-id="6b93c-229">The <xref:System.Runtime.Serialization.IDataContractSurrogate.ProcessImportedType%2A> method customizes any type created from schema importation.</span></span> <span data-ttu-id="6b93c-230">這個方法是一個選擇項目。</span><span class="sxs-lookup"><span data-stu-id="6b93c-230">This method is optional.</span></span>  
  
 <span data-ttu-id="6b93c-231">當匯入結構描述時，這個方法會允許自訂任何匯入的型別和編譯資訊。</span><span class="sxs-lookup"><span data-stu-id="6b93c-231">When importing a schema, this method allows for any imported type and compilation information to be customized.</span></span> <span data-ttu-id="6b93c-232">例如：</span><span class="sxs-lookup"><span data-stu-id="6b93c-232">For example:</span></span>  
  
 [!code-csharp[C_IDataContractSurrogate#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#7)]  
  
 <span data-ttu-id="6b93c-233">在匯入期間，會針對產生的每一個型別呼叫這個方法。</span><span class="sxs-lookup"><span data-stu-id="6b93c-233">During import, this method is called for every type generated.</span></span> <span data-ttu-id="6b93c-234">請變更指定的 <xref:System.CodeDom.CodeTypeDeclaration> 或修改 <xref:System.CodeDom.CodeCompileUnit>。</span><span class="sxs-lookup"><span data-stu-id="6b93c-234">Change the specified <xref:System.CodeDom.CodeTypeDeclaration> or modify the <xref:System.CodeDom.CodeCompileUnit>.</span></span> <span data-ttu-id="6b93c-235">包括變更名稱、成員、屬性 (Attribute) 及 `CodeTypeDeclaration` 的許多其他屬性 (Property)。</span><span class="sxs-lookup"><span data-stu-id="6b93c-235">This includes changing the name, members, attributes, and many other properties of the `CodeTypeDeclaration`.</span></span> <span data-ttu-id="6b93c-236">藉由處理 `CodeCompileUnit`，就可以修改指示詞、命名空間、參考組件及數個其他項目。</span><span class="sxs-lookup"><span data-stu-id="6b93c-236">By processing the `CodeCompileUnit`, it is possible to modify the directives, namespaces, referenced assemblies, and several other aspects.</span></span>  
  
 <span data-ttu-id="6b93c-237">`CodeTypeDeclaration` 參數包含程式碼 DOM 型別宣告。</span><span class="sxs-lookup"><span data-stu-id="6b93c-237">The `CodeTypeDeclaration` parameter contains the code DOM type declaration.</span></span> <span data-ttu-id="6b93c-238">`CodeCompileUnit` 參數則允許修改處理程式碼的方式。</span><span class="sxs-lookup"><span data-stu-id="6b93c-238">The `CodeCompileUnit` parameter allows for modification for processing the code.</span></span>  <span data-ttu-id="6b93c-239">若傳回 `null`，會導致捨棄型別宣告。</span><span class="sxs-lookup"><span data-stu-id="6b93c-239">Returning `null` results in the type declaration being discarded.</span></span> <span data-ttu-id="6b93c-240">相反地，若傳回 `CodeTypeDeclaration`，則會保留修改。</span><span class="sxs-lookup"><span data-stu-id="6b93c-240">Conversely, when returning a `CodeTypeDeclaration`, the modifications are preserved.</span></span>  
  
 <span data-ttu-id="6b93c-241">如果在中繼資料匯出期間插入自訂資料，則該資料必須在匯入期間提供給使用者才能使用。</span><span class="sxs-lookup"><span data-stu-id="6b93c-241">If custom data is inserted during metadata export, it needs to be provided to the user during import so that it can be used.</span></span> <span data-ttu-id="6b93c-242">這項自訂資料可以用於程式設計模型提示，或其他註解。</span><span class="sxs-lookup"><span data-stu-id="6b93c-242">This custom data can be used for programming model hints, or other comments.</span></span> <span data-ttu-id="6b93c-243">每個 `CodeTypeDeclaration` 和包含如 <xref:System.CodeDom.CodeTypeMember> 屬性之自訂資料的 <xref:System.CodeDom.CodeObject.UserData%2A> 執行個體，都會轉換 (Cast) 成 `IDataContractSurrogate` 型別。</span><span class="sxs-lookup"><span data-stu-id="6b93c-243">Each `CodeTypeDeclaration` and <xref:System.CodeDom.CodeTypeMember> instance includes custom data as the <xref:System.CodeDom.CodeObject.UserData%2A> property, cast to the `IDataContractSurrogate` type.</span></span>  
  
 <span data-ttu-id="6b93c-244">上面的範例會在匯入的結構描述上執行某些變更。</span><span class="sxs-lookup"><span data-stu-id="6b93c-244">The example above performs some changes on the schema imported.</span></span> <span data-ttu-id="6b93c-245">程式碼會使用代理保留原始型別的私用成員。</span><span class="sxs-lookup"><span data-stu-id="6b93c-245">The code preserves private members of the original type by using a surrogate.</span></span> <span data-ttu-id="6b93c-246">匯入結構描述時的預設存取修飾詞為 `public`。</span><span class="sxs-lookup"><span data-stu-id="6b93c-246">The default access modifier when importing a schema is `public`.</span></span> <span data-ttu-id="6b93c-247">因此除非經過修改，否則代理結構描述的所有成員都會是公用，如本範例中所示。</span><span class="sxs-lookup"><span data-stu-id="6b93c-247">Therefore, all members of the surrogate schema will be public unless modified, as in this example.</span></span> <span data-ttu-id="6b93c-248">匯出期間，自訂資料會插入有關哪些成員為私用的中繼資料中。</span><span class="sxs-lookup"><span data-stu-id="6b93c-248">During export, custom data is inserted into the metadata about which members are private.</span></span> <span data-ttu-id="6b93c-249">這個範例會查看自訂資料、檢查存取修飾詞是否為私用，然後藉由設定屬性的方式將適當的成員修改為私用。</span><span class="sxs-lookup"><span data-stu-id="6b93c-249">The example looks up the custom data, checks whether the access modifier is private, and then modifies the appropriate member to be private by setting its attributes.</span></span> <span data-ttu-id="6b93c-250">如果沒有這項自訂程序，`numpens` 成員就會定義為公用而非私用。</span><span class="sxs-lookup"><span data-stu-id="6b93c-250">Without this customization, the `numpens` member would be defined as public instead of private.</span></span>  
  
### <a name="getknowncustomdatatypes-method"></a><span data-ttu-id="6b93c-251">GetKnownCustomDataTypes 方法</span><span class="sxs-lookup"><span data-stu-id="6b93c-251">GetKnownCustomDataTypes Method</span></span>  

 <span data-ttu-id="6b93c-252">這個方法會從結構描述取得定義的自訂資料型別。</span><span class="sxs-lookup"><span data-stu-id="6b93c-252">This method obtains custom data types defined from the schema.</span></span> <span data-ttu-id="6b93c-253">這個方法對於結構描述的匯入作業來說是選擇性的。</span><span class="sxs-lookup"><span data-stu-id="6b93c-253">The method is optional for schema importation.</span></span>  
  
 <span data-ttu-id="6b93c-254">這個方法會在結構描述匯出和匯入開始時呼叫。</span><span class="sxs-lookup"><span data-stu-id="6b93c-254">The method is called at the beginning of schema export and import.</span></span> <span data-ttu-id="6b93c-255">然後傳回在匯出或匯入的結構描述中使用的自訂資料型別。</span><span class="sxs-lookup"><span data-stu-id="6b93c-255">The method returns the custom data types used in the schema exported or imported.</span></span> <span data-ttu-id="6b93c-256">這個方法會收到傳遞的 <xref:System.Collections.ObjectModel.Collection%601> (`customDataTypes` 參數)，此為型別的集合。</span><span class="sxs-lookup"><span data-stu-id="6b93c-256">The method is passed a <xref:System.Collections.ObjectModel.Collection%601> (the `customDataTypes` parameter), which is a collection of types.</span></span> <span data-ttu-id="6b93c-257">這個方法應將額外的已知型別加入這個集合中。</span><span class="sxs-lookup"><span data-stu-id="6b93c-257">The method should add additional known types to this collection.</span></span> <span data-ttu-id="6b93c-258">必須有已知的自訂資料型別，才能使用 <xref:System.Runtime.Serialization.DataContractSerializer> 序列化和還原序列化自訂資料。</span><span class="sxs-lookup"><span data-stu-id="6b93c-258">The known custom data types are needed to enable serialization and deserialization of custom data using the <xref:System.Runtime.Serialization.DataContractSerializer>.</span></span> <span data-ttu-id="6b93c-259">如需詳細資訊，請參閱 [資料合約已知類型](../feature-details/data-contract-known-types.md)。</span><span class="sxs-lookup"><span data-stu-id="6b93c-259">For more information, see [Data Contract Known Types](../feature-details/data-contract-known-types.md).</span></span>  
  
## <a name="implementing-a-surrogate"></a><span data-ttu-id="6b93c-260">實作代理</span><span class="sxs-lookup"><span data-stu-id="6b93c-260">Implementing a Surrogate</span></span>  

 <span data-ttu-id="6b93c-261">若要在 WCF 中使用資料合約代理，您必須遵循幾個特殊程式。</span><span class="sxs-lookup"><span data-stu-id="6b93c-261">To use the data contract surrogate within WCF, you must follow a few special procedures.</span></span>  
  
### <a name="to-use-a-surrogate-for-serialization-and-deserialization"></a><span data-ttu-id="6b93c-262">若要使用代理進行序列化和還原序列化</span><span class="sxs-lookup"><span data-stu-id="6b93c-262">To Use a Surrogate for Serialization and Deserialization</span></span>  

 <span data-ttu-id="6b93c-263">您可以使用 <xref:System.Runtime.Serialization.DataContractSerializer> 搭配代理來執行資料序列化和還原序列化。</span><span class="sxs-lookup"><span data-stu-id="6b93c-263">Use the <xref:System.Runtime.Serialization.DataContractSerializer> to perform serialization and deserialization of data with the surrogate.</span></span> <span data-ttu-id="6b93c-264"><xref:System.Runtime.Serialization.DataContractSerializer> 是由 <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> 建立。</span><span class="sxs-lookup"><span data-stu-id="6b93c-264">The <xref:System.Runtime.Serialization.DataContractSerializer> is created by the <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior>.</span></span> <span data-ttu-id="6b93c-265">代理同樣必須指定。</span><span class="sxs-lookup"><span data-stu-id="6b93c-265">The surrogate must also be specified.</span></span>  
  
##### <a name="to-implement-serialization-and-deserialization"></a><span data-ttu-id="6b93c-266">若要實作序列化和還原序列化</span><span class="sxs-lookup"><span data-stu-id="6b93c-266">To implement serialization and deserialization</span></span>  
  
1. <span data-ttu-id="6b93c-267">為服務建立 <xref:System.ServiceModel.ServiceHost> 的執行個體。</span><span class="sxs-lookup"><span data-stu-id="6b93c-267">Create an instance of the <xref:System.ServiceModel.ServiceHost> for your service.</span></span> <span data-ttu-id="6b93c-268">如需完整的指示，請參閱 [基本 WCF 程式設計](../basic-wcf-programming.md)。</span><span class="sxs-lookup"><span data-stu-id="6b93c-268">For complete instructions, see [Basic WCF Programming](../basic-wcf-programming.md).</span></span>  
  
2. <span data-ttu-id="6b93c-269">針對所指定服務主機的每一個 <xref:System.ServiceModel.Description.ServiceEndpoint>，尋找其 <xref:System.ServiceModel.Description.OperationDescription>。</span><span class="sxs-lookup"><span data-stu-id="6b93c-269">For every <xref:System.ServiceModel.Description.ServiceEndpoint> of the specified service host, find its <xref:System.ServiceModel.Description.OperationDescription>.</span></span>  
  
3. <span data-ttu-id="6b93c-270">搜尋作業行為，判斷是否找到 <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> 的執行個體。</span><span class="sxs-lookup"><span data-stu-id="6b93c-270">Search through the operation behaviors to determine if an instance of the <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> is found.</span></span>  
  
4. <span data-ttu-id="6b93c-271">如果找到 <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> 請將其 <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractSurrogate%2A> 屬性設為代理的新執行個體。</span><span class="sxs-lookup"><span data-stu-id="6b93c-271">If a <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> is found, set its <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractSurrogate%2A> property to a new instance of the surrogate.</span></span> <span data-ttu-id="6b93c-272">如果未找到 <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior>，則建立新執行個體，並且將新行為的 <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractSurrogate%2A> 成員設為代理的新執行個體。</span><span class="sxs-lookup"><span data-stu-id="6b93c-272">If no <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior> is found, then create a new instance and set the <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.DataContractSurrogate%2A> member of the new behavior to a new instance of the surrogate.</span></span>  
  
5. <span data-ttu-id="6b93c-273">最後，將這個新行為加入目前的作業行為中，如下列範例所示：</span><span class="sxs-lookup"><span data-stu-id="6b93c-273">Finally, add this new behavior to the current operation behaviors, as shown in the following example:</span></span>  
  
     [!code-csharp[C_IDataContractSurrogate#8](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#8)]  
  
### <a name="to-use-a-surrogate-for-metadata-import"></a><span data-ttu-id="6b93c-274">若要使用代理進行中繼資料匯入</span><span class="sxs-lookup"><span data-stu-id="6b93c-274">To Use a Surrogate for Metadata Import</span></span>  

 <span data-ttu-id="6b93c-275">匯入中繼資料如 WSDL 和 XSD 以產生用戶端程式碼時，必須將代理加入負責從 XSD 結構描述 <xref:System.Runtime.Serialization.XsdDataContractImporter> 產生程式碼的元件。</span><span class="sxs-lookup"><span data-stu-id="6b93c-275">When importing metadata like WSDL and XSD to generate client-side code, the surrogate needs to be added to the component responsible for generating code from XSD schema, <xref:System.Runtime.Serialization.XsdDataContractImporter>.</span></span> <span data-ttu-id="6b93c-276">若要執行這項操作，請直接修改用來匯入中繼資料的 <xref:System.ServiceModel.Description.WsdlImporter>。</span><span class="sxs-lookup"><span data-stu-id="6b93c-276">To do this, directly modify the <xref:System.ServiceModel.Description.WsdlImporter> used to import metadata.</span></span>  
  
##### <a name="to-implement-a-surrogate-for-metadata-importation"></a><span data-ttu-id="6b93c-277">若要實作代理以匯入中繼資料</span><span class="sxs-lookup"><span data-stu-id="6b93c-277">To implement a surrogate for metadata importation</span></span>  
  
1. <span data-ttu-id="6b93c-278">使用 <xref:System.ServiceModel.Description.WsdlImporter> 類別匯入中繼資料。</span><span class="sxs-lookup"><span data-stu-id="6b93c-278">Import the metadata using the <xref:System.ServiceModel.Description.WsdlImporter> class.</span></span>  
  
2. <span data-ttu-id="6b93c-279">使用 <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> 方法檢查是否已定義 <xref:System.Runtime.Serialization.XsdDataContractImporter>。</span><span class="sxs-lookup"><span data-stu-id="6b93c-279">Use the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method to check whether an <xref:System.Runtime.Serialization.XsdDataContractImporter> has been defined.</span></span>  
  
3. <span data-ttu-id="6b93c-280">如果 <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> 方法傳回 `false`，則建立新的 <xref:System.Runtime.Serialization.XsdDataContractImporter> 並將其 <xref:System.Runtime.Serialization.XsdDataContractImporter.Options%2A> 屬性設為 <xref:System.Runtime.Serialization.ImportOptions> 類別的新執行個體。</span><span class="sxs-lookup"><span data-stu-id="6b93c-280">If the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method returns `false`, create a new <xref:System.Runtime.Serialization.XsdDataContractImporter> and set its <xref:System.Runtime.Serialization.XsdDataContractImporter.Options%2A> property to a new instance of the <xref:System.Runtime.Serialization.ImportOptions> class.</span></span> <span data-ttu-id="6b93c-281">否則使用 `out` 方法的 <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> 參數傳回的匯入工具。</span><span class="sxs-lookup"><span data-stu-id="6b93c-281">Otherwise, use the importer returned by the `out` parameter of the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method.</span></span>  
  
4. <span data-ttu-id="6b93c-282">如果 <xref:System.Runtime.Serialization.XsdDataContractImporter> 未定義任何 <xref:System.Runtime.Serialization.ImportOptions>，則將屬性設為 <xref:System.Runtime.Serialization.ImportOptions> 類別的新執行個體。</span><span class="sxs-lookup"><span data-stu-id="6b93c-282">If the <xref:System.Runtime.Serialization.XsdDataContractImporter> has no <xref:System.Runtime.Serialization.ImportOptions> defined, then set the property to be a new instance of the <xref:System.Runtime.Serialization.ImportOptions> class.</span></span>  
  
5. <span data-ttu-id="6b93c-283">將 <xref:System.Runtime.Serialization.ImportOptions.DataContractSurrogate%2A> 之 <xref:System.Runtime.Serialization.ImportOptions> 的 <xref:System.Runtime.Serialization.XsdDataContractImporter> 屬性設為代理的新執行個體。</span><span class="sxs-lookup"><span data-stu-id="6b93c-283">Set the <xref:System.Runtime.Serialization.ImportOptions.DataContractSurrogate%2A> property of the <xref:System.Runtime.Serialization.ImportOptions> of the <xref:System.Runtime.Serialization.XsdDataContractImporter> to a new instance of the surrogate.</span></span>  
  
6. <span data-ttu-id="6b93c-284">將 <xref:System.Runtime.Serialization.XsdDataContractImporter> 加入至 <xref:System.ServiceModel.Description.MetadataExporter.State%2A> (繼承自 <xref:System.ServiceModel.Description.WsdlImporter> 類別) 的 <xref:System.ServiceModel.Description.MetadataExporter> 屬性傳回的集合。</span><span class="sxs-lookup"><span data-stu-id="6b93c-284">Add the <xref:System.Runtime.Serialization.XsdDataContractImporter> to the collection returned by the <xref:System.ServiceModel.Description.MetadataExporter.State%2A> property of the <xref:System.ServiceModel.Description.WsdlImporter> (inherited from the <xref:System.ServiceModel.Description.MetadataExporter> class.)</span></span>  
  
7. <span data-ttu-id="6b93c-285">使用 <xref:System.ServiceModel.Description.WsdlImporter.ImportAllContracts%2A> 的 <xref:System.ServiceModel.Description.WsdlImporter> 方法匯入結構描述內的所有資料合約。</span><span class="sxs-lookup"><span data-stu-id="6b93c-285">Use the <xref:System.ServiceModel.Description.WsdlImporter.ImportAllContracts%2A> method of the <xref:System.ServiceModel.Description.WsdlImporter> to import all of the data contracts within the schema.</span></span> <span data-ttu-id="6b93c-286">在進行最後的步驟時，程式碼會從呼叫至代理而載入的結構描述產生。</span><span class="sxs-lookup"><span data-stu-id="6b93c-286">During the last step, code is generated from the schemas loaded by calling into the surrogate.</span></span>  
  
     [!code-csharp[C_IDataContractSurrogate#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#9)]  
  
### <a name="to-use-a-surrogate-for-metadata-export"></a><span data-ttu-id="6b93c-287">若要使用代理進行中繼資料匯出</span><span class="sxs-lookup"><span data-stu-id="6b93c-287">To Use a surrogate for Metadata Export</span></span>  

 <span data-ttu-id="6b93c-288">根據預設，從服務的 WCF 匯出中繼資料時，必須產生 WSDL 和 XSD 架構。</span><span class="sxs-lookup"><span data-stu-id="6b93c-288">By default, when exporting metadata from WCF for a service, both WSDL and XSD schema needs to be generated.</span></span> <span data-ttu-id="6b93c-289">代理必須加入至負責產生資料合約型別 <xref:System.Runtime.Serialization.XsdDataContractExporter> 的 XSD 結構描述元件中。</span><span class="sxs-lookup"><span data-stu-id="6b93c-289">The surrogate needs to be added to the component responsible for generating XSD schema for data contract types, <xref:System.Runtime.Serialization.XsdDataContractExporter>.</span></span> <span data-ttu-id="6b93c-290">若要執行這項操作，可使用實作 <xref:System.ServiceModel.Description.IWsdlExportExtension> 的行為修改 <xref:System.ServiceModel.Description.WsdlExporter>，或是直接修改用來匯出中繼資料的 <xref:System.ServiceModel.Description.WsdlExporter>。</span><span class="sxs-lookup"><span data-stu-id="6b93c-290">To do this, either use a behavior that implements <xref:System.ServiceModel.Description.IWsdlExportExtension> to modify the <xref:System.ServiceModel.Description.WsdlExporter>, or directly modify the <xref:System.ServiceModel.Description.WsdlExporter> used to export metadata.</span></span>  
  
##### <a name="to-use-a-surrogate-for-metadata-export"></a><span data-ttu-id="6b93c-291">若要使用代理進行中繼資料匯出</span><span class="sxs-lookup"><span data-stu-id="6b93c-291">To use a surrogate for metadata export</span></span>  
  
1. <span data-ttu-id="6b93c-292">建立新的 <xref:System.ServiceModel.Description.WsdlExporter>，或是使用傳遞至 `wsdlExporter` 方法的 <xref:System.ServiceModel.Description.IWsdlExportExtension.ExportContract%2A> 參數。</span><span class="sxs-lookup"><span data-stu-id="6b93c-292">Create a new <xref:System.ServiceModel.Description.WsdlExporter> or use the `wsdlExporter` parameter passed to the <xref:System.ServiceModel.Description.IWsdlExportExtension.ExportContract%2A> method.</span></span>  
  
2. <span data-ttu-id="6b93c-293">使用 <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> 函式檢查是否已定義 <xref:System.Runtime.Serialization.XsdDataContractExporter>。</span><span class="sxs-lookup"><span data-stu-id="6b93c-293">Use the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> function to check whether an <xref:System.Runtime.Serialization.XsdDataContractExporter> has been defined.</span></span>  
  
3. <span data-ttu-id="6b93c-294">如果 <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> 傳回 `false`，則從 <xref:System.Runtime.Serialization.XsdDataContractExporter> 建立含有所產生 XML 結構描述的新 <xref:System.ServiceModel.Description.WsdlExporter>，並且將它加入至 <xref:System.ServiceModel.Description.MetadataExporter.State%2A> 的 <xref:System.ServiceModel.Description.WsdlExporter> 屬性傳回的集合。</span><span class="sxs-lookup"><span data-stu-id="6b93c-294">If <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> returns `false`, create a new <xref:System.Runtime.Serialization.XsdDataContractExporter> with the generated XML schemas from the <xref:System.ServiceModel.Description.WsdlExporter>, and add it to the collection returned by the <xref:System.ServiceModel.Description.MetadataExporter.State%2A> property of the <xref:System.ServiceModel.Description.WsdlExporter>.</span></span> <span data-ttu-id="6b93c-295">否則使用 `out` 方法的 <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> 參數傳回的匯出工具。</span><span class="sxs-lookup"><span data-stu-id="6b93c-295">Otherwise, use the exporter returned by the `out` parameter of the <xref:System.Collections.Generic.Dictionary%602.TryGetValue%2A> method.</span></span>  
  
4. <span data-ttu-id="6b93c-296">如果 <xref:System.Runtime.Serialization.XsdDataContractExporter> 未定義任何 <xref:System.Runtime.Serialization.ExportOptions>，則將 <xref:System.Runtime.Serialization.XsdDataContractExporter.Options%2A> 屬性設為 <xref:System.Runtime.Serialization.ExportOptions> 類別的新執行個體。</span><span class="sxs-lookup"><span data-stu-id="6b93c-296">If the <xref:System.Runtime.Serialization.XsdDataContractExporter> has no <xref:System.Runtime.Serialization.ExportOptions> defined, then set the <xref:System.Runtime.Serialization.XsdDataContractExporter.Options%2A> property to a new instance of the <xref:System.Runtime.Serialization.ExportOptions> class.</span></span>  
  
5. <span data-ttu-id="6b93c-297">將 <xref:System.Runtime.Serialization.ExportOptions.DataContractSurrogate%2A> 之 <xref:System.Runtime.Serialization.ExportOptions> 的 <xref:System.Runtime.Serialization.XsdDataContractExporter> 屬性設為代理的新執行個體。</span><span class="sxs-lookup"><span data-stu-id="6b93c-297">Set the <xref:System.Runtime.Serialization.ExportOptions.DataContractSurrogate%2A> property of the <xref:System.Runtime.Serialization.ExportOptions> of the <xref:System.Runtime.Serialization.XsdDataContractExporter> to a new instance of the surrogate.</span></span> <span data-ttu-id="6b93c-298">後續匯出中繼資料的步驟不需要任何改變。</span><span class="sxs-lookup"><span data-stu-id="6b93c-298">Subsequent steps for exporting metadata do not require any changes.</span></span>  
  
     [!code-csharp[C_IDataContractSurrogate#10](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_idatacontractsurrogate/cs/source.cs#10)]  
  
## <a name="see-also"></a><span data-ttu-id="6b93c-299">另請參閱</span><span class="sxs-lookup"><span data-stu-id="6b93c-299">See also</span></span>

- <xref:System.Runtime.Serialization.DataContractSerializer>
- <xref:System.Runtime.Serialization.IDataContractSurrogate>
- <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior>
- <xref:System.Runtime.Serialization.ImportOptions>
- <xref:System.Runtime.Serialization.ExportOptions>
- [<span data-ttu-id="6b93c-300">使用資料合約</span><span class="sxs-lookup"><span data-stu-id="6b93c-300">Using Data Contracts</span></span>](../feature-details/using-data-contracts.md)
