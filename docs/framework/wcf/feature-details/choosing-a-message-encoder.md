---
title: 選擇訊息編碼器
ms.date: 03/30/2017
ms.assetid: 2204d82d-d962-4922-a79e-c9a231604f19
ms.openlocfilehash: 8b53c17cccc74153e652494ec9753302cda8679b
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/26/2020
ms.locfileid: "96295154"
---
# <a name="choose-a-message-encoder"></a><span data-ttu-id="bc731-102">選擇訊息編碼器</span><span class="sxs-lookup"><span data-stu-id="bc731-102">Choose a Message Encoder</span></span>

<span data-ttu-id="bc731-103">本文將討論在 Windows Communication Foundation (WCF) ：二進位、文字和訊息傳輸優化機制 (MTOM) 中所包含之訊息編碼器的選擇準則。</span><span class="sxs-lookup"><span data-stu-id="bc731-103">This article discusses criteria for choosing among the message encoders that are included in Windows Communication Foundation (WCF): binary, text, and Message Transmission Optimization Mechanism (MTOM).</span></span>  
  
 <span data-ttu-id="bc731-104">在 WCF 中，您可以透過系結（由一系列的 *綁定* 項 *組成），* 指定如何跨網路在端點之間傳輸資料。</span><span class="sxs-lookup"><span data-stu-id="bc731-104">In WCF, you specify how to transfer data across a network between endpoints by means of a *binding*, which is made up of a sequence of *binding elements*.</span></span> <span data-ttu-id="bc731-105">訊息編碼器是由繫結堆疊中的訊息編碼繫結項目所表示。</span><span class="sxs-lookup"><span data-stu-id="bc731-105">A message encoder is represented by a message encoding binding element in the binding stack.</span></span> <span data-ttu-id="bc731-106">繫結包含選擇性通訊協定繫結項目 (例如安全性繫結項目或可靠的訊息繫結項目)、必要的訊息編碼繫結項目和必要的傳輸繫結項目。</span><span class="sxs-lookup"><span data-stu-id="bc731-106">A binding includes optional protocol binding elements, such as a security binding element or reliable messaging binding element, a required message encoding binding element, and a required transport binding element.</span></span>  
  
 <span data-ttu-id="bc731-107">訊息編碼繫結項目位在選擇性通訊協定繫結項目之下，在必要的傳輸繫結項目之上。</span><span class="sxs-lookup"><span data-stu-id="bc731-107">The message encoding binding element sits below the optional protocol binding elements and above the required transport binding element.</span></span> <span data-ttu-id="bc731-108">在傳出端，訊息編碼器會序列化傳出的 <xref:System.ServiceModel.Channels.Message>，並會將它傳遞至傳輸。</span><span class="sxs-lookup"><span data-stu-id="bc731-108">On the outgoing side, a message encoder serializes the outgoing <xref:System.ServiceModel.Channels.Message> and passes it to the transport.</span></span> <span data-ttu-id="bc731-109">在傳入端，訊息編碼器會從傳輸接收 <xref:System.ServiceModel.Channels.Message> 的序列化形式，並會將它傳遞至更高的通訊協定層 (如果有的話)，否則會傳遞至應用程式。</span><span class="sxs-lookup"><span data-stu-id="bc731-109">On the incoming side, a message encoder receives the serialized form of a <xref:System.ServiceModel.Channels.Message> from the transport and passes it to the higher protocol layer, if present, or to the application, if not.</span></span>  
  
 <span data-ttu-id="bc731-110">連接到已存在的用戶端或伺服器時，您可能沒有使用特定訊息編碼的選擇，因為您必須以另一端預期的方式，對訊息進行編碼。</span><span class="sxs-lookup"><span data-stu-id="bc731-110">When connecting to a pre-existing client or server, you may not have a choice about using a particular message encoding since you need to encode your messages in a way that the other side is expecting.</span></span> <span data-ttu-id="bc731-111">但是，如果您要撰寫 WCF 服務，您可以透過多個端點公開服務，每個端點使用不同的訊息編碼。</span><span class="sxs-lookup"><span data-stu-id="bc731-111">However, if you are writing a WCF service, you can expose your service through multiple endpoints, each using a different message encoding.</span></span> <span data-ttu-id="bc731-112">這會讓用戶端在對它們來說是最佳端點上，選擇最佳編碼方式來與服務交談，而且會提供用戶端彈性來選擇最佳編碼方式。</span><span class="sxs-lookup"><span data-stu-id="bc731-112">This allows clients to choose the best encoding for talking to your service over the endpoint that is best for them, as well as giving your clients the flexibility to choose the encoding that is best for them.</span></span> <span data-ttu-id="bc731-113">使用多個端點，也會將不同訊息編碼的好處與其他繫結程序項目結合。</span><span class="sxs-lookup"><span data-stu-id="bc731-113">Using multiple endpoints also allows you to combine the advantages of different message encodings with other binding elements.</span></span>  
  
## <a name="system-provided-encoders"></a><span data-ttu-id="bc731-114">系統提供的編碼器</span><span class="sxs-lookup"><span data-stu-id="bc731-114">System-Provided Encoders</span></span>  

 <span data-ttu-id="bc731-115">WCF 包含三個訊息編碼器，以下列三個類別表示：</span><span class="sxs-lookup"><span data-stu-id="bc731-115">WCF includes three message encoders, which are represented by the following three classes:</span></span>  
  
- <span data-ttu-id="bc731-116"><xref:System.ServiceModel.Channels.TextMessageEncodingBindingElement> 即文字訊息編碼器，支援純 XML 編碼方式和 SOAP 編碼方式。</span><span class="sxs-lookup"><span data-stu-id="bc731-116"><xref:System.ServiceModel.Channels.TextMessageEncodingBindingElement>, the text message encoder, supports both plain XML encoding and SOAP encoding.</span></span> <span data-ttu-id="bc731-117">文字訊息編碼器的純 XML 編碼模式稱為 "plain old XML" (POX)，與文字為主的 SOAP 編碼方式有所區別。</span><span class="sxs-lookup"><span data-stu-id="bc731-117">The plain XML encoding mode of the text message encoder is called "plain old XML" (POX) to distinguish it from text-based SOAP encoding.</span></span> <span data-ttu-id="bc731-118">若要啟用 POX，請將 <xref:System.ServiceModel.Channels.TextMessageEncodingBindingElement.MessageVersion%2A> 屬性設定為 <xref:System.ServiceModel.Channels.MessageVersion.None%2A>。</span><span class="sxs-lookup"><span data-stu-id="bc731-118">To enable POX, set the <xref:System.ServiceModel.Channels.TextMessageEncodingBindingElement.MessageVersion%2A> property to <xref:System.ServiceModel.Channels.MessageVersion.None%2A>.</span></span> <span data-ttu-id="bc731-119">使用文字訊息編碼器，與非 WCF 端點交互操作。</span><span class="sxs-lookup"><span data-stu-id="bc731-119">Use the text message encoder to interoperate with non-WCF endpoints.</span></span>  
  
- <span data-ttu-id="bc731-120"><xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement>（二進位訊息編碼器）使用 compact 二進位格式，並已針對 WCF 對 WCF 通訊進行優化，因此無法互通。</span><span class="sxs-lookup"><span data-stu-id="bc731-120"><xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement>, the binary message encoder, uses a compact binary format and is optimized for WCF to WCF communication, and hence is not interoperable.</span></span> <span data-ttu-id="bc731-121">這也是 WCF 提供之所有編碼器的最高效能編碼器。</span><span class="sxs-lookup"><span data-stu-id="bc731-121">This is also the most performant encoder of all the encoders WCF provides.</span></span>  
  
- <span data-ttu-id="bc731-122"><xref:System.ServiceModel.Channels.MtomMessageEncodingBindingElement> 即繫結項目，會指定以 MTOM 編碼訊息的字元編碼和訊息版本處理。</span><span class="sxs-lookup"><span data-stu-id="bc731-122"><xref:System.ServiceModel.Channels.MtomMessageEncodingBindingElement>, the binding element, specifies the character encoding and message versioning for messages using MTOM encoding.</span></span> <span data-ttu-id="bc731-123">MTOM 是在 WCF 訊息中傳輸二進位資料的有效技術。</span><span class="sxs-lookup"><span data-stu-id="bc731-123">MTOM is an efficient technology for transmitting binary data in WCF messages.</span></span> <span data-ttu-id="bc731-124">MTOM 編碼器會嘗試在效率和互通性之間建立平衡。</span><span class="sxs-lookup"><span data-stu-id="bc731-124">The MTOM encoder attempts to create a balance between efficiency and interoperability.</span></span> <span data-ttu-id="bc731-125">MTOM 編碼方式會以文字格式傳輸大部分的 XML，但是在傳輸大型區塊的二進位資料時，會依照原狀來傳送 (不轉換成文字)，好讓這些資料最佳化。</span><span class="sxs-lookup"><span data-stu-id="bc731-125">The MTOM encoding transmits most XML in textual form, but optimizes large blocks of binary data by transmitting them as-is, without conversion to text.</span></span> <span data-ttu-id="bc731-126">就效率而言，在 WCF 提供的編碼器中，MTOM 是文字 (最慢的) 和二進位 (最快的) 。</span><span class="sxs-lookup"><span data-stu-id="bc731-126">In terms of efficiency, among the encoders WCF provides, MTOM is in-between text (the slowest) and binary (the fastest).</span></span>  
  
## <a name="how-to-choose-a-message-encoder"></a><span data-ttu-id="bc731-127">如何選擇訊息編碼器</span><span class="sxs-lookup"><span data-stu-id="bc731-127">How to Choose a Message Encoder</span></span>  

 <span data-ttu-id="bc731-128">下表說明選擇訊息編碼器時的通用因素。</span><span class="sxs-lookup"><span data-stu-id="bc731-128">The following table describes common factors used to choose a message encoder.</span></span> <span data-ttu-id="bc731-129">將對您應用程式最重要的因素設定優先權，然後選擇最適合這些因素的訊息編碼器。</span><span class="sxs-lookup"><span data-stu-id="bc731-129">Prioritize the factors that are important for your application, and then choose the message encoders that work best with these factors.</span></span> <span data-ttu-id="bc731-130">請務必考慮表格中所未列出的任何其他因素，以及應用程式可能需要的任何自訂訊息編碼器。</span><span class="sxs-lookup"><span data-stu-id="bc731-130">Be sure to consider any additional factors not listed in this table and any custom message encoders that may be required in your application.</span></span>  
  
|<span data-ttu-id="bc731-131">因素</span><span class="sxs-lookup"><span data-stu-id="bc731-131">Factor</span></span>|<span data-ttu-id="bc731-132">描述</span><span class="sxs-lookup"><span data-stu-id="bc731-132">Description</span></span>|<span data-ttu-id="bc731-133">支援這個因素的編碼器</span><span class="sxs-lookup"><span data-stu-id="bc731-133">Encoders that support this factor</span></span>|  
|------------|-----------------|---------------------------------------|  
|<span data-ttu-id="bc731-134">支援的字元集。</span><span class="sxs-lookup"><span data-stu-id="bc731-134">Supported Character Sets</span></span>|<span data-ttu-id="bc731-135"><xref:System.ServiceModel.Channels.TextMessageEncodingBindingElement> 和 <xref:System.ServiceModel.Channels.MtomMessageEncodingBindingElement> 僅支援 UTF8 和 UTF16 Unicode (位元組由大到小和位元組由 *大* 到 *小的*) 編碼。</span><span class="sxs-lookup"><span data-stu-id="bc731-135"><xref:System.ServiceModel.Channels.TextMessageEncodingBindingElement> and <xref:System.ServiceModel.Channels.MtomMessageEncodingBindingElement> support only the UTF8 and UTF16 Unicode (*big-endian* and *little-endian*) encodings.</span></span> <span data-ttu-id="bc731-136">如果不需要如 UTF7 或 ASCII 等其他編碼，則必須使用自訂編碼器。</span><span class="sxs-lookup"><span data-stu-id="bc731-136">If other encodings are required, such as UTF7 or ASCII, a custom encoder must be used.</span></span> <span data-ttu-id="bc731-137">如需範例自訂編碼器，請參閱 [自訂訊息編碼器](../samples/custom-message-encoder-custom-text-encoder.md)。</span><span class="sxs-lookup"><span data-stu-id="bc731-137">For a sample custom encoder, see [Custom Message Encoder](../samples/custom-message-encoder-custom-text-encoder.md).</span></span>|<span data-ttu-id="bc731-138">文字</span><span class="sxs-lookup"><span data-stu-id="bc731-138">Text</span></span>|  
|<span data-ttu-id="bc731-139">檢閱</span><span class="sxs-lookup"><span data-stu-id="bc731-139">Inspection</span></span>|<span data-ttu-id="bc731-140">檢查是傳輸期間檢查訊息的能力。</span><span class="sxs-lookup"><span data-stu-id="bc731-140">Inspection is the ability to examine messages during transmission.</span></span> <span data-ttu-id="bc731-141">不論是否使用 SOAP，文字編碼都會讓許多應用程式檢查及分析訊息，而不需要使用特別工具。</span><span class="sxs-lookup"><span data-stu-id="bc731-141">Text encodings, either with or without the use of SOAP, allow messages to be inspected and analyzed by many applications without the use of specialized tools.</span></span> <span data-ttu-id="bc731-142">在訊息或傳輸層級使用傳輸安全性，會影響您檢查訊息的能力。</span><span class="sxs-lookup"><span data-stu-id="bc731-142">The use of transfer security, at either the message or transport level, affects your ability to inspect messages.</span></span> <span data-ttu-id="bc731-143">機密性會保護訊息不受檢查，而完整性則會保護訊息不受修改。</span><span class="sxs-lookup"><span data-stu-id="bc731-143">Confidentiality protects a message from being examined and integrity protects a message from being modified.</span></span>|<span data-ttu-id="bc731-144">文字</span><span class="sxs-lookup"><span data-stu-id="bc731-144">Text</span></span>|  
|<span data-ttu-id="bc731-145">可靠性</span><span class="sxs-lookup"><span data-stu-id="bc731-145">Reliability</span></span>|<span data-ttu-id="bc731-146">可靠性是編碼器抵抗傳輸錯誤的能力。</span><span class="sxs-lookup"><span data-stu-id="bc731-146">Reliability is the resiliency of an encoder to transmission errors.</span></span> <span data-ttu-id="bc731-147">此外，也可以在訊息、傳輸或應用程式層提供可靠性。</span><span class="sxs-lookup"><span data-stu-id="bc731-147">Reliability can also be provided at the message, transport, or application layer.</span></span> <span data-ttu-id="bc731-148">所有標準 WCF 編碼器都假設有另一層提供可靠性。</span><span class="sxs-lookup"><span data-stu-id="bc731-148">All of the standard WCF encoders assume that another layer is providing reliability.</span></span> <span data-ttu-id="bc731-149">編碼器不太能從傳輸錯誤復原。</span><span class="sxs-lookup"><span data-stu-id="bc731-149">The encoder has little ability to recover from a transmission error.</span></span>|<span data-ttu-id="bc731-150">無</span><span class="sxs-lookup"><span data-stu-id="bc731-150">None</span></span>|  
|<span data-ttu-id="bc731-151">簡潔</span><span class="sxs-lookup"><span data-stu-id="bc731-151">Simplicity</span></span>|<span data-ttu-id="bc731-152">簡單表示可輕鬆建立某個編碼規格的編碼器和解碼器。</span><span class="sxs-lookup"><span data-stu-id="bc731-152">Simplicity represents the ease with which you can create encoders and decoders for an encoding specification.</span></span> <span data-ttu-id="bc731-153">文字編碼對簡單而言特別有利，而且 POX 文字編碼還有不需要支援來處理 SOAP 的額外好處。</span><span class="sxs-lookup"><span data-stu-id="bc731-153">Text encodings are particularly advantageous for simplicity, and the POX text encoding has the additional advantage of not requiring support for processing SOAP.</span></span>|<span data-ttu-id="bc731-154">文字 (POX)</span><span class="sxs-lookup"><span data-stu-id="bc731-154">Text (POX)</span></span>|  
|<span data-ttu-id="bc731-155">大小</span><span class="sxs-lookup"><span data-stu-id="bc731-155">Size</span></span>|<span data-ttu-id="bc731-156">編碼方式決定了內容所需的負荷量。</span><span class="sxs-lookup"><span data-stu-id="bc731-156">The encoding determines the amount of overhead imposed on content.</span></span> <span data-ttu-id="bc731-157">編碼訊息的大小與服務作業的最大輸送量直接相關。</span><span class="sxs-lookup"><span data-stu-id="bc731-157">The size of encoded messages is directly related to the maximum throughput of service operations.</span></span> <span data-ttu-id="bc731-158">二進位編碼通常比文字編碼更為精簡。</span><span class="sxs-lookup"><span data-stu-id="bc731-158">Binary encodings are generally more compact than text encodings.</span></span> <span data-ttu-id="bc731-159">當訊息太大時，請考慮在編碼期間一併壓縮訊息內容。</span><span class="sxs-lookup"><span data-stu-id="bc731-159">When message size is at a premium, consider also compressing the message contents during encoding.</span></span> <span data-ttu-id="bc731-160">不過，對於訊息傳送者和接收者，壓縮都會增加處理成本。</span><span class="sxs-lookup"><span data-stu-id="bc731-160">However, compression adds processing costs for both the message sender and receiver.</span></span>|<span data-ttu-id="bc731-161">Binary</span><span class="sxs-lookup"><span data-stu-id="bc731-161">Binary</span></span>|  
|<span data-ttu-id="bc731-162">串流</span><span class="sxs-lookup"><span data-stu-id="bc731-162">Streaming</span></span>|<span data-ttu-id="bc731-163">資料流可讓應用程式在整個訊息送達之前開始處理訊息。</span><span class="sxs-lookup"><span data-stu-id="bc731-163">Streaming allows applications to begin processing a message before the entire message has arrived.</span></span> <span data-ttu-id="bc731-164">有效使用資料流，會要求訊息開頭便提供訊息的重要資料，因此接收的應用程式不需要等待訊息送達。</span><span class="sxs-lookup"><span data-stu-id="bc731-164">Effectively using streaming requires that the important data for a message be available at the beginning of the message so that the receiving application is not required to wait for it to arrive.</span></span> <span data-ttu-id="bc731-165">而且，使用資料流處理傳輸的應用程式必須累加組織訊息中的資料，因此內容沒有轉接相依性。</span><span class="sxs-lookup"><span data-stu-id="bc731-165">Moreover, applications that use streamed transfer must organize data in the message incrementally so that the content does not have forward dependencies.</span></span> <span data-ttu-id="bc731-166">在許多情況下，您必須在資料流內容和擁有內容的最小傳輸大小之間妥協。</span><span class="sxs-lookup"><span data-stu-id="bc731-166">In many cases, you must compromise between streaming content and having the smallest possible transfer size for that content.</span></span>|<span data-ttu-id="bc731-167">無</span><span class="sxs-lookup"><span data-stu-id="bc731-167">None</span></span>|  
|<span data-ttu-id="bc731-168">協力廠商工具支援</span><span class="sxs-lookup"><span data-stu-id="bc731-168">Third-Party Tool Support</span></span>|<span data-ttu-id="bc731-169">編碼方式的支援區域包含開發和診斷。</span><span class="sxs-lookup"><span data-stu-id="bc731-169">Support areas for an encoding include development and diagnosis.</span></span> <span data-ttu-id="bc731-170">協力廠商開發人員已經在處理 POX 格式編碼訊息的程式庫和工具組投入大量投資。</span><span class="sxs-lookup"><span data-stu-id="bc731-170">Third-party developers have made a large investment in libraries and toolkits for handling messages encoded in the POX format.</span></span>|<span data-ttu-id="bc731-171">文字 (POX)</span><span class="sxs-lookup"><span data-stu-id="bc731-171">Text (POX)</span></span>|  
|<span data-ttu-id="bc731-172">互通性</span><span class="sxs-lookup"><span data-stu-id="bc731-172">Interoperability</span></span>|<span data-ttu-id="bc731-173">這項因素是指 WCF 編碼器與非 WCF 服務交互操作的能力。</span><span class="sxs-lookup"><span data-stu-id="bc731-173">This factor refers to the ability of a WCF encoder to interoperate with non-WCF services.</span></span>|<span data-ttu-id="bc731-174">文字</span><span class="sxs-lookup"><span data-stu-id="bc731-174">Text</span></span><br /><br /> <span data-ttu-id="bc731-175">MTOM (部分)</span><span class="sxs-lookup"><span data-stu-id="bc731-175">MTOM (partial)</span></span>|  
  
<span data-ttu-id="bc731-176">注意：使用二進位編碼器時，在建立 XMLReader 期間使用 IgnoreWhitespace 設定將會沒有作用。</span><span class="sxs-lookup"><span data-stu-id="bc731-176">Note: When using the Binary Encoder, using the IgnoreWhitespace setting when creating a XMLReader will have no effect.</span></span>  <span data-ttu-id="bc731-177">例如，如果您在服務作業中執行下列動作：</span><span class="sxs-lookup"><span data-stu-id="bc731-177">For example, if you do the following inside a service operation:</span></span>  

```csharp
public void OperationContract(XElement input)
{
    Console.WriteLine("{0}", input.Value);
    int counter = 0;
    var xreader = input.CreateReader();
    var reader = XmlReader.Create(xreader, new XmlReaderSettings() { IgnoreWhitespace = true });
    while (reader.Read())
    {
        counter++;
    }

    Console.WriteLine("Read {0} lines with reader", counter);
}
```  
  
<span data-ttu-id="bc731-178">IgnoreWhitespace 設定會遭到忽略。</span><span class="sxs-lookup"><span data-stu-id="bc731-178">The IgnoreWhitespace setting is ignored.</span></span>  
  
## <a name="compression-and-the-binary-encoder"></a><span data-ttu-id="bc731-179">壓縮和二進位編碼器</span><span class="sxs-lookup"><span data-stu-id="bc731-179">Compression and the Binary Encoder</span></span>

<span data-ttu-id="bc731-180">從 WCF 4.5 開始，WCF 二進位編碼器加入壓縮的支援。</span><span class="sxs-lookup"><span data-stu-id="bc731-180">Beginning with WCF 4.5 the WCF binary encoder adds support for compression.</span></span> <span data-ttu-id="bc731-181">這可讓您使用 gzip/Deflate 演算法從 WCF 用戶端傳送壓縮的訊息，同時也從自我裝載的 WCF 服務以壓縮的訊息來回應。</span><span class="sxs-lookup"><span data-stu-id="bc731-181">This enables you to use the gzip/deflate algorithm for sending compressed messages from a WCF client and also respond with compressed messages from a self-hosted WCF service.</span></span> <span data-ttu-id="bc731-182">這項功能會在 HTTP 和 TCP 傳輸上啟用壓縮。</span><span class="sxs-lookup"><span data-stu-id="bc731-182">This feature enables compression on both the HTTP and TCP transports.</span></span> <span data-ttu-id="bc731-183">藉由設定 IIS 主機伺服器，IIS 所裝載的 WCF 服務就可以永遠啟用傳送壓縮回應。</span><span class="sxs-lookup"><span data-stu-id="bc731-183">An IIS hosted WCF service can always be enabled for sending compressed responses by configuring the IIS host server.</span></span> <span data-ttu-id="bc731-184">壓縮型別是透過 <xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement.CompressionFormat%2A?displayProperty=nameWithType> 屬性來設定。</span><span class="sxs-lookup"><span data-stu-id="bc731-184">The type of compression is configured with the <xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement.CompressionFormat%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="bc731-185">這個屬性會設定為其中一個 <xref:System.ServiceModel.Channels.CompressionFormat?displayProperty=nameWithType> 列舉值︰</span><span class="sxs-lookup"><span data-stu-id="bc731-185">This property is set to one of the <xref:System.ServiceModel.Channels.CompressionFormat?displayProperty=nameWithType> enum values:</span></span>

- <xref:System.ServiceModel.Channels.CompressionFormat.Deflate>
- <xref:System.ServiceModel.Channels.CompressionFormat.GZip>
- <xref:System.ServiceModel.Channels.CompressionFormat.None>
  
<span data-ttu-id="bc731-186">由於這個屬性只會在 binaryMessageEncodingBindingElement 上公開，因此您必須建立如下的自訂系結，才能使用這項功能：</span><span class="sxs-lookup"><span data-stu-id="bc731-186">Since this property is only exposed on the binaryMessageEncodingBindingElement, you will need to create a custom binding like the following to use this feature:</span></span>

 ```xml
 <customBinding>
   <binding name="BinaryCompressionBinding">
     <binaryMessageEncoding compressionFormat ="GZip" />
     <httpTransport />
  </binding>
</customBinding>
 ```

<span data-ttu-id="bc731-187">用戶端和服務都必須同意傳送和接收壓縮的訊息，因此必須在用戶端和服務上的 binaryMessageEncoding 元素上設定 compressionFormat 屬性。</span><span class="sxs-lookup"><span data-stu-id="bc731-187">Both the client and the service need to agree to send and receive compressed messages and therefore the compressionFormat property must be configured on the binaryMessageEncoding element on both client and service.</span></span> <span data-ttu-id="bc731-188">如果服務或用戶端未設定壓縮，而另一端為，則會擲回 ProtocolException。</span><span class="sxs-lookup"><span data-stu-id="bc731-188">A ProtocolException is thrown if either the service or client is not configured for compression, but the other side is.</span></span> <span data-ttu-id="bc731-189">應謹慎考慮啟用壓縮。</span><span class="sxs-lookup"><span data-stu-id="bc731-189">Enabling compression should be carefully considered.</span></span> <span data-ttu-id="bc731-190">如果網路頻寬形成瓶頸，壓縮多半是有用的。</span><span class="sxs-lookup"><span data-stu-id="bc731-190">Compression is mostly useful if network bandwidth is a bottleneck.</span></span> <span data-ttu-id="bc731-191">在 CPU 成為瓶頸所在的情況下，壓縮會減少輸送量。</span><span class="sxs-lookup"><span data-stu-id="bc731-191">In the case where the CPU is the bottleneck, compression will decrease throughput.</span></span> <span data-ttu-id="bc731-192">必須在模擬環境中進行適當測試，以確認這項功能對應用程式有益。</span><span class="sxs-lookup"><span data-stu-id="bc731-192">Appropriate testing must be done in a simulated environment to find out if this benefits the application</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="bc731-193">另請參閱</span><span class="sxs-lookup"><span data-stu-id="bc731-193">See also</span></span>

- [<span data-ttu-id="bc731-194">繫結</span><span class="sxs-lookup"><span data-stu-id="bc731-194">Bindings</span></span>](bindings.md)
