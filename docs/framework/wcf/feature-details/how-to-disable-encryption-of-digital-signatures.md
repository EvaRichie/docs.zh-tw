---
title: 作法：停用數位簽章加密
ms.date: 03/30/2017
ms.assetid: fd174313-ad81-4dca-898a-016ccaff8187
ms.openlocfilehash: 6d9102ab7676a8e751e608b6081da751464e6ee0
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/26/2020
ms.locfileid: "96237387"
---
# <a name="how-to-disable-encryption-of-digital-signatures"></a><span data-ttu-id="b0c9b-102">作法：停用數位簽章加密</span><span class="sxs-lookup"><span data-stu-id="b0c9b-102">How to: Disable Encryption of Digital Signatures</span></span>

<span data-ttu-id="b0c9b-103">根據預設，訊息會經過簽署，並且簽章會經過數位加密。</span><span class="sxs-lookup"><span data-stu-id="b0c9b-103">By default, a message is signed and the signature is digitally encrypted.</span></span> <span data-ttu-id="b0c9b-104">這是透過使用 <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement> 或 <xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement> 的執行個體建立自訂繫結，並將其中一個的 `MessageProtectionOrder` 屬性設定為 <xref:System.ServiceModel.Security.MessageProtectionOrder> 列舉值的方式來控制。</span><span class="sxs-lookup"><span data-stu-id="b0c9b-104">This is controlled by creating a custom binding with an instance of the <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement> or the <xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement> and setting the `MessageProtectionOrder` property of either class to a <xref:System.ServiceModel.Security.MessageProtectionOrder> enumeration value.</span></span> <span data-ttu-id="b0c9b-105">預設為 <xref:System.ServiceModel.Security.MessageProtectionOrder.SignBeforeEncryptAndEncryptSignature>。</span><span class="sxs-lookup"><span data-stu-id="b0c9b-105">The default is <xref:System.ServiceModel.Security.MessageProtectionOrder.SignBeforeEncryptAndEncryptSignature>.</span></span> <span data-ttu-id="b0c9b-106">這個程序會比僅僅進行簽署和加密多花最多 30% 的時間，依整體訊息大小而定 (訊息越小，對效能影響越大)。</span><span class="sxs-lookup"><span data-stu-id="b0c9b-106">This process consumes up to 30 percent more time than simply signing and encrypting based on the overall message size (the smaller the message, the greater the performance impact).</span></span> <span data-ttu-id="b0c9b-107">然而，停用簽章加密可能會使攻擊者得以猜測訊息內容。</span><span class="sxs-lookup"><span data-stu-id="b0c9b-107">Disabling encryption of the signature, however, might allow an attacker to guess the content of the message.</span></span> <span data-ttu-id="b0c9b-108">這是有可能的，因為簽章項目包含訊息中每個簽署部分的純文字雜湊程式碼。</span><span class="sxs-lookup"><span data-stu-id="b0c9b-108">This is possible because the signature element contains the hash code of the plain text of every signed part in the message.</span></span> <span data-ttu-id="b0c9b-109">例如，雖然訊息本文預設會經過加密，但未加密的簽章會包含訊息本文加密前的雜湊程式碼。</span><span class="sxs-lookup"><span data-stu-id="b0c9b-109">For example, although the message body is encrypted by default, the unencrypted signature contains the hash code of the message body before the encryption.</span></span> <span data-ttu-id="b0c9b-110">如果簽署和加密部分的可能值組合很小，攻擊者可能會參考雜湊值來推算內容。</span><span class="sxs-lookup"><span data-stu-id="b0c9b-110">If the set of possible values for the signed and encrypted part is small, an attacker might be able to deduce the contents by looking at the hash value.</span></span> <span data-ttu-id="b0c9b-111">將簽章加密可以降低遭受這個攻擊的可能性。</span><span class="sxs-lookup"><span data-stu-id="b0c9b-111">Encrypting the signature mitigates this attack vector.</span></span>  
  
 <span data-ttu-id="b0c9b-112">因此，請在內容的價值很低，或可能的內容值組合很大且非決定性，並且獲得效能比降低前述攻擊可能性來得重要時，才停用簽章加密。</span><span class="sxs-lookup"><span data-stu-id="b0c9b-112">Therefore, disable encryption of the signature only when the value of the content is low or the set of possible content values is large and nondeterministic, and the performance gain is more important than mitigating the attack described above.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="b0c9b-113">如果訊息本身沒有加密，則簽章項目也不會加密，即使 <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement.MessageProtectionOrder%2A?displayProperty=nameWithType> 或 <xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement.MessageProtectionOrder%2A?displayProperty=nameWithType> 屬性設定為 <xref:System.ServiceModel.Security.MessageProtectionOrder.SignBeforeEncryptAndEncryptSignature> 也一樣。</span><span class="sxs-lookup"><span data-stu-id="b0c9b-113">If there is nothing in the message that is encrypted, the signature element is not encrypted, even when the <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement.MessageProtectionOrder%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement.MessageProtectionOrder%2A?displayProperty=nameWithType> property is set to <xref:System.ServiceModel.Security.MessageProtectionOrder.SignBeforeEncryptAndEncryptSignature>.</span></span> <span data-ttu-id="b0c9b-114">即使是系統提供的繫結，也會發生這種情形，所有系統提供的繫結都已將訊息保護順序設定為 `SignBeforeEncryptAndEncryptSignature`。</span><span class="sxs-lookup"><span data-stu-id="b0c9b-114">This behavior occurs even with system-provided bindings; all system-provided bindings have the message protection order set to `SignBeforeEncryptAndEncryptSignature`.</span></span> <span data-ttu-id="b0c9b-115">不過，WCF 所產生的 Web 服務描述語言 (WSDL) 仍會包含判斷提示 `<sp:EncryptSignature>` 。</span><span class="sxs-lookup"><span data-stu-id="b0c9b-115">However, the Web Services Description Language (WSDL) WCF generates will still contain the `<sp:EncryptSignature>` assertion.</span></span>  
  
### <a name="to-disable-digital-signing"></a><span data-ttu-id="b0c9b-116">若要停用數位簽章</span><span class="sxs-lookup"><span data-stu-id="b0c9b-116">To disable digital signing</span></span>  
  
1. <span data-ttu-id="b0c9b-117">建立 <xref:System.ServiceModel.Channels.CustomBinding>。</span><span class="sxs-lookup"><span data-stu-id="b0c9b-117">Create a <xref:System.ServiceModel.Channels.CustomBinding>.</span></span> <span data-ttu-id="b0c9b-118">如需詳細資訊，請參閱 [如何：使用 SecurityBindingElement 建立自訂](how-to-create-a-custom-binding-using-the-securitybindingelement.md)系結。</span><span class="sxs-lookup"><span data-stu-id="b0c9b-118">For more information, see [How to: Create a Custom Binding Using the SecurityBindingElement](how-to-create-a-custom-binding-using-the-securitybindingelement.md).</span></span>  
  
2. <span data-ttu-id="b0c9b-119">在繫結集合中加入 <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement> 或 <xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement>。</span><span class="sxs-lookup"><span data-stu-id="b0c9b-119">Add either an <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement> or a <xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement> to the binding collection.</span></span>  
  
3. <span data-ttu-id="b0c9b-120">將 <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement.MessageProtectionOrder%2A?displayProperty=nameWithType> 屬性設定為 <xref:System.ServiceModel.Security.MessageProtectionOrder.SignBeforeEncrypt>，或將 <xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement.MessageProtectionOrder%2A?displayProperty=nameWithType> 屬性設定為 <xref:System.ServiceModel.Security.MessageProtectionOrder.SignBeforeEncrypt>。</span><span class="sxs-lookup"><span data-stu-id="b0c9b-120">Set the <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement.MessageProtectionOrder%2A?displayProperty=nameWithType> property to <xref:System.ServiceModel.Security.MessageProtectionOrder.SignBeforeEncrypt>, or set the <xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement.MessageProtectionOrder%2A?displayProperty=nameWithType> property to <xref:System.ServiceModel.Security.MessageProtectionOrder.SignBeforeEncrypt>.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="b0c9b-121">另請參閱</span><span class="sxs-lookup"><span data-stu-id="b0c9b-121">See also</span></span>

- [<span data-ttu-id="b0c9b-122">自訂繫結的安全性功能</span><span class="sxs-lookup"><span data-stu-id="b0c9b-122">Security Capabilities with Custom Bindings</span></span>](security-capabilities-with-custom-bindings.md)
