---
title: 資料流訊息傳輸
ms.date: 03/30/2017
ms.assetid: 72a47a51-e5e7-4b76-b24a-299d51e0ae5a
ms.openlocfilehash: 462144856750a1b8726b574fdc82746da2d72ff7
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/09/2020
ms.locfileid: "84594786"
---
# <a name="streaming-message-transfer"></a><span data-ttu-id="85eb6-102">資料流訊息傳輸</span><span class="sxs-lookup"><span data-stu-id="85eb6-102">Streaming Message Transfer</span></span>
<span data-ttu-id="85eb6-103">Windows Communication Foundation （WCF）傳輸支援兩種傳輸訊息的模式：</span><span class="sxs-lookup"><span data-stu-id="85eb6-103">Windows Communication Foundation (WCF) transports support two modes for transferring messages:</span></span>  
  
- <span data-ttu-id="85eb6-104">緩衝處理的傳輸會將整個訊息保留在記憶體緩衝區中，直到完成傳輸作業為止。</span><span class="sxs-lookup"><span data-stu-id="85eb6-104">Buffered transfers hold the entire message in a memory buffer until the transfer is complete.</span></span> <span data-ttu-id="85eb6-105">必須等到緩衝處理的訊息完全傳送出去後，接收者才能開始讀取。</span><span class="sxs-lookup"><span data-stu-id="85eb6-105">A buffered message must be completely delivered before a receiver can read it.</span></span>  
  
- <span data-ttu-id="85eb6-106">資料流處理的傳輸會將訊息公開為資料流。</span><span class="sxs-lookup"><span data-stu-id="85eb6-106">Streamed transfers expose the message as a stream.</span></span> <span data-ttu-id="85eb6-107">在訊息完全傳送出去之前，接收者就可開始處理訊息。</span><span class="sxs-lookup"><span data-stu-id="85eb6-107">The receiver starts processing the message before it is completely delivered.</span></span>  
  
- <span data-ttu-id="85eb6-108">資料流處理的傳輸可以藉由消除大量記憶體緩衝區的需求來改善服務的延展性 (Scalability)。</span><span class="sxs-lookup"><span data-stu-id="85eb6-108">Streamed transfers can improve the scalability of a service by eliminating the requirement for large memory buffers.</span></span> <span data-ttu-id="85eb6-109">變更傳輸模式是否能夠改善延展性，需視所傳輸的訊息大小而定。</span><span class="sxs-lookup"><span data-stu-id="85eb6-109">Whether changing the transfer mode improves scalability depends on the size of the messages being transferred.</span></span> <span data-ttu-id="85eb6-110">大型訊息適合使用資料流處理傳輸方式來傳輸。</span><span class="sxs-lookup"><span data-stu-id="85eb6-110">Large message sizes favor using streamed transfers.</span></span>  
  
 <span data-ttu-id="85eb6-111">根據預設，HTTP、TCP/IP 和具名管道等傳輸都使用緩衝處理的傳輸方式。</span><span class="sxs-lookup"><span data-stu-id="85eb6-111">By default, the HTTP, TCP/IP, and named pipe transports use buffered transfers.</span></span> <span data-ttu-id="85eb6-112">本文件將說明如何從緩衝處理的傳輸模式切換到資料流處理的傳輸模式，以及這麼做將有何影響。</span><span class="sxs-lookup"><span data-stu-id="85eb6-112">This document describes how to switch these transports from a buffered to streamed transfer mode and the consequences of doing so.</span></span>  
  
## <a name="enabling-streamed-transfers"></a><span data-ttu-id="85eb6-113">啟用資料流處理的傳輸</span><span class="sxs-lookup"><span data-stu-id="85eb6-113">Enabling Streamed Transfers</span></span>  
 <span data-ttu-id="85eb6-114">在設定傳輸的繫結項目時，便已完成選取使用緩衝處理的傳輸模式還是資料流處理的傳輸模式。</span><span class="sxs-lookup"><span data-stu-id="85eb6-114">Selecting between buffered and streamed transfer modes is done on the binding element of the transport.</span></span> <span data-ttu-id="85eb6-115">繫結項目包含可設為 <xref:System.ServiceModel.TransferMode>、`Buffered`、`Streamed` 或 `StreamedRequest` 的 `StreamedResponse` 屬性。</span><span class="sxs-lookup"><span data-stu-id="85eb6-115">The binding element has a <xref:System.ServiceModel.TransferMode> property that can be set to `Buffered`, `Streamed`, `StreamedRequest`, or `StreamedResponse`.</span></span> <span data-ttu-id="85eb6-116">將傳輸模式設為 `Streamed` 可啟用雙向資料流通訊。</span><span class="sxs-lookup"><span data-stu-id="85eb6-116">Setting the transfer mode to `Streamed` enables streaming communication in both directions.</span></span> <span data-ttu-id="85eb6-117">將傳輸模式設為 `StreamedRequest` 或 `StreamedResponse` 只能啟用指定方向的資料流通訊。</span><span class="sxs-lookup"><span data-stu-id="85eb6-117">Setting the transfer mode to `StreamedRequest` or `StreamedResponse` enables streaming communication in the indicated direction only.</span></span>  
  
 <span data-ttu-id="85eb6-118"><xref:System.ServiceModel.BasicHttpBinding>、<xref:System.ServiceModel.NetTcpBinding> 和 <xref:System.ServiceModel.NetNamedPipeBinding> 繫結會公開 <xref:System.ServiceModel.TransferMode> 屬性。</span><span class="sxs-lookup"><span data-stu-id="85eb6-118">The <xref:System.ServiceModel.BasicHttpBinding>, <xref:System.ServiceModel.NetTcpBinding>, and <xref:System.ServiceModel.NetNamedPipeBinding> bindings expose the <xref:System.ServiceModel.TransferMode> property.</span></span> <span data-ttu-id="85eb6-119">如果是其他傳輸模式，您必須建立自訂繫結程序才能設定傳輸模式。</span><span class="sxs-lookup"><span data-stu-id="85eb6-119">For other transports, you must create a custom binding to set the transfer mode.</span></span>  
  
 <span data-ttu-id="85eb6-120">使用緩衝或資料流傳輸是由端點處決定。</span><span class="sxs-lookup"><span data-stu-id="85eb6-120">The decision to use either buffered or streamed transfers is a local decision of the endpoint.</span></span> <span data-ttu-id="85eb6-121">如果是 HTTP 傳輸模式，則傳輸模式不會在連線之間，或是在伺服器與其他媒介之間進行傳播。</span><span class="sxs-lookup"><span data-stu-id="85eb6-121">For HTTP transports, the transfer mode does not propagate across a connection, or to servers and other intermediaries.</span></span> <span data-ttu-id="85eb6-122">設定傳輸模式不會反映在服務介面的描述中。</span><span class="sxs-lookup"><span data-stu-id="85eb6-122">Setting the transfer mode is not reflected in the description of the service interface.</span></span> <span data-ttu-id="85eb6-123">在產生服務的用戶端類別之後，您必須為搭配資料流傳輸使用的服務編輯其組態檔，以設定模式。</span><span class="sxs-lookup"><span data-stu-id="85eb6-123">After generating a client class for a service, you must edit the configuration file for services intended to be used with streamed transfers to set the mode.</span></span> <span data-ttu-id="85eb6-124">如果是 TCP 和具名管道傳輸，會傳播傳輸模式做為原則判斷提示。</span><span class="sxs-lookup"><span data-stu-id="85eb6-124">For TCP and named pipe transports, the transfer mode is propagated as a policy assertion.</span></span>  
  
 <span data-ttu-id="85eb6-125">如需程式碼範例，請參閱[如何：啟用串流](how-to-enable-streaming.md)。</span><span class="sxs-lookup"><span data-stu-id="85eb6-125">For code samples, see [How to: Enable Streaming](how-to-enable-streaming.md).</span></span>  
  
## <a name="enabling-asynchronous-streaming"></a><span data-ttu-id="85eb6-126">啟用非同步資料流處理</span><span class="sxs-lookup"><span data-stu-id="85eb6-126">Enabling Asynchronous Streaming</span></span>  
 <span data-ttu-id="85eb6-127">若要啟用非同步資料流，請將 <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior> 端點行為加入至服務主機，並將其 <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior.AsynchronousSendEnabled%2A> 屬性設定為 `true`。</span><span class="sxs-lookup"><span data-stu-id="85eb6-127">To enable asynchronous streaming, add the  <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior> endpoint behavior to the service host and set its <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior.AsynchronousSendEnabled%2A> property to `true`.</span></span>  
  
 <span data-ttu-id="85eb6-128">這個版本的 WCF 還加入了在傳送端進行真實非同步資料流處理的功能。</span><span class="sxs-lookup"><span data-stu-id="85eb6-128">This version of WCF also adde the capability of true asynchronous streaming on the send side.</span></span> <span data-ttu-id="85eb6-129">在將訊息串流至多個用戶端，但部分用戶端可能因為網路擁塞或完全不讀取而造成讀取速度緩慢的案例中，這項功能可以提升服務的延展性。</span><span class="sxs-lookup"><span data-stu-id="85eb6-129">This improves scalability of the service in scenarios where it is streaming messages to multiple clients some of which are slow in reading; possibly due to network congestion or are not reading at all.</span></span> <span data-ttu-id="85eb6-130">在這些案例中，WCF 不再針對用戶端封鎖服務上的個別執行緒。</span><span class="sxs-lookup"><span data-stu-id="85eb6-130">In these scenarios WCF no longer blocks individual threads on the service per client.</span></span> <span data-ttu-id="85eb6-131">這樣可確保服務可以處理更多的用戶端，從而提升服務的延展性。</span><span class="sxs-lookup"><span data-stu-id="85eb6-131">This ensures that the service is able to process many more clients thereby improving the scalability of the service.</span></span>  
  
## <a name="restrictions-on-streamed-transfers"></a><span data-ttu-id="85eb6-132">資料流處理的傳輸限制</span><span class="sxs-lookup"><span data-stu-id="85eb6-132">Restrictions on Streamed Transfers</span></span>  
 <span data-ttu-id="85eb6-133">使用資料流處理的傳輸模式會導致執行階段強制執行其他限制。</span><span class="sxs-lookup"><span data-stu-id="85eb6-133">Using the streamed transfer mode causes the run time to enforce additional restrictions.</span></span>  
  
 <span data-ttu-id="85eb6-134">在資料流處理的傳輸中發生的作業，會與最多一個輸入或輸出參數簽訂合約。</span><span class="sxs-lookup"><span data-stu-id="85eb6-134">Operations that occur across a streamed transport can have a contract with at most one input or output parameter.</span></span> <span data-ttu-id="85eb6-135">此參數會對應至整個訊息本文，而且必須是一個 <xref:System.ServiceModel.Channels.Message>、<xref:System.IO.Stream> 的衍生型別，或是 <xref:System.Xml.Serialization.IXmlSerializable> 實作。</span><span class="sxs-lookup"><span data-stu-id="85eb6-135">That parameter corresponds to the entire body of the message and must be a <xref:System.ServiceModel.Channels.Message>, a derived type of <xref:System.IO.Stream>, or an <xref:System.Xml.Serialization.IXmlSerializable> implementation.</span></span> <span data-ttu-id="85eb6-136">擁有作業的傳回值，相當於擁有輸出參數。</span><span class="sxs-lookup"><span data-stu-id="85eb6-136">Having a return value for an operation is equivalent to having an output parameter.</span></span>  
  
 <span data-ttu-id="85eb6-137">某些 WCF 功能（例如可靠的訊息傳送、交易和 SOAP 訊息層級安全性）依賴緩衝處理訊息來進行傳輸。</span><span class="sxs-lookup"><span data-stu-id="85eb6-137">Some WCF features, such as reliable messaging, transactions, and SOAP message-level security, rely on buffering messages for transmissions.</span></span> <span data-ttu-id="85eb6-138">使用這些功能可能減少或消除使用資料流處理模式而獲得的效能優勢。</span><span class="sxs-lookup"><span data-stu-id="85eb6-138">Using these features may reduce or eliminate the performance benefits gained by using streaming.</span></span> <span data-ttu-id="85eb6-139">若要保護資料流處理傳輸的安全，請單純使用傳輸層級安全性，或是使用傳輸層級安全性加上僅限於驗證的訊息安全性。</span><span class="sxs-lookup"><span data-stu-id="85eb6-139">To secure a streamed transport, use transport-level security only or use transport-level security plus authentication-only message security.</span></span>  
  
 <span data-ttu-id="85eb6-140">SOAP 標頭一律經過緩衝處理，就算將傳輸模式設為資料流處理也是一樣。</span><span class="sxs-lookup"><span data-stu-id="85eb6-140">SOAP headers are always buffered, even when the transfer mode is set to streamed.</span></span> <span data-ttu-id="85eb6-141">訊息的標頭不得超出 `MaxBufferSize` 傳輸配額的大小。</span><span class="sxs-lookup"><span data-stu-id="85eb6-141">The headers for a message must not exceed the size of the `MaxBufferSize` transport quota.</span></span> <span data-ttu-id="85eb6-142">如需此設定的詳細資訊，請參閱[傳輸配額](transport-quotas.md)。</span><span class="sxs-lookup"><span data-stu-id="85eb6-142">For more information about this setting, see [Transport Quotas](transport-quotas.md).</span></span>  
  
## <a name="differences-between-buffered-and-streamed-transfers"></a><span data-ttu-id="85eb6-143">緩衝處理的傳輸與資料流處理的傳輸之間的差異</span><span class="sxs-lookup"><span data-stu-id="85eb6-143">Differences Between Buffered and Streamed Transfers</span></span>  
 <span data-ttu-id="85eb6-144">將傳輸模式由緩衝處理變更為資料流處理，會同時變更 TCP 與具名管道傳輸的原生通道類型。</span><span class="sxs-lookup"><span data-stu-id="85eb6-144">Changing the transfer mode from buffered to streamed also changes the native channel shape of the TCP and named pipe transports.</span></span> <span data-ttu-id="85eb6-145">對於緩衝處理的傳輸來說，原生的通道類型為 <xref:System.ServiceModel.Channels.IDuplexSessionChannel>。</span><span class="sxs-lookup"><span data-stu-id="85eb6-145">For buffered transfers, the native channel shape is <xref:System.ServiceModel.Channels.IDuplexSessionChannel>.</span></span> <span data-ttu-id="85eb6-146">對於資料流處理的傳輸來說，原生通道為 <xref:System.ServiceModel.Channels.IRequestChannel> 和 <xref:System.ServiceModel.Channels.IReplyChannel>。</span><span class="sxs-lookup"><span data-stu-id="85eb6-146">For streamed transfers, the native channels are <xref:System.ServiceModel.Channels.IRequestChannel> and <xref:System.ServiceModel.Channels.IReplyChannel>.</span></span> <span data-ttu-id="85eb6-147">在直接使用這些傳輸 (亦即，並未透過服務合約) 的現有應用程式中變更傳輸模式，需要變更通道處理站與接聽項的預期通道類型。</span><span class="sxs-lookup"><span data-stu-id="85eb6-147">Changing the transfer mode in an existing application that uses these transports directly (that is, not through a service contract) requires changing the expected channel shape for channel factories and listeners.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="85eb6-148">請參閱</span><span class="sxs-lookup"><span data-stu-id="85eb6-148">See also</span></span>

- [<span data-ttu-id="85eb6-149">HOW TO：啟用資料流</span><span class="sxs-lookup"><span data-stu-id="85eb6-149">How to: Enable Streaming</span></span>](how-to-enable-streaming.md)
