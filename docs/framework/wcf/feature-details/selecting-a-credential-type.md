---
title: 選取認證類型
description: 瞭解認證、如何在 WCF 中使用它們，以及如何為您的應用程式選取正確的認證，以建立宣告的身分識別或功能。
ms.date: 03/30/2017
ms.assetid: bf707063-3f30-4304-ab53-0e63413728a8
ms.openlocfilehash: 7a8a6880e5fc3982bb7f470c34a77c771c26effd
ms.sourcegitcommit: 358a28048f36a8dca39a9fe6e6ac1f1913acadd5
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/23/2020
ms.locfileid: "85244916"
---
# <a name="selecting-a-credential-type"></a><span data-ttu-id="46742-103">選取認證類型</span><span class="sxs-lookup"><span data-stu-id="46742-103">Selecting a Credential Type</span></span>
<span data-ttu-id="46742-104">*認證*是資料 WINDOWS COMMUNICATION FOUNDATION （WCF）用來建立宣告的身分識別或功能。</span><span class="sxs-lookup"><span data-stu-id="46742-104">*Credentials* are the data Windows Communication Foundation (WCF) uses to establish either a claimed identity or capabilities.</span></span> <span data-ttu-id="46742-105">例如，護照是政府發給的認證，以證明一個國家或地區的公民身分。</span><span class="sxs-lookup"><span data-stu-id="46742-105">For example, a passport is a credential a government issues to prove citizenship in a country or region.</span></span> <span data-ttu-id="46742-106">在 WCF 中，認證可以採用許多形式，例如使用者名稱權杖和 x.509 憑證。</span><span class="sxs-lookup"><span data-stu-id="46742-106">In WCF, credentials can take many forms, such as user name tokens and X.509 certificates.</span></span> <span data-ttu-id="46742-107">本主題討論認證、如何在 WCF 中使用它們，以及如何為您的應用程式選取正確的認證。</span><span class="sxs-lookup"><span data-stu-id="46742-107">This topic discusses credentials, how they are used in WCF, and how to select the right credential for your application.</span></span>  
  
 <span data-ttu-id="46742-108">在許多國家和地區，駕駛執照是認證的一個例子。</span><span class="sxs-lookup"><span data-stu-id="46742-108">In many countries and regions, a driver’s license is an example of a credential.</span></span> <span data-ttu-id="46742-109">執照包含了代表一個人身分識別和能力的資料。</span><span class="sxs-lookup"><span data-stu-id="46742-109">A license contains data that represents a person's identity and capabilities.</span></span> <span data-ttu-id="46742-110">其中包含以持有人的照片做為所有權的證明。</span><span class="sxs-lookup"><span data-stu-id="46742-110">It contains proof of possession in the form of the possessor's picture.</span></span> <span data-ttu-id="46742-111">執照是由受信任的授權單位發出，通常是政府的發照部門。</span><span class="sxs-lookup"><span data-stu-id="46742-111">The license is issued by a trusted authority, usually a governmental department of licensing.</span></span> <span data-ttu-id="46742-112">執照會經過密封，而且可能內含雷射防偽，表示沒有遭到竄改或偽造。</span><span class="sxs-lookup"><span data-stu-id="46742-112">The license is sealed, and can contain a hologram, showing that it has not been tampered with or counterfeited.</span></span>  
  
 <span data-ttu-id="46742-113">出示認證包括出示資料以及資料的所有權證明。</span><span class="sxs-lookup"><span data-stu-id="46742-113">Presenting a credential involves presenting both the data and proof of possession of the data.</span></span> <span data-ttu-id="46742-114">WCF 支援傳輸和訊息安全性層級的各種認證類型。</span><span class="sxs-lookup"><span data-stu-id="46742-114">WCF supports a variety of credential types at both the transport and message security levels.</span></span> <span data-ttu-id="46742-115">例如，假設 WCF 中支援兩種類型的認證：使用者名稱和（x.509）憑證認證。</span><span class="sxs-lookup"><span data-stu-id="46742-115">For example, consider two types of credentials supported in WCF: user name and (X.509) certificate credentials.</span></span>  
  
 <span data-ttu-id="46742-116">對於使用者名稱認證，使用者名稱代表宣告的身分識別，而密碼提供所有權的證明。</span><span class="sxs-lookup"><span data-stu-id="46742-116">For the user name credential, the user name represents the claimed identity and the password provides proof of possession.</span></span> <span data-ttu-id="46742-117">在此案例中，受信任的授權單位是驗證使用者名稱和密碼的系統。</span><span class="sxs-lookup"><span data-stu-id="46742-117">The trusted authority in this case is the system that validates the user name and password.</span></span>  
  
 <span data-ttu-id="46742-118">使用 x.509 憑證認證時，憑證中的主體名稱、主體別名或特定欄位可以用來做為身分識別的宣告，而其他欄位（例如 `Valid From` 和 `Valid To` 欄位）則指定憑證的有效性。</span><span class="sxs-lookup"><span data-stu-id="46742-118">With an X.509 certificate credential, the subject name, subject alternative name or specific fields within the certificate can be used as claims of identity, while other fields, such as the `Valid From` and `Valid To` fields, specify the validity of the certificate.</span></span>  
  
## <a name="transport-credential-types"></a><span data-ttu-id="46742-119">傳輸認證類型</span><span class="sxs-lookup"><span data-stu-id="46742-119">Transport Credential Types</span></span>  
 <span data-ttu-id="46742-120">下表顯示在傳輸安全性模式中，可以由繫結使用之用戶端認證的可能類型。</span><span class="sxs-lookup"><span data-stu-id="46742-120">The following table shows the possible types of client credentials that can be used by a binding in transport security mode.</span></span> <span data-ttu-id="46742-121">當建立服務時，請將 `ClientCredentialType` 屬性設定為這些值的其中之一，以指定用戶端必須提供才能與您服務通訊之認證的類型。</span><span class="sxs-lookup"><span data-stu-id="46742-121">When creating a service, set the `ClientCredentialType` property to one of these values to specify the type of credential that the client must supply to communicate with your service.</span></span> <span data-ttu-id="46742-122">您可以使用程式碼或組態檔來設定類型。</span><span class="sxs-lookup"><span data-stu-id="46742-122">You can set the types in either code or configuration files.</span></span>  
  
|<span data-ttu-id="46742-123">設定</span><span class="sxs-lookup"><span data-stu-id="46742-123">Setting</span></span>|<span data-ttu-id="46742-124">描述</span><span class="sxs-lookup"><span data-stu-id="46742-124">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="46742-125">None</span><span class="sxs-lookup"><span data-stu-id="46742-125">None</span></span>|<span data-ttu-id="46742-126">指定用戶端不需要提出任何認證。</span><span class="sxs-lookup"><span data-stu-id="46742-126">Specifies that the client does not need to present any credential.</span></span> <span data-ttu-id="46742-127">這會轉譯成匿名用戶端。</span><span class="sxs-lookup"><span data-stu-id="46742-127">This translates to an anonymous client.</span></span>|  
|<span data-ttu-id="46742-128">基本</span><span class="sxs-lookup"><span data-stu-id="46742-128">Basic</span></span>|<span data-ttu-id="46742-129">為用戶端指定基本驗證。</span><span class="sxs-lookup"><span data-stu-id="46742-129">Specifies basic authentication for the client.</span></span> <span data-ttu-id="46742-130">如需其他資訊，請參閱 RFC2617-[HTTP 驗證：基本和摘要式驗證](ftp://ftp.rfc-editor.org/in-notes/rfc2617.txt)。</span><span class="sxs-lookup"><span data-stu-id="46742-130">For additional information, see RFC2617—[HTTP Authentication: Basic and Digest Authentication](ftp://ftp.rfc-editor.org/in-notes/rfc2617.txt).</span></span>|  
|<span data-ttu-id="46742-131">Digest</span><span class="sxs-lookup"><span data-stu-id="46742-131">Digest</span></span>|<span data-ttu-id="46742-132">為用戶端指定摘要式驗證。</span><span class="sxs-lookup"><span data-stu-id="46742-132">Specifies digest authentication for the client.</span></span> <span data-ttu-id="46742-133">如需其他資訊，請參閱 RFC2617-[HTTP 驗證：基本和摘要式驗證](ftp://ftp.rfc-editor.org/in-notes/rfc2617.txt)。</span><span class="sxs-lookup"><span data-stu-id="46742-133">For additional information, see RFC2617—[HTTP Authentication: Basic and Digest Authentication](ftp://ftp.rfc-editor.org/in-notes/rfc2617.txt).</span></span>|  
|<span data-ttu-id="46742-134">Ntlm</span><span class="sxs-lookup"><span data-stu-id="46742-134">Ntlm</span></span>|<span data-ttu-id="46742-135">指定 NT LAN 管理員 (NTLM) 驗證。</span><span class="sxs-lookup"><span data-stu-id="46742-135">Specifies NT LAN Manager (NTLM) authentication.</span></span> <span data-ttu-id="46742-136">這是用於當您因故無法使用 Kerberos 驗證時。</span><span class="sxs-lookup"><span data-stu-id="46742-136">This is used when you cannot use Kerberos authentication for some reason.</span></span> <span data-ttu-id="46742-137">您也可以將屬性設定為，以停用其做為回復 <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> `false` ，這會在使用 NTLM 時，讓 WCF 盡力擲回例外狀況。</span><span class="sxs-lookup"><span data-stu-id="46742-137">You can also disable its use as a fallback by setting the <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> property to `false`, which causes WCF to make a best-effort to throw an exception if NTLM is used.</span></span> <span data-ttu-id="46742-138">請注意，將此屬性設為 `false`，不一定能夠禁止 NTLM 認證透過網路傳送。</span><span class="sxs-lookup"><span data-stu-id="46742-138">Note that setting this property to `false` may not prevent NTLM credentials from being sent over the wire.</span></span>|  
|<span data-ttu-id="46742-139">Windows</span><span class="sxs-lookup"><span data-stu-id="46742-139">Windows</span></span>|<span data-ttu-id="46742-140">指定 Windows 驗證。</span><span class="sxs-lookup"><span data-stu-id="46742-140">Specifies Windows authentication.</span></span> <span data-ttu-id="46742-141">如果在 Windows 網域上只要指定 Kerberos 通訊協定，請將 <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> 屬性設定為 `false` (預設為 `true`)。</span><span class="sxs-lookup"><span data-stu-id="46742-141">To specify only the Kerberos protocol on a Windows domain, set the <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> property to `false` (the default is `true`).</span></span>|  
|<span data-ttu-id="46742-142">憑證</span><span class="sxs-lookup"><span data-stu-id="46742-142">Certificate</span></span>|<span data-ttu-id="46742-143">使用 X.509 憑證執行用戶端驗證。</span><span class="sxs-lookup"><span data-stu-id="46742-143">Performs client authentication using an X.509 certificate.</span></span>|  
|<span data-ttu-id="46742-144">密碼</span><span class="sxs-lookup"><span data-stu-id="46742-144">Password</span></span>|<span data-ttu-id="46742-145">使用者必須提供使用者名稱和密碼。</span><span class="sxs-lookup"><span data-stu-id="46742-145">User must supply a user name and password.</span></span> <span data-ttu-id="46742-146">請使用 Windows 驗證或其他自訂方案來驗證使用者名稱/密碼組。</span><span class="sxs-lookup"><span data-stu-id="46742-146">Validate the user name/password pair using Windows authentication or another custom solution.</span></span>|  
  
### <a name="message-client-credential-types"></a><span data-ttu-id="46742-147">訊息用戶端認證類型</span><span class="sxs-lookup"><span data-stu-id="46742-147">Message Client Credential Types</span></span>  
 <span data-ttu-id="46742-148">下表顯示在建立使用訊息安全性的應用程式時，您可以使用的可能認證類型。</span><span class="sxs-lookup"><span data-stu-id="46742-148">The following table shows the possible credential types that you can use when creating an application that uses message security.</span></span> <span data-ttu-id="46742-149">您可以在程式碼或組態檔中使用這些值。</span><span class="sxs-lookup"><span data-stu-id="46742-149">You can use these values in either code or configuration files.</span></span>  
  
|<span data-ttu-id="46742-150">設定</span><span class="sxs-lookup"><span data-stu-id="46742-150">Setting</span></span>|<span data-ttu-id="46742-151">描述</span><span class="sxs-lookup"><span data-stu-id="46742-151">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="46742-152">None</span><span class="sxs-lookup"><span data-stu-id="46742-152">None</span></span>|<span data-ttu-id="46742-153">指定用戶端不需要出示認證。</span><span class="sxs-lookup"><span data-stu-id="46742-153">Specifies that the client does not need to present a credential.</span></span> <span data-ttu-id="46742-154">這會轉譯成匿名用戶端。</span><span class="sxs-lookup"><span data-stu-id="46742-154">This translates to an anonymous client.</span></span>|  
|<span data-ttu-id="46742-155">Windows</span><span class="sxs-lookup"><span data-stu-id="46742-155">Windows</span></span>|<span data-ttu-id="46742-156">允許在使用 Windows 認證建立的安全性內容下發生 SOAP 訊息交換。</span><span class="sxs-lookup"><span data-stu-id="46742-156">Allows SOAP message exchanges to occur under the security context established with a Windows credential.</span></span>|  
|<span data-ttu-id="46742-157">使用者名稱</span><span class="sxs-lookup"><span data-stu-id="46742-157">Username</span></span>|<span data-ttu-id="46742-158">允許服務要求用戶端必須使用使用者名稱認證進行驗證。</span><span class="sxs-lookup"><span data-stu-id="46742-158">Allows the service to require that the client be authenticated with a user name credential.</span></span> <span data-ttu-id="46742-159">請注意，WCF 不允許任何具有使用者名稱的密碼編譯作業，例如產生簽章或加密資料。</span><span class="sxs-lookup"><span data-stu-id="46742-159">Note that WCF does not allow any cryptographic operations with user names, such as generating a signature or encrypting data.</span></span> <span data-ttu-id="46742-160">WCF 可確保在使用使用者名稱認證時，傳輸會受到保護。</span><span class="sxs-lookup"><span data-stu-id="46742-160">WCF ensures that the transport is secured when using user name credentials.</span></span>|  
|<span data-ttu-id="46742-161">憑證</span><span class="sxs-lookup"><span data-stu-id="46742-161">Certificate</span></span>|<span data-ttu-id="46742-162">允許服務要求用戶端使用 X.509 憑證進行驗證。</span><span class="sxs-lookup"><span data-stu-id="46742-162">Allows the service to require that the client be authenticated using an X.509 certificate.</span></span>|  
|<span data-ttu-id="46742-163">發行的權杖</span><span class="sxs-lookup"><span data-stu-id="46742-163">Issued Token</span></span>|<span data-ttu-id="46742-164">根據安全性原則設定的自訂權杖類型。</span><span class="sxs-lookup"><span data-stu-id="46742-164">A custom token type configured according to a security policy.</span></span> <span data-ttu-id="46742-165">預設的權杖類型為 Security Assertions Markup Language (SAML)。</span><span class="sxs-lookup"><span data-stu-id="46742-165">The default token type is Security Assertions Markup Language (SAML).</span></span> <span data-ttu-id="46742-166">權杖是由安全的權杖服務所發行。</span><span class="sxs-lookup"><span data-stu-id="46742-166">The token is issued by a secure token service.</span></span> <span data-ttu-id="46742-167">如需詳細資訊，請參閱[同盟和發行的權杖](federation-and-issued-tokens.md)。</span><span class="sxs-lookup"><span data-stu-id="46742-167">For more information, see [Federation and Issued Tokens](federation-and-issued-tokens.md).</span></span>|  
  
### <a name="negotiation-model-of-service-credentials"></a><span data-ttu-id="46742-168">服務認證的交涉模型</span><span class="sxs-lookup"><span data-stu-id="46742-168">Negotiation Model of Service Credentials</span></span>  
 <span data-ttu-id="46742-169">「*協商*」是藉由交換認證來建立用戶端與服務之間信任的程式。</span><span class="sxs-lookup"><span data-stu-id="46742-169">*Negotiation* is the process of establishing trust between a client and a service by exchanging credentials.</span></span> <span data-ttu-id="46742-170">此處理程序會在用戶端和服務之間反覆執行，以便只透露交涉處理程序中下一個步驟所需要的資訊。</span><span class="sxs-lookup"><span data-stu-id="46742-170">The process is performed iteratively between the client and the service, so as to disclose only the information necessary for the next step in the negotiation process.</span></span> <span data-ttu-id="46742-171">實際上，最終結果是將服務的認證傳遞至要用於後續作業中的用戶端。</span><span class="sxs-lookup"><span data-stu-id="46742-171">In practice, the end result is the delivery of a service's credential to the client to be used in subsequent operations.</span></span>  
  
 <span data-ttu-id="46742-172">有一個例外，根據預設，WCF 中系統提供的系結會在使用訊息層級安全性時，自動協商服務認證。</span><span class="sxs-lookup"><span data-stu-id="46742-172">With one exception, by default the system-provided bindings in WCF negotiate the service credential automatically when using message-level security.</span></span> <span data-ttu-id="46742-173">（例外狀況是 <xref:System.ServiceModel.BasicHttpBinding> ，預設不會啟用安全性）。若要停用此行為，請參閱 <xref:System.ServiceModel.MessageSecurityOverHttp.NegotiateServiceCredential%2A> 和 <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.NegotiateServiceCredential%2A> 屬性。</span><span class="sxs-lookup"><span data-stu-id="46742-173">(The exception is the <xref:System.ServiceModel.BasicHttpBinding>, which does not enable security by default.) To disable this behavior, see the <xref:System.ServiceModel.MessageSecurityOverHttp.NegotiateServiceCredential%2A> and <xref:System.ServiceModel.FederatedMessageSecurityOverHttp.NegotiateServiceCredential%2A> properties.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="46742-174">當 SSL 安全性與 .NET Framework 3.5 和更新版本搭配使用時，WCF 用戶端會使用其憑證存放區中的中繼憑證，以及在 SSL 協商期間收到的中繼憑證，在服務的憑證上執行憑證鏈驗證。</span><span class="sxs-lookup"><span data-stu-id="46742-174">When SSL security is used with .NET Framework 3.5 and later, a WCF client uses both the intermediate certificates in its certificate store and the intermediate certificates received during SSL negotiation to perform certificate chain validation on the service's certificate.</span></span> <span data-ttu-id="46742-175">.NET Framework 3.0 只會使用安裝在本機憑證存放區中的中繼憑證。</span><span class="sxs-lookup"><span data-stu-id="46742-175">.NET Framework 3.0 only uses the intermediate certificates installed in the local certificate store.</span></span>  
  
#### <a name="out-of-band-negotiation"></a><span data-ttu-id="46742-176">超出範圍交涉</span><span class="sxs-lookup"><span data-stu-id="46742-176">Out-of-Band Negotiation</span></span>  
 <span data-ttu-id="46742-177">如果停用自動交涉，在傳送任何訊息給服務之前，必須在用戶端提供服務認證。</span><span class="sxs-lookup"><span data-stu-id="46742-177">If automatic negotiation is disabled, the service credential must be provisioned at the client prior to sending any messages to the service.</span></span> <span data-ttu-id="46742-178">這也稱為頻外布*建*。</span><span class="sxs-lookup"><span data-stu-id="46742-178">This is also known as an *out-of-band* provisioning.</span></span> <span data-ttu-id="46742-179">例如，如果指定的認證類型是憑證，且停用自動交涉，用戶端就必須連絡服務擁有者，以在執行用戶端應用程式的電腦上接收並安裝憑證。</span><span class="sxs-lookup"><span data-stu-id="46742-179">For example, if the specified credential type is a certificate, and automatic negotiation is disabled, the client must contact the service owner to receive and install the certificate on the computer running the client application.</span></span> <span data-ttu-id="46742-180">例如，在商業案例中，當您希望嚴格控制哪些用戶端可以存取服務時，可能會完成這項操作。</span><span class="sxs-lookup"><span data-stu-id="46742-180">This can be done, for example, when you want to strictly control which clients can access a service in a business-to-business scenario.</span></span> <span data-ttu-id="46742-181">此頻外協商可以透過電子郵件來完成，而且 x.509 憑證會使用 Microsoft Management Console （MMC）憑證嵌入式管理單元之類的工具儲存在 Windows 憑證存放區中。</span><span class="sxs-lookup"><span data-stu-id="46742-181">This out-of-band-negotiation can be done in email, and the X.509 certificate is stored in Windows certificate store, using a tool such as the Microsoft Management Console (MMC) Certificates snap-in.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="46742-182"><xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> 屬性是用於為服務提供透過超出範圍交涉所取得的憑證。</span><span class="sxs-lookup"><span data-stu-id="46742-182">The <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> property is used to provide the service with a certificate that was attained through out-of-band negotiation.</span></span> <span data-ttu-id="46742-183">這在使用 <xref:System.ServiceModel.BasicHttpBinding> 類別時是必要的，因為繫結不允許自動化交涉。</span><span class="sxs-lookup"><span data-stu-id="46742-183">This is necessary when using the <xref:System.ServiceModel.BasicHttpBinding> class because the binding does not allow automated negotiation.</span></span> <span data-ttu-id="46742-184">此屬性也用於沒有關聯的雙工案例中。</span><span class="sxs-lookup"><span data-stu-id="46742-184">The property is also used in an uncorrelated duplex scenario.</span></span> <span data-ttu-id="46742-185">在這個案例中，用戶端不需要先將要求傳送至伺服器，伺服器就可以將訊息傳送到用戶端。</span><span class="sxs-lookup"><span data-stu-id="46742-185">This is a scenario where a server sends a message to the client without requiring the client to send a request to the server first.</span></span> <span data-ttu-id="46742-186">由於伺服器沒有來自用戶端的要求，因此必須使用用戶端的憑證來對用戶端加密訊息。</span><span class="sxs-lookup"><span data-stu-id="46742-186">Because the server does not have a request from the client, it must use the client's certificate to encrypt the message to the client.</span></span>  
  
## <a name="setting-credential-values"></a><span data-ttu-id="46742-187">設定認證值</span><span class="sxs-lookup"><span data-stu-id="46742-187">Setting Credential Values</span></span>  
 <span data-ttu-id="46742-188">在選擇安全性模式之後，您必須指定實際的認證。</span><span class="sxs-lookup"><span data-stu-id="46742-188">Once you select a security mode, you must specify the actual credentials.</span></span> <span data-ttu-id="46742-189">例如，如果認證類型設定為「憑證」，則您必須建立特定認證 (例如特定的 X.509 憑證) 與服務或用戶端的關聯。</span><span class="sxs-lookup"><span data-stu-id="46742-189">For example, if the credential type is set to "certificate," then you must associate a specific credential (such as a specific X.509 certificate) with the service or client.</span></span>  
  
 <span data-ttu-id="46742-190">根據您是對服務或用戶端進行程式設計，設定認證值的方法會有些許不同。</span><span class="sxs-lookup"><span data-stu-id="46742-190">Depending on whether you are programming a service or a client, the method for setting the credential value differs slightly.</span></span>  
  
### <a name="setting-service-credentials"></a><span data-ttu-id="46742-191">設定服務認證</span><span class="sxs-lookup"><span data-stu-id="46742-191">Setting Service Credentials</span></span>  
 <span data-ttu-id="46742-192">如果您是使用傳輸模式，並使用 HTTP 做為傳輸，您必須使用網際網路資訊服務 (IIS) 或使用憑證設定連接埠。</span><span class="sxs-lookup"><span data-stu-id="46742-192">If you are using transport mode, and you are using HTTP as the transport, you must use either Internet Information Services (IIS) or configure the port with a certificate.</span></span> <span data-ttu-id="46742-193">如需詳細資訊，請參閱[傳輸安全性總覽](transport-security-overview.md)和[HTTP 傳輸安全性](http-transport-security.md)。</span><span class="sxs-lookup"><span data-stu-id="46742-193">For more information, see [Transport Security Overview](transport-security-overview.md) and [HTTP Transport Security](http-transport-security.md).</span></span>  
  
 <span data-ttu-id="46742-194">如果要在程式碼中提供含有認證的服務，請建立 <xref:System.ServiceModel.ServiceHost> 類別的執行個體，並使用 <xref:System.ServiceModel.Description.ServiceCredentials> 類別指定適當的認證 (透過 <xref:System.ServiceModel.ServiceHostBase.Credentials%2A> 屬性存取)。</span><span class="sxs-lookup"><span data-stu-id="46742-194">To provision a service with credentials in code, create an instance of the <xref:System.ServiceModel.ServiceHost> class and specify the appropriate credential using the <xref:System.ServiceModel.Description.ServiceCredentials> class, accessed through the <xref:System.ServiceModel.ServiceHostBase.Credentials%2A> property.</span></span>  
  
#### <a name="setting-a-certificate"></a><span data-ttu-id="46742-195">設定憑證</span><span class="sxs-lookup"><span data-stu-id="46742-195">Setting a Certificate</span></span>  
 <span data-ttu-id="46742-196">如果要提供含有用於對用戶端驗證服務之 X.509 憑證的服務，請使用 <xref:System.ServiceModel.Security.X509CertificateInitiatorServiceCredential.SetCertificate%2A> 類別的 <xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential> 方法。</span><span class="sxs-lookup"><span data-stu-id="46742-196">To provision a service with an X.509 certificate to be used to authenticate the service to clients, use the <xref:System.ServiceModel.Security.X509CertificateInitiatorServiceCredential.SetCertificate%2A> method of the <xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential> class.</span></span>  
  
 <span data-ttu-id="46742-197">如果要提供含有用戶端憑證的服務，請使用 <xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential.SetCertificate%2A> 類別的 <xref:System.ServiceModel.Security.X509CertificateInitiatorServiceCredential> 方法。</span><span class="sxs-lookup"><span data-stu-id="46742-197">To provision a service with a client certificate, use the <xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential.SetCertificate%2A> method of the <xref:System.ServiceModel.Security.X509CertificateInitiatorServiceCredential> class.</span></span>  
  
#### <a name="setting-windows-credentials"></a><span data-ttu-id="46742-198">設定 Windows 認證</span><span class="sxs-lookup"><span data-stu-id="46742-198">Setting Windows Credentials</span></span>  
 <span data-ttu-id="46742-199">如果用戶端指定有效的使用者名稱和密碼，會使用該認證來驗證用戶端。</span><span class="sxs-lookup"><span data-stu-id="46742-199">If the client specifies a valid user name and password, that credential is used to authenticate the client.</span></span> <span data-ttu-id="46742-200">否則便會使用目前登入之使用者的認證。</span><span class="sxs-lookup"><span data-stu-id="46742-200">Otherwise, the current logged-on user's credentials are used.</span></span>  
  
### <a name="setting-client-credentials"></a><span data-ttu-id="46742-201">設定用戶端認證</span><span class="sxs-lookup"><span data-stu-id="46742-201">Setting Client Credentials</span></span>  
 <span data-ttu-id="46742-202">在 WCF 中，用戶端應用程式會使用 WCF 用戶端來連接至服務。</span><span class="sxs-lookup"><span data-stu-id="46742-202">In WCF, client applications use a WCF client to connect to services.</span></span> <span data-ttu-id="46742-203">每個用戶端都是衍生自 <xref:System.ServiceModel.ClientBase%601> 類別，而用戶端上的 <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> 屬性允許用戶端認證之各種不同值的規格。</span><span class="sxs-lookup"><span data-stu-id="46742-203">Every client derives from the <xref:System.ServiceModel.ClientBase%601> class, and the <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> property on the client allows the specification of various values of client credentials.</span></span>  
  
#### <a name="setting-a-certificate"></a><span data-ttu-id="46742-204">設定憑證</span><span class="sxs-lookup"><span data-stu-id="46742-204">Setting a Certificate</span></span>  
 <span data-ttu-id="46742-205">如果要提供含有用於對服務驗證用戶端之 X.509 憑證的服務，請使用 <xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential.SetCertificate%2A> 類別的 <xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential> 方法。</span><span class="sxs-lookup"><span data-stu-id="46742-205">To provision a service with an X.509 certificate that is used to authenticate the client to a service, use the <xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential.SetCertificate%2A> method of the <xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential> class.</span></span>  
  
## <a name="how-client-credentials-are-used-to-authenticate-a-client-to-the-service"></a><span data-ttu-id="46742-206">如何使用用戶端認證對服務驗證用戶端</span><span class="sxs-lookup"><span data-stu-id="46742-206">How Client Credentials Are Used to Authenticate a Client to the Service</span></span>  
 <span data-ttu-id="46742-207">與服務通訊所需要的用戶端認證資訊是使用 <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> 屬性或 <xref:System.ServiceModel.ChannelFactory.Credentials%2A> 屬性來提供的。</span><span class="sxs-lookup"><span data-stu-id="46742-207">Client credential information required to communicate with a service is provided using either the <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> property or the <xref:System.ServiceModel.ChannelFactory.Credentials%2A> property.</span></span> <span data-ttu-id="46742-208">安全性通道會使用此資訊對服務驗證用戶端。</span><span class="sxs-lookup"><span data-stu-id="46742-208">The security channel uses this information to authenticate the client to the service.</span></span> <span data-ttu-id="46742-209">驗證是透過兩種模式的其中之一完成的：</span><span class="sxs-lookup"><span data-stu-id="46742-209">Authentication is accomplished through one of two modes:</span></span>  
  
- <span data-ttu-id="46742-210">用戶端認證會在第一則訊息傳送之前使用一次，使用 WCF 用戶端實例來建立安全性內容。</span><span class="sxs-lookup"><span data-stu-id="46742-210">The client credentials are used once before the first message is sent, using the WCF client instance to establish a security context.</span></span> <span data-ttu-id="46742-211">然後所有的應用程式訊息都會透過安全性內容來保護其安全。</span><span class="sxs-lookup"><span data-stu-id="46742-211">All application messages are then secured through the security context.</span></span>  
  
- <span data-ttu-id="46742-212">用戶端認證是用於驗證傳送到服務的每個應用程式訊息。</span><span class="sxs-lookup"><span data-stu-id="46742-212">The client credentials are used to authenticate every application message sent to the service.</span></span> <span data-ttu-id="46742-213">在這種情況中，不會在用戶端和服務之間建立內容。</span><span class="sxs-lookup"><span data-stu-id="46742-213">In this case, no context is established between the client and the service.</span></span>  
  
### <a name="established-identities-cannot-be-changed"></a><span data-ttu-id="46742-214">無法變更已建立的身分識別</span><span class="sxs-lookup"><span data-stu-id="46742-214">Established Identities Cannot Be Changed</span></span>  
 <span data-ttu-id="46742-215">當使用第一個方法時，已建立的內容會與用戶端身分識別建立永久性的關聯。</span><span class="sxs-lookup"><span data-stu-id="46742-215">When the first method is used, the established context is permanently associated with the client identity.</span></span> <span data-ttu-id="46742-216">也就是說，在建立安全性內容之後，就無法變更與用戶端有關聯的身分識別。</span><span class="sxs-lookup"><span data-stu-id="46742-216">That is, once the security context has been established, the identity associated with the client cannot be changed.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="46742-217">當無法切換身分識別時 (也就是，當開啟已建立之安全性內容時的預設行為)，有一種情況要注意。</span><span class="sxs-lookup"><span data-stu-id="46742-217">There is a situation to be aware of when the identity cannot be switched (that is, when establish security context is on, the default behavior).</span></span> <span data-ttu-id="46742-218">如果您建立與第二個服務通訊的服務，則無法變更用來開啟 WCF 用戶端至第二個服務的身分識別。</span><span class="sxs-lookup"><span data-stu-id="46742-218">If you create a service that communicates with a second service, the identity used to open the WCF client to the second service cannot be changed.</span></span> <span data-ttu-id="46742-219">如果允許多個用戶端使用第一個服務，且該服務在存取第二個服務時模擬用戶端，這就會變成問題。</span><span class="sxs-lookup"><span data-stu-id="46742-219">This becomes a problem if multiple clients are allowed to use the first service and the service impersonates the clients when accessing the second service.</span></span> <span data-ttu-id="46742-220">如果服務對所有的呼叫者重複使用相同的用戶端，第二個服務的所有呼叫都會在用於對第二個服務開啟用戶端之第一個呼叫者的身分識別下完成。</span><span class="sxs-lookup"><span data-stu-id="46742-220">If the service reuses the same client for all callers, all calls to the second service are done under the identity of the first caller that was used to open the client to the second service.</span></span> <span data-ttu-id="46742-221">換言之，服務會對所有用戶端使用第一個用戶端的身分識別來與第二個服務通訊。</span><span class="sxs-lookup"><span data-stu-id="46742-221">In other words, the service uses the identity of the first client for all its clients to communicate with the second service.</span></span> <span data-ttu-id="46742-222">這會造成權限的升級。</span><span class="sxs-lookup"><span data-stu-id="46742-222">This can lead to the elevation of privilege.</span></span> <span data-ttu-id="46742-223">如果這不是您的服務所需要的行為，您必須追蹤每個呼叫者，並為每個不同的呼叫者建立第二個服務的新用戶端，然後確保服務只對正確的呼叫者使用正確的用戶端，以與第二個服務通訊。</span><span class="sxs-lookup"><span data-stu-id="46742-223">If this is not the desired behavior of your service, you must track each caller and create a new client to the second service for every distinct caller, and ensure that the service uses only the right client for the right caller to communicate with the second service.</span></span>  
  
 <span data-ttu-id="46742-224">如需認證和安全會話的詳細資訊，請參閱安全[會話的安全性考慮](security-considerations-for-secure-sessions.md)。</span><span class="sxs-lookup"><span data-stu-id="46742-224">For more information about credentials and secure sessions, see [Security Considerations for Secure Sessions](security-considerations-for-secure-sessions.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="46742-225">另請參閱</span><span class="sxs-lookup"><span data-stu-id="46742-225">See also</span></span>

- <xref:System.ServiceModel.ClientBase%601?displayProperty=nameWithType>
- <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.Description.ClientCredentials.ClientCertificate%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.BasicHttpMessageSecurity.ClientCredentialType%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.HttpTransportSecurity.ClientCredentialType%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.MessageSecurityOverHttp.ClientCredentialType%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.MessageSecurityOverMsmq.ClientCredentialType%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.MessageSecurityOverTcp.ClientCredentialType%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.TcpTransportSecurity.ClientCredentialType%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential.SetCertificate%2A?displayProperty=nameWithType>
- <xref:System.ServiceModel.Security.X509CertificateInitiatorServiceCredential.SetCertificate%2A?displayProperty=nameWithType>
- [<span data-ttu-id="46742-226">安全性概念</span><span class="sxs-lookup"><span data-stu-id="46742-226">Security Concepts</span></span>](security-concepts.md)
- [<span data-ttu-id="46742-227">Securing Services and Clients</span><span class="sxs-lookup"><span data-stu-id="46742-227">Securing Services and Clients</span></span>](securing-services-and-clients.md)
- [<span data-ttu-id="46742-228">WCF 安全性程式設計</span><span class="sxs-lookup"><span data-stu-id="46742-228">Programming WCF Security</span></span>](programming-wcf-security.md)
- [<span data-ttu-id="46742-229">HTTP 傳輸安全性</span><span class="sxs-lookup"><span data-stu-id="46742-229">HTTP Transport Security</span></span>](http-transport-security.md)
