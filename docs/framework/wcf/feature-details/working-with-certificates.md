---
title: 使用憑證
description: 瞭解 x.509 數位憑證的功能，以及如何在 WCF 中使用它們。 本文中的資源可以進一步說明這些概念。
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- certificates [WCF]
ms.assetid: 6ffb8682-8f07-4a45-afbb-8d2487e9dbc3
ms.openlocfilehash: a12e723c763cdc3b9cf2105df9d0ee601f8bda1a
ms.sourcegitcommit: 27a15a55019f6b5f2733961738babe94aec0def3
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/15/2020
ms.locfileid: "90559014"
---
# <a name="working-with-certificates"></a><span data-ttu-id="8925a-104">使用憑證</span><span class="sxs-lookup"><span data-stu-id="8925a-104">Working with Certificates</span></span>

<span data-ttu-id="8925a-105">在針對 Windows Communication Foundation (WCF) 安全性設計程式時，通常會採用 X.509 數位憑證來驗證用戶端與伺服器、加密，以及數位簽署訊息。</span><span class="sxs-lookup"><span data-stu-id="8925a-105">To program Windows Communication Foundation (WCF) security, X.509 digital certificates are commonly used to authenticate clients and servers, encrypt, and digitally sign messages.</span></span> <span data-ttu-id="8925a-106">本主題將簡要說明 X.509 數位憑證功能及如何在 WCF 中使用這些憑證，同時針對這些概念的進一步說明以及如何運用 WCF 與憑證來完成一般工作的主題說明提供連結。</span><span class="sxs-lookup"><span data-stu-id="8925a-106">This topic briefly explains X.509 digital certificate features and how to use them in WCF, and includes links to topics that explain these concepts further or that show how to accomplish common tasks using WCF and certificates.</span></span>

<span data-ttu-id="8925a-107">簡單地說，數位憑證是「公開金鑰基礎結構」(Public Key Infrastructure，PKI)\*\* 的一部分，這是一套結合數位憑證、憑證授權單位，與其他登錄授權單位，並以公開金鑰密碼編譯法來驗證參與電子異動每一方之有效性的系統。</span><span class="sxs-lookup"><span data-stu-id="8925a-107">In brief, a digital certificate is a part of a *public key infrastructure* (PKI), which is a system of digital certificates, certificate authorities, and other registration authorities that verify and authenticate the validity of each party involved in an electronic transaction through the use of public key cryptography.</span></span> <span data-ttu-id="8925a-108">憑證授權單位會發出憑證，而每個憑證都會有一組欄位，其中包含如「主體」\*\*(也就是接受發行憑證的實體)、有效日期 (當憑證有效時)、簽發者 (發行憑證的實體) 與公開金鑰之類的資料。</span><span class="sxs-lookup"><span data-stu-id="8925a-108">A certification authority issues certificates and each certificate has a set of fields that contain data, such as *subject* (the entity to which the certificate is issued), validity dates (when the certificate is valid), issuer (the entity that issued the certificate), and a public key.</span></span> <span data-ttu-id="8925a-109">在 WCF 中，每一個屬性都會被當成 <xref:System.IdentityModel.Claims.Claim> 處理，而且每個宣告還會進一步分成兩種類型：身分識別與權限。</span><span class="sxs-lookup"><span data-stu-id="8925a-109">In WCF, each of these properties is processed as a <xref:System.IdentityModel.Claims.Claim>, and each claim is further divided into two types: identity and right.</span></span> <span data-ttu-id="8925a-110">如需 X.509 憑證的詳細資訊，請參閱 [X.509 公用金鑰憑證](/windows/desktop/SecCertEnroll/about-x-509-public-key-certificates)。</span><span class="sxs-lookup"><span data-stu-id="8925a-110">For more information about X.509 certificates see [X.509 Public Key Certificates](/windows/desktop/SecCertEnroll/about-x-509-public-key-certificates).</span></span> <span data-ttu-id="8925a-111">如需宣告和 WCF 授權的詳細資訊，請參閱[使用身分識別模型來管理宣告與授權](managing-claims-and-authorization-with-the-identity-model.md)。</span><span class="sxs-lookup"><span data-stu-id="8925a-111">For more information about Claims and Authorization in WCF see [Managing Claims and Authorization with the Identity Model](managing-claims-and-authorization-with-the-identity-model.md).</span></span> <span data-ttu-id="8925a-112">如需有關如何執行 PKI 的詳細資訊，請參閱 [使用 Windows Server 2012 R2 的企業 PKI Active Directory 憑證服務](/archive/blogs/yungchou/enterprise-pki-with-windows-server-2012-r2-active-directory-certificate-services-part-1-of-2)。</span><span class="sxs-lookup"><span data-stu-id="8925a-112">For more information about implementing a PKI, see [Enterprise PKI with Windows Server 2012 R2 Active Directory Certificate Services](/archive/blogs/yungchou/enterprise-pki-with-windows-server-2012-r2-active-directory-certificate-services-part-1-of-2).</span></span>

<span data-ttu-id="8925a-113">憑證的主要功能就是向其他人驗證憑證擁有者的身分識別。</span><span class="sxs-lookup"><span data-stu-id="8925a-113">The primary function of a certificate is to authenticate the identity of the owner of the certificate to others.</span></span> <span data-ttu-id="8925a-114">憑證包含擁有者的「公開金鑰」\*\*，而擁有者本身則保留私密金鑰。</span><span class="sxs-lookup"><span data-stu-id="8925a-114">A certificate contains the *public key* of the owner, while the owner retains the private key.</span></span> <span data-ttu-id="8925a-115">公開金鑰可以用來加密傳送給憑證擁有者的訊息。</span><span class="sxs-lookup"><span data-stu-id="8925a-115">The public key can be used to encrypt messages sent to the owner of the certificate.</span></span> <span data-ttu-id="8925a-116">只有擁有者才能存取私密金鑰，因此只有擁有者可以解密這些訊息。</span><span class="sxs-lookup"><span data-stu-id="8925a-116">Only the owner has access to the private key, so only the owner can decrypt those messages.</span></span>

<span data-ttu-id="8925a-117">憑證必須由憑證授權單位發行，此單位通常是憑證的協力廠商簽發者。</span><span class="sxs-lookup"><span data-stu-id="8925a-117">Certificates must be issued by a certification authority, which is often a third-party  issuer of certificates.</span></span> <span data-ttu-id="8925a-118">在 Windows 網域中，會包含憑證授權單位以便用來對網域中的電腦發行憑證。</span><span class="sxs-lookup"><span data-stu-id="8925a-118">On a Windows domain, a certification authority is included that can be used to issue certificates to computers on the domain.</span></span>

## <a name="viewing-certificates"></a><span data-ttu-id="8925a-119">檢視憑證</span><span class="sxs-lookup"><span data-stu-id="8925a-119">Viewing Certificates</span></span>

<span data-ttu-id="8925a-120">使用憑證時，通常需要檢視並檢查其內容。</span><span class="sxs-lookup"><span data-stu-id="8925a-120">To work with certificates, it is often necessary to view them and examine their properties.</span></span> <span data-ttu-id="8925a-121">您可以透過 Microsoft Management Console (MMC) 嵌入式管理單元工具輕鬆達到這個目的。</span><span class="sxs-lookup"><span data-stu-id="8925a-121">This is easily done with the Microsoft Management Console (MMC) snap-in tool.</span></span> <span data-ttu-id="8925a-122">如需詳細資訊，請參閱 [做法：使用 MMC 嵌入式管理單元檢視憑證](how-to-view-certificates-with-the-mmc-snap-in.md)。</span><span class="sxs-lookup"><span data-stu-id="8925a-122">For more information, see [How to: View Certificates with the MMC Snap-in](how-to-view-certificates-with-the-mmc-snap-in.md).</span></span>

## <a name="certificate-stores"></a><span data-ttu-id="8925a-123">憑證存放區</span><span class="sxs-lookup"><span data-stu-id="8925a-123">Certificate Stores</span></span>

<span data-ttu-id="8925a-124">您可以在存放區中找到憑證。</span><span class="sxs-lookup"><span data-stu-id="8925a-124">Certificates are found in stores.</span></span> <span data-ttu-id="8925a-125">兩個主要的存放區位置還可進一步細分為子存放區。</span><span class="sxs-lookup"><span data-stu-id="8925a-125">Two major store locations exist that are further divided into sub-stores.</span></span> <span data-ttu-id="8925a-126">如果您是電腦的系統管理員，就可以使用 MMC 嵌入式管理單元工具來同時檢視兩個主要的存放區。</span><span class="sxs-lookup"><span data-stu-id="8925a-126">If you are the administrator on a computer, you can view both major stores by using the MMC snap-in tool.</span></span> <span data-ttu-id="8925a-127">非系統管理員只能檢視目前使用者的存放區。</span><span class="sxs-lookup"><span data-stu-id="8925a-127">Non-administrators can view only the current user store.</span></span>

- <span data-ttu-id="8925a-128">**本機電腦存放區**。</span><span class="sxs-lookup"><span data-stu-id="8925a-128">**The local machine store**.</span></span> <span data-ttu-id="8925a-129">這包含電腦進程所存取的憑證，例如 ASP.NET。</span><span class="sxs-lookup"><span data-stu-id="8925a-129">This contains the certificates accessed by machine processes, such as ASP.NET.</span></span> <span data-ttu-id="8925a-130">請使用此位置來存放可對用戶端驗證伺服器的憑證。</span><span class="sxs-lookup"><span data-stu-id="8925a-130">Use this location to store certificates that authenticate the server to clients.</span></span>

- <span data-ttu-id="8925a-131">**目前使用者的存放區**。</span><span class="sxs-lookup"><span data-stu-id="8925a-131">**The current user store**.</span></span> <span data-ttu-id="8925a-132">一般來說，互動性應用程式會將電腦目前使用者的憑證放在此處。</span><span class="sxs-lookup"><span data-stu-id="8925a-132">Interactive applications typically place certificates here for the computer's current user.</span></span> <span data-ttu-id="8925a-133">如果您正在建立用戶端應用程式，通常會將用來向服務驗證使用者的憑證放在此處。</span><span class="sxs-lookup"><span data-stu-id="8925a-133">If you are creating a client application, this is where you typically place certificates that authenticate a user to a service.</span></span>

<span data-ttu-id="8925a-134">這兩個存放區還可進一步細分為子存放區。</span><span class="sxs-lookup"><span data-stu-id="8925a-134">These two stores are further divided into sub-stores.</span></span> <span data-ttu-id="8925a-135">使用 WCF 來設計程式時，其中最重要的存放區為：</span><span class="sxs-lookup"><span data-stu-id="8925a-135">The most important of these when programming with WCF include:</span></span>

- <span data-ttu-id="8925a-136">**可信任的根憑證授權單位**。</span><span class="sxs-lookup"><span data-stu-id="8925a-136">**Trusted Root Certification Authorities**.</span></span> <span data-ttu-id="8925a-137">您可以使用此存放區中的憑證來建立憑證鏈結，並藉由這些憑證回溯追蹤到此存放區中某個憑證授權單位的憑證。</span><span class="sxs-lookup"><span data-stu-id="8925a-137">You can use the certificates in this store to create a chain of certificates, which can be traced back to a certification authority certificate in this store.</span></span>

  > [!IMPORTANT]
  > <span data-ttu-id="8925a-138">本機電腦會隱含地信任放在此存放區中的任何憑證，就算此憑證並未來自受信任的協力廠商憑證授權單位也是一樣。</span><span class="sxs-lookup"><span data-stu-id="8925a-138">The local computer implicitly trusts any certificate placed in this store, even if the certificate does not come from a trusted third-party certification authority.</span></span> <span data-ttu-id="8925a-139">因此，除非您充分信任簽發者並了解其相關影響，否則請勿將任何憑證放在此存放區。</span><span class="sxs-lookup"><span data-stu-id="8925a-139">For this reason, do not place any certificate into this store unless you fully trust the issuer and understand the consequences.</span></span>

- <span data-ttu-id="8925a-140">**個人**。</span><span class="sxs-lookup"><span data-stu-id="8925a-140">**Personal**.</span></span> <span data-ttu-id="8925a-141">此存放區可用來存放與電腦使用者相關聯的憑證。</span><span class="sxs-lookup"><span data-stu-id="8925a-141">This store is used for certificates associated with a user of a computer.</span></span> <span data-ttu-id="8925a-142">一般來說，此存放區是用來存放 [受信任的根憑證授權單位] 存放區中所找到的其中一個憑證授權單位所發行的憑證。</span><span class="sxs-lookup"><span data-stu-id="8925a-142">Typically this store is used for certificates issued by one of the certification authority certificates found in the Trusted Root Certification Authorities store.</span></span> <span data-ttu-id="8925a-143">另外，此處找到的憑證可能是自動發行並由某個應用程式所信任。</span><span class="sxs-lookup"><span data-stu-id="8925a-143">Alternatively, a certificate found here may be self-issued and trusted by an application.</span></span>

<span data-ttu-id="8925a-144">如需憑證存放區的詳細資訊，請參閱[憑證存放區](/windows/desktop/secauthn/certificate-stores)。</span><span class="sxs-lookup"><span data-stu-id="8925a-144">For more information about certificate stores, see [Certificate Stores](/windows/desktop/secauthn/certificate-stores).</span></span>

### <a name="selecting-a-store"></a><span data-ttu-id="8925a-145">選取存放區</span><span class="sxs-lookup"><span data-stu-id="8925a-145">Selecting a Store</span></span>

<span data-ttu-id="8925a-146">選取存放憑證的位置時，必須考量服務或用戶端執行的方式與時機，</span><span class="sxs-lookup"><span data-stu-id="8925a-146">Selecting where to store a certificate depends how and when the service or client runs.</span></span> <span data-ttu-id="8925a-147">並套用下列一般規則：</span><span class="sxs-lookup"><span data-stu-id="8925a-147">The following general rules apply:</span></span>

- <span data-ttu-id="8925a-148">如果 WCF 服務是裝載在 Windows 服務中，請使用 [本機電腦]\*\*\*\* 存放區。</span><span class="sxs-lookup"><span data-stu-id="8925a-148">If the WCF service is hosted in a Windows service use the **local machine** store.</span></span> <span data-ttu-id="8925a-149">請注意，您需要系統管理員權限將憑證安裝到本機電腦存放區。</span><span class="sxs-lookup"><span data-stu-id="8925a-149">Note that administrator privileges are required to install certificates into the local machine store.</span></span>

- <span data-ttu-id="8925a-150">如果服務或用戶端是透過使用者帳戶執行的應用程式，則請使用 [目前使用者]\*\*\*\* 存放區。</span><span class="sxs-lookup"><span data-stu-id="8925a-150">If the service or client is an application that runs under a user account, then use the **current user** store.</span></span>

### <a name="accessing-stores"></a><span data-ttu-id="8925a-151">存取存放區</span><span class="sxs-lookup"><span data-stu-id="8925a-151">Accessing Stores</span></span>

<span data-ttu-id="8925a-152">存放區會受到存取控制清單 (ACL) 的保護，就像電腦上的資料夾一樣。</span><span class="sxs-lookup"><span data-stu-id="8925a-152">Stores are protected by access control lists (ACLs), just like folders on a computer.</span></span> <span data-ttu-id="8925a-153">當您建立由 Internet Information Services (IIS) 所裝載的服務時，ASP.NET 進程會在 ASP.NET 帳戶下執行。</span><span class="sxs-lookup"><span data-stu-id="8925a-153">When creating a service hosted by Internet Information Services (IIS), the ASP.NET process runs under the ASP.NET account.</span></span> <span data-ttu-id="8925a-154">該帳戶必須能夠存取包含服務所使用之憑證的存放區。</span><span class="sxs-lookup"><span data-stu-id="8925a-154">That account must have access to the store that contains the certificates a service uses.</span></span> <span data-ttu-id="8925a-155">每一個主要存放區都會以預設的存取清單加以保護，但是您可以修改此清單。</span><span class="sxs-lookup"><span data-stu-id="8925a-155">Each of the major stores is protected with a default access list, but the lists can be modified.</span></span> <span data-ttu-id="8925a-156">如果您建立個別的角色來存取存放區，則必須授予該角色存取權限。</span><span class="sxs-lookup"><span data-stu-id="8925a-156">If you create a separate role to access a store, you must grant that role access permission.</span></span> <span data-ttu-id="8925a-157">若要了解如何使用 WinHttpCertConfig.exe 工具來修改存取清單，請參閱[如何：建立開發時要使用的暫時憑證](how-to-create-temporary-certificates-for-use-during-development.md)。</span><span class="sxs-lookup"><span data-stu-id="8925a-157">To learn how to modify the access list using the WinHttpCertConfig.exe tool, see [How to: Create Temporary Certificates for Use During Development](how-to-create-temporary-certificates-for-use-during-development.md).</span></span>

## <a name="chain-trust-and-certificate-authorities"></a><span data-ttu-id="8925a-158">鏈結信任與憑證授權單位</span><span class="sxs-lookup"><span data-stu-id="8925a-158">Chain Trust and Certificate Authorities</span></span>

<span data-ttu-id="8925a-159">憑證是在階層中建立的，其中每個個別憑證都會連結到核發憑證的 CA。</span><span class="sxs-lookup"><span data-stu-id="8925a-159">Certificates are created in a hierarchy where each individual certificate is linked to the CA that issued the certificate.</span></span> <span data-ttu-id="8925a-160">此連結連至 CA 的憑證。</span><span class="sxs-lookup"><span data-stu-id="8925a-160">This link is to the CA’s certificate.</span></span> <span data-ttu-id="8925a-161">CA 的憑證接著會連結到發出原始 CA 憑證的 CA。</span><span class="sxs-lookup"><span data-stu-id="8925a-161">The CA’s certificate then links to the CA that issued the original CA’s certificate.</span></span> <span data-ttu-id="8925a-162">在找到根 CA 的憑證之前，會一直重複這個程序。</span><span class="sxs-lookup"><span data-stu-id="8925a-162">This process is repeated up until the Root CA’s certificate is reached.</span></span> <span data-ttu-id="8925a-163">根 CA 的憑證在本質上會受到信任。</span><span class="sxs-lookup"><span data-stu-id="8925a-163">The Root CA’s certificate is inherently trusted.</span></span>

<span data-ttu-id="8925a-164">數位簽章會藉由依賴此階層 (也稱為「信任鏈結」\*\* 來驗證實體。</span><span class="sxs-lookup"><span data-stu-id="8925a-164">Digital certificates are used to authenticate an entity by relying on this hierarchy, also called a *chain of trust*.</span></span> <span data-ttu-id="8925a-165">只要按兩下任何憑證，然後按一下 [ **憑證路徑** ] 索引標籤，就可以使用 MMC 嵌入式管理單元來查看任何憑證的鏈。如需匯入憑證授權單位單位之憑證鏈的詳細資訊，請參閱 [如何：指定用來驗證簽章的憑證授權單位單位憑證鏈](specify-the-certificate-authority-chain-verify-signatures-wcf.md)。</span><span class="sxs-lookup"><span data-stu-id="8925a-165">You can view any certificate's chain using the MMC snap-in by double-clicking any certificate, then clicking the **Certificate Path** tab. For more information about importing certificate chains for a Certification authority, see [How to: Specify the Certificate Authority Certificate Chain Used to Verify Signatures](specify-the-certificate-authority-chain-verify-signatures-wcf.md).</span></span>

> [!NOTE]
> <span data-ttu-id="8925a-166">您可以藉由將簽發者的憑證放在信任的根授權憑證存放區，為任何簽發者都指定一個信任的根授權。</span><span class="sxs-lookup"><span data-stu-id="8925a-166">Any issuer can be designated a trusted root authority by placing the issuer's certificate in the trusted root authority certificate store.</span></span>

### <a name="disabling-chain-trust"></a><span data-ttu-id="8925a-167">停用鏈結信任</span><span class="sxs-lookup"><span data-stu-id="8925a-167">Disabling Chain Trust</span></span>

<span data-ttu-id="8925a-168">在建立新服務時，您可能使用並非由信任的根憑證所發行的憑證，或者發行的憑證本身並非位於 [受信任的根憑證授權單位] 存放區中。</span><span class="sxs-lookup"><span data-stu-id="8925a-168">When creating a new service, you may be using a certificate that is not issued by a trusted root certificate, or the issuing certificate itself may not be in the Trusted Root Certification Authorities store.</span></span> <span data-ttu-id="8925a-169">如果只是做為開發用途，您可以暫時停用檢查憑證之信任鏈結的機制。</span><span class="sxs-lookup"><span data-stu-id="8925a-169">For development purposes only, you can temporarily disable the mechanism that checks the chain of trust for a certificate.</span></span> <span data-ttu-id="8925a-170">若要這麼做，請將 `CertificateValidationMode` 屬性 (Property) 設為 `PeerTrust` 或 `PeerOrChainTrust`。</span><span class="sxs-lookup"><span data-stu-id="8925a-170">To do this, set the `CertificateValidationMode` property to either `PeerTrust` or `PeerOrChainTrust`.</span></span> <span data-ttu-id="8925a-171">每種模式都會將憑證指定為自動發行 (對等信任) 或是信任鏈結的一部分。</span><span class="sxs-lookup"><span data-stu-id="8925a-171">Either mode specifies that the certificate can either be self-issued (peer trust) or part of a chain of trust.</span></span> <span data-ttu-id="8925a-172">您可以在下列任何一個類別中設定屬性。</span><span class="sxs-lookup"><span data-stu-id="8925a-172">You can set the property on any of the following classes.</span></span>

|<span data-ttu-id="8925a-173">類別</span><span class="sxs-lookup"><span data-stu-id="8925a-173">Class</span></span>|<span data-ttu-id="8925a-174">屬性</span><span class="sxs-lookup"><span data-stu-id="8925a-174">Property</span></span>|
|-----------|--------------|
|<xref:System.ServiceModel.Security.X509ClientCertificateAuthentication>|<xref:System.ServiceModel.Security.X509ClientCertificateAuthentication.CertificateValidationMode%2A?displayProperty=nameWithType>|
|<xref:System.ServiceModel.Security.X509PeerCertificateAuthentication>|<xref:System.ServiceModel.Security.X509PeerCertificateAuthentication.CertificateValidationMode%2A?displayProperty=nameWithType>|
|<xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication>|<xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication.CertificateValidationMode%2A?displayProperty=nameWithType>|
|<xref:System.ServiceModel.Security.IssuedTokenServiceCredential>|<xref:System.ServiceModel.Security.IssuedTokenServiceCredential.CertificateValidationMode%2A?displayProperty=nameWithType>|

<span data-ttu-id="8925a-175">您也可以使用組態來設定屬性。</span><span class="sxs-lookup"><span data-stu-id="8925a-175">You can also set the property using configuration.</span></span> <span data-ttu-id="8925a-176">下列項目可用來指定驗證模式：</span><span class="sxs-lookup"><span data-stu-id="8925a-176">The following elements are used to specify the validation mode:</span></span>

- [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-servicecertificate-element.md)

- [\<peerAuthentication>](../../configure-apps/file-schema/wcf/peerauthentication-element.md)

- [\<messageSenderAuthentication>](../../configure-apps/file-schema/wcf/messagesenderauthentication-element.md)

## <a name="custom-authentication"></a><span data-ttu-id="8925a-177">自訂驗證</span><span class="sxs-lookup"><span data-stu-id="8925a-177">Custom Authentication</span></span>

<span data-ttu-id="8925a-178">`CertificateValidationMode` 屬性同時可讓您自訂憑證的驗證方式。</span><span class="sxs-lookup"><span data-stu-id="8925a-178">The `CertificateValidationMode` property also enables you to customize how certificates are authenticated.</span></span> <span data-ttu-id="8925a-179">根據預設，層級會設為 `ChainTrust`。</span><span class="sxs-lookup"><span data-stu-id="8925a-179">By default, the level is set to `ChainTrust`.</span></span> <span data-ttu-id="8925a-180">若要使用 <xref:System.ServiceModel.Security.X509CertificateValidationMode.Custom> 值，您必須同時將 `CustomCertificateValidatorType` 屬性 (Attribute) 設為可用來驗證憑證的組件與型別。</span><span class="sxs-lookup"><span data-stu-id="8925a-180">To use the <xref:System.ServiceModel.Security.X509CertificateValidationMode.Custom> value, you must also set the `CustomCertificateValidatorType` attribute to an assembly and type used to validate the certificate.</span></span> <span data-ttu-id="8925a-181">若要建立自訂驗證程式，您必須繼承自抽象 <xref:System.IdentityModel.Selectors.X509CertificateValidator> 類別。</span><span class="sxs-lookup"><span data-stu-id="8925a-181">To create a custom validator, you must inherit from the abstract <xref:System.IdentityModel.Selectors.X509CertificateValidator> class.</span></span>

<span data-ttu-id="8925a-182">在建立自訂的驗證器時，要覆寫之最重要的方法是 <xref:System.IdentityModel.Selectors.X509CertificateValidator.Validate%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="8925a-182">When creating a custom authenticator, the most important method to override is the <xref:System.IdentityModel.Selectors.X509CertificateValidator.Validate%2A> method.</span></span> <span data-ttu-id="8925a-183">如需自訂驗證的範例，請參閱 [X.509 憑證驗證程式](../samples/x-509-certificate-validator.md)範例。</span><span class="sxs-lookup"><span data-stu-id="8925a-183">For an example of custom authentication, see the [X.509 Certificate Validator](../samples/x-509-certificate-validator.md) sample.</span></span> <span data-ttu-id="8925a-184">如需詳細資訊，請參閱[自訂認證與認證驗證](../extending/custom-credential-and-credential-validation.md)。</span><span class="sxs-lookup"><span data-stu-id="8925a-184">For more information, see [Custom Credential and Credential Validation](../extending/custom-credential-and-credential-validation.md).</span></span>

## <a name="using-the-powershell-new-selfsignedcertificate-cmdlet-to-build-a-certificate-chain"></a><span data-ttu-id="8925a-185">使用 PowerShell New-selfsignedcertificate Cmdlet 來建立憑證鏈</span><span class="sxs-lookup"><span data-stu-id="8925a-185">Using the PowerShell New-SelfSignedCertificate Cmdlet to Build a Certificate Chain</span></span>

<span data-ttu-id="8925a-186">PowerShell New-selfsignedcertificate 指令 Cmdlet 會建立 x.509 憑證和私密金鑰/公開金鑰組。</span><span class="sxs-lookup"><span data-stu-id="8925a-186">The PowerShell New-SelfSignedCertificate cmdlet creates X.509 certificates and private key/public key pairs.</span></span> <span data-ttu-id="8925a-187">您可以將私密金鑰儲存到磁碟，然後用它來發行並簽署新的憑證，藉此模擬鏈結憑證的階層架構。</span><span class="sxs-lookup"><span data-stu-id="8925a-187">You can save the private key to disk and then use it to issue and sign new certificates, thus simulating a hierarchy of chained certificates.</span></span> <span data-ttu-id="8925a-188">在開發服務時，此 Cmdlet 僅供用來作為輔助工具，不應該用來建立實際部署的憑證。</span><span class="sxs-lookup"><span data-stu-id="8925a-188">The cmdlet is intended for use only as an aid when developing services and should never be used to create certificates for actual deployment.</span></span> <span data-ttu-id="8925a-189">開發 WCF 服務時，請使用下列步驟建立 New-selfsignedcertificate 指令程式的信任鏈。</span><span class="sxs-lookup"><span data-stu-id="8925a-189">When developing a WCF service, use the following steps to build a chain of trust with the New-SelfSignedCertificate cmdlet.</span></span>

#### <a name="to-build-a-chain-of-trust-with-the-new-selfsignedcertificate-cmdlet"></a><span data-ttu-id="8925a-190">若要使用 New-selfsignedcertificate Cmdlet 建立一鏈信任</span><span class="sxs-lookup"><span data-stu-id="8925a-190">To build a chain of trust with the New-SelfSignedCertificate cmdlet</span></span>

1. <span data-ttu-id="8925a-191">使用 New-selfsignedcertificate Cmdlet 建立暫時的根授權單位 (自我簽署的) 憑證。</span><span class="sxs-lookup"><span data-stu-id="8925a-191">Create a temporary root authority (self-signed) certificate using the New-SelfSignedCertificate cmdlet.</span></span> <span data-ttu-id="8925a-192">將私密金鑰儲存到磁碟。</span><span class="sxs-lookup"><span data-stu-id="8925a-192">Save the private key to the disk.</span></span>

2. <span data-ttu-id="8925a-193">使用新的憑證來發行另一個包含公開金鑰的憑證。</span><span class="sxs-lookup"><span data-stu-id="8925a-193">Use the new certificate to issue another certificate that contains the public key.</span></span>

3. <span data-ttu-id="8925a-194">將根授權憑證匯入 [受信任的根憑證授權單位] 存放區。</span><span class="sxs-lookup"><span data-stu-id="8925a-194">Import the root authority certificate into the Trusted Root Certification Authorities store.</span></span>

4. <span data-ttu-id="8925a-195">如需逐步教學說明，請參閱[如何：建立開發時要使用的暫時憑證](how-to-create-temporary-certificates-for-use-during-development.md)。</span><span class="sxs-lookup"><span data-stu-id="8925a-195">For step-by-step instructions, see [How to: Create Temporary Certificates for Use During Development](how-to-create-temporary-certificates-for-use-during-development.md).</span></span>

## <a name="which-certificate-to-use"></a><span data-ttu-id="8925a-196">該使用哪個憑證？</span><span class="sxs-lookup"><span data-stu-id="8925a-196">Which Certificate to Use?</span></span>

<span data-ttu-id="8925a-197">關於憑證常見的問題包括該使用哪些憑證以及為何使用這些憑證。</span><span class="sxs-lookup"><span data-stu-id="8925a-197">Common questions about certificates are which certificate to use, and why.</span></span> <span data-ttu-id="8925a-198">答案需視您是要針對用戶端或服務設計程式而定。</span><span class="sxs-lookup"><span data-stu-id="8925a-198">The answer depends on whether you are programming a client or service.</span></span> <span data-ttu-id="8925a-199">下列資訊將提供您一般性的指示，可能無法完全解答這些問題。</span><span class="sxs-lookup"><span data-stu-id="8925a-199">The following information provides a general guideline and is not an exhaustive answer to these questions.</span></span>

### <a name="service-certificates"></a><span data-ttu-id="8925a-200">服務憑證</span><span class="sxs-lookup"><span data-stu-id="8925a-200">Service Certificates</span></span>

<span data-ttu-id="8925a-201">服務憑證的主要工作就是對用戶端驗證伺服器。</span><span class="sxs-lookup"><span data-stu-id="8925a-201">Service certificates have the primary task of authenticating the server to clients.</span></span> <span data-ttu-id="8925a-202">當用戶端驗證伺服器時，首先要執行的檢查項目之一就是將 [主體]\*\*\*\* 欄位的值與用來連絡服務的統一資源識別元 (URI) 加以比較：兩者的 DNS 必須相符。</span><span class="sxs-lookup"><span data-stu-id="8925a-202">One of the initial checks when a client authenticates a server is to compare the value of the **Subject** field to the Uniform Resource Identifier (URI) used to contact the service: the DNS of both must match.</span></span> <span data-ttu-id="8925a-203">例如，如果服務的 URI 是，主旨 `http://www.contoso.com/endpoint/` 欄位也必須**Subject**包含值 `www.contoso.com` 。</span><span class="sxs-lookup"><span data-stu-id="8925a-203">For example, if the URI of the service is `http://www.contoso.com/endpoint/` then the **Subject** field must also contain the value `www.contoso.com`.</span></span>

<span data-ttu-id="8925a-204">請注意，該欄位可以包含數個值，每個值都可加上代表該值的初始化前置詞。</span><span class="sxs-lookup"><span data-stu-id="8925a-204">Note that the field can contain several values, each prefixed with an initialization to indicate the value.</span></span> <span data-ttu-id="8925a-205">最常見的情況是，一般名稱的初始化為 "CN"，例如 `CN = www.contoso.com` 。</span><span class="sxs-lookup"><span data-stu-id="8925a-205">Most commonly, the initialization is "CN" for common name, for example, `CN = www.contoso.com`.</span></span> <span data-ttu-id="8925a-206">您也可以將 [主體]\*\*\*\* 欄位留空，在這種情況下，[主體別名]\*\*\*\* 欄位則可包含 [DNS 名稱]\*\*\*\* 值。</span><span class="sxs-lookup"><span data-stu-id="8925a-206">It is also possible for the **Subject** field to be blank, in which case the **Subject Alternative Name** field can contain the **DNS Name** value.</span></span>

<span data-ttu-id="8925a-207">另請注意，憑證的 [使用目的]\*\*\*\* 欄位值應該包含適當的值，例如 [伺服器驗證] 或 [用戶端驗證]。</span><span class="sxs-lookup"><span data-stu-id="8925a-207">Also note the value of the **Intended Purposes** field of the certificate should include an appropriate value, such as "Server Authentication" or "Client Authentication".</span></span>

### <a name="client-certificates"></a><span data-ttu-id="8925a-208">用戶端憑證</span><span class="sxs-lookup"><span data-stu-id="8925a-208">Client Certificates</span></span>

<span data-ttu-id="8925a-209">用戶端憑證通常不是由協力廠商憑證授權單位所發行。</span><span class="sxs-lookup"><span data-stu-id="8925a-209">Client certificates are not typically issued by a third-party certification authority.</span></span> <span data-ttu-id="8925a-210">反之，目前使用者位置上的 [個人] 存放區通常包含了由根授權所放置、帶有 [用戶端驗證] 使用目的之憑證。</span><span class="sxs-lookup"><span data-stu-id="8925a-210">Instead, the Personal store of the current user location typically contains certificates placed there by a root authority, with an intended purpose of "Client Authentication".</span></span> <span data-ttu-id="8925a-211">用戶端可以在需要相互驗證時使用這類憑證。</span><span class="sxs-lookup"><span data-stu-id="8925a-211">The client can use such a certificate when mutual authentication is required.</span></span>

## <a name="online-revocation-and-offline-revocation"></a><span data-ttu-id="8925a-212">線上撤銷與離線撤銷</span><span class="sxs-lookup"><span data-stu-id="8925a-212">Online Revocation and Offline Revocation</span></span>

### <a name="certificate-validity"></a><span data-ttu-id="8925a-213">憑證有效性</span><span class="sxs-lookup"><span data-stu-id="8925a-213">Certificate Validity</span></span>

<span data-ttu-id="8925a-214">每個憑證只有在指定期間 (稱為「有效期間」\*\*) 才有效。</span><span class="sxs-lookup"><span data-stu-id="8925a-214">Every certificate is valid only for a given period of time, called the *validity period*.</span></span> <span data-ttu-id="8925a-215">X.509 憑證的 [有效期自]\*\*\*\* 與 [有效期到]\*\*\*\* 欄位會定義有效期間。</span><span class="sxs-lookup"><span data-stu-id="8925a-215">The validity period is defined by the **Valid from** and **Valid to** fields of an X.509 certificate.</span></span> <span data-ttu-id="8925a-216">在驗證期間，會檢查憑證以判斷憑證日期是否仍在有效期間內。</span><span class="sxs-lookup"><span data-stu-id="8925a-216">During authentication, the certificate is checked to determine whether the certificate is still within the validity period.</span></span>

### <a name="certificate-revocation-list"></a><span data-ttu-id="8925a-217">憑證撤銷清單</span><span class="sxs-lookup"><span data-stu-id="8925a-217">Certificate Revocation List</span></span>

<span data-ttu-id="8925a-218">在有效期間內，憑證授權單位隨時可撤銷憑證。</span><span class="sxs-lookup"><span data-stu-id="8925a-218">At any time during the validity period, the certification authority can revoke a certificate.</span></span> <span data-ttu-id="8925a-219">有許多原因會導致發生這種情況，例如憑證的私密金鑰遭到破壞。</span><span class="sxs-lookup"><span data-stu-id="8925a-219">This can occur for many reasons, such as a compromise of the private key of the certificate.</span></span>

<span data-ttu-id="8925a-220">一旦發生這種情況，任何來自已撤銷憑證的鏈結會同時失效，而且在驗證程序期間將不會受到信任。</span><span class="sxs-lookup"><span data-stu-id="8925a-220">When this occurs, any chains that descend from the revoked certificate are also invalid, and are not trusted during authentication procedures.</span></span> <span data-ttu-id="8925a-221">為了找出已撤銷的憑證，每個簽發者會發佈一個包含時間與日期戳記的「憑證撤銷清單」\*\*(CRL)。</span><span class="sxs-lookup"><span data-stu-id="8925a-221">To find out which certificates are revoked, each issuer publishes a time- and date-stamped *certificate revocation list* (CRL).</span></span> <span data-ttu-id="8925a-222">您也可以透過將下列類別的 `RevocationMode` 或 `DefaultRevocationMode` 屬性設為其中一個 <xref:System.Security.Cryptography.X509Certificates.X509RevocationMode> 列舉值的方式，使用線上撤銷或離線撤銷來檢查此清單：<xref:System.ServiceModel.Security.X509ClientCertificateAuthentication>、<xref:System.ServiceModel.Security.X509PeerCertificateAuthentication>、<xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication> 與 <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> 類別。</span><span class="sxs-lookup"><span data-stu-id="8925a-222">The list can be checked using either online revocation or offline revocation by setting the `RevocationMode` or `DefaultRevocationMode` property of the following classes to one of the <xref:System.Security.Cryptography.X509Certificates.X509RevocationMode> enumeration values: <xref:System.ServiceModel.Security.X509ClientCertificateAuthentication>, <xref:System.ServiceModel.Security.X509PeerCertificateAuthentication>, <xref:System.ServiceModel.Security.X509ServiceCertificateAuthentication>, and the <xref:System.ServiceModel.Security.IssuedTokenServiceCredential> classes.</span></span> <span data-ttu-id="8925a-223">所有屬性的預設值為 `Online`。</span><span class="sxs-lookup"><span data-stu-id="8925a-223">The default value for all properties is `Online`.</span></span>

<span data-ttu-id="8925a-224">您也可以使用 `revocationMode` [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-clientcertificate-element.md)) 的 ([\<serviceBehaviors>](../../configure-apps/file-schema/wcf/servicebehaviors.md) 和 [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-clientcertificate-element.md))  (的屬性來設定 configuration 中的模式 [\<endpointBehaviors>](../../configure-apps/file-schema/wcf/endpointbehaviors.md) 。</span><span class="sxs-lookup"><span data-stu-id="8925a-224">You can also set the mode in configuration using the `revocationMode` attribute of both the [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-clientcertificate-element.md) (of the [\<serviceBehaviors>](../../configure-apps/file-schema/wcf/servicebehaviors.md)) and the [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-clientcertificate-element.md) (of the [\<endpointBehaviors>](../../configure-apps/file-schema/wcf/endpointbehaviors.md)).</span></span>

## <a name="the-setcertificate-method"></a><span data-ttu-id="8925a-225">SetCertificate 方法</span><span class="sxs-lookup"><span data-stu-id="8925a-225">The SetCertificate Method</span></span>

<span data-ttu-id="8925a-226">在 WCF 中，您必須經常指定服務或用戶端用來驗證、加密或數位簽署訊息的憑證或憑證集。</span><span class="sxs-lookup"><span data-stu-id="8925a-226">In WCF, you must often specify a certificate or set of certificates a service or client is to use to authenticate, encrypt, or digitally sign a message.</span></span> <span data-ttu-id="8925a-227">您也可以使用代表 X.509 憑證之各種類別的 `SetCertificate` 方法，以程式設計方式來執行這項工作。</span><span class="sxs-lookup"><span data-stu-id="8925a-227">You can do this programmatically by using the `SetCertificate` method of various classes that represent X.509 certificates.</span></span> <span data-ttu-id="8925a-228">下列類別會使用 `SetCertificate` 方法來指定憑證。</span><span class="sxs-lookup"><span data-stu-id="8925a-228">The following classes use the `SetCertificate` method to specify a certificate.</span></span>

|<span data-ttu-id="8925a-229">類別</span><span class="sxs-lookup"><span data-stu-id="8925a-229">Class</span></span>|<span data-ttu-id="8925a-230">方法</span><span class="sxs-lookup"><span data-stu-id="8925a-230">Method</span></span>|
|-----------|------------|
|<xref:System.ServiceModel.Security.PeerCredential>|<xref:System.ServiceModel.Security.PeerCredential.SetCertificate%2A>|
|<xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential>|<xref:System.ServiceModel.Security.X509CertificateInitiatorClientCredential.SetCertificate%2A>|
|<xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential>|<xref:System.ServiceModel.Security.X509CertificateRecipientServiceCredential.SetCertificate%2A>|
|<xref:System.ServiceModel.Security.X509CertificateInitiatorServiceCredential>|
|<xref:System.ServiceModel.Security.X509CertificateInitiatorServiceCredential.SetCertificate%2A>|

<span data-ttu-id="8925a-231">`SetCertificate` 方法會藉由指定下列項目來進行運作：指定存放區位置與存放區、用來指定憑證欄位的 [尋找] 型別 (`x509FindType` 參數)，以及指定要在欄位中尋找的值。</span><span class="sxs-lookup"><span data-stu-id="8925a-231">The `SetCertificate` method works by designating a store location and store, a "find" type (`x509FindType` parameter) that specifies a field of the certificate, and a value to find in the field.</span></span> <span data-ttu-id="8925a-232">例如，下列程式碼會建立 <xref:System.ServiceModel.ServiceHost> 執行個體，並使用 `SetCertificate` 方法來設定用來向用戶端驗證服務的服務憑證。</span><span class="sxs-lookup"><span data-stu-id="8925a-232">For example, the following code creates a <xref:System.ServiceModel.ServiceHost> instance and sets the service certificate used to authenticate the service to clients with the `SetCertificate` method.</span></span>

[!code-csharp[c_WorkingWithCertificates#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_workingwithcertificates/cs/source.cs#1)]
[!code-vb[c_WorkingWithCertificates#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_workingwithcertificates/vb/source.vb#1)]

### <a name="multiple-certificates-with-the-same-value"></a><span data-ttu-id="8925a-233">使用相同值的多個憑證</span><span class="sxs-lookup"><span data-stu-id="8925a-233">Multiple Certificates with the Same Value</span></span>

<span data-ttu-id="8925a-234">存放區可能包含使用相同主體名稱的多個憑證。</span><span class="sxs-lookup"><span data-stu-id="8925a-234">A store may contain multiple certificates with the same subject name.</span></span> <span data-ttu-id="8925a-235">也就是說，如果您將 `x509FindType` 指定為 <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindBySubjectName> 或 <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindBySubjectDistinguishedName>，而且有一個以上的憑證使用相同值，則會因為無法區分所需的憑證是哪一個而擲回例外狀況。</span><span class="sxs-lookup"><span data-stu-id="8925a-235">This means that if you specify that the `x509FindType` is <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindBySubjectName> or <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindBySubjectDistinguishedName>, and more than one certificate has the same value, an exception is thrown because there is no way to distinguish which certificate is required.</span></span> <span data-ttu-id="8925a-236">您可以將 `x509FindType` 設為 <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindByThumbprint> 來降低此行為的影響。</span><span class="sxs-lookup"><span data-stu-id="8925a-236">You can mitigate this by setting the `x509FindType` to <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindByThumbprint>.</span></span> <span data-ttu-id="8925a-237">指紋欄位包含可用來尋找存放區中特定憑證的唯一值。</span><span class="sxs-lookup"><span data-stu-id="8925a-237">The thumbprint field contains a unique value that can be used to find a specific certificate in a store.</span></span> <span data-ttu-id="8925a-238">然而，此欄位也有缺點：如果憑證遭到撤銷或更新，則 `SetCertificate` 方法會因為指紋一併消失而失敗。</span><span class="sxs-lookup"><span data-stu-id="8925a-238">However, this has its own disadvantage: if the certificate is revoked or renewed, the `SetCertificate` method fails because the thumbprint is also gone.</span></span> <span data-ttu-id="8925a-239">或者，當憑證失效時，驗證也會失敗。</span><span class="sxs-lookup"><span data-stu-id="8925a-239">Or, if the certificate is no longer valid, authentication fails.</span></span> <span data-ttu-id="8925a-240">降低這項風險的做法就是，將 `x590FindType` 參數設為 <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindByIssuerName> 並指定簽發者名稱。</span><span class="sxs-lookup"><span data-stu-id="8925a-240">The way to mitigate this is to set the `x590FindType` parameter to <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindByIssuerName> and specify the issuer's name.</span></span> <span data-ttu-id="8925a-241">如果不需要特定的簽發者，則您也可以設定其他任何一個 <xref:System.Security.Cryptography.X509Certificates.X509FindType> 列舉值，例如 <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindByTimeValid>。</span><span class="sxs-lookup"><span data-stu-id="8925a-241">If no particular issuer is required, you can also set one of the other <xref:System.Security.Cryptography.X509Certificates.X509FindType> enumeration values, such as <xref:System.Security.Cryptography.X509Certificates.X509FindType.FindByTimeValid>.</span></span>

## <a name="certificates-in-configuration"></a><span data-ttu-id="8925a-242">組態中的憑證</span><span class="sxs-lookup"><span data-stu-id="8925a-242">Certificates in Configuration</span></span>

<span data-ttu-id="8925a-243">您也可以使用組態來設定憑證。</span><span class="sxs-lookup"><span data-stu-id="8925a-243">You can also set certificates by using configuration.</span></span> <span data-ttu-id="8925a-244">如果您正在建立服務，則會在底下指定認證（包括憑證） [\<serviceBehaviors>](../../configure-apps/file-schema/wcf/servicebehaviors.md) 。</span><span class="sxs-lookup"><span data-stu-id="8925a-244">If you are creating a service, credentials, including certificates, are specified under the [\<serviceBehaviors>](../../configure-apps/file-schema/wcf/servicebehaviors.md).</span></span> <span data-ttu-id="8925a-245">當您設計用戶端時，會在下指定憑證 [\<endpointBehaviors>](../../configure-apps/file-schema/wcf/endpointbehaviors.md) 。</span><span class="sxs-lookup"><span data-stu-id="8925a-245">When you are programming a client, certificates are specified under the [\<endpointBehaviors>](../../configure-apps/file-schema/wcf/endpointbehaviors.md).</span></span>

## <a name="mapping-a-certificate-to-a-user-account"></a><span data-ttu-id="8925a-246">將憑證對應至使用者帳戶</span><span class="sxs-lookup"><span data-stu-id="8925a-246">Mapping a Certificate to a User Account</span></span>

<span data-ttu-id="8925a-247">IIS 與 Active Directory 的其中一項功能，就是能夠將憑證對應至 Windows 使用者帳戶。</span><span class="sxs-lookup"><span data-stu-id="8925a-247">A feature of IIS and Active Directory is the ability to map a certificate to a Windows user account.</span></span> <span data-ttu-id="8925a-248">如需功能的詳細資訊，請參閱[將憑證對應至使用者帳戶](/previous-versions/windows/it-pro/windows-server-2003/cc736706(v=ws.10))。</span><span class="sxs-lookup"><span data-stu-id="8925a-248">For more information about the feature, see [Map certificates to user accounts](/previous-versions/windows/it-pro/windows-server-2003/cc736706(v=ws.10)).</span></span>

<span data-ttu-id="8925a-249">如需使用 Active Directory 對應的詳細資訊，請參閱[將用戶端憑證與目錄服務進行對應](/previous-versions/windows/it-pro/windows-server-2003/cc758484(v=ws.10))。</span><span class="sxs-lookup"><span data-stu-id="8925a-249">For more information about using Active Directory mapping, see [Mapping Client Certificates with Directory Service Mapping](/previous-versions/windows/it-pro/windows-server-2003/cc758484(v=ws.10)).</span></span>

<span data-ttu-id="8925a-250">一旦您啟用這項功能，就可以將 <xref:System.ServiceModel.Security.X509ClientCertificateAuthentication.MapClientCertificateToWindowsAccount%2A> 類別的 <xref:System.ServiceModel.Security.X509ClientCertificateAuthentication> 屬性設為 `true`。</span><span class="sxs-lookup"><span data-stu-id="8925a-250">With this capability enabled, you can set the <xref:System.ServiceModel.Security.X509ClientCertificateAuthentication.MapClientCertificateToWindowsAccount%2A> property of the <xref:System.ServiceModel.Security.X509ClientCertificateAuthentication> class to `true`.</span></span> <span data-ttu-id="8925a-251">在設定中，您可以將 `mapClientCertificateToWindowsAccount` 元素的屬性設定 [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-servicecertificate-element.md) 為 `true` ，如下列程式碼所示。</span><span class="sxs-lookup"><span data-stu-id="8925a-251">In configuration, you can set the `mapClientCertificateToWindowsAccount` attribute of the [\<authentication>](../../configure-apps/file-schema/wcf/authentication-of-servicecertificate-element.md) element to `true`, as shown in the following code.</span></span>

```xml
<serviceBehaviors>
 <behavior name="MappingBehavior">
  <serviceCredentials>
   <clientCertificate>
    <authentication certificateValidationMode="None" mapClientCertificateToWindowsAccount="true" />
   </clientCertificate>
  </serviceCredentials>
 </behavior>
</serviceBehaviors>
```

<span data-ttu-id="8925a-252">將 X.509 憑證對應至代表 Windows 使用者帳戶的權杖可視為權限的提升，因為一旦對應之後，就可以使用 Windows 權杖針對受保護的資源取得其存取權限。</span><span class="sxs-lookup"><span data-stu-id="8925a-252">Mapping an X.509 certificate to the token that represents a Windows user account is considered an elevation of privilege because, once mapped, the Windows token can be used to gain access to protected resources.</span></span> <span data-ttu-id="8925a-253">因此，網域原則要求 X.509 憑證在執行對應之前必須先符合此原則規定。</span><span class="sxs-lookup"><span data-stu-id="8925a-253">Therefore, domain policy requires the X.509 certificate to comply with its policy prior to mapping.</span></span> <span data-ttu-id="8925a-254">*SChannel* 安全性套件會強制執行此要求。</span><span class="sxs-lookup"><span data-stu-id="8925a-254">The *SChannel* security package enforces this requirement.</span></span>

<span data-ttu-id="8925a-255">使用 .NET Framework 3.5 或更新版本時，WCF 會確保憑證符合網域原則，然後才會對應至 Windows 帳戶。</span><span class="sxs-lookup"><span data-stu-id="8925a-255">When using .NET Framework 3.5 or later versions, WCF ensures the certificate conforms to domain policy before it is mapped to a Windows account.</span></span>

<span data-ttu-id="8925a-256">在第一版的 WCF 中，您不需要諮詢網域原則便可進行對應。</span><span class="sxs-lookup"><span data-stu-id="8925a-256">In the first release of WCF, mapping is done without consulting the domain policy.</span></span> <span data-ttu-id="8925a-257">因此，當啟用對應功能且 X.509 憑證無法滿足網域原則要求時，以往在第一版中能夠順利執行的舊版應用程式可能會無法執行。</span><span class="sxs-lookup"><span data-stu-id="8925a-257">Therefore it is possible that older applications that used to work when running under the first release, fails if the mapping is enabled and the X.509 certificate does not satisfy the domain policy.</span></span>

## <a name="see-also"></a><span data-ttu-id="8925a-258">另請參閱</span><span class="sxs-lookup"><span data-stu-id="8925a-258">See also</span></span>

- <xref:System.ServiceModel.Channels>
- <xref:System.ServiceModel.Security>
- <xref:System.ServiceModel>
- <xref:System.Security.Cryptography.X509Certificates.X509FindType>
- [<span data-ttu-id="8925a-259">確保服務與用戶端的安全</span><span class="sxs-lookup"><span data-stu-id="8925a-259">Securing Services and Clients</span></span>](securing-services-and-clients.md)
