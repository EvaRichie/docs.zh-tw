---
title: CustomPeerResolverService 內部：用戶端註冊
ms.date: 03/30/2017
ms.assetid: 40236953-a916-4236-84a6-928859e1331a
ms.openlocfilehash: a905e5d1e467f32575eb38451d66392be25a0759
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/26/2020
ms.locfileid: "96265878"
---
# <a name="inside-the-custompeerresolverservice-client-registrations"></a><span data-ttu-id="7ca9a-102">CustomPeerResolverService 內部：用戶端註冊</span><span class="sxs-lookup"><span data-stu-id="7ca9a-102">Inside the CustomPeerResolverService: Client Registrations</span></span>

<span data-ttu-id="7ca9a-103">網狀結構中的每一個節點都會將自己的端點資訊透過 `Register` 函式發佈給解析程式服務。</span><span class="sxs-lookup"><span data-stu-id="7ca9a-103">Each node in the mesh publishes its endpoint information to the resolver service through the `Register` function.</span></span> <span data-ttu-id="7ca9a-104">解析程式服務會儲存這項資訊做為註冊記錄。</span><span class="sxs-lookup"><span data-stu-id="7ca9a-104">The resolver service stores this information as a registration record.</span></span> <span data-ttu-id="7ca9a-105">這份記錄會包含該節點的唯一識別碼 (RegistrationID) 以及端點資訊 (PeerNodeAddress)。</span><span class="sxs-lookup"><span data-stu-id="7ca9a-105">This record contains a unique identifier (RegistrationID) and endpoint information (PeerNodeAddress) for the node.</span></span>  
  
## <a name="stale-records-and-expiration-time"></a><span data-ttu-id="7ca9a-106">失效記錄與到期時間</span><span class="sxs-lookup"><span data-stu-id="7ca9a-106">Stale Records and Expiration Time</span></span>  

 <span data-ttu-id="7ca9a-107">在理想的狀況下，當節點要脫離網狀結構時，該節點會呼叫 `Unregister` 函式，這個函式會讓解析程式服務移除該註冊記錄。</span><span class="sxs-lookup"><span data-stu-id="7ca9a-107">Ideally, when a node leaves the mesh, it will call the `Unregister` function, which causes the resolver service to remove the registration entry.</span></span> <span data-ttu-id="7ca9a-108">有時候，節點在呼叫 `Unregister` 前即已關閉或變得無法存取，而留下失效的註冊記錄。</span><span class="sxs-lookup"><span data-stu-id="7ca9a-108">Sometimes, nodes shut down or become inaccessible before calling `Unregister`, leaving behind a stale registration record.</span></span>  
  
 <span data-ttu-id="7ca9a-109">解析程式服務中的失效記錄可能會導致無法連線。</span><span class="sxs-lookup"><span data-stu-id="7ca9a-109">Stale records in your resolver service can cause failed connections.</span></span> <span data-ttu-id="7ca9a-110">如果嘗試連線到網狀結構的某一個節點收到來自解析程式服務失效連線資訊，則可能需要更久的時間，才能順利加入該網狀結構。</span><span class="sxs-lookup"><span data-stu-id="7ca9a-110">If a node trying to connect to a mesh receives stale connection information from the resolver service, it can take longer to successfully join the mesh.</span></span> <span data-ttu-id="7ca9a-111">失效的記錄也會佔用記憶體。</span><span class="sxs-lookup"><span data-stu-id="7ca9a-111">Stale records also take up memory.</span></span> <span data-ttu-id="7ca9a-112">如果不進行有效的清除程序，用於儲存註冊資訊的快取記憶體終究會發生溢位，且毀損解析程式服務。</span><span class="sxs-lookup"><span data-stu-id="7ca9a-112">Without an efficient clean up process, the cache used to store registrations could eventually overflow and crash the resolver service.</span></span>  
  
 <span data-ttu-id="7ca9a-113"><xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> 會標記每一筆記錄的到期時間 (DateTime)，也會儲存到期時間做為記錄的一部分。</span><span class="sxs-lookup"><span data-stu-id="7ca9a-113">The <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> marks each record with an expiration time (DateTime), and stores that information as part of the record.</span></span> <span data-ttu-id="7ca9a-114">服務會利用到期時間識別失效的記錄。</span><span class="sxs-lookup"><span data-stu-id="7ca9a-114">The service uses the expiration time to identify stale records.</span></span> <span data-ttu-id="7ca9a-115">自訂實作也應該可以完成類似的工作。</span><span class="sxs-lookup"><span data-stu-id="7ca9a-115">Custom implementations should do something similar.</span></span>  
  
## <a name="refreshinterval-and-cleanupinterval"></a><span data-ttu-id="7ca9a-116">RefreshInterval 及 CleanupInterval</span><span class="sxs-lookup"><span data-stu-id="7ca9a-116">RefreshInterval and CleanupInterval</span></span>  

 <span data-ttu-id="7ca9a-117">`RefreshInterval` 的 <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> 屬性會定義註冊記錄保存在服務註冊查詢表中的有效期限。</span><span class="sxs-lookup"><span data-stu-id="7ca9a-117">The `RefreshInterval` property of the <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> defines how long registration records remain valid in the service's registration lookup table.</span></span> <span data-ttu-id="7ca9a-118">指定給這個屬性的時間長度傳遞給特定記錄後，該記錄即失效且會標記為必須刪除。</span><span class="sxs-lookup"><span data-stu-id="7ca9a-118">When the amount of time supplied to this property has passed for a given record, that record becomes stale and is marked for deletion.</span></span>  
  
 <span data-ttu-id="7ca9a-119">`CleanupInterval` 的 <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> 屬性會告知服務搜尋與刪除失效註冊記錄的頻率。</span><span class="sxs-lookup"><span data-stu-id="7ca9a-119">The `CleanupInterval` property of the <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> tells the service how often to search for and delete stale registration records.</span></span> <span data-ttu-id="7ca9a-120">`CleanupInterval` 的設定值應該大於或等於服務上的 `RefreshInterval`。</span><span class="sxs-lookup"><span data-stu-id="7ca9a-120">The `CleanupInterval` should be set to a time greater than or equal to the `RefreshInterval` set on the service.</span></span>  
  
 <span data-ttu-id="7ca9a-121">若要實作自己的解析程式服務，必須自行撰寫可以移除失效註冊記錄的維護函式。</span><span class="sxs-lookup"><span data-stu-id="7ca9a-121">To implement your own resolver service, you need to write a maintenance function to remove stale registration records.</span></span> <span data-ttu-id="7ca9a-122">有幾個方式可做到這點：</span><span class="sxs-lookup"><span data-stu-id="7ca9a-122">There are several ways to do this:</span></span>  
  
- <span data-ttu-id="7ca9a-123">**定期維護**：設定計時器以定期關閉，然後流覽您的資料存放區來刪除舊的記錄。</span><span class="sxs-lookup"><span data-stu-id="7ca9a-123">**Periodic maintenance**: Set a timer to go off periodically, and go through your data store to delete old records.</span></span> <span data-ttu-id="7ca9a-124"><xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> 會使用這個方法。</span><span class="sxs-lookup"><span data-stu-id="7ca9a-124">The <xref:System.ServiceModel.PeerResolvers.CustomPeerResolverService> uses this approach.</span></span>  
  
- <span data-ttu-id="7ca9a-125">**被動式刪除**：當您的服務已在執行另一個函式時，您可以識別並刪除過時的記錄，而不是積極地定期搜尋過時的記錄。</span><span class="sxs-lookup"><span data-stu-id="7ca9a-125">**Passive deletion**: Instead of actively searching for stale records at regular intervals, you can identify and delete stale records when your service is already performing another function.</span></span> <span data-ttu-id="7ca9a-126">可能會延遲對解析程式用戶端發出之要求的回應時間，但是這可以省去設定計時器的作法，對於只有少數節點會在不呼叫 `Unregister` 而離開網狀結構的情況，也比較有效率。</span><span class="sxs-lookup"><span data-stu-id="7ca9a-126">This may potentially slow down response time to requests from the resolver clients, but it eliminates the need for a timer, and may be more efficient if few nodes are expected to leave without calling `Unregister`.</span></span>  
  
## <a name="registrationlifetime-and-refresh"></a><span data-ttu-id="7ca9a-127">RegistrationLifetime 與 Refresh</span><span class="sxs-lookup"><span data-stu-id="7ca9a-127">RegistrationLifetime and Refresh</span></span>  

 <span data-ttu-id="7ca9a-128">當一個節點註冊到解析程式服務時，該節點會收到來自服務的 <xref:System.ServiceModel.PeerResolvers.RegisterResponseInfo> 物件。</span><span class="sxs-lookup"><span data-stu-id="7ca9a-128">When a node registers with a resolver service, it receives a <xref:System.ServiceModel.PeerResolvers.RegisterResponseInfo> object from the service.</span></span> <span data-ttu-id="7ca9a-129">指定新的時間量的 `RegistrationLifetime`，註冊項目將在經過這段時間後到期並由解析程式服務移除。</span><span class="sxs-lookup"><span data-stu-id="7ca9a-129">This object has a `RegistrationLifetime` property which indicates to the node how much time it has before the registration expires and is removed by the resolver service.</span></span> <span data-ttu-id="7ca9a-130">例如，假設 `RegistrationLifetime` 為 2 分鐘，那麼節點必須在 2 分鐘內呼叫 `Refresh`，才能確保記錄的更新狀況且沒有被刪除。</span><span class="sxs-lookup"><span data-stu-id="7ca9a-130">If, for example, the `RegistrationLifetime` is 2 minutes, the node needs to call `Refresh` in under 2 minutes to ensure the record stays fresh and is not deleted.</span></span> <span data-ttu-id="7ca9a-131">解析程式服務收到 `Refresh` 要求時，服務會檢查該記錄並且重設到期時間。</span><span class="sxs-lookup"><span data-stu-id="7ca9a-131">When the resolver service receives a `Refresh` request, it looks up the record and resets the expiration time.</span></span> <span data-ttu-id="7ca9a-132">Refresh 會連同 <xref:System.ServiceModel.PeerResolvers.RefreshResponseInfo> 屬性傳回 `RegistrationLifetime` 物件。</span><span class="sxs-lookup"><span data-stu-id="7ca9a-132">Refresh returns a <xref:System.ServiceModel.PeerResolvers.RefreshResponseInfo> object with a `RegistrationLifetime` property.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="7ca9a-133">另請參閱</span><span class="sxs-lookup"><span data-stu-id="7ca9a-133">See also</span></span>

- [<span data-ttu-id="7ca9a-134">對等解析程式</span><span class="sxs-lookup"><span data-stu-id="7ca9a-134">Peer Resolvers</span></span>](peer-resolvers.md)
