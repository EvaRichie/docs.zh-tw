---
title: 使用模擬搭配傳輸安全性
ms.date: 03/30/2017
ms.assetid: 426df8cb-6337-4262-b2c0-b96c2edf21a9
ms.openlocfilehash: 1d33bfbbb74266aefa538166b4e1aca7d7e315ef
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/09/2020
ms.locfileid: "84594968"
---
# <a name="using-impersonation-with-transport-security"></a><span data-ttu-id="ff76c-102">使用模擬搭配傳輸安全性</span><span class="sxs-lookup"><span data-stu-id="ff76c-102">Using Impersonation with Transport Security</span></span>
<span data-ttu-id="ff76c-103">模擬*是伺服器*應用程式採用用戶端身分識別的能力。</span><span class="sxs-lookup"><span data-stu-id="ff76c-103">*Impersonation* is the ability of a server application to take on the identity of the client.</span></span> <span data-ttu-id="ff76c-104">對服務而言，驗證存取資源時使用模擬是很常見的。</span><span class="sxs-lookup"><span data-stu-id="ff76c-104">It is common for services to use impersonation when validating access to resources.</span></span> <span data-ttu-id="ff76c-105">伺服器應用程式使用服務帳戶執行，但是伺服器在接受用戶端連線會模擬用戶端，藉此使用用戶端的認證執行存取檢查。</span><span class="sxs-lookup"><span data-stu-id="ff76c-105">The server application runs using a service account, but when the server accepts a client connection, it impersonates the client so that access checks are performed using the client's credentials.</span></span> <span data-ttu-id="ff76c-106">傳輸安全性是一種用於傳遞認證與使用該認證保護通訊安全性的機制。</span><span class="sxs-lookup"><span data-stu-id="ff76c-106">Transport security is a mechanism both for passing credentials and securing communication using those credentials.</span></span> <span data-ttu-id="ff76c-107">本主題說明如何使用 Windows Communication Foundation （WCF）中的傳輸安全性與模擬功能。</span><span class="sxs-lookup"><span data-stu-id="ff76c-107">This topic describes using transport security in Windows Communication Foundation (WCF) with the impersonation feature.</span></span> <span data-ttu-id="ff76c-108">如需使用訊息安全性模擬的詳細資訊，請參閱[委派和](delegation-and-impersonation-with-wcf.md)模擬。</span><span class="sxs-lookup"><span data-stu-id="ff76c-108">For more information about impersonation using message security, see [Delegation and Impersonation](delegation-and-impersonation-with-wcf.md).</span></span>  
  
## <a name="five-impersonation-levels"></a><span data-ttu-id="ff76c-109">五個模擬等級</span><span class="sxs-lookup"><span data-stu-id="ff76c-109">Five Impersonation Levels</span></span>  
 <span data-ttu-id="ff76c-110">傳輸安全性運用如下表所述的五種模擬等級。</span><span class="sxs-lookup"><span data-stu-id="ff76c-110">Transport security makes use of five levels of impersonation, as described in the following table.</span></span>  
  
|<span data-ttu-id="ff76c-111">模擬等級</span><span class="sxs-lookup"><span data-stu-id="ff76c-111">Impersonation level</span></span>|<span data-ttu-id="ff76c-112">描述</span><span class="sxs-lookup"><span data-stu-id="ff76c-112">Description</span></span>|  
|-------------------------|-----------------|  
|<span data-ttu-id="ff76c-113">None</span><span class="sxs-lookup"><span data-stu-id="ff76c-113">None</span></span>|<span data-ttu-id="ff76c-114">伺服器不嘗試模擬用戶端。</span><span class="sxs-lookup"><span data-stu-id="ff76c-114">The server application does not attempt to impersonate the client.</span></span>|  
|<span data-ttu-id="ff76c-115">匿名</span><span class="sxs-lookup"><span data-stu-id="ff76c-115">Anonymous</span></span>|<span data-ttu-id="ff76c-116">伺服器應用程式可以根據用戶端的認證執行存取檢查，但不會接收任何有關用戶端身分識別的資訊。</span><span class="sxs-lookup"><span data-stu-id="ff76c-116">The server application can perform access checks against the client's credentials, but does not receive any information about the client's identity.</span></span> <span data-ttu-id="ff76c-117">模擬等級只對電腦上的通訊有意義，例如具名管道。</span><span class="sxs-lookup"><span data-stu-id="ff76c-117">This impersonation level is meaningful only for on-machine communication, such as named pipes.</span></span> <span data-ttu-id="ff76c-118">使用 `Anonymous` 搭配遠端連線將模擬等級提升至識別。</span><span class="sxs-lookup"><span data-stu-id="ff76c-118">Using `Anonymous` with a remote connection promotes the impersonation level to Identify.</span></span>|  
|<span data-ttu-id="ff76c-119">識別</span><span class="sxs-lookup"><span data-stu-id="ff76c-119">Identify</span></span>|<span data-ttu-id="ff76c-120">伺服器應用程式知道用戶端的身分，而且可以根據用戶端的認證執行存取驗證，但無法模擬用戶端。</span><span class="sxs-lookup"><span data-stu-id="ff76c-120">The server application knows the client's identity and can perform access validation against the client's credentials, but cannot impersonate the client.</span></span> <span data-ttu-id="ff76c-121">識別是 WCF 中與 SSPI 認證搭配使用的預設模擬等級，除非權杖提供者提供不同的模擬層級。</span><span class="sxs-lookup"><span data-stu-id="ff76c-121">Identify is the default impersonation level used with SSPI credentials in WCF unless the token provider provides a different impersonation level.</span></span>|  
|<span data-ttu-id="ff76c-122">Impersonate</span><span class="sxs-lookup"><span data-stu-id="ff76c-122">Impersonate</span></span>|<span data-ttu-id="ff76c-123">除了執行存取檢查外，伺服器應用程式可以存取做為用戶端的伺服器電腦上的資源。</span><span class="sxs-lookup"><span data-stu-id="ff76c-123">The server application can access resources on the server machine as the client in addition to performing access checks.</span></span> <span data-ttu-id="ff76c-124">伺服器應用程式無法使用用戶端識別存取遠端電腦上的資源，因為模擬的權杖沒有網路認證。</span><span class="sxs-lookup"><span data-stu-id="ff76c-124">The server application cannot access resources on remote machines using the client's identity because the impersonated token does not have network credentials</span></span>|  
|<span data-ttu-id="ff76c-125">代理人</span><span class="sxs-lookup"><span data-stu-id="ff76c-125">Delegate</span></span>|<span data-ttu-id="ff76c-126">除了擁有與 `Impersonate` 相同的功能外，「委派」模擬等級也可以使用用戶端識別讓伺服器應用程式存取遠端電腦上的資訊，並且將識別傳遞到其他應用程式。</span><span class="sxs-lookup"><span data-stu-id="ff76c-126">In addition to having the same capabilities as `Impersonate`, the Delegate impersonation level also enables the server application to access resources on remote machines using the client's identity and to pass the identity to other applications.</span></span><br /><br /> <span data-ttu-id="ff76c-127">**重要事項**伺服器網域帳戶必須標示為受信任，才能在網域控制站上進行委派，以使用這些額外的功能。</span><span class="sxs-lookup"><span data-stu-id="ff76c-127">**Important** The server domain account must be marked as trusted for delegation on the domain controller to use these additional features.</span></span> <span data-ttu-id="ff76c-128">這個模擬等級無法搭配標示為敏感的用戶端網域帳戶使用。</span><span class="sxs-lookup"><span data-stu-id="ff76c-128">This level of impersonation cannot be used with client domain accounts marked as sensitive.</span></span>|  
  
 <span data-ttu-id="ff76c-129">傳輸安全性最常使用的層級是 `Identify` 和 `Impersonate` 。</span><span class="sxs-lookup"><span data-stu-id="ff76c-129">The levels most commonly used with transport security are `Identify` and `Impersonate`.</span></span> <span data-ttu-id="ff76c-130">不建議將 `None` 和 `Anonymous` 等級使用於一般用途，而且很多傳輸不支援使用這些等級進行驗證。</span><span class="sxs-lookup"><span data-stu-id="ff76c-130">The levels `None` and `Anonymous` are not recommended for typical use, and many transports do not support using those levels with authentication.</span></span> <span data-ttu-id="ff76c-131">請小心使用 `Delegate` 等級的強大功能，</span><span class="sxs-lookup"><span data-stu-id="ff76c-131">The `Delegate` level is a powerful feature that should be used with care.</span></span> <span data-ttu-id="ff76c-132">僅將委派憑證的使用權限提供給受信任的伺服器應用程式。</span><span class="sxs-lookup"><span data-stu-id="ff76c-132">Only trusted server applications should be given the permission to delegate credentials.</span></span>  
  
 <span data-ttu-id="ff76c-133">伺服器應用程式需要有 `Impersonate` 權限，才能在 `Delegate` 或 `SeImpersonatePrivilege` 等級使用模擬。</span><span class="sxs-lookup"><span data-stu-id="ff76c-133">Using impersonation at the `Impersonate` or `Delegate` levels requires the server application to have the `SeImpersonatePrivilege` privilege.</span></span> <span data-ttu-id="ff76c-134">如果應用程式在管理員群組或有服務 SID (網路服務、本機服務或本機系統) 的帳戶上執行，該應用程式預設為擁有此權限。</span><span class="sxs-lookup"><span data-stu-id="ff76c-134">An application has this privilege by default if it is running on an account in the Administrators group or on an account with a Service SID (Network Service, Local Service, or Local System).</span></span> <span data-ttu-id="ff76c-135">伺服器不需要用戶端和伺服器的相互驗證。</span><span class="sxs-lookup"><span data-stu-id="ff76c-135">Impersonation does not require mutual authentication of the client and server.</span></span> <span data-ttu-id="ff76c-136">有些支援模擬的驗證配置 (例如 NTLM) 無法搭配相互驗證使用。</span><span class="sxs-lookup"><span data-stu-id="ff76c-136">Some authentication schemes that support impersonation, such as NTLM, cannot be used with mutual authentication.</span></span>  
  
## <a name="transport-specific-issues-with-impersonation"></a><span data-ttu-id="ff76c-137">模擬的特定傳輸問題</span><span class="sxs-lookup"><span data-stu-id="ff76c-137">Transport-Specific Issues with Impersonation</span></span>  
 <span data-ttu-id="ff76c-138">在 WCF 中選擇傳輸會影響模擬的可能選擇。</span><span class="sxs-lookup"><span data-stu-id="ff76c-138">The choice of a transport in WCF affects the possible choices for impersonation.</span></span> <span data-ttu-id="ff76c-139">本節說明在 WCF 中影響標準 HTTP 和具名管道傳輸的問題。</span><span class="sxs-lookup"><span data-stu-id="ff76c-139">This section describes issues affecting the standard HTTP and named pipe transports in WCF.</span></span> <span data-ttu-id="ff76c-140">自訂傳輸在支援模擬上有其限制。</span><span class="sxs-lookup"><span data-stu-id="ff76c-140">Custom transports have their own restrictions on support for impersonation.</span></span>  
  
### <a name="named-pipe-transport"></a><span data-ttu-id="ff76c-141">具名管道傳輸</span><span class="sxs-lookup"><span data-stu-id="ff76c-141">Named Pipe Transport</span></span>  
 <span data-ttu-id="ff76c-142">下列項目會與具名管道傳輸一併使用：</span><span class="sxs-lookup"><span data-stu-id="ff76c-142">The following items are used with the named pipe transport:</span></span>  
  
- <span data-ttu-id="ff76c-143">命名管道傳輸僅供在本機電腦上使用。</span><span class="sxs-lookup"><span data-stu-id="ff76c-143">The named pipe transport is intended for use only on the local machine.</span></span> <span data-ttu-id="ff76c-144">WCF 中的具名管道傳輸明確不允許跨電腦連接。</span><span class="sxs-lookup"><span data-stu-id="ff76c-144">The named pipe transport in WCF explicitly disallows cross-machine connections.</span></span>  
  
- <span data-ttu-id="ff76c-145">具名管道無法搭配 `Impersonate` 或 `Delegate` 模擬等級使用。</span><span class="sxs-lookup"><span data-stu-id="ff76c-145">Named pipes cannot be used with the `Impersonate` or `Delegate` impersonation level.</span></span> <span data-ttu-id="ff76c-146">具名管道無法在這些模擬等級強制執行電腦保證。</span><span class="sxs-lookup"><span data-stu-id="ff76c-146">The named pipe cannot enforce the on-machine guarantee at these impersonation levels.</span></span>  
  
 <span data-ttu-id="ff76c-147">如需具名管道的詳細資訊，請參閱[選擇傳輸](choosing-a-transport.md)。</span><span class="sxs-lookup"><span data-stu-id="ff76c-147">For more information about named pipes, see [Choosing a Transport](choosing-a-transport.md).</span></span>  
  
### <a name="http-transport"></a><span data-ttu-id="ff76c-148">HTTP 傳輸</span><span class="sxs-lookup"><span data-stu-id="ff76c-148">HTTP Transport</span></span>  
 <span data-ttu-id="ff76c-149">使用 HTTP 傳輸（和）的系 <xref:System.ServiceModel.WSHttpBinding> 結 <xref:System.ServiceModel.BasicHttpBinding> 支援數種驗證配置，如[瞭解 HTTP 驗證](understanding-http-authentication.md)中所述。</span><span class="sxs-lookup"><span data-stu-id="ff76c-149">The bindings that use the HTTP transport (<xref:System.ServiceModel.WSHttpBinding> and <xref:System.ServiceModel.BasicHttpBinding>) support several authentication schemes, as explained in [Understanding HTTP Authentication](understanding-http-authentication.md).</span></span> <span data-ttu-id="ff76c-150">支援的模擬等級視驗證配置而定。</span><span class="sxs-lookup"><span data-stu-id="ff76c-150">The impersonation level supported depends on the authentication scheme.</span></span> <span data-ttu-id="ff76c-151">下列項目會與 HTTP 傳輸一併使用：</span><span class="sxs-lookup"><span data-stu-id="ff76c-151">The following items are used with the HTTP transport:</span></span>  
  
- <span data-ttu-id="ff76c-152">`Anonymous` 驗證配置會忽略模擬。</span><span class="sxs-lookup"><span data-stu-id="ff76c-152">The `Anonymous` authentication scheme ignores impersonation.</span></span>  
  
- <span data-ttu-id="ff76c-153">`Basic`驗證配置僅支援 `Delegate` 層級。</span><span class="sxs-lookup"><span data-stu-id="ff76c-153">The `Basic` authentication scheme supports only the `Delegate` level.</span></span> <span data-ttu-id="ff76c-154">所有較低的模擬等級都會進行升級。</span><span class="sxs-lookup"><span data-stu-id="ff76c-154">All lower impersonation levels are upgraded.</span></span>  
  
- <span data-ttu-id="ff76c-155">`Digest` 驗證配置僅支援 `Impersonate` 和 `Delegate` 等級。</span><span class="sxs-lookup"><span data-stu-id="ff76c-155">The `Digest` authentication scheme supports only the `Impersonate` and `Delegate` levels.</span></span>  
  
- <span data-ttu-id="ff76c-156">可直接選擇或透過交涉選擇的 `NTLM` 驗證配置僅支援本機電腦上的 `Delegate` 等級。</span><span class="sxs-lookup"><span data-stu-id="ff76c-156">The `NTLM` authentication scheme, selectable either directly or through negotiation, supports only the `Delegate` level on the local machine.</span></span>  
  
- <span data-ttu-id="ff76c-157">只能夠透過交涉選擇的 Kerberos 驗證配置可以搭配任何支援的模擬等級使用。</span><span class="sxs-lookup"><span data-stu-id="ff76c-157">The Kerberos authentication scheme, which can only be selected through negotiation, can be used with any supported impersonation level.</span></span>  
  
 <span data-ttu-id="ff76c-158">如需有關 HTTP 傳輸的詳細資訊，請參閱[選擇傳輸](choosing-a-transport.md)。</span><span class="sxs-lookup"><span data-stu-id="ff76c-158">For more information about the HTTP transport, see [Choosing a Transport](choosing-a-transport.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ff76c-159">另請參閱</span><span class="sxs-lookup"><span data-stu-id="ff76c-159">See also</span></span>

- [<span data-ttu-id="ff76c-160">委派和模擬</span><span class="sxs-lookup"><span data-stu-id="ff76c-160">Delegation and Impersonation</span></span>](delegation-and-impersonation-with-wcf.md)
- [<span data-ttu-id="ff76c-161">授權</span><span class="sxs-lookup"><span data-stu-id="ff76c-161">Authorization</span></span>](authorization-in-wcf.md)
- [<span data-ttu-id="ff76c-162">如何：在服務上模擬用戶端</span><span class="sxs-lookup"><span data-stu-id="ff76c-162">How to: Impersonate a Client on a Service</span></span>](../how-to-impersonate-a-client-on-a-service.md)
- [<span data-ttu-id="ff76c-163">了解 HTTP 驗證</span><span class="sxs-lookup"><span data-stu-id="ff76c-163">Understanding HTTP Authentication</span></span>](understanding-http-authentication.md)
