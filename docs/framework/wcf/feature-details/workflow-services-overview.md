---
title: 工作流程服務總覽
ms.date: 03/30/2017
ms.assetid: e536dda3-e286-441e-99a7-49ddc004b646
ms.openlocfilehash: f752eca621f9d30f38d85d7e71228fdfe1343c32
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/09/2020
ms.locfileid: "84594864"
---
# <a name="workflow-services-overview"></a><span data-ttu-id="7aedf-102">工作流程服務總覽</span><span class="sxs-lookup"><span data-stu-id="7aedf-102">Workflow services overview</span></span>

<span data-ttu-id="7aedf-103">工作流程服務是以 WCF 為基礎的服務，使用工作流程來執行。</span><span class="sxs-lookup"><span data-stu-id="7aedf-103">Workflow services are WCF-based services that are implemented using workflows.</span></span> <span data-ttu-id="7aedf-104">工作流程服務是使用訊息活動傳送和接收 Windows Communication Foundation （WCF）訊息的工作流程。</span><span class="sxs-lookup"><span data-stu-id="7aedf-104">Workflow services are workflows that use the messaging activities to send and receive Windows Communication Foundation (WCF) messages.</span></span> <span data-ttu-id="7aedf-105">.NET Framework 4.5 引入了許多傳訊活動，可讓您從工作流程內傳送及接收訊息。</span><span class="sxs-lookup"><span data-stu-id="7aedf-105">.NET Framework 4.5 introduces a number of messaging activities that allow you send and receive messages from within a workflow.</span></span> <span data-ttu-id="7aedf-106">如需訊息活動的詳細資訊，以及如何使用它們來執行不同的訊息交換模式，請參閱[訊息活動](messaging-activities.md)。</span><span class="sxs-lookup"><span data-stu-id="7aedf-106">For more information about messaging activities and how they can be used to implement different message exchange patterns, see [Messaging Activities](messaging-activities.md).</span></span>

## <a name="benefits-of-using-workflow-services"></a><span data-ttu-id="7aedf-107">使用工作流程服務的優點</span><span class="sxs-lookup"><span data-stu-id="7aedf-107">Benefits of using workflow services</span></span>

<span data-ttu-id="7aedf-108">當應用程式的散發範圍越來越廣時，就必須由個別服務負責呼叫其他服務來卸載部分工作。</span><span class="sxs-lookup"><span data-stu-id="7aedf-108">As applications become increasingly distributed, individual services become responsible for calling other services to offload some of the work.</span></span> <span data-ttu-id="7aedf-109">實作這些呼叫做為非同步作業會為程式碼增添少許複雜性。</span><span class="sxs-lookup"><span data-stu-id="7aedf-109">Implementing these calls as asynchronous operations introduces some complexity into the code.</span></span> <span data-ttu-id="7aedf-110">錯誤處理會增加額外的複雜性，因為它需要處理例外狀況及提供詳細的追蹤資訊。</span><span class="sxs-lookup"><span data-stu-id="7aedf-110">Error handling adds additional complexity in the form of handling exceptions and providing detailed tracking information.</span></span> <span data-ttu-id="7aedf-111">部分服務經常需要長時間執行，等待輸入時可能會佔用重要的系統資源。</span><span class="sxs-lookup"><span data-stu-id="7aedf-111">Some services are often long running and can take up valuable system resources while waiting for input.</span></span> <span data-ttu-id="7aedf-112">由於這些問題，分散式應用程式通常非常複雜，而且難以撰寫及維護。</span><span class="sxs-lookup"><span data-stu-id="7aedf-112">Because of these issues, distributed applications are often very complex and difficult to write and maintain.</span></span> <span data-ttu-id="7aedf-113">工作流程是表達非同步工作 (特別是呼叫外部服務) 協調性的自然方式。</span><span class="sxs-lookup"><span data-stu-id="7aedf-113">Workflows are a natural way to express the coordination of asynchronous work, especially calls to external services.</span></span> <span data-ttu-id="7aedf-114">工作流程也能有效地表示長期執行的商務程序。</span><span class="sxs-lookup"><span data-stu-id="7aedf-114">Workflows are also effective at representing long-running business processes.</span></span> <span data-ttu-id="7aedf-115">這些特質使得工作流程成為在分散式環境中建置服務的重要資產。</span><span class="sxs-lookup"><span data-stu-id="7aedf-115">It is these qualities that make the workflow a great asset to building services in a distributed environment.</span></span>

## <a name="implementing-a-workflow-service"></a><span data-ttu-id="7aedf-116">執行工作流程服務</span><span class="sxs-lookup"><span data-stu-id="7aedf-116">Implementing a workflow service</span></span>

<span data-ttu-id="7aedf-117">在執行 WCF 服務時，您會定義許多合約來描述服務和它所傳送和接收的資料。</span><span class="sxs-lookup"><span data-stu-id="7aedf-117">When implementing a WCF service, you define a number of contracts that describe the service and the data that it sends and receives.</span></span> <span data-ttu-id="7aedf-118">資料會以資料合約及訊息合約表示。</span><span class="sxs-lookup"><span data-stu-id="7aedf-118">The data is represented as data contracts and message contracts.</span></span> <span data-ttu-id="7aedf-119">WCF 和工作流程服務都使用資料合約和訊息合約定義做為部分服務描述。</span><span class="sxs-lookup"><span data-stu-id="7aedf-119">Both WCF and workflow services use data contract and message contract definitions as part of service descriptions.</span></span> <span data-ttu-id="7aedf-120">服務本身會公開中繼資料 (以 WSDL 的形式) 來描述服務的作業。</span><span class="sxs-lookup"><span data-stu-id="7aedf-120">The service itself exposes metadata (in the form of WSDL) to describe the operations of the service.</span></span> <span data-ttu-id="7aedf-121">在 WCF 中，服務合約和作業合約會定義所支援的服務及作業。</span><span class="sxs-lookup"><span data-stu-id="7aedf-121">In WCF, service contracts and operation contracts define the service and the operations it supports.</span></span> <span data-ttu-id="7aedf-122">不過，在工作流程服務中，這些合約是商務程序的一部分。</span><span class="sxs-lookup"><span data-stu-id="7aedf-122">However in a workflow service, these contracts are part of the business process itself.</span></span> <span data-ttu-id="7aedf-123">它們會藉由名為合約推斷的程序在中繼資料中公布。</span><span class="sxs-lookup"><span data-stu-id="7aedf-123">They are exposed in metadata by a process called contract inference.</span></span> <span data-ttu-id="7aedf-124">使用 <xref:System.ServiceModel.Activities.WorkflowServiceHost> 裝載工作流程服務時，會檢查該工作流程定義，並根據在工作流程中找到的傳訊活動集產生合約。</span><span class="sxs-lookup"><span data-stu-id="7aedf-124">When a workflow service is hosted using <xref:System.ServiceModel.Activities.WorkflowServiceHost>, the workflow definition is examined and a contract is generated based on the set of messaging activities found in the workflow.</span></span> <span data-ttu-id="7aedf-125">特別是，下列活動和屬性會用來產生合約：</span><span class="sxs-lookup"><span data-stu-id="7aedf-125">In particular, the following activities and properties are used to generate the contract:</span></span>

<span data-ttu-id="7aedf-126"><xref:System.ServiceModel.Activities.Receive> 活動</span><span class="sxs-lookup"><span data-stu-id="7aedf-126"><xref:System.ServiceModel.Activities.Receive> Activity</span></span>

- <xref:System.ServiceModel.Activities.Receive.ServiceContractName%2A>

- <xref:System.ServiceModel.Activities.Receive.OperationName%2A>

- <xref:System.ServiceModel.Activities.Receive.Action%2A>

<span data-ttu-id="7aedf-127"><xref:System.ServiceModel.Activities.SendReply> 活動</span><span class="sxs-lookup"><span data-stu-id="7aedf-127"><xref:System.ServiceModel.Activities.SendReply> Activity</span></span>

- <xref:System.ServiceModel.Activities.SendReply.Action%2A>

<span data-ttu-id="7aedf-128"><xref:System.ServiceModel.Activities.TransactedReceiveScope> 活動</span><span class="sxs-lookup"><span data-stu-id="7aedf-128"><xref:System.ServiceModel.Activities.TransactedReceiveScope> Activity</span></span>

<span data-ttu-id="7aedf-129">合約推斷的最終結果是使用與 WCF 服務和作業合約相同的資料結構來描述服務。</span><span class="sxs-lookup"><span data-stu-id="7aedf-129">The end result of contract inference is a description of the service using the same data structures as WCF services and operation contracts.</span></span> <span data-ttu-id="7aedf-130">接著，這項資訊會用來公開工作流程服務的 WSDL。</span><span class="sxs-lookup"><span data-stu-id="7aedf-130">This information is then used to expose WSDL for the workflow service.</span></span>

> [!NOTE]
> [!INCLUDE[netfx_current_short](../../../../includes/netfx-current-short-md.md)] <span data-ttu-id="7aedf-131">不允許您使用現有的合約定義而不使用其他工具撰寫工作流程服務。</span><span class="sxs-lookup"><span data-stu-id="7aedf-131">does not allow you to write workflow services using an existing contract definition without some additional tooling support.</span></span> <span data-ttu-id="7aedf-132">工作流程服務合約是由上述合約推斷程序所建立的，</span><span class="sxs-lookup"><span data-stu-id="7aedf-132">Workflow service contracts are created by the contract inference process discussed previously.</span></span> <span data-ttu-id="7aedf-133">但可以完全支援訊息合約和資料合約。</span><span class="sxs-lookup"><span data-stu-id="7aedf-133">Message contracts and data contracts are fully supported, however.</span></span>

## <a name="workflow-services-and-msmq-based-bindings"></a><span data-ttu-id="7aedf-134">工作流程服務和以 MSMQ 為基礎的系結</span><span class="sxs-lookup"><span data-stu-id="7aedf-134">Workflow services and MSMQ-based bindings</span></span>

<span data-ttu-id="7aedf-135">WCF 定義兩種以 MSMQ 為主的繫結：<xref:System.ServiceModel.NetMsmqBinding> 與 <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding>。</span><span class="sxs-lookup"><span data-stu-id="7aedf-135">WCF defines two MSMQ-based bindings <xref:System.ServiceModel.NetMsmqBinding> and <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding>.</span></span>  <span data-ttu-id="7aedf-136">由於工作流程服務的長期執行特性，以 MSMQ 為主的繫結通常會與此類服務搭配使用。</span><span class="sxs-lookup"><span data-stu-id="7aedf-136">MSMQ-based bindings are often used with workflow services because of the long-running nature of such services.</span></span> <span data-ttu-id="7aedf-137">以 MSMQ 為主的繫結具有 `ValidityDuration` 屬性，該屬性會指定可以假設 MSMQ 訊息有效的時間長短。</span><span class="sxs-lookup"><span data-stu-id="7aedf-137">The MSMQ-based bindings have a `ValidityDuration` property that specifies how long MSMQ messages can assume to be valid.</span></span> <span data-ttu-id="7aedf-138">由於工作流程服務的長期執行特性，因此 MSMQ 訊息的有效性持續時間可能會在工作流程服務能夠處理該訊息之前結束。</span><span class="sxs-lookup"><span data-stu-id="7aedf-138">Because of the long running nature of workflow services it is possible that the validity duration of a MSMQ message may elapse before the workflow service can process it.</span></span> <span data-ttu-id="7aedf-139">因此，將 MSMQ 繫結的有效性持續時間設定為適當的值相當重要。</span><span class="sxs-lookup"><span data-stu-id="7aedf-139">It is therefore very important to set the validity duration of a MSMQ binding to an appropriate value.</span></span> <span data-ttu-id="7aedf-140">您必須根據工作流程和工作流程處理訊息的方式選擇這個值。</span><span class="sxs-lookup"><span data-stu-id="7aedf-140">This value must be chosen based on the workflow and how it processes messages.</span></span> <span data-ttu-id="7aedf-141">例如，如果您的工作流程含有 <xref:System.ServiceModel.Activities.Receive> 活動加上需要執行 10 分鐘的自訂活動，接著是另一個 <xref:System.ServiceModel.Activities.Receive> 活動，正確的 `ValidityDuration` 值便會大於 10 分鐘。</span><span class="sxs-lookup"><span data-stu-id="7aedf-141">For example if you have a workflow with a <xref:System.ServiceModel.Activities.Receive> activity followed by a custom activity that takes 10 minutes to run, followed by another <xref:System.ServiceModel.Activities.Receive> activity, the correct value for `ValidityDuration` would be greater than 10 minutes.</span></span>

## <a name="hosting-a-workflow-service"></a><span data-ttu-id="7aedf-142">裝載工作流程服務</span><span class="sxs-lookup"><span data-stu-id="7aedf-142">Hosting a workflow service</span></span>

<span data-ttu-id="7aedf-143">就像 WCF 服務一樣，必須裝載工作流程服務。</span><span class="sxs-lookup"><span data-stu-id="7aedf-143">Like WCF services, workflow services must be hosted.</span></span> <span data-ttu-id="7aedf-144">WCF 服務會使用 <xref:System.ServiceModel.ServiceHost> 類別來裝載服務，並使用工作流程服務 <xref:System.ServiceModel.Activities.WorkflowServiceHost> 來裝載服務。</span><span class="sxs-lookup"><span data-stu-id="7aedf-144">WCF services use the <xref:System.ServiceModel.ServiceHost> class to host services and workflow services use <xref:System.ServiceModel.Activities.WorkflowServiceHost> to host services.</span></span> <span data-ttu-id="7aedf-145">就像 WCF 服務一樣，工作流程服務也可以透過各種方式來裝載，例如：</span><span class="sxs-lookup"><span data-stu-id="7aedf-145">Like WCF services, workflow services can be hosted in a variety of ways, for example:</span></span>

- <span data-ttu-id="7aedf-146">在 managed .NET Framework 應用程式中。</span><span class="sxs-lookup"><span data-stu-id="7aedf-146">In a managed .NET Framework application.</span></span>

- <span data-ttu-id="7aedf-147">在網際網路資訊服務 (IIS) 中。</span><span class="sxs-lookup"><span data-stu-id="7aedf-147">In Internet Information Services (IIS).</span></span>

- <span data-ttu-id="7aedf-148">在 Windows 處理序啟用服務 (WAS) 中。</span><span class="sxs-lookup"><span data-stu-id="7aedf-148">In Windows Process Activation Service (WAS).</span></span>

- <span data-ttu-id="7aedf-149">在 Managed Windows 服務中。</span><span class="sxs-lookup"><span data-stu-id="7aedf-149">In a managed Windows Service.</span></span>

<span data-ttu-id="7aedf-150">裝載于 managed .NET Framework 應用程式或 managed Windows 服務中的工作流程服務會建立類別的實例 <xref:System.ServiceModel.Activities.WorkflowServiceHost> ，並將實例（ <xref:System.ServiceModel.Activities.WorkflowService> 其中包含屬性中的工作流程定義）傳遞給它 <xref:System.ServiceModel.Activities.WorkflowService.Body%2A> 。</span><span class="sxs-lookup"><span data-stu-id="7aedf-150">Workflow services hosted in a managed .NET Framework application or a managed Windows service create an instance of the <xref:System.ServiceModel.Activities.WorkflowServiceHost> class and pass it an instance of the <xref:System.ServiceModel.Activities.WorkflowService> that contains the workflow definition within the <xref:System.ServiceModel.Activities.WorkflowService.Body%2A> property.</span></span> <span data-ttu-id="7aedf-151">包含傳訊活動的工作流程定義會公開為工作流程服務。</span><span class="sxs-lookup"><span data-stu-id="7aedf-151">A workflow definition that contains messaging activities is exposed as a workflow service.</span></span>

<span data-ttu-id="7aedf-152">若要將工作流程服務裝載於 IIS 或 WAS 中，請將包含工作流程服務定義的 .xamlx 檔案置入虛擬目錄中。</span><span class="sxs-lookup"><span data-stu-id="7aedf-152">To host a workflow service in IIS or WAS, place the .xamlx file that contains the workflow service definition into a virtual directory.</span></span> <span data-ttu-id="7aedf-153"><xref:System.ServiceModel.BasicHttpBinding>系統會自動建立預設端點（使用）以取得詳細資訊，請參閱[簡化](../simplified-configuration.md)的設定。</span><span class="sxs-lookup"><span data-stu-id="7aedf-153">A default endpoint (using <xref:System.ServiceModel.BasicHttpBinding>) is created automatically For more information, see [Simplified Configuration](../simplified-configuration.md).</span></span> <span data-ttu-id="7aedf-154">您也可以將 Web.config 檔案置於虛擬目錄中，指定您自己的端點。</span><span class="sxs-lookup"><span data-stu-id="7aedf-154">You can also place a Web.config file in the virtual directory to specify your own endpoints.</span></span> <span data-ttu-id="7aedf-155">如果工作流程定義位於組件中，您可以將 .svc 檔案置於虛擬目錄內，並將工作流程組件置於 App_Code 目錄中。</span><span class="sxs-lookup"><span data-stu-id="7aedf-155">If your workflow definition is in an assembly you can place a .svc file in the virtual directory and the workflow assembly in the App_Code directory.</span></span> <span data-ttu-id="7aedf-156">.svc 檔案必須指定服務主機處理站，以及實作工作流程服務的類別。</span><span class="sxs-lookup"><span data-stu-id="7aedf-156">The .svc file must specify the service host factory and the class that implements the workflow service.</span></span> <span data-ttu-id="7aedf-157">下列範例示範如何指定服務主機處理站，以及指定實作工作流程服務的類別。</span><span class="sxs-lookup"><span data-stu-id="7aedf-157">The following example shows how to specify the service host factory and specify the class that implements the workflow service.</span></span>

```
<%@ServiceHost Factory=" System.ServiceModel.Activities.Activation.WorkflowServiceHostFactory
Service="EchoService"%>
```
