---
title: 訊息活動
ms.date: 03/30/2017
ms.assetid: 8498f215-1823-4aba-a6e1-391407f8c273
ms.openlocfilehash: 69a0e9a415b10d9c58d04eac27e48b1ed6a78064
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/09/2020
ms.locfileid: "84576391"
---
# <a name="messaging-activities"></a><span data-ttu-id="5dfca-102">訊息活動</span><span class="sxs-lookup"><span data-stu-id="5dfca-102">Messaging activities</span></span>

<span data-ttu-id="5dfca-103">訊息傳遞活動允許工作流程傳送和接收 WCF 訊息。</span><span class="sxs-lookup"><span data-stu-id="5dfca-103">Messaging activities allow workflows to send and receive WCF messages.</span></span> <span data-ttu-id="5dfca-104">藉由將訊息傳遞活動加入至工作流程，您就可以製作任何複雜訊息交換模式 (MEP) 的模型。</span><span class="sxs-lookup"><span data-stu-id="5dfca-104">By adding messaging activities to a workflow you can model any arbitrarily complex message exchange patterns (MEP).</span></span>

## <a name="message-exchange-patterns"></a><span data-ttu-id="5dfca-105">訊息交換模式</span><span class="sxs-lookup"><span data-stu-id="5dfca-105">Message exchange patterns</span></span>

<span data-ttu-id="5dfca-106">有三種基本的訊息交換模式：</span><span class="sxs-lookup"><span data-stu-id="5dfca-106">There are three basic message exchange patterns:</span></span>

- <span data-ttu-id="5dfca-107">**資料包**-使用資料包 MEP 時，用戶端會將訊息傳送至服務，但服務不會回應。</span><span class="sxs-lookup"><span data-stu-id="5dfca-107">**Datagram** - When using the datagram MEP the client sends a message to the service, but the service does not respond.</span></span> <span data-ttu-id="5dfca-108">這種模式有時稱為「射後不理」(Fire And Forget)。</span><span class="sxs-lookup"><span data-stu-id="5dfca-108">This is sometimes called "fire and forget".</span></span> <span data-ttu-id="5dfca-109">射後不理交換是一種需要以超出範圍之外的方式確認傳遞成功的交換。</span><span class="sxs-lookup"><span data-stu-id="5dfca-109">A fire and forget exchange is one that requires out-of-band confirmation of successful delivery.</span></span> <span data-ttu-id="5dfca-110">訊息可能會在傳輸時遺失而永遠無法抵達服務。</span><span class="sxs-lookup"><span data-stu-id="5dfca-110">The message might be lost in transit and never reach the service.</span></span> <span data-ttu-id="5dfca-111">即使用戶端成功傳送訊息，也不會保證服務收到訊息。</span><span class="sxs-lookup"><span data-stu-id="5dfca-111">If the client successfully sends a message, it does not guarantee that the service has received the message.</span></span> <span data-ttu-id="5dfca-112">資料包是訊息的基本建置組塊，您可以在資料包的最上層建立自己的 MEP。</span><span class="sxs-lookup"><span data-stu-id="5dfca-112">The datagram is a fundamental building block for messaging, as you can build your own MEPs on top of it.</span></span>

- <span data-ttu-id="5dfca-113">**要求-回應**-使用要求-回應 MEP 時，用戶端會將訊息傳送至服務，服務會執行必要的處理，然後將回應傳回給用戶端。</span><span class="sxs-lookup"><span data-stu-id="5dfca-113">**Request-Response** - When using the request-response MEP the client sends a message to the service, the service does the required processing, and then sends a response back to the client.</span></span> <span data-ttu-id="5dfca-114">此模式是由要求-回應組合所構成。</span><span class="sxs-lookup"><span data-stu-id="5dfca-114">The pattern consists of request-response pairs.</span></span> <span data-ttu-id="5dfca-115">遠端程序呼叫 (Remote Procedure Call，RPC) 與瀏覽器 GET 要求就是要求-回應呼叫的例子。</span><span class="sxs-lookup"><span data-stu-id="5dfca-115">Examples of request-response calls are remote procedure calls (RPC) and browser GET requests.</span></span> <span data-ttu-id="5dfca-116">這個模式又稱為半雙工。</span><span class="sxs-lookup"><span data-stu-id="5dfca-116">This pattern is also known as half-duplex.</span></span>

- <span data-ttu-id="5dfca-117">**雙工**-使用雙工 MEP 時，用戶端和服務可以依任何順序傳送訊息給彼此。</span><span class="sxs-lookup"><span data-stu-id="5dfca-117">**Duplex** - When using the duplex MEP the client and service can send messages to each other in any order.</span></span> <span data-ttu-id="5dfca-118">雙工 MEP 就像是電話交談，談話中說出的每個字都是一則訊息。</span><span class="sxs-lookup"><span data-stu-id="5dfca-118">The duplex MEP is like a phone conversation, where each word being spoken is a message.</span></span>

<span data-ttu-id="5dfca-119">訊息傳遞活動可讓您實作上述任何基本 MEP 以及各種複雜的 MEP。</span><span class="sxs-lookup"><span data-stu-id="5dfca-119">The messaging activities allow you to implement any of these basic MEPs as well as any arbitrarily complex MEP.</span></span>

## <a name="messaging-activities"></a><span data-ttu-id="5dfca-120">訊息活動</span><span class="sxs-lookup"><span data-stu-id="5dfca-120">Messaging activities</span></span>

<span data-ttu-id="5dfca-121">[!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)] 會定義下列訊息傳遞活動：</span><span class="sxs-lookup"><span data-stu-id="5dfca-121">The [!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)] defines the following messaging activities:</span></span>

- <span data-ttu-id="5dfca-122"><xref:System.ServiceModel.Activities.Send> - 使用 <xref:System.ServiceModel.Activities.Send> 活動傳送訊息。</span><span class="sxs-lookup"><span data-stu-id="5dfca-122"><xref:System.ServiceModel.Activities.Send>- Use the <xref:System.ServiceModel.Activities.Send> activity to send a message.</span></span>

- <span data-ttu-id="5dfca-123"><xref:System.ServiceModel.Activities.SendReply> - 使用 <xref:System.ServiceModel.Activities.SendReply> 活動傳送對所收到訊息的回應。</span><span class="sxs-lookup"><span data-stu-id="5dfca-123"><xref:System.ServiceModel.Activities.SendReply> - Use the <xref:System.ServiceModel.Activities.SendReply> activity to send a response to a received message.</span></span> <span data-ttu-id="5dfca-124">此活動是工作流程服務在實作要求/回覆 MEP 時使用。</span><span class="sxs-lookup"><span data-stu-id="5dfca-124">This activity is used by workflow services when implementing a request/reply MEP.</span></span>

- <span data-ttu-id="5dfca-125"><xref:System.ServiceModel.Activities.Receive> - 使用 <xref:System.ServiceModel.Activities.Receive> 活動接收訊息。</span><span class="sxs-lookup"><span data-stu-id="5dfca-125"><xref:System.ServiceModel.Activities.Receive>- Use the <xref:System.ServiceModel.Activities.Receive> activity to receive a message.</span></span>

- <span data-ttu-id="5dfca-126"><xref:System.ServiceModel.Activities.ReceiveReply> - 使用 <xref:System.ServiceModel.Activities.ReceiveReply> 活動接收回覆訊息。</span><span class="sxs-lookup"><span data-stu-id="5dfca-126"><xref:System.ServiceModel.Activities.ReceiveReply> - Use the <xref:System.ServiceModel.Activities.ReceiveReply> activity to receive a reply message.</span></span> <span data-ttu-id="5dfca-127">此活動是工作流程服務用戶端在實作要求/回覆 MEP 時使用。</span><span class="sxs-lookup"><span data-stu-id="5dfca-127">This activity is used by workflow service clients when implementing a request/reply MEP.</span></span>

## <a name="messaging-activities-and-message-exchange-patterns"></a><span data-ttu-id="5dfca-128">訊息活動和訊息交換模式</span><span class="sxs-lookup"><span data-stu-id="5dfca-128">Messaging activities and message exchange patterns</span></span>

<span data-ttu-id="5dfca-129">資料包 MEP 包含傳送訊息的用戶端，以及接收訊息的服務。</span><span class="sxs-lookup"><span data-stu-id="5dfca-129">A datagram MEP involves a client sending a message and a service receiving the message.</span></span> <span data-ttu-id="5dfca-130">如果用戶端是工作流程，請使用 <xref:System.ServiceModel.Activities.Send> 活動傳送訊息。</span><span class="sxs-lookup"><span data-stu-id="5dfca-130">If the client is a workflow use a <xref:System.ServiceModel.Activities.Send> activity to send the message.</span></span> <span data-ttu-id="5dfca-131">若要在工作流程中接收訊息，請使用 <xref:System.ServiceModel.Activities.Receive> 活動。</span><span class="sxs-lookup"><span data-stu-id="5dfca-131">To receive that message in a workflow, use a <xref:System.ServiceModel.Activities.Receive> activity.</span></span> <span data-ttu-id="5dfca-132"><xref:System.ServiceModel.Activities.Send> 和 <xref:System.ServiceModel.Activities.Receive> 活動各有一個名為 `Content` 的屬性。</span><span class="sxs-lookup"><span data-stu-id="5dfca-132">The <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.Receive> activities each have a property named `Content`.</span></span> <span data-ttu-id="5dfca-133">此屬性包含要傳送或接收的資料。</span><span class="sxs-lookup"><span data-stu-id="5dfca-133">This property contains the data being sent or received.</span></span> <span data-ttu-id="5dfca-134">實作要求-回應 MEP 時，用戶端和服務都會使用多組活動。</span><span class="sxs-lookup"><span data-stu-id="5dfca-134">When implementing the request-response MEP both the client and the service use pairs of activities.</span></span> <span data-ttu-id="5dfca-135">用戶端會使用 <xref:System.ServiceModel.Activities.Send> 活動傳送訊息，並且使用 <xref:System.ServiceModel.Activities.ReceiveReply> 活動接收來自服務的回應。</span><span class="sxs-lookup"><span data-stu-id="5dfca-135">The client uses a <xref:System.ServiceModel.Activities.Send> activity to send the message and a <xref:System.ServiceModel.Activities.ReceiveReply> activity to receive the response from the service.</span></span> <span data-ttu-id="5dfca-136">這兩種活動之間是透過 <xref:System.ServiceModel.Activities.ReceiveReply.Request%2A> 屬性建立關聯。</span><span class="sxs-lookup"><span data-stu-id="5dfca-136">These two activities are associated with each other by the <xref:System.ServiceModel.Activities.ReceiveReply.Request%2A> property.</span></span> <span data-ttu-id="5dfca-137">此屬性會設定為傳送原始訊息的 <xref:System.ServiceModel.Activities.Send> 活動。</span><span class="sxs-lookup"><span data-stu-id="5dfca-137">This property is set to the <xref:System.ServiceModel.Activities.Send> activity that sent the original message.</span></span> <span data-ttu-id="5dfca-138">服務也會使用一組關聯的活動：<xref:System.ServiceModel.Activities.Receive> 和 <xref:System.ServiceModel.Activities.SendReply>。</span><span class="sxs-lookup"><span data-stu-id="5dfca-138">The service also uses a pair of associated activities: <xref:System.ServiceModel.Activities.Receive> and <xref:System.ServiceModel.Activities.SendReply>.</span></span> <span data-ttu-id="5dfca-139">這兩種活動之間是透過 <xref:System.ServiceModel.Activities.SendReply.Request%2A> 屬性建立關聯。</span><span class="sxs-lookup"><span data-stu-id="5dfca-139">These two activities are associated by the <xref:System.ServiceModel.Activities.SendReply.Request%2A> property.</span></span> <span data-ttu-id="5dfca-140">此屬性會設定為接收原始訊息的 <xref:System.ServiceModel.Activities.Receive> 活動。</span><span class="sxs-lookup"><span data-stu-id="5dfca-140">This property is set to the <xref:System.ServiceModel.Activities.Receive> activity that received the original message.</span></span> <span data-ttu-id="5dfca-141"><xref:System.ServiceModel.Activities.ReceiveReply> 和 <xref:System.ServiceModel.Activities.SendReply> 活動就像 <xref:System.ServiceModel.Activities.Send> 和 <xref:System.ServiceModel.Activities.Receive>，可讓您傳送 <xref:System.ServiceModel.Channels.Message> 執行個體或訊息合約型別。</span><span class="sxs-lookup"><span data-stu-id="5dfca-141">The <xref:System.ServiceModel.Activities.ReceiveReply> and <xref:System.ServiceModel.Activities.SendReply> activities, like <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.Receive> allow you to send a <xref:System.ServiceModel.Channels.Message> instance or a message contract type.</span></span>

<span data-ttu-id="5dfca-142">由於工作流程會長時間執行，因此雙工通訊模式必須也支援長時間執行的對話。</span><span class="sxs-lookup"><span data-stu-id="5dfca-142">Because of the long-running nature of workflows, it is important for the duplex pattern of communication to also support long-running conversations.</span></span> <span data-ttu-id="5dfca-143">若要支援長時間執行的對話，初始化對話的用戶端必須讓服務可在之後資料能夠使用時回呼。</span><span class="sxs-lookup"><span data-stu-id="5dfca-143">To support long-running conversations, clients who initiate the conversation must provide the service with an opportunity to call it back at a later time when the data becomes available.</span></span> <span data-ttu-id="5dfca-144">例如，訂單要求提交讓管理員核准之後，可能經過一天、一週甚至一年都未處理；管理訂單核准的工作流程必須知道要在核准之後繼續執行。</span><span class="sxs-lookup"><span data-stu-id="5dfca-144">For example, a purchase order request is submitted for manager approval, but it might not be processed for a day, a week, or even a year; the workflow that manages the purchase order approval must know to resume after the approval is given.</span></span> <span data-ttu-id="5dfca-145">使用相互關聯的工作流程中可支援這種雙向通訊模式。</span><span class="sxs-lookup"><span data-stu-id="5dfca-145">This pattern of duplex communication is supported in workflows using correlation.</span></span> <span data-ttu-id="5dfca-146">若要實作雙工模式，請使用 <xref:System.ServiceModel.Activities.Send> 和 <xref:System.ServiceModel.Activities.Receive> 活動。</span><span class="sxs-lookup"><span data-stu-id="5dfca-146">To implement a duplex pattern, use <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.Receive> activities.</span></span> <span data-ttu-id="5dfca-147">在 <xref:System.ServiceModel.Activities.Receive> 活動上，使用初始化相互關聯 <xref:System.ServiceModel.Activities.CorrelationHandle> 。</span><span class="sxs-lookup"><span data-stu-id="5dfca-147">On the <xref:System.ServiceModel.Activities.Receive> activity, initialize a correlation using <xref:System.ServiceModel.Activities.CorrelationHandle>.</span></span> <span data-ttu-id="5dfca-148">在 <xref:System.ServiceModel.Activities.Send> 活動上，將該相互關聯控制代碼設定為 <xref:System.ServiceModel.Activities.Send.CorrelatesWith%2A> 屬性值。</span><span class="sxs-lookup"><span data-stu-id="5dfca-148">On the <xref:System.ServiceModel.Activities.Send> activity set that correlation handle as the <xref:System.ServiceModel.Activities.Send.CorrelatesWith%2A> property value.</span></span> <span data-ttu-id="5dfca-149">如需詳細資訊，請參閱永久性[雙工](durable-duplex-correlation.md)。</span><span class="sxs-lookup"><span data-stu-id="5dfca-149">For more information, see [Durable Duplex](durable-duplex-correlation.md).</span></span>

> [!NOTE]
> <span data-ttu-id="5dfca-150">工作流程使用回呼相互關聯（「永久性雙工」）的雙工執行，適用于長時間執行的交談。</span><span class="sxs-lookup"><span data-stu-id="5dfca-150">Workflow’s implementation of duplex using a callback correlation ("Durable Duplex") is intended for long-running conversations.</span></span> <span data-ttu-id="5dfca-151">這與採用回呼合約的 WCF 雙工不同，後者會處理短時間執行 (通道的存留期) 的對話。</span><span class="sxs-lookup"><span data-stu-id="5dfca-151">This is not the same as WCF duplex with callback contracts where the conversation is short-running (the lifetime of the channel).</span></span>

## <a name="message-formatting-and-messaging-activities"></a><span data-ttu-id="5dfca-152">訊息格式和訊息活動</span><span class="sxs-lookup"><span data-stu-id="5dfca-152">Message formatting and messaging activities</span></span>

<span data-ttu-id="5dfca-153"><xref:System.ServiceModel.Activities.Receive> 和 <xref:System.ServiceModel.Activities.ReceiveReply> 活動都有一個名為 `Content` 的屬性。</span><span class="sxs-lookup"><span data-stu-id="5dfca-153">The <xref:System.ServiceModel.Activities.Receive> and <xref:System.ServiceModel.Activities.ReceiveReply> activities have a property named `Content`.</span></span> <span data-ttu-id="5dfca-154">此屬性的型別為 <xref:System.ServiceModel.Activities.ReceiveContent>，並且表示 <xref:System.ServiceModel.Activities.Receive> 或 <xref:System.ServiceModel.Activities.ReceiveReply> 活動接收的資料。</span><span class="sxs-lookup"><span data-stu-id="5dfca-154">This property is of type <xref:System.ServiceModel.Activities.ReceiveContent> and represents data the <xref:System.ServiceModel.Activities.Receive> or <xref:System.ServiceModel.Activities.ReceiveReply> activity receives.</span></span> <span data-ttu-id="5dfca-155">.NET Framework 會定義分別稱為 <xref:System.ServiceModel.Activities.ReceiveMessageContent> 和 <xref:System.ServiceModel.Activities.ReceiveParametersContent> 的兩個相關類別，兩者都是衍生自 <xref:System.ServiceModel.Activities.ReceiveContent>。</span><span class="sxs-lookup"><span data-stu-id="5dfca-155">The .NET Framework defines two related classes called <xref:System.ServiceModel.Activities.ReceiveMessageContent> and <xref:System.ServiceModel.Activities.ReceiveParametersContent> both of which are derived from <xref:System.ServiceModel.Activities.ReceiveContent>.</span></span> <span data-ttu-id="5dfca-156">將 <xref:System.ServiceModel.Activities.Receive> 或 <xref:System.ServiceModel.Activities.ReceiveReply> 活動的 `Content` 屬性設定為其中一種型別的執行個體，即可在工作流程服務中接收資料。</span><span class="sxs-lookup"><span data-stu-id="5dfca-156">Set the <xref:System.ServiceModel.Activities.Receive> or <xref:System.ServiceModel.Activities.ReceiveReply> activity’s `Content` property to an instance of one of these types to receive data into a workflow service.</span></span> <span data-ttu-id="5dfca-157">要使用的型別是依據活動接收的資料型別而定。</span><span class="sxs-lookup"><span data-stu-id="5dfca-157">The type to use depends upon the type of data the activity receives.</span></span> <span data-ttu-id="5dfca-158">如果活動接收 `Message` 物件或訊息合約型別，則使用 <xref:System.ServiceModel.Activities.ReceiveMessageContent>。</span><span class="sxs-lookup"><span data-stu-id="5dfca-158">If the activity receives a `Message` object or a message contract type, use <xref:System.ServiceModel.Activities.ReceiveMessageContent>.</span></span> <span data-ttu-id="5dfca-159">如果活動接收一組可序列化的資料合約或 XML 型別，則使用 <xref:System.ServiceModel.Activities.ReceiveParametersContent>。</span><span class="sxs-lookup"><span data-stu-id="5dfca-159">If the activity receives a set of data contract or XML types that can be serialized, use <xref:System.ServiceModel.Activities.ReceiveParametersContent>.</span></span> <span data-ttu-id="5dfca-160"><xref:System.ServiceModel.Activities.ReceiveParametersContent> 可讓您傳送多個參數，而 <xref:System.ServiceModel.Activities.ReceiveMessageContent> 只能讓您傳送一個物件，也就是訊息 (或訊息合約型別)。</span><span class="sxs-lookup"><span data-stu-id="5dfca-160"><xref:System.ServiceModel.Activities.ReceiveParametersContent> allows you to send multiple parameters, whereas <xref:System.ServiceModel.Activities.ReceiveMessageContent> only allows you to send one object, the message (or message contract type).</span></span>

> [!NOTE]
> <span data-ttu-id="5dfca-161"><xref:System.ServiceModel.Activities.ReceiveMessageContent> 也可以搭配可序列化的單一資料合約或 XML 型別使用。</span><span class="sxs-lookup"><span data-stu-id="5dfca-161"><xref:System.ServiceModel.Activities.ReceiveMessageContent> can also be used with a single data contract or XML type that can be serialized.</span></span> <span data-ttu-id="5dfca-162">使用 <xref:System.ServiceModel.Activities.ReceiveParametersContent> 搭配單一參數與直接傳遞至 <xref:System.ServiceModel.Activities.ReceiveMessageContent> 的物件之間的差異在於 Wire 格式。</span><span class="sxs-lookup"><span data-stu-id="5dfca-162">The difference between using <xref:System.ServiceModel.Activities.ReceiveParametersContent> with a single parameter and the object passed directly to <xref:System.ServiceModel.Activities.ReceiveMessageContent> is the wire-format.</span></span> <span data-ttu-id="5dfca-163">參數的內容是以對應於作業名稱的 XML 項目包裝，而序列化物件是以使用參數名稱的 XML 項目包裝 (例如 `<Echo><msg>Hello, World</msg></Echo>`)。</span><span class="sxs-lookup"><span data-stu-id="5dfca-163">The parameter’s content is wrapped in an XML element that corresponds to the operation name and the serialized object is wrapped in an XML element using the parameter name (for example, `<Echo><msg>Hello, World</msg></Echo>`).</span></span> <span data-ttu-id="5dfca-164">訊息內容不會由作業名稱包裝。</span><span class="sxs-lookup"><span data-stu-id="5dfca-164">The message content is not wrapped by the operation name.</span></span> <span data-ttu-id="5dfca-165">但是序列化物件會放置在使用 XML 限定型別名稱的 XML 項目內 (例如 `<string>Hello, World</string>`)。</span><span class="sxs-lookup"><span data-stu-id="5dfca-165">Instead, the serialized object is placed within an XML element using the XML-qualified type name (for example, `<string>Hello, World</string>`).</span></span>

<span data-ttu-id="5dfca-166"><xref:System.ServiceModel.Activities.Send> 和 <xref:System.ServiceModel.Activities.SendReply> 活動也有一個名為 `Content` 的屬性。</span><span class="sxs-lookup"><span data-stu-id="5dfca-166">The <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.SendReply> activities also have a property named `Content`.</span></span> <span data-ttu-id="5dfca-167">此屬性的型別為 <xref:System.ServiceModel.Activities.SendContent>，並且表示 <xref:System.ServiceModel.Activities.Send> 或 <xref:System.ServiceModel.Activities.SendReply> 活動傳送的資料。</span><span class="sxs-lookup"><span data-stu-id="5dfca-167">This property is of type <xref:System.ServiceModel.Activities.SendContent> and represents data the <xref:System.ServiceModel.Activities.Send> or <xref:System.ServiceModel.Activities.SendReply> activity sends.</span></span> <span data-ttu-id="5dfca-168">.NET Framework 會定義分別稱為 <xref:System.ServiceModel.Activities.SendMessageContent> 和 <xref:System.ServiceModel.Activities.SendParametersContent> 的兩個相關型別，兩者都是衍生自 <xref:System.ServiceModel.Activities.SendContent>。</span><span class="sxs-lookup"><span data-stu-id="5dfca-168">The .NET Framework defines two related types called <xref:System.ServiceModel.Activities.SendMessageContent> and <xref:System.ServiceModel.Activities.SendParametersContent> both of which are derived from <xref:System.ServiceModel.Activities.SendContent>.</span></span> <span data-ttu-id="5dfca-169">將 <xref:System.ServiceModel.Activities.Send> 或 <xref:System.ServiceModel.Activities.SendReply> 活動的 `Content` 屬性設定為其中一種型別的執行個體，即可從工作流程服務傳送資料。</span><span class="sxs-lookup"><span data-stu-id="5dfca-169">Set the <xref:System.ServiceModel.Activities.Send> or <xref:System.ServiceModel.Activities.SendReply> activity’s `Content` property to an instance of one of these types to send data from a workflow service.</span></span> <span data-ttu-id="5dfca-170">要使用的類型是依據活動傳送的資料型別而定。</span><span class="sxs-lookup"><span data-stu-id="5dfca-170">The type to use depends upon the type of data the activity sends.</span></span> <span data-ttu-id="5dfca-171">如果活動傳送 `Message` 物件或訊息合約型別，則使用 <xref:System.ServiceModel.Activities.SendMessageContent>。</span><span class="sxs-lookup"><span data-stu-id="5dfca-171">If the activity sends a `Message` object or a message contract type, use <xref:System.ServiceModel.Activities.SendMessageContent>.</span></span> <span data-ttu-id="5dfca-172">如果活動傳送資料合約型別，則使用 <xref:System.ServiceModel.Activities.SendParametersContent>。</span><span class="sxs-lookup"><span data-stu-id="5dfca-172">If the activity sends a data contract type use <xref:System.ServiceModel.Activities.SendParametersContent>.</span></span> <span data-ttu-id="5dfca-173"><xref:System.ServiceModel.Activities.SendParametersContent> 可讓您傳送多個參數，而 <xref:System.ServiceModel.Activities.SendMessageContent> 只能讓您傳送一個物件，也就是訊息 (或訊息合約型別)。</span><span class="sxs-lookup"><span data-stu-id="5dfca-173"><xref:System.ServiceModel.Activities.SendParametersContent> allows you to send multiple parameters, whereas <xref:System.ServiceModel.Activities.SendMessageContent> only allows you to send one object, the message (or the message contract type).</span></span>

<span data-ttu-id="5dfca-174">以命令方式程式設計訊息傳遞活動時，可使用泛型 <xref:System.Activities.InArgument%601> 和 <xref:System.Activities.OutArgument%601> 包裝您指派給訊息的物件，或 <xref:System.ServiceModel.Activities.Send>、<xref:System.ServiceModel.Activities.SendReply>、<xref:System.ServiceModel.Activities.Receive> 和 <xref:System.ServiceModel.Activities.ReceiveReply> 活動的參數屬性。</span><span class="sxs-lookup"><span data-stu-id="5dfca-174">When programming imperatively with the messaging activities, you use the generic <xref:System.Activities.InArgument%601> and <xref:System.Activities.OutArgument%601> to wrap the objects you assign to the message or parameters properties of the <xref:System.ServiceModel.Activities.Send>, <xref:System.ServiceModel.Activities.SendReply>, <xref:System.ServiceModel.Activities.Receive>, and <xref:System.ServiceModel.Activities.ReceiveReply> activities.</span></span> <span data-ttu-id="5dfca-175"><xref:System.Activities.InArgument%601>針對和 <xref:System.ServiceModel.Activities.Send> <xref:System.ServiceModel.Activities.SendReply> 活動以及和活動 <xref:System.Activities.OutArgument%601> 使用 <xref:System.ServiceModel.Activities.Receive> <xref:System.ServiceModel.Activities.ReceiveReply> 。</span><span class="sxs-lookup"><span data-stu-id="5dfca-175">Use <xref:System.Activities.InArgument%601> for the <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.SendReply> activities and <xref:System.Activities.OutArgument%601> for <xref:System.ServiceModel.Activities.Receive> and <xref:System.ServiceModel.Activities.ReceiveReply> activities.</span></span> <span data-ttu-id="5dfca-176">`In` 引數會搭配傳送活動使用，因為資料會傳遞至活動內。</span><span class="sxs-lookup"><span data-stu-id="5dfca-176">`In` arguments are used with the send activities because the data is being passed into the activities.</span></span> <span data-ttu-id="5dfca-177">`Out` 引數則搭配接收活動使用，因為資料會從活動傳出，如下列範例中所示。</span><span class="sxs-lookup"><span data-stu-id="5dfca-177">`Out` arguments are used with the receive activities because data is being passed out of the activities, as shown in the following example.</span></span>

```csharp
Receive reserveSeat = new Receive
{
    ...
    Content = new ReceiveParametersContent
    {
        Parameters =
        {
            { "ReservationInfo", new OutArgument<ReservationRequest>(reservationInfo) }
        }
    }
};
SendReply reserveSeat = new SendReply
{
    ...
    Request = reserveSeat,
    Content = new SendParametersContent
    {
        Parameters =
        {
            { "ReservationId", new InArgument<string>(reservationId) }
        }
    },
};
```

<span data-ttu-id="5dfca-178">實作定義以傳回 Void 之要求/回應作業的工作流程服務時，您必須具現化 <xref:System.ServiceModel.Activities.SendReply> 活動，並且將 <xref:System.ServiceModel.Activities.SendReply.Content%2A> 屬性設定為其中一個內容型別 (<xref:System.ServiceModel.Activities.SendMessageContent> 或 <xref:System.ServiceModel.Activities.SendParametersContent>) 的空執行個體，如下列範例中所示。</span><span class="sxs-lookup"><span data-stu-id="5dfca-178">When implementing a workflow service that defines a request/response operation that returns void, you must instantiate a <xref:System.ServiceModel.Activities.SendReply> activity and set the <xref:System.ServiceModel.Activities.SendReply.Content%2A> property to an empty instance of one of the content types (<xref:System.ServiceModel.Activities.SendMessageContent> or <xref:System.ServiceModel.Activities.SendParametersContent>) as shown in the following example.</span></span>

```csharp
Receive rcv = new Receive()
{
ServiceContractName = "IService",
OperationName = "NullReturningContract",
Content = new ReceiveParametersContent( new Dictionary<string, OutArgument>() { { "message", new OutArgument<string>() } } )
};
SendReply sr = new SendReply()
{
Request = rcv
   Content = new SendParametersContent();
};
```

## <a name="add-service-reference"></a><span data-ttu-id="5dfca-179">新增服務參考</span><span class="sxs-lookup"><span data-stu-id="5dfca-179">Add service reference</span></span>

<span data-ttu-id="5dfca-180">從工作流應用程式呼叫工作流程服務時，Visual Studio 2012 會產生自訂訊息活動，以封裝 <xref:System.ServiceModel.Activities.Send> <xref:System.ServiceModel.Activities.ReceiveReply> 要求/回復 MEP 中常用的和活動。</span><span class="sxs-lookup"><span data-stu-id="5dfca-180">When calling a workflow service from a workflow application, Visual Studio 2012 generates custom messaging activities that encapsulate the usual <xref:System.ServiceModel.Activities.Send> and <xref:System.ServiceModel.Activities.ReceiveReply> activities used in a request/reply MEP.</span></span> <span data-ttu-id="5dfca-181">若要使用這項功能，請以滑鼠右鍵按一下 Visual Studio 中的用戶端專案，然後選取 [**加入**  >  **服務參考**]。</span><span class="sxs-lookup"><span data-stu-id="5dfca-181">To use this feature, right-click the client project in Visual Studio and select **Add** > **Service Reference**.</span></span> <span data-ttu-id="5dfca-182">在位址方塊中輸入服務的基底位址，然後按一下 [移至]。</span><span class="sxs-lookup"><span data-stu-id="5dfca-182">Type the base address of the service in the address box and click Go.</span></span> <span data-ttu-id="5dfca-183">可用的服務會顯示在 [**服務：** ] 方塊中。</span><span class="sxs-lookup"><span data-stu-id="5dfca-183">The available services are displayed in the **Services:** box.</span></span> <span data-ttu-id="5dfca-184">展開服務節點，即可顯示支援的合約。</span><span class="sxs-lookup"><span data-stu-id="5dfca-184">Expand the service node to display the contracts supported.</span></span> <span data-ttu-id="5dfca-185">選取您想要呼叫的合約，[**作業**] 方塊中會顯示可用作業的清單。</span><span class="sxs-lookup"><span data-stu-id="5dfca-185">Select the contract you want to call and the list of available operations is displayed in the **Operations** box.</span></span> <span data-ttu-id="5dfca-186">接著，您可以指定所產生之活動的命名空間，然後按一下 **[確定]**。</span><span class="sxs-lookup"><span data-stu-id="5dfca-186">You can then specify the namespace for the generated activity and click **OK**.</span></span> <span data-ttu-id="5dfca-187">接著您會看見一個對話方塊，說明作業已成功完成，而且在您重建專案之後，產生的自訂活動會位於工具方塊內。</span><span class="sxs-lookup"><span data-stu-id="5dfca-187">You then see a dialog that says the operation completed successfully and that the generated custom activities are in the toolbox after you have rebuilt the project.</span></span> <span data-ttu-id="5dfca-188">服務合約中會針對每一項作業定義一個活動。</span><span class="sxs-lookup"><span data-stu-id="5dfca-188">There is one activity for each operation defined on the service contract.</span></span> <span data-ttu-id="5dfca-189">重建專案之後，您可以拖放自訂活動至工作流程，並且在 [屬性] 視窗中設定任何必要的屬性。</span><span class="sxs-lookup"><span data-stu-id="5dfca-189">After rebuilding the project you can drag and drop the custom activities onto your workflow and set any required properties in the properties window.</span></span>

## <a name="messaging-activity-templates"></a><span data-ttu-id="5dfca-190">訊息活動範本</span><span class="sxs-lookup"><span data-stu-id="5dfca-190">Messaging activity templates</span></span>

<span data-ttu-id="5dfca-191">為了讓在用戶端和服務上設定要求/回應 MEP 變得更容易，Visual Studio 2012 提供兩個訊息活動範本。</span><span class="sxs-lookup"><span data-stu-id="5dfca-191">To make setting up a request/response MEP on the client and service easier, Visual Studio 2012 provides two messaging activity templates.</span></span> <span data-ttu-id="5dfca-192">`System.ServiceModel.Activities.Design.ReceiveAndSendReply` 是用在服務上，而 `System.ServiceModel.Activities.Design.SendAndReceiveReply` 是用在用戶端上。</span><span class="sxs-lookup"><span data-stu-id="5dfca-192">`System.ServiceModel.Activities.Design.ReceiveAndSendReply` is used on the service and `System.ServiceModel.Activities.Design.SendAndReceiveReply` is used on the client.</span></span> <span data-ttu-id="5dfca-193">這兩種情況下，範本都會將適當的訊息傳遞活動加入至您的工作流程。</span><span class="sxs-lookup"><span data-stu-id="5dfca-193">In both cases the templates add the appropriate messaging activities to your workflow.</span></span> <span data-ttu-id="5dfca-194">在服務上，`System.ServiceModel.Activities.Design.ReceiveAndSendReply` 會加入 <xref:System.ServiceModel.Activities.Receive> 活動，後面接著 <xref:System.ServiceModel.Activities.SendReply> 活動。</span><span class="sxs-lookup"><span data-stu-id="5dfca-194">On the service, the `System.ServiceModel.Activities.Design.ReceiveAndSendReply` adds a <xref:System.ServiceModel.Activities.Receive> activity followed by a <xref:System.ServiceModel.Activities.SendReply> activity.</span></span> <span data-ttu-id="5dfca-195"><xref:System.ServiceModel.Activities.SendReply.Request> 屬性會自動設定為 <xref:System.ServiceModel.Activities.Receive> 活動。</span><span class="sxs-lookup"><span data-stu-id="5dfca-195">The <xref:System.ServiceModel.Activities.SendReply.Request> property is automatically set to the <xref:System.ServiceModel.Activities.Receive> activity.</span></span> <span data-ttu-id="5dfca-196">在用戶端上，`System.ServiceModel.Activities.Design.SendAndReceiveReply` 會加入 <xref:System.ServiceModel.Activities.Send> 活動，後面接著 <xref:System.ServiceModel.Activities.ReceiveReply>。</span><span class="sxs-lookup"><span data-stu-id="5dfca-196">On the client, the `System.ServiceModel.Activities.Design.SendAndReceiveReply` adds a <xref:System.ServiceModel.Activities.Send> activity followed by a <xref:System.ServiceModel.Activities.ReceiveReply>.</span></span> <span data-ttu-id="5dfca-197"><xref:System.ServiceModel.Activities.ReceiveReply.Request%2A> 屬性會自動設定為 <xref:System.ServiceModel.Activities.Send> 活動。</span><span class="sxs-lookup"><span data-stu-id="5dfca-197">The <xref:System.ServiceModel.Activities.ReceiveReply.Request%2A> property is automatically set to the <xref:System.ServiceModel.Activities.Send> activity.</span></span> <span data-ttu-id="5dfca-198">若要使用這兩個範本，只要將適當的範本拖放至您的工作流程即可。</span><span class="sxs-lookup"><span data-stu-id="5dfca-198">To use these templates, just drag and drop the appropriate template onto your workflow.</span></span>

## <a name="messaging-activities-and-transactions"></a><span data-ttu-id="5dfca-199">訊息活動和交易</span><span class="sxs-lookup"><span data-stu-id="5dfca-199">Messaging activities and transactions</span></span>

<span data-ttu-id="5dfca-200">呼叫工作流程服務時，您可能想要讓異動流向服務作業。</span><span class="sxs-lookup"><span data-stu-id="5dfca-200">When a call is made to a workflow service you may want to flow a transaction to the service operation.</span></span> <span data-ttu-id="5dfca-201">若要執行這項操作，請將 <xref:System.ServiceModel.Activities.Receive> 活動放置到 <xref:System.ServiceModel.Activities.TransactedReceiveScope> 活動內。</span><span class="sxs-lookup"><span data-stu-id="5dfca-201">To do this place the <xref:System.ServiceModel.Activities.Receive> activity within a <xref:System.ServiceModel.Activities.TransactedReceiveScope> activity.</span></span> <span data-ttu-id="5dfca-202"><xref:System.ServiceModel.Activities.TransactedReceiveScope> 活動包含 `Receive` 活動和主體。</span><span class="sxs-lookup"><span data-stu-id="5dfca-202">The <xref:System.ServiceModel.Activities.TransactedReceiveScope> activity contains a `Receive` activity and a body.</span></span> <span data-ttu-id="5dfca-203">流向服務的異動會在執行 <xref:System.ServiceModel.Activities.TransactedReceiveScope> 主體的整個過程中維持環境。</span><span class="sxs-lookup"><span data-stu-id="5dfca-203">The transaction flowed to the service remains ambient throughout the execution of the body of the <xref:System.ServiceModel.Activities.TransactedReceiveScope>.</span></span> <span data-ttu-id="5dfca-204">當主體執行完成時，異動即完成。</span><span class="sxs-lookup"><span data-stu-id="5dfca-204">The transaction is completed when the body finishes executing.</span></span> <span data-ttu-id="5dfca-205">如需工作流程和交易的詳細資訊，請參閱[工作流程交易](../../windows-workflow-foundation/workflow-transactions.md)。</span><span class="sxs-lookup"><span data-stu-id="5dfca-205">For more information about workflows and transactions see [Workflow Transactions](../../windows-workflow-foundation/workflow-transactions.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="5dfca-206">請參閱</span><span class="sxs-lookup"><span data-stu-id="5dfca-206">See also</span></span>

- [<span data-ttu-id="5dfca-207">如何在工作流程服務中傳送和接收錯誤</span><span class="sxs-lookup"><span data-stu-id="5dfca-207">How to Send and Receive Faults in Workflow Services</span></span>](https://go.microsoft.com/fwlink/?LinkId=189151)
- [<span data-ttu-id="5dfca-208">建立長期執行的工作流程服務</span><span class="sxs-lookup"><span data-stu-id="5dfca-208">Creating a Long-running Workflow Service</span></span>](creating-a-long-running-workflow-service.md)
