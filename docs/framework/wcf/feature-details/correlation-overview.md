---
title: 相互關聯概觀
ms.date: 03/30/2017
ms.assetid: edcc0315-5d26-44d6-a36d-ea554c418e9f
ms.openlocfilehash: 65f87195fde0c3dbda610804260f0ebfbf599073
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/09/2020
ms.locfileid: "84586971"
---
# <a name="correlation-overview"></a><span data-ttu-id="5d632-102">相互關聯概觀</span><span class="sxs-lookup"><span data-stu-id="5d632-102">Correlation Overview</span></span>
<span data-ttu-id="5d632-103">相互關聯是一種機制，可將工作流程服務訊息彼此產生關聯性、將工作流程服務訊息與應用程式執行個體狀態 (例如針對初始要求的回覆) 產生關聯性，或者是將特定的訂單 ID 與訂單處理工作流程的保存狀態產生關聯性。</span><span class="sxs-lookup"><span data-stu-id="5d632-103">Correlation is the mechanism for relating workflow service messages to each other or to the application instance state, such as a reply to an initial request, or a particular order ID to the persisted state of an order-processing workflow.</span></span> <span data-ttu-id="5d632-104">本主題提供相互關聯的概觀。</span><span class="sxs-lookup"><span data-stu-id="5d632-104">This topic provides an overview of correlation.</span></span> <span data-ttu-id="5d632-105">本節的其他主題則會提供各種相互關聯類型的其他資訊。</span><span class="sxs-lookup"><span data-stu-id="5d632-105">The other topics in this section provide additional information for each type of correlation.</span></span>  
  
## <a name="types-of-correlation"></a><span data-ttu-id="5d632-106">相互關聯的類型</span><span class="sxs-lookup"><span data-stu-id="5d632-106">Types of Correlation</span></span>  
 <span data-ttu-id="5d632-107">相互關聯可以以通訊協定為主或以內容為主。</span><span class="sxs-lookup"><span data-stu-id="5d632-107">Correlation can be protocol-based or content-based.</span></span> <span data-ttu-id="5d632-108">以通訊協定為主的相互關聯會使用訊息傳遞基礎結構提供的資料，提供訊息之間的對應。</span><span class="sxs-lookup"><span data-stu-id="5d632-108">Protocol-based correlations use data provided by the message delivery infrastructure to provide the mapping between messages.</span></span> <span data-ttu-id="5d632-109">利用以通訊協定為主之相互關聯功能彼此產生關聯性的訊息，會使用記憶體中的物件 (例如 <xref:System.ServiceModel.Channels.RequestContext>)，或者使用傳輸通訊協定提供的權杖彼此相互關聯。</span><span class="sxs-lookup"><span data-stu-id="5d632-109">Messages that are correlated using protocol-based correlation are related to each other using an object in memory, such as a <xref:System.ServiceModel.Channels.RequestContext>, or by a token provided by the transport protocol.</span></span> <span data-ttu-id="5d632-110">以內容為基礎的相互關聯則會利用指定應用程式的資料產生訊息與訊息之間的關聯性。</span><span class="sxs-lookup"><span data-stu-id="5d632-110">Content-based correlations relate messages to each other using application-specified data.</span></span> <span data-ttu-id="5d632-111">利用以內容為主之相互關聯功能彼此產生關聯性的訊息，是透過訊息中某些應用程式定義的資料 (如客戶編號) 而彼此產生關聯性的。</span><span class="sxs-lookup"><span data-stu-id="5d632-111">Messages that are correlated using content-based correlation are related to each other by some application-defined data in the message, such as a customer number.</span></span>  
  
 <span data-ttu-id="5d632-112">參與相互關聯的活動會使用 <xref:System.ServiceModel.Activities.CorrelationHandle> 將傳訊活動結合在一起。</span><span class="sxs-lookup"><span data-stu-id="5d632-112">Activities that participate in correlation use a <xref:System.ServiceModel.Activities.CorrelationHandle> to tie the messaging activities together.</span></span> <span data-ttu-id="5d632-113">例如，用於呼叫服務的 <xref:System.ServiceModel.Activities.Send>，以及後續用於接收服務所傳回之回呼的 <xref:System.ServiceModel.Activities.Receive>，兩者會共用相同的 <xref:System.ServiceModel.Activities.CorrelationHandle>。</span><span class="sxs-lookup"><span data-stu-id="5d632-113">For example, a <xref:System.ServiceModel.Activities.Send> that is used to call a service and a subsequent <xref:System.ServiceModel.Activities.Receive> that is used to receive a callback from the service, share the same <xref:System.ServiceModel.Activities.CorrelationHandle>.</span></span> <span data-ttu-id="5d632-114">無論是以通訊協定為主或以內容為主的相互關聯，都會採用這個基本模式。</span><span class="sxs-lookup"><span data-stu-id="5d632-114">This basic pattern is used whether the correlation is content based or protocol based.</span></span> <span data-ttu-id="5d632-115">相互關聯控制代碼可在每個活動明確設定，或者可將所有活動包含在一個 <xref:System.ServiceModel.Activities.CorrelationScope> 活動中。</span><span class="sxs-lookup"><span data-stu-id="5d632-115">The correlation handle can be explicitly set on each activity or the activities can be contained in a <xref:System.ServiceModel.Activities.CorrelationScope> activity.</span></span> <span data-ttu-id="5d632-116">包含在 <xref:System.ServiceModel.Activities.CorrelationScope> 中的活動會將其相互關聯控制代碼交由 <xref:System.ServiceModel.Activities.CorrelationScope> 管理，而不需明確設定 <xref:System.ServiceModel.Activities.CorrelationHandle>。</span><span class="sxs-lookup"><span data-stu-id="5d632-116">Activities contained in a <xref:System.ServiceModel.Activities.CorrelationScope> have their correlation handles managed by the <xref:System.ServiceModel.Activities.CorrelationScope> and do not require the <xref:System.ServiceModel.Activities.CorrelationHandle> to be explicitly set.</span></span> <span data-ttu-id="5d632-117"><xref:System.ServiceModel.Activities.CorrelationScope> 範圍針對要求-回覆相互關聯及一個其他相互關聯類型提供 <xref:System.ServiceModel.Activities.CorrelationHandle> 管理。</span><span class="sxs-lookup"><span data-stu-id="5d632-117">A <xref:System.ServiceModel.Activities.CorrelationScope> scope provides <xref:System.ServiceModel.Activities.CorrelationHandle> management for a request-reply correlation and one additional correlation type.</span></span> <span data-ttu-id="5d632-118">使用 <xref:System.ServiceModel.Activities.WorkflowServiceHost> 裝載的工作流程服務與 <xref:System.ServiceModel.Activities.CorrelationScope> 活動具有相同的預設相互關聯管理。</span><span class="sxs-lookup"><span data-stu-id="5d632-118">Workflow services hosted using <xref:System.ServiceModel.Activities.WorkflowServiceHost> have the same default correlation management as the <xref:System.ServiceModel.Activities.CorrelationScope> activity.</span></span> <span data-ttu-id="5d632-119">這個預設相互關聯管理功能通常表示在許多情況下，<xref:System.ServiceModel.Activities.CorrelationScope> 或工作流程服務中的傳訊活動不需設定其 <xref:System.ServiceModel.Activities.CorrelationHandle>，除非有多個傳訊活動平行或重疊，例如兩個 <xref:System.ServiceModel.Activities.Receive> 活動平行，或者兩個 <xref:System.ServiceModel.Activities.Send> 活動之後緊接著兩個 <xref:System.ServiceModel.Activities.Receive> 活動。</span><span class="sxs-lookup"><span data-stu-id="5d632-119">This default correlation management generally means that in many scenarios, messaging activities in a <xref:System.ServiceModel.Activities.CorrelationScope> or a workflow service do not require their <xref:System.ServiceModel.Activities.CorrelationHandle> set unless multiple messaging activities are in parallel or overlap, such as two <xref:System.ServiceModel.Activities.Receive> activities in parallel, or two <xref:System.ServiceModel.Activities.Send> activities followed by two <xref:System.ServiceModel.Activities.Receive> activities.</span></span> <span data-ttu-id="5d632-120">本節中的主題提供更多關於預設相互關聯的資訊，其中包含相互關聯的每種特定類型。</span><span class="sxs-lookup"><span data-stu-id="5d632-120">More information about default correlation is provided in the topics in this section that cover each specific type of correlation.</span></span> <span data-ttu-id="5d632-121">如需訊息活動的詳細資訊，請參閱[訊息活動](messaging-activities.md)和[如何：使用訊息活動建立工作流程服務](how-to-create-a-workflow-service-with-messaging-activities.md)。</span><span class="sxs-lookup"><span data-stu-id="5d632-121">For more information about messaging activities see [Messaging Activities](messaging-activities.md) and [How to: Create a Workflow Service with Messaging Activities](how-to-create-a-workflow-service-with-messaging-activities.md).</span></span>  
  
## <a name="protocol-based-correlation"></a><span data-ttu-id="5d632-122">以通訊協定為主的相互關聯</span><span class="sxs-lookup"><span data-stu-id="5d632-122">Protocol-Based Correlation</span></span>

<span data-ttu-id="5d632-123">以通訊協定為主的相互關聯會使用傳輸機制將訊息彼此產生關聯性，以及將訊息與適當的執行個體產生關聯性。</span><span class="sxs-lookup"><span data-stu-id="5d632-123">Protocol-based correlation uses the transport mechanism to relate messages to each other and the appropriate instance.</span></span> <span data-ttu-id="5d632-124">某些由系統提供的通訊協定相互關聯會包含要求-回覆相互關聯，以及以內容為主的相互關聯。</span><span class="sxs-lookup"><span data-stu-id="5d632-124">Some system-provided protocol correlations include request-reply correlation and context-based correlation.</span></span> <span data-ttu-id="5d632-125">要求-回覆相互關聯用於將單獨一組的傳訊活動相互關聯，以形成雙向作業，例如 <xref:System.ServiceModel.Activities.Send> 搭配 <xref:System.ServiceModel.Activities.ReceiveReply>，或是 <xref:System.ServiceModel.Activities.Receive> 搭配 <xref:System.ServiceModel.Activities.SendReply>。</span><span class="sxs-lookup"><span data-stu-id="5d632-125">A request-reply correlation is used to correlate a single pair of messaging activities to form a two-way operation, such as a <xref:System.ServiceModel.Activities.Send> paired with a <xref:System.ServiceModel.Activities.ReceiveReply>, or a <xref:System.ServiceModel.Activities.Receive> paired with a <xref:System.ServiceModel.Activities.SendReply>.</span></span> <span data-ttu-id="5d632-126">Visual Studio 工作流程設計工具也會提供一組活動範本，以快速執行此模式。</span><span class="sxs-lookup"><span data-stu-id="5d632-126">The Visual Studio Workflow Designer also provides a set of activity templates to quickly implement this pattern.</span></span> <span data-ttu-id="5d632-127">以內容為基礎的相互關聯是以[.Net 內容交換通訊協定規格](https://docs.microsoft.com/openspecs/windows_protocols/mc-netcex/a7f26280-491f-465b-9914-c5eb5322dbb4)中描述的內容交換器制為基礎。</span><span class="sxs-lookup"><span data-stu-id="5d632-127">A context-based correlation is based on the context exchange mechanism described in the [.NET Context Exchange Protocol Specification](https://docs.microsoft.com/openspecs/windows_protocols/mc-netcex/a7f26280-491f-465b-9914-c5eb5322dbb4).</span></span> <span data-ttu-id="5d632-128">若要使用以內容為主的相互關聯，必須在端點上使用以內容為主的繫結，例如 <xref:System.ServiceModel.BasicHttpContextBinding>、<xref:System.ServiceModel.WSHttpContextBinding> 或 <xref:System.ServiceModel.NetTcpContextBinding>。</span><span class="sxs-lookup"><span data-stu-id="5d632-128">To use context-based correlation, a context-based binding such as <xref:System.ServiceModel.BasicHttpContextBinding>, <xref:System.ServiceModel.WSHttpContextBinding> or <xref:System.ServiceModel.NetTcpContextBinding> must be used on the endpoint.</span></span>  
  
<span data-ttu-id="5d632-129">如需有關通訊協定相互關聯的詳細資訊，請參閱永久性[雙工](durable-duplex-correlation.md)和[要求-回復](request-reply-correlation.md)。</span><span class="sxs-lookup"><span data-stu-id="5d632-129">For more information about protocol correlation, see [Durable Duplex](durable-duplex-correlation.md) and [Request-Reply](request-reply-correlation.md).</span></span> <span data-ttu-id="5d632-130">如需使用 Visual Studio 工作流程設計工具活動範本的詳細資訊，請參閱[訊息活動](messaging-activities.md)。</span><span class="sxs-lookup"><span data-stu-id="5d632-130">For more information about using the Visual Studio Workflow Designer activity templates, see [Messaging Activities](messaging-activities.md).</span></span> <span data-ttu-id="5d632-131">如需範例程式碼，請參閱[NetCoNtextExchangeCorrelation](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ee662963%28v%3dvs.100%29)範例。</span><span class="sxs-lookup"><span data-stu-id="5d632-131">For sample code, see the [NetContextExchangeCorrelation](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ee662963%28v%3dvs.100%29) sample.</span></span>  
  
## <a name="content-based-correlation"></a><span data-ttu-id="5d632-132">以內容為基礎的相互關聯</span><span class="sxs-lookup"><span data-stu-id="5d632-132">Content-Based Correlation</span></span>

<span data-ttu-id="5d632-133">以內容為基礎的相互關聯會利用訊息中的部分資訊片段，將其與特定執行個體產生關聯。</span><span class="sxs-lookup"><span data-stu-id="5d632-133">Content-based correlation uses some piece of information in the message to associate it to a particular instance.</span></span> <span data-ttu-id="5d632-134">不同於以通訊協定為主的相互關聯，以內容為主的相互關聯會要求應用程式作者明確陳述這項資料在每個相關訊息中的位置。</span><span class="sxs-lookup"><span data-stu-id="5d632-134">Unlike protocol-based correlation, content-based correlation requires the application author to explicitly state where this data can be found in each related message.</span></span> <span data-ttu-id="5d632-135">使用以內容為主的相互關聯的活動會使用 <xref:System.ServiceModel.MessageQuerySet> 來指定這項訊息資料。</span><span class="sxs-lookup"><span data-stu-id="5d632-135">Activities that use content-based correlation specify this message data by using a <xref:System.ServiceModel.MessageQuerySet>.</span></span> <span data-ttu-id="5d632-136">與不使用其中一種內容繫結 (例如 <xref:System.ServiceModel.BasicHttpContextBinding>) 的服務通訊時，以內容為基礎的相互關聯非常有用。</span><span class="sxs-lookup"><span data-stu-id="5d632-136">Content-based correlation is useful when communicating with services that do not use one of the context bindings such as <xref:System.ServiceModel.BasicHttpContextBinding>.</span></span>
  
## <a name="see-also"></a><span data-ttu-id="5d632-137">請參閱</span><span class="sxs-lookup"><span data-stu-id="5d632-137">See also</span></span>

- [<span data-ttu-id="5d632-138">NetContextExchangeCorrelation</span><span class="sxs-lookup"><span data-stu-id="5d632-138">NetContextExchangeCorrelation</span></span>](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ee662963%28v%3dvs.100%29)
