---
title: 延伸保護原則
ms.date: 03/30/2017
ms.assetid: e2616a10-317e-4c34-8023-0c015a80a82f
ms.openlocfilehash: b513eafecf9b5eaee49b5bc318b3f4bad71213a2
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/26/2020
ms.locfileid: "96281920"
---
# <a name="extended-protection-policy"></a><span data-ttu-id="d9ab5-102">延伸保護原則</span><span class="sxs-lookup"><span data-stu-id="d9ab5-102">Extended Protection Policy</span></span>

<span data-ttu-id="d9ab5-103">延伸保護是防止攔截式攻擊的一項安全性方案。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-103">Extended Protection is a security initiative for protecting against man-in-the-middle (MITM) attacks.</span></span> <span data-ttu-id="d9ab5-104">MITM 攻擊是一項安全性威脅，其方式為 MITM 取得用戶端的認證並將它轉送至伺服器。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-104">A MITM attack is a security threat in which a MITM takes a client’s credentials and forwards it to a server.</span></span>  
  
## <a name="demonstrates"></a><span data-ttu-id="d9ab5-105">示範</span><span class="sxs-lookup"><span data-stu-id="d9ab5-105">Demonstrates</span></span>  

 <span data-ttu-id="d9ab5-106">延伸保護</span><span class="sxs-lookup"><span data-stu-id="d9ab5-106">Extended protection</span></span>  
  
## <a name="discussion"></a><span data-ttu-id="d9ab5-107">討論</span><span class="sxs-lookup"><span data-stu-id="d9ab5-107">Discussion</span></span>  

 <span data-ttu-id="d9ab5-108">當應用程式使用 Kerberos、Digest 或 NTLM 透過 HTTPS 進行驗證時，首先會建立傳輸層安全性 (TLS) 通道，然後使用這個安全的通道進行驗證。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-108">When applications authenticate using Kerberos, Digest or NTLM using HTTPS, a Transport Level Security (TLS) channel is first established and then authentication takes place using the secure channel.</span></span> <span data-ttu-id="d9ab5-109">但是，SSL 所產生的工作階段金鑰與驗證期間產生的工作階段金鑰之間並無任何繫結。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-109">However, there is no binding between the session key generated by SSL and the session key generated during authentication.</span></span> <span data-ttu-id="d9ab5-110">任何 MITM 都可以在用戶端和伺服器之間自行建立，並且開始從用戶端轉送要求，甚至是在傳輸通道本身是安全的情況下進行，因為伺服器無從得知安全的通道是從用戶端或 MITM 所建立。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-110">Any MITM can establish itself between the client and the server and start forwarding the requests from the client, even when the transport channel itself is secure, because the server has no way of knowing whether the secure channel has been established from the client or a MITM.</span></span> <span data-ttu-id="d9ab5-111">這個案例中的解決方法是將外部 TLS 通道與內部驗證通道加以繫結，讓伺服器能夠偵測是否有 MITM。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-111">The solution in this scenario is to bind the outer TLS channel with the inner authentication channel such that the server can detect if there is a MITM.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="d9ab5-112">這個範例只有在裝載於 IIS 上時才能運作，無法在 Cassini (Visual Studio 程式開發伺服器) 上運作，因為 Cassini 不支援 HTTPS。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-112">This sample only works when hosted on IIS and cannot work on Cassini – Visual Studio Development Server because Cassini does not support HTTPS.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="d9ab5-113">這項功能目前僅於 Windows 7 上提供。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-113">This feature is currently only available on Windows 7.</span></span> <span data-ttu-id="d9ab5-114">以下為 Windows 7 專屬步驟。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-114">The following steps are specific to Windows 7.</span></span>  
  
#### <a name="to-set-up-build-and-run-the-sample"></a><span data-ttu-id="d9ab5-115">若要安裝、建置及執行範例</span><span class="sxs-lookup"><span data-stu-id="d9ab5-115">To set up, build, and run the sample</span></span>  
  
1. <span data-ttu-id="d9ab5-116">從 **主控台**、[ **新增/移除程式**]、[ **Windows 功能**] 安裝 Internet Information Services。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-116">Install Internet Information Services from **Control Panel**, **Add/Remove Programs**, **Windows Features**.</span></span>  
  
2. <span data-ttu-id="d9ab5-117">在 **Windows 功能**、 **Internet Information Services**、 **World Wide Web 服務**、**安全性** 和 **Windows 驗證** 中安裝 **windows 驗證**。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-117">Install **Windows Authentication** in **Windows Features**, **Internet Information Services**, **World Wide Web Services**, **Security**, and **Windows Authentication**.</span></span>  
  
3. <span data-ttu-id="d9ab5-118">在 **Windows 功能**、 **Microsoft .NET Framework 3.5.1** 和 **Windows Communication Foundation HTTP 啟用** Windows Communication Foundation 中安裝 **HTTP 啟用**。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-118">Install **Windows Communication Foundation HTTP Activation** in **Windows Features**, **Microsoft .NET Framework 3.5.1**, and **Windows Communication Foundation HTTP Activation**.</span></span>  
  
4. <span data-ttu-id="d9ab5-119">這個範例需由用戶端建立與伺服器之間的安全通道，所以必須有可從 Internet Information Services (IIS) 管理員進行安裝的伺服器憑證。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-119">This sample requires the client to establish a secure channel with the server, so it requires the presence of a server certificate which can be installed from Internet Information Services (IIS) Manager.</span></span>  
  
    1. <span data-ttu-id="d9ab5-120">開啟 IIS 管理員。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-120">Open IIS Manager.</span></span> <span data-ttu-id="d9ab5-121">開啟 [ **伺服器憑證**]，當選取根節點 (電腦名稱稱) 時，會出現在 [ **功能視圖** ] 索引標籤中。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-121">Open **Server certificates**, which appears in the **Feature View** tab when the root node (machine name) is selected.</span></span>  
  
    2. <span data-ttu-id="d9ab5-122">若要測試這個範例，請建立自我簽署憑證。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-122">For the purpose of testing this sample, create a self-signed certificate.</span></span> <span data-ttu-id="d9ab5-123">如果您不希望 Internet Explorer 出現憑證可能不安全的提示，請將此憑證安裝到 [受信任的根憑證授權單位] 存放區。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-123">If you do not want Internet Explorer to prompt you about the certificate not being secure, install the certificate in the Trusted Certificate Root authority store.</span></span>  
  
5. <span data-ttu-id="d9ab5-124">開啟 [預設網站] 的 [ **動作** ] 窗格。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-124">Open the **Actions** pane for the default Web site.</span></span> <span data-ttu-id="d9ab5-125">按一下 [ **編輯網站** **、系** 結]。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-125">Click **Edit Site**, **Bindings**.</span></span> <span data-ttu-id="d9ab5-126">加入 HTTPS 做為類型 (如果尚未存在)，並且使用連接埠號碼 443。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-126">Add HTTPS as a type if not already present, with port number 443.</span></span> <span data-ttu-id="d9ab5-127">指派上一個步驟中建立的 SSL 憑證。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-127">Assign the SSL certificate created in the preceding step.</span></span>  
  
6. <span data-ttu-id="d9ab5-128">建置服務。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-128">Build the service.</span></span> <span data-ttu-id="d9ab5-129">這樣會在 IIS 中建立一個虛擬目錄，並且視需要複製 Web 主控服務的 .dll、.svc 和 .config 檔案。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-129">This creates a virtual directory in IIS, and copies the .dll, .svc and .config files as required for the service to be Web hosted.</span></span>  
  
7. <span data-ttu-id="d9ab5-130">開啟 IIS 管理員。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-130">Open IIS Manager.</span></span> <span data-ttu-id="d9ab5-131">以滑鼠右鍵按一下在上一個步驟中建立 (**ExtendedProtection**) 的虛擬目錄。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-131">Right-click the virtual directory (**ExtendedProtection**), which was created in the preceding step.</span></span> <span data-ttu-id="d9ab5-132">選取 [ **轉換成應用程式**]。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-132">Select **Convert to Application**.</span></span>  
  
8. <span data-ttu-id="d9ab5-133">在 IIS 管理員中開啟此虛擬目錄的 **驗證** 模組，並啟用 **Windows 驗證**。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-133">Open the **Authentication** module in IIS Manager for this virtual directory and enable **Windows Authentication**.</span></span>  
  
9. <span data-ttu-id="d9ab5-134">在 [ **Windows 驗證**] 下開啟此虛擬目錄的 [ **Advanced Settings** ]，並將它設定為 [**必要**]。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-134">Open **Advanced Settings** under **Windows Authentication** for this virtual directory and set it to **Required**.</span></span>  
  
10. <span data-ttu-id="d9ab5-135">您可以從瀏覽器視窗存取 HTTPS URL 來測試服務 (提供完整網域名稱)。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-135">You can test the service by accessing the HTTPS URL from a browser window (Provide a fully-qualified domain name).</span></span> <span data-ttu-id="d9ab5-136">如果您想要從遠端電腦存取此 URL，請確定防火牆已開放所有傳入的 HTTP 和 HTTPS 連線。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-136">If you want to access this URL from a remote machine, make sure that the firewall is opened for all incoming HTTP and HTTPS connections.</span></span>  
  
11. <span data-ttu-id="d9ab5-137">開啟用戶端組態檔，並且為用戶端提供完整網域名稱，或是取代 `<<full_machine_name>>` 的端點位址屬性。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-137">Open the client configuration file and provide a fully-qualified domain name for the client or endpoint address attribute that replaces `<<full_machine_name>>`.</span></span>  
  
12. <span data-ttu-id="d9ab5-138">執行該用戶端。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-138">Run the client.</span></span> <span data-ttu-id="d9ab5-139">用戶端將與服務進行通訊，該服務會建立安全通道並且使用延伸保護。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-139">The client communicates with the service, which establishes a secure channel and uses extended protection.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="d9ab5-140">這些範例可能已安裝在您的電腦上。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-140">The samples may already be installed on your machine.</span></span> <span data-ttu-id="d9ab5-141">請先檢查下列 (預設) 目錄，然後再繼續。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-141">Check for the following (default) directory before continuing.</span></span>  
>
> `<InstallDrive>:\WF_WCF_Samples`  
>
> <span data-ttu-id="d9ab5-142">如果此目錄不存在，請移至 [Windows Communication Foundation (wcf) 並 Windows Workflow Foundation (適用于) 4 的 WF .NET Framework 範例](https://www.microsoft.com/download/details.aspx?id=21459) 下載所有 WINDOWS COMMUNICATION FOUNDATION 的 wcf (和 [!INCLUDE[wf1](../../../../includes/wf1-md.md)] 範例。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-142">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=21459) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="d9ab5-143">此範例位於下列目錄。</span><span class="sxs-lookup"><span data-stu-id="d9ab5-143">This sample is located in the following directory.</span></span>  
>
> `<InstallDrive>:\WF_WCF_Samples\WCF\Basic\Services\Security\ExtendedProtection`
