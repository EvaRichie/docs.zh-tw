---
title: '具有擴充保護的整合式 Windows 驗證 '
ms.date: 03/30/2017
ms.assetid: 81731998-d5e7-49e4-ad38-c8e6d01689d0
ms.openlocfilehash: d69471f4be0f102381dee4fc5037e8f8b0c625c3
ms.sourcegitcommit: ee5b798427f81237a3c23d1fd81fff7fdc21e8d3
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 05/28/2020
ms.locfileid: "84144847"
---
# <a name="integrated-windows-authentication-with-extended-protection"></a><span data-ttu-id="5983e-102">具有擴充保護的整合式 Windows 驗證 </span><span class="sxs-lookup"><span data-stu-id="5983e-102">Integrated Windows Authentication with Extended Protection</span></span>
<span data-ttu-id="5983e-103">已建立的增強功能會影響 <xref:System.Net> 中的 <xref:System.Net.HttpWebRequest>、<xref:System.Net.HttpListener>、<xref:System.Net.Mail.SmtpClient>、<xref:System.Net.Security.SslStream>、<xref:System.Net.Security.NegotiateStream> 和相關類別以及相關命名空間處理整合式 Windows 驗證的方式。</span><span class="sxs-lookup"><span data-stu-id="5983e-103">Enhancements were made that affect how integrated Windows authentication is handled by the <xref:System.Net.HttpWebRequest>, <xref:System.Net.HttpListener>, <xref:System.Net.Mail.SmtpClient>, <xref:System.Net.Security.SslStream>, <xref:System.Net.Security.NegotiateStream>, and related classes in the <xref:System.Net> and related namespaces.</span></span> <span data-ttu-id="5983e-104">為加強安全性，擴充保護已新增支援。</span><span class="sxs-lookup"><span data-stu-id="5983e-104">Support was added for extended protection to enhance security.</span></span>  
  
 <span data-ttu-id="5983e-105">這些變更可能會影響使用這些類別提出 Web 要求並接收回應的應用程式，它們使用整合式 Windows 驗證。</span><span class="sxs-lookup"><span data-stu-id="5983e-105">These changes can affect applications that use these classes to make web requests and receive responses where integrated Windows authentication is used.</span></span> <span data-ttu-id="5983e-106">這項變更也會影響設定成使用整合式 Windows 驗證的網頁伺服器和用戶端應用程式。</span><span class="sxs-lookup"><span data-stu-id="5983e-106">This change can also impact web servers and client applications that are configured to use integrated Windows authentication.</span></span>  
  
 <span data-ttu-id="5983e-107">這些變更也會影響使用這些類別提出其他類型要求並接收回應的應用程式，它們使用整合式 Windows 驗證。</span><span class="sxs-lookup"><span data-stu-id="5983e-107">These changes can also affect applications that use these classes to make other types of requests and receive responses where integrated Windows authentication is used.</span></span>  
  
 <span data-ttu-id="5983e-108">支援擴充保護的變更僅供 Windows 7 和 Windows Server 2008 R2 的應用程式使用。</span><span class="sxs-lookup"><span data-stu-id="5983e-108">The changes to support extended protection are available only for applications on Windows 7 and Windows Server 2008 R2.</span></span> <span data-ttu-id="5983e-109">舊版 Windows 無法使用擴充保護的功能。</span><span class="sxs-lookup"><span data-stu-id="5983e-109">The extended protection features are not available on earlier versions of Windows.</span></span>  
  
## <a name="overview"></a><span data-ttu-id="5983e-110">概觀</span><span class="sxs-lookup"><span data-stu-id="5983e-110">Overview</span></span>  
 <span data-ttu-id="5983e-111">整合式 Windows 驗證的設計可讓某些認證的挑戰回應成為通用的，這表示可以重複使用或轉寄它們。</span><span class="sxs-lookup"><span data-stu-id="5983e-111">The design of integrated Windows authentication allows for some credential challenge responses to be universal, meaning they can be re-used or forwarded.</span></span> <span data-ttu-id="5983e-112">挑戰回應至少應該使用目標特定資訊建構，最好也能使用某些通道特定資訊。</span><span class="sxs-lookup"><span data-stu-id="5983e-112">The challenge responses should be constructed at a minimum with target specific information and preferably also with some channel specific information.</span></span> <span data-ttu-id="5983e-113">服務隨後可以提供擴充保護，確保認證的挑戰回應包含服務特定資訊，例如服務主體名稱 (SPN)。</span><span class="sxs-lookup"><span data-stu-id="5983e-113">Services can then provide extended protection to ensure that credential challenge responses contain service specific information such as a Service Principal Name (SPN).</span></span> <span data-ttu-id="5983e-114">在認證交換時利用此資訊，服務就能進一步免於惡意使用可能未正確使用的認證挑戰回應。</span><span class="sxs-lookup"><span data-stu-id="5983e-114">With this information in the credential exchanges, services are able to better protect against malicious use of credential challenge responses that might have been improperly used.</span></span>  
  
 <span data-ttu-id="5983e-115">擴充保護旨在增強驗證通訊協定，以強化其降低驗證轉送攻擊的功能。</span><span class="sxs-lookup"><span data-stu-id="5983e-115">The extended protection design is an enhancement to authentication protocols designed to mitigate authentication relay attacks.</span></span> <span data-ttu-id="5983e-116">它會圍繞著通道和服務繫結資訊的概念打轉。</span><span class="sxs-lookup"><span data-stu-id="5983e-116">It revolves around the concept of channel and service binding information.</span></span>  
  
 <span data-ttu-id="5983e-117">整體目標如下：</span><span class="sxs-lookup"><span data-stu-id="5983e-117">The overall objectives are the following:</span></span>  
  
1. <span data-ttu-id="5983e-118">如已更新用戶端支援擴充保護，應用程式應該向所有支援的驗證通訊協定提供通道繫結和服務繫結資訊。</span><span class="sxs-lookup"><span data-stu-id="5983e-118">If the client is updated to support the extended protection, applications should supply a channel binding and service binding information to all supported authentication protocols.</span></span> <span data-ttu-id="5983e-119">有要繫結的通道 (TLS) 時，只能提供通道繫結資訊。</span><span class="sxs-lookup"><span data-stu-id="5983e-119">Channel binding information can only be supplied when there is a channel (TLS) to bind to.</span></span> <span data-ttu-id="5983e-120">應該一律提供服務繫結資訊。</span><span class="sxs-lookup"><span data-stu-id="5983e-120">Service binding information should always be supplied.</span></span>  
  
2. <span data-ttu-id="5983e-121">已正確設定的更新伺服器可能會在當它出現於用戶端驗證權杖時，驗證通道和服務繫結資訊，並在通道繫結不相符時，拒絕驗證嘗試。</span><span class="sxs-lookup"><span data-stu-id="5983e-121">Updated servers which are properly configured may verify the channel and service binding information when it is present in the client authentication token and reject the authentication attempt if the channel bindings do not match.</span></span> <span data-ttu-id="5983e-122">根據部署案例，伺服器可能會驗證通道繫結、服務繫結或兩者都驗證。</span><span class="sxs-lookup"><span data-stu-id="5983e-122">Depending on the deployment scenario, servers may verify channel binding, service binding or both.</span></span>  
  
3. <span data-ttu-id="5983e-123">更新的伺服器能夠接受或拒絕下層用戶端要求，這些要求不包含以原則為基礎的通道繫結資訊。</span><span class="sxs-lookup"><span data-stu-id="5983e-123">Updated servers have the ability to accept or reject down-level client requests that do not contain the channel binding information based on policy.</span></span>  
  
 <span data-ttu-id="5983e-124">擴充保護所使用的資訊，是由下列兩個部分的其中之一或全部所組成：</span><span class="sxs-lookup"><span data-stu-id="5983e-124">Information used by extended protection consists of one or both of the following two parts:</span></span>  
  
1. <span data-ttu-id="5983e-125">通道繫結權杖或 CBT。</span><span class="sxs-lookup"><span data-stu-id="5983e-125">A Channel Binding Token or CBT.</span></span>  
  
2. <span data-ttu-id="5983e-126">使用服務主體名稱或 SPN 格式的服務繫結資訊。</span><span class="sxs-lookup"><span data-stu-id="5983e-126">Service Binding information in the form of a Service Principal Name or SPN.</span></span>  
  
 <span data-ttu-id="5983e-127">服務繫結資訊會指出用戶端意圖驗證特定的服務端點。</span><span class="sxs-lookup"><span data-stu-id="5983e-127">Service Binding information is an indication of a client’s intent to authenticate to a particular service endpoint.</span></span> <span data-ttu-id="5983e-128">用戶端與伺服器之間的通訊使用下列屬性：</span><span class="sxs-lookup"><span data-stu-id="5983e-128">It is communicated from client to server with the following properties:</span></span>  
  
- <span data-ttu-id="5983e-129">以純文字格式執行用戶端驗證的伺服器必須能夠取得 SPN 值。</span><span class="sxs-lookup"><span data-stu-id="5983e-129">The SPN value must be available to the server performing client authentication in clear text form.</span></span>  
  
- <span data-ttu-id="5983e-130">SPN 的值是公用的。</span><span class="sxs-lookup"><span data-stu-id="5983e-130">The value of the SPN is public.</span></span>  
  
- <span data-ttu-id="5983e-131">SPN 在傳輸中必須以密碼編譯方式保護，令攔截式攻擊無法插入、移除或修改其值。</span><span class="sxs-lookup"><span data-stu-id="5983e-131">The SPN must be cryptographically protected in transit such that a man-in-the-middle attack cannot insert, remove or modify its value.</span></span>  
  
 <span data-ttu-id="5983e-132">CBT 是外部安全通道 (例如 TLS) 的屬性，透過內部、用戶端驗證型的通道用來繫結 (bind) 至交談。</span><span class="sxs-lookup"><span data-stu-id="5983e-132">A CBT is a property of the outer secure channel (such as TLS) used to tie (bind) it to a conversation over an inner, client-authenticated channel.</span></span> <span data-ttu-id="5983e-133">CBT 必須具有下列屬性 (也由 IETF RFC 5056 定義)：</span><span class="sxs-lookup"><span data-stu-id="5983e-133">The CBT must have the following properties (also defined by IETF RFC 5056):</span></span>  
  
- <span data-ttu-id="5983e-134">有外部通道存在時，CBT 的值必須是能識別外部通道或伺服器端點的屬性，獨立抵達交談的用戶端和伺服器端。</span><span class="sxs-lookup"><span data-stu-id="5983e-134">When an outer channel exists, the value of the CBT must be a property identifying either the outer channel or the server endpoint, independently arrived at by both client and server sides of a conversation.</span></span>  
  
- <span data-ttu-id="5983e-135">用戶端傳送的 CBT 值絕不能是會受攻擊者影響的項目。</span><span class="sxs-lookup"><span data-stu-id="5983e-135">Value of the CBT sent by the client must not be something an attacker can influence.</span></span>  
  
- <span data-ttu-id="5983e-136">不保證 CBT 值的保密性。</span><span class="sxs-lookup"><span data-stu-id="5983e-136">No guarantees are made about secrecy of the CBT value.</span></span> <span data-ttu-id="5983e-137">但這不表示，當帶有 CBT 的通訊協定可能加密它時，伺服器執行驗證以外的任何其他驗證一律可以檢查服務繫結的值以及通道繫結資訊。</span><span class="sxs-lookup"><span data-stu-id="5983e-137">This does not however mean that the value of the service binding as well as channel binding information can always be examined by any other but the server performing authentication, as the protocol carrying the CBT may be encrypting it.</span></span>  
  
- <span data-ttu-id="5983e-138">CBT 在傳輸中必須受到密碼編譯式的完整性保護，令攻擊者無法插入、移除或修改其值。</span><span class="sxs-lookup"><span data-stu-id="5983e-138">The CBT must be cryptographically integrity protected in transit such that an attacker cannot insert, remove or modify its value.</span></span>  
  
 <span data-ttu-id="5983e-139">透過用戶端將 SPN 和 CBT 以防竄改方式傳送到伺服器，即完成通道繫結。</span><span class="sxs-lookup"><span data-stu-id="5983e-139">Channel binding is accomplished by the client transferring the SPN and the CBT to the server in a tamperproof fashion.</span></span> <span data-ttu-id="5983e-140">伺服器驗證通道繫結資訊是否與其原則一致，拒絕它本身不認為是預期目標的驗證嘗試。</span><span class="sxs-lookup"><span data-stu-id="5983e-140">The server validates the channel binding information in accordance with its policy and rejects authentication attempts for which it does not believe itself to have been the intended target.</span></span> <span data-ttu-id="5983e-141">如此一來，兩個通道就會以密碼編譯方式繫結在一起。</span><span class="sxs-lookup"><span data-stu-id="5983e-141">This way, the two channels become cryptographically bound together.</span></span>  
  
 <span data-ttu-id="5983e-142">為保留現有用戶端和應用程式的相容性，您可設定伺服器允許尚不支援擴充保護的用戶端嘗試驗證。</span><span class="sxs-lookup"><span data-stu-id="5983e-142">To preserve compatibility with existing clients and applications, a server may be configured to allow authentication attempts by clients that do not yet support extended protection.</span></span> <span data-ttu-id="5983e-143">相較於「完全強化」組態，這稱為「部分強化」組態。</span><span class="sxs-lookup"><span data-stu-id="5983e-143">This is referred to as a "partially hardened" configuration, in contrast to a "fully hardened" configuration.</span></span>  
  
 <span data-ttu-id="5983e-144"><xref:System.Net> 和 <xref:System.Net.Security> 命名空間中的多個元件都會代表呼叫端應用程式執行整合式 Windows 驗證。</span><span class="sxs-lookup"><span data-stu-id="5983e-144">Multiple components in the <xref:System.Net> and <xref:System.Net.Security> namespaces perform integrated Windows authentication on behalf of a calling application.</span></span> <span data-ttu-id="5983e-145">本節描述在使用整合式 Windows 驗證時新增擴充保護的 System.Net 元件變更。</span><span class="sxs-lookup"><span data-stu-id="5983e-145">This section describes changes to System.Net components to add extended protection in their use of integrated Windows authentication.</span></span>  
  
 <span data-ttu-id="5983e-146">Windows 7 目前支援的擴充保護。</span><span class="sxs-lookup"><span data-stu-id="5983e-146">Extended protection is currently supported on Windows 7.</span></span> <span data-ttu-id="5983e-147">提供一種機制，讓應用程式可以判斷作業系統是否支援擴充保護。</span><span class="sxs-lookup"><span data-stu-id="5983e-147">A mechanism is provided so an application can determine if the operating system supports extended protection.</span></span>  
  
## <a name="changes-to-support-extended-protection"></a><span data-ttu-id="5983e-148">支援擴充保護的變更</span><span class="sxs-lookup"><span data-stu-id="5983e-148">Changes to Support Extended Protection</span></span>  
 <span data-ttu-id="5983e-149">與整合式 Windows 驗證搭配使用的驗證程序，視所用的驗證通訊協定而定，通常包含目的地電腦所發出並傳回給用戶端電腦的挑戰。</span><span class="sxs-lookup"><span data-stu-id="5983e-149">The authentication process used with integrated Windows authentication, depending on the authentication protocol used, often includes a challenge issued by the destination computer and sent back to the client computer.</span></span> <span data-ttu-id="5983e-150">擴充的保護會在此驗證程序中新增功能</span><span class="sxs-lookup"><span data-stu-id="5983e-150">Extended protection adds new features to this authentication process</span></span>  
  
 <span data-ttu-id="5983e-151"><xref:System.Security.Authentication.ExtendedProtection> 命名空間支援應用程式使用擴充保護進行驗證。</span><span class="sxs-lookup"><span data-stu-id="5983e-151">The <xref:System.Security.Authentication.ExtendedProtection> namespace provides support for authentication using extended protection for applications.</span></span> <span data-ttu-id="5983e-152">這個命名空間中的 <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding> 類別代表通道繫結。</span><span class="sxs-lookup"><span data-stu-id="5983e-152">The <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding> class in this namespace represents a channel binding.</span></span> <span data-ttu-id="5983e-153">命名空間的 <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> 類別代表伺服器用於驗證傳入用戶端連接的擴充保護原則。</span><span class="sxs-lookup"><span data-stu-id="5983e-153">The <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> class in this namespace represents the extended protection policy used by the server to validate incoming client connections.</span></span> <span data-ttu-id="5983e-154">其他類別成員是搭配擴充保護使用。</span><span class="sxs-lookup"><span data-stu-id="5983e-154">Other class members are used with extended protection.</span></span>  
  
 <span data-ttu-id="5983e-155">就伺服器應用程式而言，這些類別包括下列：</span><span class="sxs-lookup"><span data-stu-id="5983e-155">For server applications, these classes include the following:</span></span>  
  
 <span data-ttu-id="5983e-156"><xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy>，具有下列項目：</span><span class="sxs-lookup"><span data-stu-id="5983e-156">A <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> that has the following elements:</span></span>  
  
- <span data-ttu-id="5983e-157"><xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy.OSSupportsExtendedProtection%2A> 屬性，指出作業系統是否支援使用擴充保護的整合式 Windows 驗證。</span><span class="sxs-lookup"><span data-stu-id="5983e-157">An <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy.OSSupportsExtendedProtection%2A> property that indicates whether the operating system supports integrated windows authentication with extended protection.</span></span>  
  
- <span data-ttu-id="5983e-158"><xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement> 值，指出應該在何時強制執行延伸的保護原則。</span><span class="sxs-lookup"><span data-stu-id="5983e-158">A <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement> value that indicates when the extended protection policy should be enforced.</span></span>  
  
- <span data-ttu-id="5983e-159"><xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario> 值，指出部署案例。</span><span class="sxs-lookup"><span data-stu-id="5983e-159">A <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario> value that indicates the deployment scenario.</span></span> <span data-ttu-id="5983e-160">這會影響檢查擴充保護的方式。</span><span class="sxs-lookup"><span data-stu-id="5983e-160">This influences how extended protection is checked.</span></span>  
  
- <span data-ttu-id="5983e-161">選擇性的 <xref:System.Security.Authentication.ExtendedProtection.ServiceNameCollection>，其包含的自訂 SPN 清單，是用來比對用戶端提供為預期驗證目標的 SPN。</span><span class="sxs-lookup"><span data-stu-id="5983e-161">An optional <xref:System.Security.Authentication.ExtendedProtection.ServiceNameCollection> that contains the custom SPN list that is used to match against the SPN provided by the client as the intended target of the authentication.</span></span>  
  
- <span data-ttu-id="5983e-162">選擇性的 <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding>，包含的自訂通道繫結可用於驗證。</span><span class="sxs-lookup"><span data-stu-id="5983e-162">An optional <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding> that contains a custom channel binding to use for validation.</span></span> <span data-ttu-id="5983e-163">此案例不是常見案例</span><span class="sxs-lookup"><span data-stu-id="5983e-163">This scenario is not a common case</span></span>  
  
 <span data-ttu-id="5983e-164"><xref:System.Security.Authentication.ExtendedProtection.Configuration> 命名空間支援應用程式使用擴充保護的驗證組態。</span><span class="sxs-lookup"><span data-stu-id="5983e-164">The <xref:System.Security.Authentication.ExtendedProtection.Configuration> namespace provides support for configuration of authentication using extended protection for applications.</span></span>  
  
 <span data-ttu-id="5983e-165">已進行一些功能變更，以支援現有 <xref:System.Net> 命名空間中的擴充保護。</span><span class="sxs-lookup"><span data-stu-id="5983e-165">A number of feature changes were made to support extended protection in the existing <xref:System.Net> namespace.</span></span> <span data-ttu-id="5983e-166">這些變更包括下列幾項：</span><span class="sxs-lookup"><span data-stu-id="5983e-166">These changes include the following:</span></span>  
  
- <span data-ttu-id="5983e-167">新的 <xref:System.Net.TransportContext> 類別新增至表示傳輸內容的 <xref:System.Net> 命名空間。</span><span class="sxs-lookup"><span data-stu-id="5983e-167">A new <xref:System.Net.TransportContext> class added to the <xref:System.Net> namespace that represents a transport context.</span></span>  
  
- <span data-ttu-id="5983e-168"><xref:System.Net.HttpWebRequest> 類別中的新 <xref:System.Net.HttpWebRequest.EndGetRequestStream%2A> 和 <xref:System.Net.HttpWebRequest.GetRequestStream%2A> 多載方法，可讓您擷取 <xref:System.Net.TransportContext> 以支援用戶端應用程式的擴充保護。</span><span class="sxs-lookup"><span data-stu-id="5983e-168">New <xref:System.Net.HttpWebRequest.EndGetRequestStream%2A> and <xref:System.Net.HttpWebRequest.GetRequestStream%2A> overload methods in the <xref:System.Net.HttpWebRequest> class that allow retrieving the <xref:System.Net.TransportContext> to support extended protection for client applications.</span></span>  
  
- <span data-ttu-id="5983e-169">新增 <xref:System.Net.HttpListener> 和 <xref:System.Net.HttpListenerRequest> 類別以支援伺服器應用程式。</span><span class="sxs-lookup"><span data-stu-id="5983e-169">Additions to the <xref:System.Net.HttpListener> and <xref:System.Net.HttpListenerRequest> classes to support server applications.</span></span>  
  
 <span data-ttu-id="5983e-170">已進行一項功能變更，以支援現有 <xref:System.Net.Mail> 命名空間中的 SMTP 用戶端應用程式的擴充保護：</span><span class="sxs-lookup"><span data-stu-id="5983e-170">A feature change was made to support extended protection for SMTP client applications in the existing <xref:System.Net.Mail> namespace:</span></span>  
  
- <span data-ttu-id="5983e-171"><xref:System.Net.Mail.SmtpClient> 類別中的 <xref:System.Net.Mail.SmtpClient.TargetName%2A> 屬性，代表使用 SMTP 用戶端應用程式的擴充保護時，用於驗證的 SPN。</span><span class="sxs-lookup"><span data-stu-id="5983e-171">A <xref:System.Net.Mail.SmtpClient.TargetName%2A> property in the <xref:System.Net.Mail.SmtpClient> class that represents the SPN to use for authentication when using extended protection for SMTP client applications.</span></span>  
  
 <span data-ttu-id="5983e-172">已進行一些功能變更，以支援現有 <xref:System.Net.Security> 命名空間中的擴充保護。</span><span class="sxs-lookup"><span data-stu-id="5983e-172">A number of feature changes were made to support extended protection in the existing <xref:System.Net.Security> namespace.</span></span> <span data-ttu-id="5983e-173">這些變更包括下列幾項：</span><span class="sxs-lookup"><span data-stu-id="5983e-173">These changes include the following:</span></span>  
  
- <span data-ttu-id="5983e-174"><xref:System.Net.Security.NegotiateStream> 類別中的新 <xref:System.Net.Security.NegotiateStream.BeginAuthenticateAsClient%2A> 和 <xref:System.Net.Security.NegotiateStream.AuthenticateAsClient%2A> 多載方法，允許傳送 CBT 以支援用戶端應用程式的擴充保護。</span><span class="sxs-lookup"><span data-stu-id="5983e-174">New <xref:System.Net.Security.NegotiateStream.BeginAuthenticateAsClient%2A> and <xref:System.Net.Security.NegotiateStream.AuthenticateAsClient%2A> overload methods in the <xref:System.Net.Security.NegotiateStream> class that allow passing a CBT to support extended protection for client applications.</span></span>  
  
- <span data-ttu-id="5983e-175"><xref:System.Net.Security.NegotiateStream> 類別中的新 <xref:System.Net.Security.NegotiateStream.BeginAuthenticateAsServer%2A> 和 <xref:System.Net.Security.NegotiateStream.AuthenticateAsServer%2A> 多載方法，允許傳送 <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> 以支援伺服器應用程式的擴充保護。</span><span class="sxs-lookup"><span data-stu-id="5983e-175">New <xref:System.Net.Security.NegotiateStream.BeginAuthenticateAsServer%2A> and <xref:System.Net.Security.NegotiateStream.AuthenticateAsServer%2A> overload methods in the <xref:System.Net.Security.NegotiateStream> class that allow passing an <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> to support extended protection for server applications.</span></span>  
  
- <span data-ttu-id="5983e-176"><xref:System.Net.Security.SslStream> 類別的新 <xref:System.Net.Security.SslStream.TransportContext%2A> 屬性，支援用戶端和伺服器應用程式的擴充保護。</span><span class="sxs-lookup"><span data-stu-id="5983e-176">A new <xref:System.Net.Security.SslStream.TransportContext%2A> property in the <xref:System.Net.Security.SslStream> class to support extended protection for client and server applications.</span></span>  
  
 <span data-ttu-id="5983e-177">已新增 <xref:System.Net.Configuration.SmtpNetworkElement> 屬性，支援 <xref:System.Net.Security> 命名空間中 SMTP 用戶端擴充保護的組態。</span><span class="sxs-lookup"><span data-stu-id="5983e-177">A <xref:System.Net.Configuration.SmtpNetworkElement> property was added to support configuration of extended protection for SMTP clients in the <xref:System.Net.Security> namespace.</span></span>  
  
## <a name="extended-protection-for-client-applications"></a><span data-ttu-id="5983e-178">用戶端應用程式的擴充保護</span><span class="sxs-lookup"><span data-stu-id="5983e-178">Extended Protection for Client Applications</span></span>  
 <span data-ttu-id="5983e-179">大部分用戶端應用程式的擴充保護支援都會自動發生。</span><span class="sxs-lookup"><span data-stu-id="5983e-179">Extended protection support for most client applications happens automatically.</span></span> <span data-ttu-id="5983e-180">只要 Windows 基礎版本支援擴充保護，<xref:System.Net.HttpWebRequest> 和 <xref:System.Net.Mail.SmtpClient> 類別就支援擴充保護。</span><span class="sxs-lookup"><span data-stu-id="5983e-180">The <xref:System.Net.HttpWebRequest> and <xref:System.Net.Mail.SmtpClient> classes support extended protection whenever the underlying version of Windows supports extended protection.</span></span> <span data-ttu-id="5983e-181"><xref:System.Net.HttpWebRequest> 執行個體傳送從 <xref:System.Uri> 建構的 SPN。</span><span class="sxs-lookup"><span data-stu-id="5983e-181">An <xref:System.Net.HttpWebRequest> instance sends an SPN constructed from the <xref:System.Uri>.</span></span> <span data-ttu-id="5983e-182">根據預設，<xref:System.Net.Mail.SmtpClient> 執行個體會傳送從 SMTP 郵件伺服器主機名稱建構的 SPN。</span><span class="sxs-lookup"><span data-stu-id="5983e-182">By default, an <xref:System.Net.Mail.SmtpClient> instance sends an SPN constructed from the host name of the SMTP mail server.</span></span>  
  
 <span data-ttu-id="5983e-183">針對自訂驗證，用戶端應用程式可以使用 <xref:System.Net.HttpWebRequest> 類別的 <xref:System.Net.HttpWebRequest.EndGetRequestStream%28System.IAsyncResult%2CSystem.Net.TransportContext%40%29?displayProperty=nameWithType> 或 <xref:System.Net.HttpWebRequest.GetRequestStream%28System.Net.TransportContext%40%29?displayProperty=nameWithType> 方法，允許擷取 <xref:System.Net.TransportContext> 和使用 <xref:System.Net.TransportContext.GetChannelBinding%2A> 方法的 CBT。</span><span class="sxs-lookup"><span data-stu-id="5983e-183">For custom authentication, client applications can use the <xref:System.Net.HttpWebRequest.EndGetRequestStream%28System.IAsyncResult%2CSystem.Net.TransportContext%40%29?displayProperty=nameWithType> or <xref:System.Net.HttpWebRequest.GetRequestStream%28System.Net.TransportContext%40%29?displayProperty=nameWithType> methods in the <xref:System.Net.HttpWebRequest> class that allow retrieving the <xref:System.Net.TransportContext> and the CBT using the <xref:System.Net.TransportContext.GetChannelBinding%2A> method.</span></span>  
  
 <span data-ttu-id="5983e-184"><xref:System.Net.HttpWebRequest> 執行個體傳送至指定服務用於整合式 Windows 驗證的 SPN，可藉由設定 <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A> 屬性予以覆寫。</span><span class="sxs-lookup"><span data-stu-id="5983e-184">The SPN to use for integrated Windows authentication sent by an <xref:System.Net.HttpWebRequest> instance to a given service can be overridden by setting the <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A> property.</span></span>  
  
 <span data-ttu-id="5983e-185"><xref:System.Net.Mail.SmtpClient.TargetName%2A> 屬性可用來設定自訂的 SPN，用於 SMTP 連線的整合式 Windows 驗證。</span><span class="sxs-lookup"><span data-stu-id="5983e-185">The <xref:System.Net.Mail.SmtpClient.TargetName%2A> property can be used to set a custom SPN to use for integrated Windows authentication for the SMTP connection.</span></span>  
  
## <a name="extended-protection-for-server-applications"></a><span data-ttu-id="5983e-186">伺服器應用程式的擴充保護</span><span class="sxs-lookup"><span data-stu-id="5983e-186">Extended Protection for Server Applications</span></span>  
 <span data-ttu-id="5983e-187"><xref:System.Net.HttpListener> 會在執行 HTTP 驗證時，自動提供驗證服務繫結的機制。</span><span class="sxs-lookup"><span data-stu-id="5983e-187"><xref:System.Net.HttpListener> automatically provides mechanisms for validating service bindings when performing HTTP authentication.</span></span>  
  
 <span data-ttu-id="5983e-188">最安全的案例是啟用首碼的擴充保護 `HTTPS://` 。</span><span class="sxs-lookup"><span data-stu-id="5983e-188">The most secure scenario is to enable extended protection for `HTTPS://` prefixes.</span></span> <span data-ttu-id="5983e-189">在本例中，將 <xref:System.Net.HttpListener.ExtendedProtectionPolicy%2A?displayProperty=nameWithType> 設定成將 <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement> 設成 <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> 或 <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> 的 <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy>，以及 <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario> 設成 <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario.TransportSelected>。值 <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> 會將 <xref:System.Net.HttpListener> 置於部分強化模式中，而 <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> 則對應到完全強化模式。</span><span class="sxs-lookup"><span data-stu-id="5983e-189">In this case, set <xref:System.Net.HttpListener.ExtendedProtectionPolicy%2A?displayProperty=nameWithType> to an <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> with <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement> set to <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> or <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always>, and <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario> set to <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario.TransportSelected> A value of  <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> puts <xref:System.Net.HttpListener> in partially hardened mode, while <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> corresponds to fully hardened mode.</span></span>  
  
 <span data-ttu-id="5983e-190">在此組態中，當透過外部安全通道向伺服器提出要求時，會查詢外部通道是否有通道繫結。</span><span class="sxs-lookup"><span data-stu-id="5983e-190">In this configuration when a request is made to the server through an outer secure channel, the outer channel is queried for a channel binding.</span></span> <span data-ttu-id="5983e-191">此通道繫結會傳遞給驗證 SSPI 呼叫，確認驗證 Blob 中的通道繫結是否相符。</span><span class="sxs-lookup"><span data-stu-id="5983e-191">This channel binding is passed to the authentication SSPI calls, which validate that the channel binding in the authentication blob matches.</span></span> <span data-ttu-id="5983e-192">有三個可能的結果：</span><span class="sxs-lookup"><span data-stu-id="5983e-192">There are three possible outcomes:</span></span>  
  
1. <span data-ttu-id="5983e-193">伺服器的基礎作業系統不支援擴充的保護。</span><span class="sxs-lookup"><span data-stu-id="5983e-193">The server’s underlying operating system does not support extended protection.</span></span> <span data-ttu-id="5983e-194">要求不會向應用程式公開，且未經授權的 (401) 回應會傳回至用戶端。</span><span class="sxs-lookup"><span data-stu-id="5983e-194">The request will not be exposed to the application, and an unauthorized (401) response will be returned to the client.</span></span> <span data-ttu-id="5983e-195">記錄到 <xref:System.Net.HttpListener> 追蹤來源的訊息會指定失敗的原因。</span><span class="sxs-lookup"><span data-stu-id="5983e-195">A message will be logged to the <xref:System.Net.HttpListener> trace source specifying the reason for the failure.</span></span>  
  
2. <span data-ttu-id="5983e-196">SSPI 呼叫失敗，表示可能是用戶端指定的通道繫結不符合從外部通道擷取的預期值，或針對 <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> 在伺服器上設定擴充保護原則時，用戶端無法提供通道繫結。</span><span class="sxs-lookup"><span data-stu-id="5983e-196">The SSPI call fails indicating that either the client specified a channel binding that did not match the expected value retrieved from the outer channel or the client failed to supply a channel binding when the extended protection policy on the server was configured for <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always>.</span></span> <span data-ttu-id="5983e-197">這兩種情況下，要求都不會向應用程式公開，且未經授權的 (401) 回應會傳回至用戶端。</span><span class="sxs-lookup"><span data-stu-id="5983e-197">In both cases, the request will not be exposed to the application, and an unauthorized (401) response will be returned to the client.</span></span> <span data-ttu-id="5983e-198">記錄到 <xref:System.Net.HttpListener> 追蹤來源的訊息會指定失敗的原因。</span><span class="sxs-lookup"><span data-stu-id="5983e-198">A message will be logged to the <xref:System.Net.HttpListener> trace source specifying the reason for the failure.</span></span>  
  
3. <span data-ttu-id="5983e-199">用戶端指定了正確的通道繫結，或允許連接但未指定通道繫結，因為伺服器上使用 <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> 設定擴充保護原則。要求會傳回應用程式處理。</span><span class="sxs-lookup"><span data-stu-id="5983e-199">The client specifies the correct channel binding or is allowed to connect without specifying a channel binding since the extended protection policy on the server is configured with <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> The request is returned to the application for processing.</span></span> <span data-ttu-id="5983e-200">不會自動執行服務名稱檢查。</span><span class="sxs-lookup"><span data-stu-id="5983e-200">No service name check is performed automatically.</span></span> <span data-ttu-id="5983e-201">應用程式可選擇執行它自己使用 <xref:System.Net.HttpListenerRequest.ServiceName%2A> 屬性的服務名稱驗證，但在這些情況下會重複。</span><span class="sxs-lookup"><span data-stu-id="5983e-201">An application may choose to perform its own service name validation using the <xref:System.Net.HttpListenerRequest.ServiceName%2A> property, but under these circumstances it is redundant.</span></span>  
  
 <span data-ttu-id="5983e-202">如果應用程式進行自己的 SSPI 呼叫，執行以在 HTTP 要求主體內來回傳遞的 Blob 為基礎的驗證，而且想要支援通道繫結，它需要從使用 <xref:System.Net.HttpListener> 的外部安全通道擷取預期的通道繫結，才能將它傳遞給原生的 Win32 [AcceptSecurityContext](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) 函式。</span><span class="sxs-lookup"><span data-stu-id="5983e-202">If an application makes its own SSPI calls to perform authentication based on blobs passed back and forth within the body of an HTTP request and wishes to support channel binding, it needs to retrieve the expected channel binding from the outer secure channel using <xref:System.Net.HttpListener> in order to pass it to native Win32 [AcceptSecurityContext](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) function.</span></span> <span data-ttu-id="5983e-203">若要這樣做，請使用 <xref:System.Net.HttpListenerRequest.TransportContext%2A> 屬性並呼叫 <xref:System.Net.TransportContext.GetChannelBinding%2A> 方法來擷取 CBT。</span><span class="sxs-lookup"><span data-stu-id="5983e-203">To do this, use the <xref:System.Net.HttpListenerRequest.TransportContext%2A> property and call <xref:System.Net.TransportContext.GetChannelBinding%2A> method to retrieve the CBT.</span></span> <span data-ttu-id="5983e-204">僅支援端點繫結。</span><span class="sxs-lookup"><span data-stu-id="5983e-204">Only endpoint bindings are supported.</span></span> <span data-ttu-id="5983e-205">如指定任何其他 <xref:System.Security.Authentication.ExtendedProtection.ChannelBindingKind.Endpoint>，就會擲回 <xref:System.NotSupportedException>。</span><span class="sxs-lookup"><span data-stu-id="5983e-205">If anything other <xref:System.Security.Authentication.ExtendedProtection.ChannelBindingKind.Endpoint> is specified, a <xref:System.NotSupportedException> will be thrown.</span></span> <span data-ttu-id="5983e-206">如果基礎作業系統支援通道系結，則此 <xref:System.Net.TransportContext.GetChannelBinding%2A> 方法會將 <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding> <xref:System.Runtime.InteropServices.SafeHandle> 指標包裝到適用于傳遞至[AcceptSecurityCoNtext](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext)函式的通道系結，做為傳入參數之之 secbuffer 結構的 pvBuffer 成員 `pInput` 。</span><span class="sxs-lookup"><span data-stu-id="5983e-206">If the underlying operating system supports channel binding, the <xref:System.Net.TransportContext.GetChannelBinding%2A> method will return a <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding><xref:System.Runtime.InteropServices.SafeHandle> wrapping a pointer to a channel binding suitable for passing to [AcceptSecurityContext](/windows/win32/api/sspi/nf-sspi-acceptsecuritycontext) function as the pvBuffer member of a SecBuffer structure passed in the `pInput` parameter.</span></span> <span data-ttu-id="5983e-207"><xref:System.Security.Authentication.ExtendedProtection.ChannelBinding.Size%2A> 屬性包含通道繫結的長度，以位元組為單位。</span><span class="sxs-lookup"><span data-stu-id="5983e-207">The <xref:System.Security.Authentication.ExtendedProtection.ChannelBinding.Size%2A> property contains the length, in bytes, of the channel binding.</span></span> <span data-ttu-id="5983e-208">如果基礎作業系統不支援通道繫結，此函式會傳回 `null`。</span><span class="sxs-lookup"><span data-stu-id="5983e-208">If the underlying operating system does not support channel bindings, the function will return `null`.</span></span>  
  
 <span data-ttu-id="5983e-209">另一個可能的案例是在未使用 proxy 時，啟用前置詞的擴充保護 `HTTP://` 。</span><span class="sxs-lookup"><span data-stu-id="5983e-209">Another possible scenario is to enable extended protection for `HTTP://` prefixes when proxies are not used.</span></span> <span data-ttu-id="5983e-210">在本例中，將 <xref:System.Net.HttpListener.ExtendedProtectionPolicy%2A?displayProperty=nameWithType> 設定成將 <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement> 設成 <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> 或 <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> 的 <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy>，以及 <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario> 設成 <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario.TransportSelected>。值 <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> 會將 <xref:System.Net.HttpListener> 置於部分強化模式中，而 <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> 則對應到完全強化模式。</span><span class="sxs-lookup"><span data-stu-id="5983e-210">In this case, set <xref:System.Net.HttpListener.ExtendedProtectionPolicy%2A?displayProperty=nameWithType> to an <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> with <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement> set to <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> or <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always>, and <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario> set to <xref:System.Security.Authentication.ExtendedProtection.ProtectionScenario.TransportSelected> A value of  <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> puts <xref:System.Net.HttpListener> in partially hardened mode, while <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> corresponds to fully hardened mode.</span></span>  
  
 <span data-ttu-id="5983e-211">會根據已向 <xref:System.Net.HttpListener> 登錄的前置詞建立所允許服務名稱的預設清單。</span><span class="sxs-lookup"><span data-stu-id="5983e-211">A default list of allowed service names is created based on the prefixes which have been registered with the <xref:System.Net.HttpListener>.</span></span> <span data-ttu-id="5983e-212">此預設清單可透過 <xref:System.Net.HttpListener.DefaultServiceNames%2A> 屬性檢查。</span><span class="sxs-lookup"><span data-stu-id="5983e-212">This default list can be examined through the <xref:System.Net.HttpListener.DefaultServiceNames%2A> property.</span></span> <span data-ttu-id="5983e-213">如果這份清單不完整，應用程式可以在建構函式中針對會使用的 <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> 類別指定自訂的服務名稱集合，而不是預設的服務名稱清單。</span><span class="sxs-lookup"><span data-stu-id="5983e-213">If this list is not comprehensive, an application can specify a custom service name collection in the constructor for the <xref:System.Security.Authentication.ExtendedProtection.ExtendedProtectionPolicy> class which will be used instead of the default service name list.</span></span>  
  
 <span data-ttu-id="5983e-214">在此組態中，向沒有外部安全通道的伺服器提出要求時，通常會在沒有通道繫結檢查的情況下繼續驗證。</span><span class="sxs-lookup"><span data-stu-id="5983e-214">In this configuration, when a request is made to the server without an outer secure channel authentication proceeds normally without a channel binding check.</span></span> <span data-ttu-id="5983e-215">如果驗證成功，會查詢內容是否有用戶端提供的服務名稱，用以比對驗證可接受的服務名稱清單。</span><span class="sxs-lookup"><span data-stu-id="5983e-215">If the authentication succeeds, the context is queried for the service name that the client provided and validated against the list of acceptable service names.</span></span> <span data-ttu-id="5983e-216">有四個可能的結果：</span><span class="sxs-lookup"><span data-stu-id="5983e-216">There are four possible outcomes:</span></span>  
  
1. <span data-ttu-id="5983e-217">伺服器的基礎作業系統不支援擴充的保護。</span><span class="sxs-lookup"><span data-stu-id="5983e-217">The server’s underlying operating system does not support extended protection.</span></span> <span data-ttu-id="5983e-218">要求不會向應用程式公開，且未經授權的 (401) 回應會傳回至用戶端。</span><span class="sxs-lookup"><span data-stu-id="5983e-218">The request will not be exposed to the application, and an unauthorized (401) response will be returned to the client.</span></span> <span data-ttu-id="5983e-219">記錄到 <xref:System.Net.HttpListener> 追蹤來源的訊息會指定失敗的原因。</span><span class="sxs-lookup"><span data-stu-id="5983e-219">A message will be logged to the <xref:System.Net.HttpListener> trace source specifying the reason for the failure.</span></span>  
  
2. <span data-ttu-id="5983e-220">用戶端的基礎作業系統不支援擴充的保護。</span><span class="sxs-lookup"><span data-stu-id="5983e-220">The client’s underlying operating system does not support extended protection.</span></span> <span data-ttu-id="5983e-221">在 <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> 組態中，該驗證嘗試會成功，且要求會傳回給應用程式。</span><span class="sxs-lookup"><span data-stu-id="5983e-221">In the <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.WhenSupported> configuration, the authentication attempt will succeed and the request will be returned to the application.</span></span> <span data-ttu-id="5983e-222">在 <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> 組態中，驗證嘗試會失敗。</span><span class="sxs-lookup"><span data-stu-id="5983e-222">In the <xref:System.Security.Authentication.ExtendedProtection.PolicyEnforcement.Always> configuration, the authentication attempt will fail.</span></span> <span data-ttu-id="5983e-223">要求不會向應用程式公開，且未經授權的 (401) 回應會傳回至用戶端。</span><span class="sxs-lookup"><span data-stu-id="5983e-223">The request will not be exposed to the application, and an unauthorized (401) response will be returned to the client.</span></span> <span data-ttu-id="5983e-224">記錄到 <xref:System.Net.HttpListener> 追蹤來源的訊息會指定失敗的原因。</span><span class="sxs-lookup"><span data-stu-id="5983e-224">A message will be logged to the <xref:System.Net.HttpListener> trace source specifying the reason for the failure.</span></span>  
  
3. <span data-ttu-id="5983e-225">用戶端基礎作業系統支援擴充的保護，但應用程式未指定服務繫結。</span><span class="sxs-lookup"><span data-stu-id="5983e-225">The client’s underlying operating system supports extended protection, but the application did not specify a service binding.</span></span> <span data-ttu-id="5983e-226">要求不會向應用程式公開，且未經授權的 (401) 回應會傳回至用戶端。</span><span class="sxs-lookup"><span data-stu-id="5983e-226">The request will not be exposed to the application, and an unauthorized (401) response will be returned to the client.</span></span> <span data-ttu-id="5983e-227">記錄到 <xref:System.Net.HttpListener> 追蹤來源的訊息會指定失敗的原因。</span><span class="sxs-lookup"><span data-stu-id="5983e-227">A message will be logged to the <xref:System.Net.HttpListener> trace source specifying the reason for the failure.</span></span>  
  
4. <span data-ttu-id="5983e-228">用戶端指定了服務繫結。</span><span class="sxs-lookup"><span data-stu-id="5983e-228">The client specified a service binding.</span></span> <span data-ttu-id="5983e-229">比較服務繫結和允許的服務繫結清單。</span><span class="sxs-lookup"><span data-stu-id="5983e-229">The service binding is compared to the list of allowed service bindings.</span></span> <span data-ttu-id="5983e-230">如果相符，則要求會傳回至應用程式。</span><span class="sxs-lookup"><span data-stu-id="5983e-230">If it matches, the request is returned to the application.</span></span> <span data-ttu-id="5983e-231">否則，要求不會向應用程式公開，且未經授權的 (401) 回應會自動傳回至用戶端。</span><span class="sxs-lookup"><span data-stu-id="5983e-231">Otherwise, the request will not be exposed to the application, and an unauthorized (401) response will be automatically returned to the client.</span></span> <span data-ttu-id="5983e-232">記錄到 <xref:System.Net.HttpListener> 追蹤來源的訊息會指定失敗的原因。</span><span class="sxs-lookup"><span data-stu-id="5983e-232">A message will be logged to the <xref:System.Net.HttpListener> trace source specifying the reason for the failure.</span></span>  
  
 <span data-ttu-id="5983e-233">如果使用可接受服務名稱允許清單的這個簡單方法不足，應用程式可以查詢 <xref:System.Net.HttpListenerRequest.ServiceName%2A> 屬性，提供它自己的服務名稱驗證。</span><span class="sxs-lookup"><span data-stu-id="5983e-233">If this simple approach using an allowed list of acceptable service names is insufficient, an application may provide its own service name validation by querying the <xref:System.Net.HttpListenerRequest.ServiceName%2A> property.</span></span> <span data-ttu-id="5983e-234">在上述的 1 和 2 案例中，屬性會傳回 `null`。</span><span class="sxs-lookup"><span data-stu-id="5983e-234">In cases 1 and 2 above, the property will return `null`.</span></span> <span data-ttu-id="5983e-235">在案例 3 中，它會傳回空字串。</span><span class="sxs-lookup"><span data-stu-id="5983e-235">In case 3, it will return an empty string.</span></span> <span data-ttu-id="5983e-236">在案例 4 中，會傳回用戶端指定的服務名稱。</span><span class="sxs-lookup"><span data-stu-id="5983e-236">In case 4, the service name specified by the client will be returned.</span></span>  
  
 <span data-ttu-id="5983e-237">伺服器應用程式也可以使用這些擴充的保護功能，搭配其他類型的要求進行驗證，以及在使用受信任的 Proxy 時進行驗證。</span><span class="sxs-lookup"><span data-stu-id="5983e-237">These extended protection features can also be used by server applications for authentication with other types of requests and when trusted proxies are used.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="5983e-238">另請參閱</span><span class="sxs-lookup"><span data-stu-id="5983e-238">See also</span></span>

- <xref:System.Security.Authentication.ExtendedProtection>
- <xref:System.Security.Authentication.ExtendedProtection.Configuration>
