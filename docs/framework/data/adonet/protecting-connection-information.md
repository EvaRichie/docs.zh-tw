---
title: 保護連接資訊
description: 瞭解連接字串中的安全性弱點，這可能是因為連接字串的建立方式和保存方式以及驗證類型而產生的。
ms.date: 03/30/2017
ms.assetid: 1471f580-bcd4-4046-bdaf-d2541ecda2f4
ms.openlocfilehash: 76b182a3d14be08d956f8ffb95dd2ae05245c003
ms.sourcegitcommit: 27a15a55019f6b5f2733961738babe94aec0def3
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/15/2020
ms.locfileid: "90557888"
---
# <a name="protecting-connection-information"></a><span data-ttu-id="d95a2-103">保護連接資訊</span><span class="sxs-lookup"><span data-stu-id="d95a2-103">Protecting Connection Information</span></span>
<span data-ttu-id="d95a2-104">保護應用程式時的最重要目標之一就是保護資料來源的存取。</span><span class="sxs-lookup"><span data-stu-id="d95a2-104">Protecting access to your data source is one of the most important goals when securing an application.</span></span> <span data-ttu-id="d95a2-105">連接字串如果沒有受到保護，就可能造成安全性漏洞。</span><span class="sxs-lookup"><span data-stu-id="d95a2-105">A connection string presents a potential vulnerability if it is not secured.</span></span> <span data-ttu-id="d95a2-106">以純文字儲存連接資訊，或在記憶體中保存連接資訊，都會危及整個系統的安全性。</span><span class="sxs-lookup"><span data-stu-id="d95a2-106">Storing connection information in plain text or persisting it in memory risks compromising your entire system.</span></span> <span data-ttu-id="d95a2-107">您可以使用 [Ildasm.exe (IL ](../../tools/ildasm-exe-il-disassembler.md) 解譯器) 來查看內嵌在原始程式碼中的連接字串，以在編譯的元件中查看 Microsoft 中繼語言 (MSIL) 。</span><span class="sxs-lookup"><span data-stu-id="d95a2-107">Connection strings embedded in your source code can be read using the [Ildasm.exe (IL Disassembler)](../../tools/ildasm-exe-il-disassembler.md) to view Microsoft intermediate language (MSIL) in a compiled assembly.</span></span>  
  
 <span data-ttu-id="d95a2-108">涉及連接字串的安全性漏洞，可能會根據使用的驗證類型、連接字串在記憶體及磁碟中的保存方式，以及在執行階段用來建構連接字串的技巧而引發。</span><span class="sxs-lookup"><span data-stu-id="d95a2-108">Security vulnerabilities involving connection strings can arise based on the type of authentication used, how connection strings are persisted in memory and on disk, and the techniques used to construct them at run time.</span></span>  
  
## <a name="use-windows-authentication"></a><span data-ttu-id="d95a2-109">[使用 Windows 驗證]</span><span class="sxs-lookup"><span data-stu-id="d95a2-109">Use Windows Authentication</span></span>  
 <span data-ttu-id="d95a2-110">為了限制他人存取您的資料來源，您必須保護連線資訊，例如使用者 ID、密碼和資料來源名稱。</span><span class="sxs-lookup"><span data-stu-id="d95a2-110">To help limit access to your data source, you must secure connection information such as user ID, password, and data source name.</span></span> <span data-ttu-id="d95a2-111">為了避免公開使用者資訊，建議您盡可能使用 Windows 驗證 (有時也稱為整合式 *安全性*) 。</span><span class="sxs-lookup"><span data-stu-id="d95a2-111">In order to avoid exposing user information, we recommend using Windows authentication (sometimes referred to as *integrated security*) wherever possible.</span></span> <span data-ttu-id="d95a2-112">Windows 驗證是藉由 `Integrated Security` 或 `Trusted_Connection` 關鍵字指定於連接字串中，可免除使用使用者 ID 和密碼的需要。</span><span class="sxs-lookup"><span data-stu-id="d95a2-112">Windows authentication is specified in a connection string by using the `Integrated Security` or `Trusted_Connection` keywords, eliminating the need to use a user ID and password.</span></span> <span data-ttu-id="d95a2-113">在使用 Windows 驗證時，使用者會由 Windows 進行驗證，而對伺服器和資料庫資源的存取權則是藉由授權給 Windows 使用者和群組來決定。</span><span class="sxs-lookup"><span data-stu-id="d95a2-113">When using Windows authentication, users are authenticated by Windows, and access to server and database resources is determined by granting permissions to Windows users and groups.</span></span>  
  
 <span data-ttu-id="d95a2-114">在無法使用 WIndows 驗證時必須特別小心，因為使用者認證會在連接字串中公開。</span><span class="sxs-lookup"><span data-stu-id="d95a2-114">For situations where it is not possible to use Windows authentication, you must use extra care because user credentials are exposed in the connection string.</span></span> <span data-ttu-id="d95a2-115">在 ASP.NET 應用程式中，可以將 Windows 帳戶設定為用於連接到資料庫和其他網路資源的固定識別 (Identity)。</span><span class="sxs-lookup"><span data-stu-id="d95a2-115">In an ASP.NET application, you can configure a Windows account as a fixed identity that is used to connect to databases and other network resources.</span></span> <span data-ttu-id="d95a2-116">您可以在 **web.config** 檔案中的 identity 元素啟用模擬，並指定使用者名稱和密碼。</span><span class="sxs-lookup"><span data-stu-id="d95a2-116">You enable impersonation in the identity element in the **web.config** file and specify a user name and password.</span></span>  
  
```xml  
<identity impersonate="true"
        userName="MyDomain\UserAccount"
        password="*****" />  
```  
  
 <span data-ttu-id="d95a2-117">固定識別帳戶應該是低權限的帳戶，僅為其授與資料庫中的必要權限。</span><span class="sxs-lookup"><span data-stu-id="d95a2-117">The fixed identity account should be a low-privilege account that has been granted only necessary permissions in the database.</span></span> <span data-ttu-id="d95a2-118">此外，您也應該將組態檔加密，讓使用者名稱和密碼不至於以純文字方式公開。</span><span class="sxs-lookup"><span data-stu-id="d95a2-118">In addition, you should encrypt the configuration file so that the user name and password are not exposed in clear text.</span></span>  
  
## <a name="do-not-use-universal-data-link-udl-files"></a><span data-ttu-id="d95a2-119">不使用通用資料連結 (UDL) 檔</span><span class="sxs-lookup"><span data-stu-id="d95a2-119">Do Not Use Universal Data Link (UDL) files</span></span>  
 <span data-ttu-id="d95a2-120">請避免將 <xref:System.Data.OleDb.OleDbConnection> 的連接字串儲存於「通用資料連結」(UDL) 檔案中。</span><span class="sxs-lookup"><span data-stu-id="d95a2-120">Avoid storing connection strings for an <xref:System.Data.OleDb.OleDbConnection> in a Universal Data Link (UDL) file.</span></span> <span data-ttu-id="d95a2-121">UDL 會以純文字方式儲存且無法加密。</span><span class="sxs-lookup"><span data-stu-id="d95a2-121">UDLs are stored in clear text and cannot be encrypted.</span></span> <span data-ttu-id="d95a2-122">UDL 檔案是應用程式外部的檔案型資源，無法使用 .NET Framework 進行保護或加密。</span><span class="sxs-lookup"><span data-stu-id="d95a2-122">A UDL file is an external file-based resource to your application, and it cannot be secured or encrypted using the .NET Framework.</span></span>  
  
## <a name="avoid-injection-attacks-with-connection-string-builders"></a><span data-ttu-id="d95a2-123">使用連接字串產生器來避免插入式攻擊</span><span class="sxs-lookup"><span data-stu-id="d95a2-123">Avoid Injection Attacks with Connection String Builders</span></span>  
 <span data-ttu-id="d95a2-124">當使用動態字串串連來根據使用者輸入建立連接字串時，就可能發生連接字串插入式攻擊。</span><span class="sxs-lookup"><span data-stu-id="d95a2-124">A connection string injection attack can occur when dynamic string concatenation is used to build connection strings based on user input.</span></span> <span data-ttu-id="d95a2-125">如果使用者輸入未經驗證且未逸出惡意的文字或字元，攻擊者就可能得以存取伺服器上的機密資料或其他資源。</span><span class="sxs-lookup"><span data-stu-id="d95a2-125">If the user input is not validated and malicious text or characters not escaped, an attacker can potentially access sensitive data or other resources on the server.</span></span> <span data-ttu-id="d95a2-126">為了解決此問題，ADO.NET 2.0 導入了新的連接字串產生器 (Builder) 類別 (Class)，可用於驗證連接字串語法，並確保沒有導入其他的參數。</span><span class="sxs-lookup"><span data-stu-id="d95a2-126">To address this problem, ADO.NET 2.0 introduced new connection string builder classes to validate connection string syntax and ensure that additional parameters are not introduced.</span></span> <span data-ttu-id="d95a2-127">如需詳細資訊，請參閱[連接字串建置器](connection-string-builders.md)。</span><span class="sxs-lookup"><span data-stu-id="d95a2-127">For more information, see [Connection String Builders](connection-string-builders.md).</span></span>  
  
## <a name="use-persist-security-infofalse"></a><span data-ttu-id="d95a2-128">使用 Persist Security Info=False</span><span class="sxs-lookup"><span data-stu-id="d95a2-128">Use Persist Security Info=False</span></span>  
 <span data-ttu-id="d95a2-129">`Persist Security Info` 的預設值為 False；建議您在所有連接字串中都使用此預設值。</span><span class="sxs-lookup"><span data-stu-id="d95a2-129">The default value for `Persist Security Info` is false; we recommend using this default in all connection strings.</span></span> <span data-ttu-id="d95a2-130">如果將 `Persist Security Info` 設定為 `true` 或 `yes`，則在開啟連接後，可透過連接取得安全機密資訊，包括使用者 ID 和密碼。</span><span class="sxs-lookup"><span data-stu-id="d95a2-130">Setting `Persist Security Info` to `true` or `yes` allows security-sensitive information, including the user ID and password, to be obtained from a connection after it has been opened.</span></span> <span data-ttu-id="d95a2-131">當 `Persist Security Info` 是設定為 `false` 或 `no` 時，安全性資訊會在用來開啟連接之後捨棄，以確保未受信任的來源無法存取安全機密資訊。</span><span class="sxs-lookup"><span data-stu-id="d95a2-131">When `Persist Security Info` is set to `false` or `no`, security information is discarded after it is used to open the connection, ensuring that an untrusted source does not have access to security-sensitive information.</span></span>  
  
## <a name="encrypt-configuration-files"></a><span data-ttu-id="d95a2-132">加密組態檔</span><span class="sxs-lookup"><span data-stu-id="d95a2-132">Encrypt Configuration Files</span></span>  
 <span data-ttu-id="d95a2-133">連接字串也可以儲存在組態檔案中，這麼做可免除將連接字串嵌入應用程式程式碼的需要。</span><span class="sxs-lookup"><span data-stu-id="d95a2-133">You can also store connection strings in configuration files, which eliminates the need to embed them in your application's code.</span></span> <span data-ttu-id="d95a2-134">組態檔是標準的 XML 檔案，.NET Framework 已為其定義了共用元素組。</span><span class="sxs-lookup"><span data-stu-id="d95a2-134">Configuration files are standard XML files for which the .NET Framework has defined a common set of elements.</span></span> <span data-ttu-id="d95a2-135">設定檔案中的連接字串通常會儲存在 **\<connectionStrings>** Windows 應用程式的 **app.config** 中的元素內，或是 ASP.NET 應用程式的 **web.config** 檔案中。</span><span class="sxs-lookup"><span data-stu-id="d95a2-135">Connection strings in configuration files are typically stored inside the **\<connectionStrings>** element in the **app.config** for a Windows application, or the **web.config** file for an ASP.NET application.</span></span> <span data-ttu-id="d95a2-136">如需有關儲存、從設定檔案中取得和加密連接字串之基本概念的詳細資訊，請參閱 [連接字串和設定檔](connection-strings-and-configuration-files.md)。</span><span class="sxs-lookup"><span data-stu-id="d95a2-136">For more information on the basics of storing, retrieving and encrypting connection strings from configuration files, see [Connection Strings and Configuration Files](connection-strings-and-configuration-files.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d95a2-137">另請參閱</span><span class="sxs-lookup"><span data-stu-id="d95a2-137">See also</span></span>

- [<span data-ttu-id="d95a2-138">設定 ADO.NET 應用程式的安全性</span><span class="sxs-lookup"><span data-stu-id="d95a2-138">Securing ADO.NET Applications</span></span>](securing-ado-net-applications.md)
- <span data-ttu-id="d95a2-139">[使用受保護的設定來加密設定資訊](/previous-versions/aspnet/53tyfkaw(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="d95a2-139">[Encrypting Configuration Information Using Protected Configuration](/previous-versions/aspnet/53tyfkaw(v=vs.100))</span></span>
- [<span data-ttu-id="d95a2-140">.NET 的安全性</span><span class="sxs-lookup"><span data-stu-id="d95a2-140">Security in .NET</span></span>](../../../standard/security/index.md)
- <span data-ttu-id="d95a2-141">[ADO.NET 概觀](ado-net-overview.md) \(部分機器翻譯\)</span><span class="sxs-lookup"><span data-stu-id="d95a2-141">[ADO.NET Overview](ado-net-overview.md)</span></span>
