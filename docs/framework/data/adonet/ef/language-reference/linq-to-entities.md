---
title: LINQ to Entities
description: '瞭解如何建立和執行 LINQ to Entities 查詢，讓您使用 Visual Basic 或 Visual c #，針對 Entity Framework 概念模型撰寫查詢。'
ms.date: 03/30/2017
ms.assetid: 641f9b68-9046-47a1-abb0-1c8eaeda0e2d
ms.openlocfilehash: 389a81872f4652c69e2b845359cf4e5a275aed5c
ms.sourcegitcommit: 33deec3e814238fb18a49b2a7e89278e27888291
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/02/2020
ms.locfileid: "84286840"
---
# <a name="linq-to-entities"></a><span data-ttu-id="47427-103">LINQ to Entities</span><span class="sxs-lookup"><span data-stu-id="47427-103">LINQ to Entities</span></span>
<span data-ttu-id="47427-104">LINQ to Entities 提供了 Language-Integrated Query (LINQ) 支援，可讓開發人員使用 Visual Basic 或 Visual C# 針對 Entity Framework 概念模型撰寫查詢。</span><span class="sxs-lookup"><span data-stu-id="47427-104">LINQ to Entities provides Language-Integrated Query (LINQ) support that enables developers to write queries against the Entity Framework conceptual model using Visual Basic or Visual C#.</span></span> <span data-ttu-id="47427-105">針對 Entity Framework 執行的查詢是以命令樹查詢來表示，每一個查詢都會針對物件內容來執行。</span><span class="sxs-lookup"><span data-stu-id="47427-105">Queries against the Entity Framework are represented by command tree queries, which execute against the object context.</span></span> <span data-ttu-id="47427-106">LINQ to Entities 會將 Language-Integrated Queries (LINQ) 查詢轉換成命令樹查詢、針對 Entity Framework 執行查詢，並傳回 Entity Framework 和 LINQ 都可以使用的物件。</span><span class="sxs-lookup"><span data-stu-id="47427-106">LINQ to Entities converts Language-Integrated Queries (LINQ) queries to command tree queries, executes the queries against the Entity Framework, and returns objects that can be used by both the Entity Framework and LINQ.</span></span> <span data-ttu-id="47427-107">下列是建立及執行 LINQ to Entities 查詢的程序：</span><span class="sxs-lookup"><span data-stu-id="47427-107">The following is the process for creating and executing a LINQ to Entities query:</span></span>  
  
1. <span data-ttu-id="47427-108">從 <xref:System.Data.Objects.ObjectQuery%601> 建構 <xref:System.Data.Objects.ObjectContext> 執行個體。</span><span class="sxs-lookup"><span data-stu-id="47427-108">Construct an <xref:System.Data.Objects.ObjectQuery%601> instance from <xref:System.Data.Objects.ObjectContext>.</span></span>  
  
2. <span data-ttu-id="47427-109">使用 <xref:System.Data.Objects.ObjectQuery%601> 執行個體，在 C# 或 Visual Basic 中撰寫 LINQ to Entities 查詢。</span><span class="sxs-lookup"><span data-stu-id="47427-109">Compose a LINQ to Entities query in C# or Visual Basic by using the <xref:System.Data.Objects.ObjectQuery%601> instance.</span></span>  
  
3. <span data-ttu-id="47427-110">將 LINQ 標準查詢運算子和運算式轉換成命令樹。</span><span class="sxs-lookup"><span data-stu-id="47427-110">Convert LINQ standard query operators and expressions to command trees.</span></span>  
  
4. <span data-ttu-id="47427-111">在命令樹中會針對資料來源查詢執行。</span><span class="sxs-lookup"><span data-stu-id="47427-111">Execute the query, in command tree representation, against the data source.</span></span> <span data-ttu-id="47427-112">執行期間於資料來源上擲回的任何例外狀況都會直接傳遞給用戶端。</span><span class="sxs-lookup"><span data-stu-id="47427-112">Any exceptions thrown on the data source during execution are passed directly up to the client.</span></span>  
  
5. <span data-ttu-id="47427-113">將查詢結果傳回用戶端。</span><span class="sxs-lookup"><span data-stu-id="47427-113">Return query results back to the client.</span></span>  
  
## <a name="constructing-an-objectquery-instance"></a><span data-ttu-id="47427-114">建構 ObjectQuery 執行個體</span><span class="sxs-lookup"><span data-stu-id="47427-114">Constructing an ObjectQuery Instance</span></span>  
 <span data-ttu-id="47427-115"><xref:System.Data.Objects.ObjectQuery%601> 泛型類別表示傳回零個或多個具型別實體之集合的查詢。</span><span class="sxs-lookup"><span data-stu-id="47427-115">The <xref:System.Data.Objects.ObjectQuery%601> generic class represents a query that returns a collection of zero or more typed entities.</span></span> <span data-ttu-id="47427-116">物件查詢通常是從現有的物件內容所建構 (而不是手動建構)，而且一定會屬於該物件內容。</span><span class="sxs-lookup"><span data-stu-id="47427-116">An object query is typically constructed from an existing object context, instead of being manually constructed, and always belongs to that object context.</span></span> <span data-ttu-id="47427-117">此內容提供了撰寫及執行查詢所需的連接和中繼資料 (Metadata) 資訊。</span><span class="sxs-lookup"><span data-stu-id="47427-117">This context provides the connection and metadata information that is required to compose and execute the query.</span></span> <span data-ttu-id="47427-118"><xref:System.Data.Objects.ObjectQuery%601> 泛型類別會實作 <xref:System.Linq.IQueryable%601> 泛型介面，此介面的 builder 方法可累加建置 LINQ 查詢。</span><span class="sxs-lookup"><span data-stu-id="47427-118">The <xref:System.Data.Objects.ObjectQuery%601> generic class implements the <xref:System.Linq.IQueryable%601> generic interface, whose builder methods enable LINQ queries to be incrementally built.</span></span> <span data-ttu-id="47427-119">使用 C# `var` 關鍵字 (在 Visual Basic 中啟用區域型別推斷的話為 `Dim`)，您也可以讓編譯器推斷實體類型。</span><span class="sxs-lookup"><span data-stu-id="47427-119">You can also let the compiler infer the type of entities by using the C# `var` keyword (`Dim` in Visual Basic, with local type inference enabled).</span></span>  
  
## <a name="composing-the-queries"></a><span data-ttu-id="47427-120">撰寫查詢</span><span class="sxs-lookup"><span data-stu-id="47427-120">Composing the Queries</span></span>  
 <span data-ttu-id="47427-121">實作泛型 <xref:System.Data.Objects.ObjectQuery%601> 介面之 <xref:System.Linq.IQueryable%601> 泛型類別的執行個體會當做 LINQ to Entities 查詢的資料來源。</span><span class="sxs-lookup"><span data-stu-id="47427-121">Instances of the <xref:System.Data.Objects.ObjectQuery%601> generic class, which implements the generic <xref:System.Linq.IQueryable%601> interface, serve as the data source for LINQ to Entities queries.</span></span> <span data-ttu-id="47427-122">在查詢中，您可以精確地指定想要從資料來源中擷取的資訊。</span><span class="sxs-lookup"><span data-stu-id="47427-122">In a query, you specify exactly the information that you want to retrieve from the data source.</span></span> <span data-ttu-id="47427-123">此外，查詢也可以指定該項資訊傳回之前應該如何排序、分組和成形。</span><span class="sxs-lookup"><span data-stu-id="47427-123">A query can also specify how that information should be sorted, grouped, and shaped before it is returned.</span></span> <span data-ttu-id="47427-124">在 LINQ 中，查詢會儲存在變數內。</span><span class="sxs-lookup"><span data-stu-id="47427-124">In LINQ, a query is stored in a variable.</span></span> <span data-ttu-id="47427-125">這個查詢變數不會採取任何動作，也不會傳回任何資料。它只會儲存查詢資訊。</span><span class="sxs-lookup"><span data-stu-id="47427-125">This query variable takes no action and returns no data; it only stores the query information.</span></span> <span data-ttu-id="47427-126">在您建立查詢之後，必須執行該查詢以便擷取任何資料。</span><span class="sxs-lookup"><span data-stu-id="47427-126">After you create a query you must execute that query to retrieve any data.</span></span>  
  
 <span data-ttu-id="47427-127">LINQ to Entities 查詢可以使用兩個不同的語法來撰寫：查詢運算式語法和以方法為基礎的查詢語法。</span><span class="sxs-lookup"><span data-stu-id="47427-127">LINQ to Entities queries can be composed in two different syntaxes: query expression syntax and method-based query syntax.</span></span> <span data-ttu-id="47427-128">查詢運算式語法和以方法為基礎的查詢語法都是 C# 3.0 和 Visual Basic 9.0 中的新增功能。</span><span class="sxs-lookup"><span data-stu-id="47427-128">Query expression syntax and method-based query syntax are new in C# 3.0 and Visual Basic 9.0.</span></span>  
  
 <span data-ttu-id="47427-129">如需詳細資訊，請參閱[LINQ to Entities 中的查詢](queries-in-linq-to-entities.md)。</span><span class="sxs-lookup"><span data-stu-id="47427-129">For more information, see [Queries in LINQ to Entities](queries-in-linq-to-entities.md).</span></span>  
  
## <a name="query-conversion"></a><span data-ttu-id="47427-130">查詢轉換</span><span class="sxs-lookup"><span data-stu-id="47427-130">Query Conversion</span></span>  
 <span data-ttu-id="47427-131">若要針對 Entity Framework 執行 LINQ to Entities 查詢，LINQ 查詢必須轉換成可以針對 Entity Framework 執行的命令樹表示法。</span><span class="sxs-lookup"><span data-stu-id="47427-131">To execute a LINQ to Entities query against the Entity Framework, the LINQ query must be converted to a command tree representation that can be executed against the Entity Framework.</span></span>  
  
 <span data-ttu-id="47427-132">LINQ to Entities 查詢是由 LINQ 標準查詢運算子（例如 <xref:System.Linq.Queryable.Select%2A> 、 <xref:System.Linq.Queryable.Where%2A> 和 <xref:System.Linq.Queryable.GroupBy%2A> ）和運算式（x > 10、Contact 和 LastName 等等）所組成。</span><span class="sxs-lookup"><span data-stu-id="47427-132">LINQ to Entities queries are comprised of LINQ standard query operators (such as <xref:System.Linq.Queryable.Select%2A>, <xref:System.Linq.Queryable.Where%2A>, and <xref:System.Linq.Queryable.GroupBy%2A>) and expressions (x > 10, Contact.LastName, and so on).</span></span> <span data-ttu-id="47427-133">LINQ 運算子並不是由類別所定義，而是類別上的方法。</span><span class="sxs-lookup"><span data-stu-id="47427-133">LINQ operators are not defined by a class, but rather are methods on a class.</span></span> <span data-ttu-id="47427-134">在 LINQ 中，運算式可以包含 <xref:System.Linq.Expressions> 命名空間內類型所允許的任何項目，以及能以 Lambda 函式表示的任何項目 (依擴充而定)。</span><span class="sxs-lookup"><span data-stu-id="47427-134">In LINQ, expressions can contain anything allowed by types within the <xref:System.Linq.Expressions> namespace and, by extension, anything that can be represented in a lambda function.</span></span> <span data-ttu-id="47427-135">這是 Entity Framework 所允許之運算式的超集，根據定義，這些運算式限制為只有資料庫上允許且 <xref:System.Data.Objects.ObjectQuery%601> 支援的作業。</span><span class="sxs-lookup"><span data-stu-id="47427-135">This is a superset of the expressions that are allowed by the Entity Framework, which are by definition restricted to operations allowed on the database, and supported by <xref:System.Data.Objects.ObjectQuery%601>.</span></span>  
  
 <span data-ttu-id="47427-136">在 Entity Framework 中，運算子和運算式都是由單一型別階層所代表，然後會將它們置於命令樹中。</span><span class="sxs-lookup"><span data-stu-id="47427-136">In the Entity Framework, both operators and expressions are represented by a single type hierarchy, which are then placed in a command tree.</span></span> <span data-ttu-id="47427-137">Entity Framework 會使用此命令樹來執行查詢。</span><span class="sxs-lookup"><span data-stu-id="47427-137">The command tree is used by the Entity Framework to execute the query.</span></span> <span data-ttu-id="47427-138">如果 LINQ 查詢不能表示為命令樹，則當轉換查詢時，將會擲回例外狀況。</span><span class="sxs-lookup"><span data-stu-id="47427-138">If the LINQ query cannot be expressed as a command tree, an exception will be thrown when the query is being converted.</span></span> <span data-ttu-id="47427-139">LINQ to Entities 查詢的轉換牽涉到兩個子轉換：標準查詢運算子的轉換及運算式的轉換。</span><span class="sxs-lookup"><span data-stu-id="47427-139">The conversion of LINQ to Entities queries involves two sub-conversions: the conversion of the standard query operators, and the conversion of the expressions.</span></span>  
  
 <span data-ttu-id="47427-140">許多 LINQ 標準查詢運算子沒有 LINQ to Entities 中的有效轉譯。</span><span class="sxs-lookup"><span data-stu-id="47427-140">There are a number of LINQ standard query operators that do not have a valid translation in LINQ to Entities.</span></span> <span data-ttu-id="47427-141">嘗試使用這些運算子將會在查詢轉譯時產生例外狀況。</span><span class="sxs-lookup"><span data-stu-id="47427-141">Attempts to use these operators will result in an exception at query translation time.</span></span> <span data-ttu-id="47427-142">如需支援的 LINQ to Entities 運算子清單，請參閱[支援和不支援的 LINQ 方法（LINQ to Entities）](supported-and-unsupported-linq-methods-linq-to-entities.md)。</span><span class="sxs-lookup"><span data-stu-id="47427-142">For a list of supported LINQ to Entities operators, see [Supported and Unsupported LINQ Methods (LINQ to Entities)](supported-and-unsupported-linq-methods-linq-to-entities.md).</span></span>  
  
 <span data-ttu-id="47427-143">如需在 LINQ to Entities 中使用標準查詢運算子的詳細資訊，請參閱[LINQ to Entities 查詢中的標準查詢運算子](standard-query-operators-in-linq-to-entities-queries.md)。</span><span class="sxs-lookup"><span data-stu-id="47427-143">For more information about using the standard query operators in LINQ to Entities, see [Standard Query Operators in LINQ to Entities Queries](standard-query-operators-in-linq-to-entities-queries.md).</span></span>  
  
 <span data-ttu-id="47427-144">一般來說，LINQ to Entities 中的運算式會在伺服器上評估，所以運算式的行為不需要遵循 CLR 語意。</span><span class="sxs-lookup"><span data-stu-id="47427-144">In general, expressions in LINQ to Entities are evaluated on the server, so the behavior of the expression should not be expected to follow CLR semantics.</span></span> <span data-ttu-id="47427-145">如需詳細資訊，請參閱[LINQ to Entities 查詢中的運算式](expressions-in-linq-to-entities-queries.md)。</span><span class="sxs-lookup"><span data-stu-id="47427-145">For more information, see [Expressions in LINQ to Entities Queries](expressions-in-linq-to-entities-queries.md).</span></span>  
  
 <span data-ttu-id="47427-146">如需如何將 CLR 方法呼叫對應至資料來源中標準函式的詳細資訊，請參閱標準函式[對應的 Clr 方法](clr-method-to-canonical-function-mapping.md)。</span><span class="sxs-lookup"><span data-stu-id="47427-146">For information about how CLR method calls are mapped to canonical functions in the data source, see [CLR Method to Canonical Function Mapping](clr-method-to-canonical-function-mapping.md).</span></span>  
  
 <span data-ttu-id="47427-147">如需如何從 LINQ to Entities 查詢內呼叫標準、資料庫和自訂函式的詳細資訊，請參閱[LINQ to Entities 查詢中呼叫函數](calling-functions-in-linq-to-entities-queries.md)。</span><span class="sxs-lookup"><span data-stu-id="47427-147">For information about how to call canonical, database, and custom functions from within LINQ to Entities queries, see [Calling Functions in LINQ to Entities Queries](calling-functions-in-linq-to-entities-queries.md).</span></span>  
  
## <a name="query-execution"></a><span data-ttu-id="47427-148">查詢執行</span><span class="sxs-lookup"><span data-stu-id="47427-148">Query Execution</span></span>  
 <span data-ttu-id="47427-149">當使用者建立 LINQ 查詢之後，會將它轉換成與 Entity Framework 相容的表示法 (命令樹的形式)，然後針對資料來源執行此查詢。</span><span class="sxs-lookup"><span data-stu-id="47427-149">After the LINQ query is created by the user, it is converted to a representation that is compatible with the Entity Framework (in the form of command trees), which is then executed against the data source.</span></span> <span data-ttu-id="47427-150">在執行查詢時，所有的查詢運算式 (或是查詢的元件) 都會在用戶端或伺服器上評估，</span><span class="sxs-lookup"><span data-stu-id="47427-150">At query execution time, all query expressions (or components of the query) are evaluated on the client or on the server.</span></span> <span data-ttu-id="47427-151">這包括用於結果具體化或實體投影的運算式。</span><span class="sxs-lookup"><span data-stu-id="47427-151">This includes expressions that are used in result materialization or entity projections.</span></span> <span data-ttu-id="47427-152">如需詳細資訊，請參閱[查詢執行](query-execution.md)。</span><span class="sxs-lookup"><span data-stu-id="47427-152">For more information, see [Query Execution](query-execution.md).</span></span> <span data-ttu-id="47427-153">如需如何編譯查詢一次，然後使用不同的參數執行數次來改善效能的相關資訊，請參閱[編譯的查詢（LINQ to Entities）](compiled-queries-linq-to-entities.md)。</span><span class="sxs-lookup"><span data-stu-id="47427-153">For information on how to improve performance by compiling a query once and then executing it several times with different parameters, see [Compiled Queries  (LINQ to Entities)](compiled-queries-linq-to-entities.md).</span></span>  
  
## <a name="materialization"></a><span data-ttu-id="47427-154">具體化</span><span class="sxs-lookup"><span data-stu-id="47427-154">Materialization</span></span>  
 <span data-ttu-id="47427-155">具體化是將查詢結果以 CLR 型別形式傳回用戶端的程序。</span><span class="sxs-lookup"><span data-stu-id="47427-155">Materialization is the process of returning query results back to the client as CLR types.</span></span> <span data-ttu-id="47427-156">在 LINQ to Entities 中，絕對不會傳回查詢結果資料記錄；一定會有支援的 CLR 型別，該型別是由使用者或 Entity Framework 所定義或是由編譯器所產生 (匿名型別)。</span><span class="sxs-lookup"><span data-stu-id="47427-156">In LINQ to Entities, query results data records are never returned; there is always a backing CLR type, defined by the user or by the Entity Framework, or generated by the compiler (anonymous types).</span></span> <span data-ttu-id="47427-157">所有物件具體化都是由 Entity Framework 執行。</span><span class="sxs-lookup"><span data-stu-id="47427-157">All object materialization is performed by the Entity Framework.</span></span> <span data-ttu-id="47427-158">因為無法在 Entity Framework 與 CLR 之間對應而產生的任何錯誤，都將導致物件具體化期間擲回例外狀況。</span><span class="sxs-lookup"><span data-stu-id="47427-158">Any errors that result from an inability to map between the Entity Framework and the CLR will cause exceptions to be thrown during object materialization.</span></span>  
  
 <span data-ttu-id="47427-159">查詢結果通常會以下列其中一個項目的形式來傳回：</span><span class="sxs-lookup"><span data-stu-id="47427-159">Query results are usually returned as one of the following:</span></span>  
  
- <span data-ttu-id="47427-160">零個或多個具型別實體物件的集合，或是概念模型中所定義的複雜類型的投影。</span><span class="sxs-lookup"><span data-stu-id="47427-160">A collection of zero or more typed entity objects or a projection of complex types defined in the conceptual model.</span></span>  
  
- <span data-ttu-id="47427-161">Entity Framework 支援的 CLR 類型。</span><span class="sxs-lookup"><span data-stu-id="47427-161">CLR types that are supported by the Entity Framework.</span></span>  
  
- <span data-ttu-id="47427-162">內嵌集合。</span><span class="sxs-lookup"><span data-stu-id="47427-162">Inline collections.</span></span>  
  
- <span data-ttu-id="47427-163">匿名型別。</span><span class="sxs-lookup"><span data-stu-id="47427-163">Anonymous types.</span></span>  
  
 <span data-ttu-id="47427-164">如需詳細資訊，請參閱[查詢結果](query-results.md)。</span><span class="sxs-lookup"><span data-stu-id="47427-164">For more information, see [Query Results](query-results.md).</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="47427-165">本節內容</span><span class="sxs-lookup"><span data-stu-id="47427-165">In This Section</span></span>  
 [<span data-ttu-id="47427-166">LINQ to Entities 中的查詢</span><span class="sxs-lookup"><span data-stu-id="47427-166">Queries in LINQ to Entities</span></span>](queries-in-linq-to-entities.md)  
  
 [<span data-ttu-id="47427-167">LINQ to Entities 查詢中的運算式</span><span class="sxs-lookup"><span data-stu-id="47427-167">Expressions in LINQ to Entities Queries</span></span>](expressions-in-linq-to-entities-queries.md)  
  
 [<span data-ttu-id="47427-168">在 LINQ to Entities 查詢中呼叫函式</span><span class="sxs-lookup"><span data-stu-id="47427-168">Calling Functions in LINQ to Entities Queries</span></span>](calling-functions-in-linq-to-entities-queries.md)  
  
 [<span data-ttu-id="47427-169">已編譯查詢 (LINQ to Entities)</span><span class="sxs-lookup"><span data-stu-id="47427-169">Compiled Queries  (LINQ to Entities)</span></span>](compiled-queries-linq-to-entities.md)  
  
 [<span data-ttu-id="47427-170">查詢執行</span><span class="sxs-lookup"><span data-stu-id="47427-170">Query Execution</span></span>](query-execution.md)  
  
 [<span data-ttu-id="47427-171">查詢結果</span><span class="sxs-lookup"><span data-stu-id="47427-171">Query Results</span></span>](query-results.md)  
  
 [<span data-ttu-id="47427-172">LINQ to Entities 查詢中的標準查詢運算子</span><span class="sxs-lookup"><span data-stu-id="47427-172">Standard Query Operators in LINQ to Entities Queries</span></span>](standard-query-operators-in-linq-to-entities-queries.md)  
  
 [<span data-ttu-id="47427-173">標準函式的對應 CLR 方法</span><span class="sxs-lookup"><span data-stu-id="47427-173">CLR Method to Canonical Function Mapping</span></span>](clr-method-to-canonical-function-mapping.md)  
  
 [<span data-ttu-id="47427-174">支援與不支援的 LINQ 方法 (LINQ to Entities)</span><span class="sxs-lookup"><span data-stu-id="47427-174">Supported and Unsupported LINQ Methods (LINQ to Entities)</span></span>](supported-and-unsupported-linq-methods-linq-to-entities.md)  
  
 [<span data-ttu-id="47427-175">LINQ to Entities 中的已知問題和考量</span><span class="sxs-lookup"><span data-stu-id="47427-175">Known Issues and Considerations in LINQ to Entities</span></span>](known-issues-and-considerations-in-linq-to-entities.md)  
  
## <a name="see-also"></a><span data-ttu-id="47427-176">另請參閱</span><span class="sxs-lookup"><span data-stu-id="47427-176">See also</span></span>

- [<span data-ttu-id="47427-177">LINQ to Entities 中的已知問題和考量</span><span class="sxs-lookup"><span data-stu-id="47427-177">Known Issues and Considerations in LINQ to Entities</span></span>](known-issues-and-considerations-in-linq-to-entities.md)
- [<span data-ttu-id="47427-178">Language-Integrated Query (LINQ) - C#</span><span class="sxs-lookup"><span data-stu-id="47427-178">Language-Integrated Query (LINQ) - C#</span></span>](../../../../../csharp/programming-guide/concepts/linq/index.md)
- [<span data-ttu-id="47427-179">Language-Integrated Query (LINQ) - Visual Basic</span><span class="sxs-lookup"><span data-stu-id="47427-179">Language-Integrated Query (LINQ) - Visual Basic</span></span>](../../../../../visual-basic/programming-guide/concepts/linq/index.md)
- [<span data-ttu-id="47427-180">LINQ 和 ADO.NET</span><span class="sxs-lookup"><span data-stu-id="47427-180">LINQ and ADO.NET</span></span>](../../linq-and-ado-net.md)
- [<span data-ttu-id="47427-181">ADO.NET Entity Framework</span><span class="sxs-lookup"><span data-stu-id="47427-181">ADO.NET Entity Framework</span></span>](../index.md)
