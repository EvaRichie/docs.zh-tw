---
title: 安全性考量 (Entity Framework)
ms.date: 03/30/2017
ms.assetid: 84758642-9b72-4447-86f9-f831fef46962
ms.openlocfilehash: 5a2d96679c43528b86d3b1d7301b4520a38289aa
ms.sourcegitcommit: 5b475c1855b32cf78d2d1bbb4295e4c236f39464
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/24/2020
ms.locfileid: "91156676"
---
# <a name="security-considerations-entity-framework"></a><span data-ttu-id="2abd3-102">安全性考量 (Entity Framework)</span><span class="sxs-lookup"><span data-stu-id="2abd3-102">Security Considerations (Entity Framework)</span></span>

<span data-ttu-id="2abd3-103">本主題說明開發、部署和執行 Entity Framework 應用程式特有的安全性考慮。</span><span class="sxs-lookup"><span data-stu-id="2abd3-103">This topic describes security considerations that are specific to developing, deploying, and running Entity Framework applications.</span></span> <span data-ttu-id="2abd3-104">您也應該遵循建議來建立安全的 .NET Framework 應用程式。</span><span class="sxs-lookup"><span data-stu-id="2abd3-104">You should also follow recommendations for creating secure .NET Framework applications.</span></span> <span data-ttu-id="2abd3-105">如需詳細資訊，請參閱[安全性概觀](../security-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="2abd3-105">For more information, see [Security Overview](../security-overview.md).</span></span>  
  
## <a name="general-security-considerations"></a><span data-ttu-id="2abd3-106">一般安全性考量</span><span class="sxs-lookup"><span data-stu-id="2abd3-106">General Security Considerations</span></span>  

 <span data-ttu-id="2abd3-107">下列安全性考慮適用于使用 Entity Framework 的所有應用程式。</span><span class="sxs-lookup"><span data-stu-id="2abd3-107">The following security considerations apply to all applications that use the Entity Framework.</span></span>  
  
#### <a name="use-only-trusted-data-source-providers"></a><span data-ttu-id="2abd3-108">僅使用信任的資料來源提供者。</span><span class="sxs-lookup"><span data-stu-id="2abd3-108">Use only trusted data source providers.</span></span>  

 <span data-ttu-id="2abd3-109">若要與資料來源通訊，提供者必須進行下列作業：</span><span class="sxs-lookup"><span data-stu-id="2abd3-109">To communicate with the data source, a provider must do the following:</span></span>  
  
- <span data-ttu-id="2abd3-110">從 Entity Framework 接收連接字串。</span><span class="sxs-lookup"><span data-stu-id="2abd3-110">Receive the connection string from the Entity Framework.</span></span>  
  
- <span data-ttu-id="2abd3-111">將命令樹轉譯成資料來源的原生 (Native) 查詢語言。</span><span class="sxs-lookup"><span data-stu-id="2abd3-111">Translate the command tree to the data source's native query language.</span></span>  
  
- <span data-ttu-id="2abd3-112">組合並傳回結果集。</span><span class="sxs-lookup"><span data-stu-id="2abd3-112">Assemble and return result sets.</span></span>  
  
 <span data-ttu-id="2abd3-113">進行登入作業期間，以使用者密碼為基礎的資訊會透過基礎資料來源的網路程式庫傳遞至伺服器。</span><span class="sxs-lookup"><span data-stu-id="2abd3-113">During the logon operation, information that is based on the user password is passed to the server through the network libraries of the underlying data source.</span></span> <span data-ttu-id="2abd3-114">惡意提供者可能會竊取使用者認證、產生惡意查詢，或竄改結果集。</span><span class="sxs-lookup"><span data-stu-id="2abd3-114">A malicious provider can steal user credentials, generate malicious queries, or tamper with the result set.</span></span>  
  
#### <a name="encrypt-your-connection-to-protect-sensitive-data"></a><span data-ttu-id="2abd3-115">加密您的連接以便保護機密資料。</span><span class="sxs-lookup"><span data-stu-id="2abd3-115">Encrypt your connection to protect sensitive data.</span></span>  

 <span data-ttu-id="2abd3-116">Entity Framework 不會直接處理資料加密。</span><span class="sxs-lookup"><span data-stu-id="2abd3-116">The Entity Framework does not directly handle data encryption.</span></span> <span data-ttu-id="2abd3-117">如果使用者透過公用 (Public) 網路存取資料，您的應用程式就應該建立資料來源的加密連接，以便提升安全性。</span><span class="sxs-lookup"><span data-stu-id="2abd3-117">If users access data over a public network, your application should establish an encrypted connection to the data source to increase security.</span></span> <span data-ttu-id="2abd3-118">如需詳細資訊，請參閱資料來源的安全性相關文件。</span><span class="sxs-lookup"><span data-stu-id="2abd3-118">For more information, see the security-related documentation for your data source.</span></span> <span data-ttu-id="2abd3-119">如 SQL Server 的資料來源，請參閱 [加密 SQL Server 的連接](/previous-versions/sql/sql-server-2008-r2/ms189067(v=sql.105))。</span><span class="sxs-lookup"><span data-stu-id="2abd3-119">For a SQL Server data source, see [Encrypting Connections to SQL Server](/previous-versions/sql/sql-server-2008-r2/ms189067(v=sql.105)).</span></span>  
  
#### <a name="secure-the-connection-string"></a><span data-ttu-id="2abd3-120">保護連接字串的安全。</span><span class="sxs-lookup"><span data-stu-id="2abd3-120">Secure the connection string.</span></span>  

 <span data-ttu-id="2abd3-121">保護應用程式時的最重要目標之一就是保護資料來源的存取。</span><span class="sxs-lookup"><span data-stu-id="2abd3-121">Protecting access to your data source is one of the most important goals when securing an application.</span></span> <span data-ttu-id="2abd3-122">如果連接字串未受保護，或者建構方式不當，它就會成為可能的弱點。</span><span class="sxs-lookup"><span data-stu-id="2abd3-122">A connection string presents a potential vulnerability if it is not secured or if it is improperly constructed.</span></span> <span data-ttu-id="2abd3-123">如果您以純文字方式儲存連接資訊，或將它保存在記憶體中，就會面臨危害整個系統的風險。</span><span class="sxs-lookup"><span data-stu-id="2abd3-123">When you store connection information in plain text or persist it in memory, you risk compromising your entire system.</span></span> <span data-ttu-id="2abd3-124">下面是保護連接字串安全的建議方法：</span><span class="sxs-lookup"><span data-stu-id="2abd3-124">The following are the recommended methods for securing connection strings:</span></span>  
  
- <span data-ttu-id="2abd3-125">使用 Windows 驗證搭配 SQL Server 資料來源。</span><span class="sxs-lookup"><span data-stu-id="2abd3-125">Use Windows Authentication with a SQL Server data source.</span></span>  
  
     <span data-ttu-id="2abd3-126">當您使用 Windows 驗證來連接至 SQL Server 資料來源時，連接字串不會包含登入和密碼資訊。</span><span class="sxs-lookup"><span data-stu-id="2abd3-126">When you use Windows Authentication to connect to a SQL Server data source, the connection string does not contain logon and password information.</span></span>  
  
- <span data-ttu-id="2abd3-127">使用受保護的組態來加密組態檔區段。</span><span class="sxs-lookup"><span data-stu-id="2abd3-127">Encrypt configuration file sections using protected configuration.</span></span>  
  
     <span data-ttu-id="2abd3-128">ASP.NET 提供了一項稱為受保護組態的功能，可讓您加密組態檔中的機密資訊。</span><span class="sxs-lookup"><span data-stu-id="2abd3-128">ASP.NET provides a feature called protected configuration that enables you to encrypt sensitive information in a configuration file.</span></span> <span data-ttu-id="2abd3-129">雖然主要是針對 ASP.NET 所設計，不過您也可以使用受保護的組態來加密 Windows 應用程式中組態檔的區段。</span><span class="sxs-lookup"><span data-stu-id="2abd3-129">Although primarily designed for ASP.NET, you can also use protected configuration to encrypt sections of configuration files in Windows applications.</span></span> <span data-ttu-id="2abd3-130">如需新的受保護設定功能的詳細說明，請參閱 [使用受保護](/previous-versions/aspnet/53tyfkaw(v=vs.100))的設定加密設定資訊。</span><span class="sxs-lookup"><span data-stu-id="2abd3-130">For a detailed description of the new protected configuration capabilities, see [Encrypting Configuration Information Using Protected Configuration](/previous-versions/aspnet/53tyfkaw(v=vs.100)).</span></span>  
  
- <span data-ttu-id="2abd3-131">將連接字串儲存在受保護的組態檔中。</span><span class="sxs-lookup"><span data-stu-id="2abd3-131">Store connection strings in secured configuration files.</span></span>  
  
     <span data-ttu-id="2abd3-132">請勿將連接字串內嵌在原始程式碼中。</span><span class="sxs-lookup"><span data-stu-id="2abd3-132">You should never embed connection strings in your source code.</span></span> <span data-ttu-id="2abd3-133">您可以將連接字串儲存在組態檔中，如此就不需要將它們內嵌在應用程式的程式碼中。</span><span class="sxs-lookup"><span data-stu-id="2abd3-133">You can store connection strings in configuration files, which eliminates the need to embed them in your application's code.</span></span> <span data-ttu-id="2abd3-134">根據預設，Entity Data Model 精靈會將連接字串儲存在應用程式組態檔中。</span><span class="sxs-lookup"><span data-stu-id="2abd3-134">By default, the Entity Data Model Wizard stores connection strings in the application configuration file.</span></span> <span data-ttu-id="2abd3-135">您必須保護這個檔案的安全，避免未經授權的存取。</span><span class="sxs-lookup"><span data-stu-id="2abd3-135">You must secure this file to prevent unauthorized access.</span></span>  
  
- <span data-ttu-id="2abd3-136">以動態方式建立連接時使用連接字串產生器 (Builder)。</span><span class="sxs-lookup"><span data-stu-id="2abd3-136">Use connection string builders when dynamically creating connections.</span></span>  
  
     <span data-ttu-id="2abd3-137">如果您必須在執行階段建構連接字串，請使用 <xref:System.Data.EntityClient.EntityConnectionStringBuilder> 類別 (Class)。</span><span class="sxs-lookup"><span data-stu-id="2abd3-137">If you must construct connection strings at runtime, use the <xref:System.Data.EntityClient.EntityConnectionStringBuilder> class.</span></span> <span data-ttu-id="2abd3-138">這個字串產生器類別會透過驗證和逸出無效的輸入資訊，協助避免連接字串插入式攻擊。</span><span class="sxs-lookup"><span data-stu-id="2abd3-138">This string builder class helps prevent connection string injection attacks by validating and escaping invalid input information.</span></span> <span data-ttu-id="2abd3-139">如需詳細資訊，請參閱 [如何：建立 EntityConnection 連接字串](how-to-build-an-entityconnection-connection-string.md)。</span><span class="sxs-lookup"><span data-stu-id="2abd3-139">For more information, see [How to: Build an EntityConnection Connection String](how-to-build-an-entityconnection-connection-string.md).</span></span> <span data-ttu-id="2abd3-140">也請使用適當的字串產生器類別，來建立屬於 Entity Framework 連接字串一部分的資料來源連接字串。</span><span class="sxs-lookup"><span data-stu-id="2abd3-140">Also use the appropriate string builder class to construct the data source connection string that is part of the Entity Framework connection string.</span></span> <span data-ttu-id="2abd3-141">如需 ADO.NET 提供者之連接字串產生器的詳細資訊，請參閱 [連接字串](../connection-string-builders.md)產生器。</span><span class="sxs-lookup"><span data-stu-id="2abd3-141">For information about connection string builders for ADO.NET providers, see [Connection String Builders](../connection-string-builders.md).</span></span>  
  
 <span data-ttu-id="2abd3-142">如需詳細資訊，請參閱[保護連線資訊](../protecting-connection-information.md)。</span><span class="sxs-lookup"><span data-stu-id="2abd3-142">For more information, see [Protecting Connection Information](../protecting-connection-information.md).</span></span>  
  
#### <a name="do-not-expose-an-entityconnection-to-untrusted-users"></a><span data-ttu-id="2abd3-143">請勿將 EntityConnection 公開 (Expose) 給未受信任的使用者。</span><span class="sxs-lookup"><span data-stu-id="2abd3-143">Do not expose an EntityConnection to untrusted users.</span></span>  

 <span data-ttu-id="2abd3-144"><xref:System.Data.EntityClient.EntityConnection> 物件會公開基礎連接的連接字串。</span><span class="sxs-lookup"><span data-stu-id="2abd3-144">An <xref:System.Data.EntityClient.EntityConnection> object exposes the connection string of the underlying connection.</span></span> <span data-ttu-id="2abd3-145">擁有 <xref:System.Data.EntityClient.EntityConnection> 物件存取權的使用者也可以變更基礎連接的 <xref:System.Data.ConnectionState>。</span><span class="sxs-lookup"><span data-stu-id="2abd3-145">A user with access to an <xref:System.Data.EntityClient.EntityConnection> object can also change the <xref:System.Data.ConnectionState> of the underlying connection.</span></span> <span data-ttu-id="2abd3-146"><xref:System.Data.EntityClient.EntityConnection> 類別不具備執行緒安全。</span><span class="sxs-lookup"><span data-stu-id="2abd3-146">The <xref:System.Data.EntityClient.EntityConnection> class is not thread safe.</span></span>  
  
#### <a name="do-not-pass-connections-outside-the-security-context"></a><span data-ttu-id="2abd3-147">請勿在安全性內容外部傳遞連接。</span><span class="sxs-lookup"><span data-stu-id="2abd3-147">Do not pass connections outside the security context.</span></span>  

 <span data-ttu-id="2abd3-148">已經建立連接之後，您就不得在安全性內容外部傳遞連接。</span><span class="sxs-lookup"><span data-stu-id="2abd3-148">After a connection has been established, you must not pass it outside the security context.</span></span> <span data-ttu-id="2abd3-149">例如，某個具有開啟連接之權限的執行緒不應該將連接儲存在全域位置中。</span><span class="sxs-lookup"><span data-stu-id="2abd3-149">For example, one thread with permission to open a connection should not store the connection in a global location.</span></span> <span data-ttu-id="2abd3-150">如果可以在全域位置中使用此連接，則其他惡意執行緒可能會在沒有明確授與權限的情況下，使用開啟的連接。</span><span class="sxs-lookup"><span data-stu-id="2abd3-150">If the connection is available in a global location, then another malicious thread can use the open connection without having that permission explicitly granted to it.</span></span>  
  
#### <a name="be-aware-that-logon-information-and-passwords-may-be-visible-in-a-memory-dump"></a><span data-ttu-id="2abd3-151">請注意，登入資訊和密碼可能會顯示在記憶體傾印中。</span><span class="sxs-lookup"><span data-stu-id="2abd3-151">Be aware that logon information and passwords may be visible in a memory dump.</span></span>  

 <span data-ttu-id="2abd3-152">當連接字串提供了資料來源的登入和密碼資訊時，這項資訊就會保留在記憶體中，直到記憶體回收作業回收了這些資源為止。</span><span class="sxs-lookup"><span data-stu-id="2abd3-152">When data source logon and password information is supplied in the connection string, this information is maintained in memory until garbage collection reclaims the resources.</span></span> <span data-ttu-id="2abd3-153">這樣做可讓人無法判斷密碼字串不再位於記憶體中的時間。</span><span class="sxs-lookup"><span data-stu-id="2abd3-153">This makes it impossible to determine when a password string is no longer in memory.</span></span> <span data-ttu-id="2abd3-154">如果應用程式損毀，記憶體傾印檔可能會包含機密安全性資訊，而且執行應用程式的使用者和擁有電腦管理存取權的任何使用者都可以檢視此記憶體傾印檔。</span><span class="sxs-lookup"><span data-stu-id="2abd3-154">If an application crashes, a memory dump file may contain sensitive security information, and the user running the application and any user with administrative access to the computer can view the memory dump file.</span></span> <span data-ttu-id="2abd3-155">您可以使用 Windows 驗證來連接到 Microsoft SQL Server。</span><span class="sxs-lookup"><span data-stu-id="2abd3-155">Use Windows Authentication for connections to Microsoft SQL Server.</span></span>  
  
#### <a name="grant-users-only-the-necessary-permissions-in-the-data-source"></a><span data-ttu-id="2abd3-156">只授與資料來源中的必要權限給使用者。</span><span class="sxs-lookup"><span data-stu-id="2abd3-156">Grant users only the necessary permissions in the data source.</span></span>  

 <span data-ttu-id="2abd3-157">資料來源管理員應該只授與必要的權限給使用者。</span><span class="sxs-lookup"><span data-stu-id="2abd3-157">A data source administrator should grant only the necessary permissions to users.</span></span> <span data-ttu-id="2abd3-158">即使 [!INCLUDE[esql](../../../../../includes/esql-md.md)] 不支援修改資料的 DML 陳述式 (Statement) (例如 INSERT、UPDATE 或 DELETE)，使用者仍然可以存取資料來源的連接。</span><span class="sxs-lookup"><span data-stu-id="2abd3-158">Even though [!INCLUDE[esql](../../../../../includes/esql-md.md)] does not support DML statements that modify data, such as INSERT, UPDATE, or DELETE, users can still access the connection to the data source.</span></span> <span data-ttu-id="2abd3-159">不過，惡意使用者可能會使用這個連接，以資料來源的原生語言執行 DML 陳述式。</span><span class="sxs-lookup"><span data-stu-id="2abd3-159">A malicious user could use this connection to execute DML statements in the native language of the data source.</span></span>  
  
#### <a name="run-applications-with-the-minimum-permissions"></a><span data-ttu-id="2abd3-160">使用最低權限來執行應用程式。</span><span class="sxs-lookup"><span data-stu-id="2abd3-160">Run applications with the minimum permissions.</span></span>  

 <span data-ttu-id="2abd3-161">當您允許受控應用程式以完全信任許可權執行時，.NET Framework 不會限制應用程式存取您的電腦。</span><span class="sxs-lookup"><span data-stu-id="2abd3-161">When you allow a managed application to run with full-trust permission, the .NET Framework does not limit the application's access to your computer.</span></span> <span data-ttu-id="2abd3-162">這樣做可能會讓應用程式存在安全性弱點，進而危害整個系統。</span><span class="sxs-lookup"><span data-stu-id="2abd3-162">This may enable a security vulnerability in your application to compromise the entire system.</span></span> <span data-ttu-id="2abd3-163">若要在 .NET Framework 中使用代碼啟用安全性和其他安全性機制，您應該使用部分信任許可權，以及啟用應用程式運作所需的最低許可權集合，來執行應用程式。</span><span class="sxs-lookup"><span data-stu-id="2abd3-163">To use code access security and other security mechanisms in the .NET Framework, you should run applications by using partial-trust permissions and with the minimum set of permissions that are needed to enable the application to function.</span></span> <span data-ttu-id="2abd3-164">下列程式碼存取權限是 Entity Framework 應用程式所需的最小許可權：</span><span class="sxs-lookup"><span data-stu-id="2abd3-164">The following code access permissions are the minimum permissions your Entity Framework application needs:</span></span>  
  
- <span data-ttu-id="2abd3-165"><xref:System.Security.Permissions.FileIOPermission>：<xref:System.Security.Permissions.FileIOPermissionAccess.Write> (用以開啟指定的中繼資料檔案) 或 <xref:System.Security.Permissions.FileIOPermissionAccess.PathDiscovery> (用以搜尋中繼資料檔案的目錄)。</span><span class="sxs-lookup"><span data-stu-id="2abd3-165"><xref:System.Security.Permissions.FileIOPermission>: <xref:System.Security.Permissions.FileIOPermissionAccess.Write> to open the specified metadata files or <xref:System.Security.Permissions.FileIOPermissionAccess.PathDiscovery> to search a directory for metadata files.</span></span>  
  
- <span data-ttu-id="2abd3-166"><xref:System.Security.Permissions.ReflectionPermission>：<xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess> (用以支援 LINQ to Entities 查詢)。</span><span class="sxs-lookup"><span data-stu-id="2abd3-166"><xref:System.Security.Permissions.ReflectionPermission>: <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess> to support LINQ to Entities queries.</span></span>  
  
- <span data-ttu-id="2abd3-167"><xref:System.Transactions.DistributedTransactionPermission>：<xref:System.Security.Permissions.PermissionState.Unrestricted> (用以在 <xref:System.Transactions><xref:System.Transactions.Transaction> 中登記)。</span><span class="sxs-lookup"><span data-stu-id="2abd3-167"><xref:System.Transactions.DistributedTransactionPermission>: <xref:System.Security.Permissions.PermissionState.Unrestricted> to enlist in a <xref:System.Transactions><xref:System.Transactions.Transaction>.</span></span>  
  
- <span data-ttu-id="2abd3-168"><xref:System.Security.Permissions.SecurityPermission>：<xref:System.Security.Permissions.SecurityPermissionFlag.SerializationFormatter> (用以使用 <xref:System.Runtime.Serialization.ISerializable> 介面來序列化例外狀況 (Exception))。</span><span class="sxs-lookup"><span data-stu-id="2abd3-168"><xref:System.Security.Permissions.SecurityPermission>: <xref:System.Security.Permissions.SecurityPermissionFlag.SerializationFormatter> to serialize exceptions by using the <xref:System.Runtime.Serialization.ISerializable> interface.</span></span>  
  
- <span data-ttu-id="2abd3-169">開啟資料庫連接並對資料庫執行命令的許可權，例如 <xref:System.Data.SqlClient.SqlClientPermission> SQL Server 資料庫。</span><span class="sxs-lookup"><span data-stu-id="2abd3-169">Permission to open a database connection and execute commands against the database, such as <xref:System.Data.SqlClient.SqlClientPermission> for a SQL Server database.</span></span>  
  
 <span data-ttu-id="2abd3-170">如需詳細資訊，請參閱 [Code Access Security and ADO.NET](../code-access-security.md)。</span><span class="sxs-lookup"><span data-stu-id="2abd3-170">For more information, see [Code Access Security and ADO.NET](../code-access-security.md).</span></span>  
  
#### <a name="do-not-install-untrusted-applications"></a><span data-ttu-id="2abd3-171">請勿安裝未受信任的應用程式。</span><span class="sxs-lookup"><span data-stu-id="2abd3-171">Do not install untrusted applications.</span></span>  

 <span data-ttu-id="2abd3-172">Entity Framework 不會強制執行任何安全性許可權，而且不論是否受信任，都會在進程中叫用任何使用者提供的資料物件程式碼。</span><span class="sxs-lookup"><span data-stu-id="2abd3-172">The Entity Framework does not enforce any security permissions and will invoke any user-supplied data object code in process regardless of whether it is trusted or not.</span></span> <span data-ttu-id="2abd3-173">請確定資料存放區和應用程式都會執行用戶端的驗證與授權。</span><span class="sxs-lookup"><span data-stu-id="2abd3-173">Ensure that authentication and authorization of the client is performed by the data store and by your application.</span></span>  
  
#### <a name="restrict-access-to-all-configuration-files"></a><span data-ttu-id="2abd3-174">限制所有組態檔的存取權。</span><span class="sxs-lookup"><span data-stu-id="2abd3-174">Restrict access to all configuration files.</span></span>  

 <span data-ttu-id="2abd3-175">系統管理員必須限制對指定應用程式設定的所有檔案的寫入存取權，包括 enterprisesec.config、security.config、電腦和應用程式佈建檔 \<*application*>.exe.config。</span><span class="sxs-lookup"><span data-stu-id="2abd3-175">An administrator must restrict write access to all files that specify configuration for an application, including to enterprisesec.config, security.config, machine.conf, and the application configuration file \<*application*>.exe.config.</span></span>  
  
 <span data-ttu-id="2abd3-176">在 app.config 中，提供者的不變名稱是可修改的。用戶端應用程式必須負責使用強式名稱透過標準提供者 factory 模型來存取基礎提供者。</span><span class="sxs-lookup"><span data-stu-id="2abd3-176">The provider invariant name is modifiable in the app.config. The client application must take responsibility for accessing the underlying provider through the standard provider factory model by using a strong name.</span></span>  
  
#### <a name="restrict-permissions-to-the-model-and-mapping-files"></a><span data-ttu-id="2abd3-177">限制模型和對應檔的權限。</span><span class="sxs-lookup"><span data-stu-id="2abd3-177">Restrict permissions to the model and mapping files.</span></span>  

 <span data-ttu-id="2abd3-178">管理員必須將模型和對應檔 (.edmx、.csdl、.ssdl 和 .msl) 的寫入存取權限制為只有修改模型或對應的使用者。</span><span class="sxs-lookup"><span data-stu-id="2abd3-178">An administrator must restrict write access to the model and mapping files (.edmx, .csdl, .ssdl, and .msl) to only users who modify the model or mappings.</span></span> <span data-ttu-id="2abd3-179">Entity Framework 只需要在執行時間讀取這些檔案的許可權。</span><span class="sxs-lookup"><span data-stu-id="2abd3-179">The Entity Framework only requires read access to these files at run time.</span></span> <span data-ttu-id="2abd3-180">系統管理員也應該限制存取實體資料模型工具產生的物件層和預先編譯的視圖原始程式碼檔。</span><span class="sxs-lookup"><span data-stu-id="2abd3-180">An administrator should also restrict access to object layer and pre-compiled view source code files that are generated by the Entity Data Model tools.</span></span>  
  
## <a name="security-considerations-for-queries"></a><span data-ttu-id="2abd3-181">查詢的安全性考量</span><span class="sxs-lookup"><span data-stu-id="2abd3-181">Security Considerations for Queries</span></span>  

 <span data-ttu-id="2abd3-182">查詢概念模型時適用下列安全性考量。</span><span class="sxs-lookup"><span data-stu-id="2abd3-182">The following security considerations apply when querying a conceptual model.</span></span> <span data-ttu-id="2abd3-183">這些考量適用於使用 EntityClient 的 [!INCLUDE[esql](../../../../../includes/esql-md.md)] 查詢以及使用 LINQ、[!INCLUDE[esql](../../../../../includes/esql-md.md)] 的物件，並查詢產生器方法。</span><span class="sxs-lookup"><span data-stu-id="2abd3-183">These considerations apply to [!INCLUDE[esql](../../../../../includes/esql-md.md)] queries using EntityClient and to object queries using LINQ, [!INCLUDE[esql](../../../../../includes/esql-md.md)], and query builder methods.</span></span>  
  
#### <a name="prevent-sql-injection-attacks"></a><span data-ttu-id="2abd3-184">避免 SQL 插入式攻擊。</span><span class="sxs-lookup"><span data-stu-id="2abd3-184">Prevent SQL injection attacks.</span></span>  

 <span data-ttu-id="2abd3-185">應用程式經常會接受外部輸入 (來自使用者或其他外部代理程式) 以及根據該項輸入執行動作。</span><span class="sxs-lookup"><span data-stu-id="2abd3-185">Applications frequently take external input (from a user or another external agent) and perform actions based on that input.</span></span> <span data-ttu-id="2abd3-186">任何直接或間接衍生自使用者或外部代理程式的輸入都可能會具有使用目標語言語法以便執行未授權動作的內容。</span><span class="sxs-lookup"><span data-stu-id="2abd3-186">Any input that is directly or indirectly derived from the user or an external agent might have content that uses the syntax of the target language in order to perform unauthorized actions.</span></span> <span data-ttu-id="2abd3-187">當目的語言是結構化查詢語言 (SQL)  (SQL) （例如 Transact-sql）時，這項操作稱為「SQL 插入式攻擊」。</span><span class="sxs-lookup"><span data-stu-id="2abd3-187">When the target language is a Structured Query Language (SQL), such as Transact-SQL, this manipulation is known as a SQL injection attack.</span></span> <span data-ttu-id="2abd3-188">惡意使用者可能會將命令直接插入查詢中，並且卸除資料庫資料表、導致阻斷服務攻擊，或以其他方式變更正在執行之作業的本質。</span><span class="sxs-lookup"><span data-stu-id="2abd3-188">A malicious user can inject commands directly into the query and drop a database table, cause a denial of service, or otherwise change the nature of the operation being performed.</span></span>  
  
- [!INCLUDE[esql](../../../../../includes/esql-md.md)] <span data-ttu-id="2abd3-189">插入式攻擊：</span><span class="sxs-lookup"><span data-stu-id="2abd3-189">injection attacks:</span></span>  
  
     <span data-ttu-id="2abd3-190">使用者可能會透過提供惡意輸入給查詢述詞 (Predicate) 和參數名稱所使用的值，在 [!INCLUDE[esql](../../../../../includes/esql-md.md)] 中執行 SQL 插入式攻擊。</span><span class="sxs-lookup"><span data-stu-id="2abd3-190">SQL injection attacks can be performed in [!INCLUDE[esql](../../../../../includes/esql-md.md)] by supplying malicious input to values that are used in a query predicate and in parameter names.</span></span> <span data-ttu-id="2abd3-191">若要避免 SQL 插入式攻擊的風險，請勿結合使用者輸入與 [!INCLUDE[esql](../../../../../includes/esql-md.md)] 命令文字。</span><span class="sxs-lookup"><span data-stu-id="2abd3-191">To avoid the risk of SQL injection, you should never combine user input with [!INCLUDE[esql](../../../../../includes/esql-md.md)] command text.</span></span>  
  
     [!INCLUDE[esql](../../../../../includes/esql-md.md)] <span data-ttu-id="2abd3-192">查詢會在可接受常值 (Literal) 的任何位置接受參數。</span><span class="sxs-lookup"><span data-stu-id="2abd3-192">queries accept parameters everywhere that literals are accepted.</span></span> <span data-ttu-id="2abd3-193">您應該使用參數型查詢，而非直接將外部代理程式的常值插入查詢中。</span><span class="sxs-lookup"><span data-stu-id="2abd3-193">You should use parameterized queries instead of injecting literals from an external agent directly into the query.</span></span> <span data-ttu-id="2abd3-194">您也應該考慮使用 [查詢](/previous-versions/dotnet/netframework-4.0/bb896238(v=vs.100)) 產生器方法，安全地建立 Entity SQL。</span><span class="sxs-lookup"><span data-stu-id="2abd3-194">You should also consider using [query builder methods](/previous-versions/dotnet/netframework-4.0/bb896238(v=vs.100)) to safely construct Entity SQL.</span></span>  
  
- <span data-ttu-id="2abd3-195">LINQ to Entities 的插入式攻擊：</span><span class="sxs-lookup"><span data-stu-id="2abd3-195">LINQ to Entities injection attacks:</span></span>  
  
     <span data-ttu-id="2abd3-196">雖然可以在 LINQ to Entities 中進行查詢組合，但是它是透過物件模型 API 來執行。</span><span class="sxs-lookup"><span data-stu-id="2abd3-196">Although query composition is possible in LINQ to Entities, it is performed through the object model API.</span></span> <span data-ttu-id="2abd3-197">與 [!INCLUDE[esql](../../../../../includes/esql-md.md)] 查詢不同的是，LINQ to Entities 查詢不是使用字串操作或串連所撰寫，而且不容易遭受傳統的 SQL 插入式攻擊。</span><span class="sxs-lookup"><span data-stu-id="2abd3-197">Unlike [!INCLUDE[esql](../../../../../includes/esql-md.md)] queries, LINQ to Entities queries are not composed by using string manipulation or concatenation, and they are not susceptible to traditional SQL injection attacks.</span></span>  
  
#### <a name="prevent-very-large-result-sets"></a><span data-ttu-id="2abd3-198">避免非常龐大的結果集。</span><span class="sxs-lookup"><span data-stu-id="2abd3-198">Prevent very large result sets.</span></span>  

 <span data-ttu-id="2abd3-199">如果用戶端正在執行耗用資源與結果集大小成正比的作業，非常龐大的結果集可能會導致用戶端系統關閉。</span><span class="sxs-lookup"><span data-stu-id="2abd3-199">A very large result set could cause the client system to shut down if the client is performing operations that consume resources proportional to the size of the result set.</span></span> <span data-ttu-id="2abd3-200">意外龐大的結果集可能會在下列狀況下發生：</span><span class="sxs-lookup"><span data-stu-id="2abd3-200">Unexpectedly large result sets can occur under the following conditions:</span></span>  
  
- <span data-ttu-id="2abd3-201">在針對大型資料庫而且不包含適當篩選條件的查詢中。</span><span class="sxs-lookup"><span data-stu-id="2abd3-201">In queries against a large database that do not include appropriate filter conditions.</span></span>  
  
- <span data-ttu-id="2abd3-202">在針對伺服器建立 Cartesian 聯結 (Join) 的查詢中。</span><span class="sxs-lookup"><span data-stu-id="2abd3-202">In queries that create Cartesian joins on the server.</span></span>  
  
- <span data-ttu-id="2abd3-203">在巢狀 [!INCLUDE[esql](../../../../../includes/esql-md.md)] 查詢中。</span><span class="sxs-lookup"><span data-stu-id="2abd3-203">In nested [!INCLUDE[esql](../../../../../includes/esql-md.md)] queries.</span></span>  
  
 <span data-ttu-id="2abd3-204">接受使用者輸入時，您必須確定輸入不會導致結果集變成超過系統能夠處理的大小。</span><span class="sxs-lookup"><span data-stu-id="2abd3-204">When accepting user input, you must make sure that the input cannot cause result sets to become larger than what the system can handle.</span></span> <span data-ttu-id="2abd3-205">您也可以使用 LINQ to Entities 中的 <xref:System.Linq.Queryable.Take%2A> 方法或中的 [limit](./language-reference/limit-entity-sql.md) 運算子 [!INCLUDE[esql](../../../../../includes/esql-md.md)] 來限制結果集的大小。</span><span class="sxs-lookup"><span data-stu-id="2abd3-205">You can also use the <xref:System.Linq.Queryable.Take%2A> method in LINQ to Entities or the [LIMIT](./language-reference/limit-entity-sql.md) operator in [!INCLUDE[esql](../../../../../includes/esql-md.md)] to limit the size of the result set.</span></span>  
  
#### <a name="avoid-returning-iqueryable-results-when-exposing-methods-to-potentially-untrusted-callers"></a><span data-ttu-id="2abd3-206">避免在將方法公開至可能未受信任的呼叫端時傳回 IQueryable 結果。</span><span class="sxs-lookup"><span data-stu-id="2abd3-206">Avoid Returning IQueryable Results When Exposing Methods to Potentially Untrusted Callers.</span></span>  

 <span data-ttu-id="2abd3-207">基於下列原因，應避免從公開至可能未受信任之呼叫端的方法傳回 <xref:System.Linq.IQueryable%601> 類型：</span><span class="sxs-lookup"><span data-stu-id="2abd3-207">Avoid returning <xref:System.Linq.IQueryable%601> types from methods that are exposed to potentially untrusted callers for the following reasons:</span></span>  
  
- <span data-ttu-id="2abd3-208">會公開 <xref:System.Linq.IQueryable%601> 類型的查詢消費者可能會針對結果呼叫方法，而該些方法會公開安全資料或增加結果集的大小。</span><span class="sxs-lookup"><span data-stu-id="2abd3-208">A consumer of a query that exposes an <xref:System.Linq.IQueryable%601> type could call methods on the result that expose secure data or increase the size of the result set.</span></span> <span data-ttu-id="2abd3-209">例如，請考慮下列方法簽章：</span><span class="sxs-lookup"><span data-stu-id="2abd3-209">For example, consider the following method signature:</span></span>  

    ```csharp
    public IQueryable<Customer> GetCustomer(int customerId)
    ```

    <span data-ttu-id="2abd3-210">此查詢的消費者可能會針對傳回的 `.Include("Orders")`呼叫 `IQueryable<Customer>` ，以擷取查詢未打算公開的資料。</span><span class="sxs-lookup"><span data-stu-id="2abd3-210">A consumer of this query could call `.Include("Orders")` on the returned `IQueryable<Customer>` to retrieve data that the query did not intend to expose.</span></span> <span data-ttu-id="2abd3-211">將方法的傳回型別變更為 <xref:System.Collections.Generic.IEnumerable%601> 並呼叫會具體化結果的方法 (例如 `.ToList()`)，便可以避免發生此情況。</span><span class="sxs-lookup"><span data-stu-id="2abd3-211">This can be avoided by changing the return type of the method to <xref:System.Collections.Generic.IEnumerable%601> and calling a method (such as `.ToList()`) that materializes the results.</span></span>  
  
- <span data-ttu-id="2abd3-212">因為 <xref:System.Linq.IQueryable%601> 查詢會在反覆查看結果時執行，所以會公開 <xref:System.Linq.IQueryable%601> 型別的查詢消費者可以攔截被擲回的例外狀況。</span><span class="sxs-lookup"><span data-stu-id="2abd3-212">Because <xref:System.Linq.IQueryable%601> queries are executed when the results are iterated over, a consumer of a query that exposes an <xref:System.Linq.IQueryable%601> type could catch exceptions that are thrown.</span></span> <span data-ttu-id="2abd3-213">例外狀況可能包含消費者不適用的資訊。</span><span class="sxs-lookup"><span data-stu-id="2abd3-213">Exceptions could contain information not intended for the consumer.</span></span>  
  
## <a name="security-considerations-for-entities"></a><span data-ttu-id="2abd3-214">實體的安全性考量</span><span class="sxs-lookup"><span data-stu-id="2abd3-214">Security Considerations for Entities</span></span>  

 <span data-ttu-id="2abd3-215">下列安全性考量會在產生和使用實體類型時適用。</span><span class="sxs-lookup"><span data-stu-id="2abd3-215">The following security considerations apply when generating and working with entity types.</span></span>  
  
#### <a name="do-not-share-an-objectcontext-across-application-domains"></a><span data-ttu-id="2abd3-216">請勿在應用程式定義域中共用 ObjectContext。</span><span class="sxs-lookup"><span data-stu-id="2abd3-216">Do not share an ObjectContext across application domains.</span></span>  

 <span data-ttu-id="2abd3-217">與多個應用程式定義域共用 <xref:System.Data.Objects.ObjectContext> 可能會公開連接字串中的資訊。</span><span class="sxs-lookup"><span data-stu-id="2abd3-217">Sharing an <xref:System.Data.Objects.ObjectContext> with more than one application domain may expose information in the connection string.</span></span> <span data-ttu-id="2abd3-218">您應該改為將序列化物件或物件圖形傳輸至其他應用程式定義域，然後將這些物件附加至該應用程式定義域中的 <xref:System.Data.Objects.ObjectContext>。</span><span class="sxs-lookup"><span data-stu-id="2abd3-218">Instead, you should transfer serialized objects or object graphs to the other application domain and then attach those objects to an <xref:System.Data.Objects.ObjectContext> in that application domain.</span></span> <span data-ttu-id="2abd3-219">如需詳細資訊，請參閱序列化 [物件](/previous-versions/dotnet/netframework-4.0/bb738446(v=vs.100))。</span><span class="sxs-lookup"><span data-stu-id="2abd3-219">For more information, see [Serializing Objects](/previous-versions/dotnet/netframework-4.0/bb738446(v=vs.100)).</span></span>  
  
#### <a name="prevent-type-safety-violations"></a><span data-ttu-id="2abd3-220">避免型別安全 (Type Safety) 違規。</span><span class="sxs-lookup"><span data-stu-id="2abd3-220">Prevent type safety violations.</span></span>  

 <span data-ttu-id="2abd3-221">如果違反了型別安全，Entity Framework 無法保證物件中資料的完整性。</span><span class="sxs-lookup"><span data-stu-id="2abd3-221">If type safety is violated, the Entity Framework cannot guarantee the integrity of data in objects.</span></span> <span data-ttu-id="2abd3-222">如果您允許未受信任的應用程式使用完全信任的程式碼存取安全性來執行，可能就會發生型別安全違規。</span><span class="sxs-lookup"><span data-stu-id="2abd3-222">Type safety violations could occur if you allow untrusted applications to run with full-trust code access security.</span></span>  
  
#### <a name="handle-exceptions"></a><span data-ttu-id="2abd3-223">處理例外狀況。</span><span class="sxs-lookup"><span data-stu-id="2abd3-223">Handle exceptions.</span></span>  

 <span data-ttu-id="2abd3-224">存取 try-catch 區塊內 <xref:System.Data.Objects.ObjectContext> 的方法和屬性。</span><span class="sxs-lookup"><span data-stu-id="2abd3-224">Access methods and properties of an <xref:System.Data.Objects.ObjectContext> within a try-catch block.</span></span> <span data-ttu-id="2abd3-225">攔截例外狀況可避免未處理的例外狀況將 <xref:System.Data.Objects.ObjectStateManager> 中的項目或模型資訊 (例如資料表名稱) 公開給應用程式的使用者。</span><span class="sxs-lookup"><span data-stu-id="2abd3-225">Catching exceptions prevents unhandled exceptions from exposing entries in the <xref:System.Data.Objects.ObjectStateManager> or model information (such as table names) to users of your application.</span></span>  
  
## <a name="security-considerations-for-aspnet-applications"></a><span data-ttu-id="2abd3-226">ASP.NET 應用程式的安全性考量</span><span class="sxs-lookup"><span data-stu-id="2abd3-226">Security Considerations for ASP.NET Applications</span></span>  

<span data-ttu-id="2abd3-227">當您在 ASP.NET 應用程式中使用路徑時，應該考慮下列事項。</span><span class="sxs-lookup"><span data-stu-id="2abd3-227">You should consider the following when you work with paths in ASP.NET applications.</span></span>  
  
#### <a name="verify-whether-your-host-performs-path-checks"></a><span data-ttu-id="2abd3-228">確認主應用程式 (Host) 是否執行路徑檢查。</span><span class="sxs-lookup"><span data-stu-id="2abd3-228">Verify whether your host performs path checks.</span></span>  

 <span data-ttu-id="2abd3-229">`|DataDirectory|`使用以管道符號括住的 () 替代字串時，ADO.NET 會確認是否支援已解析的路徑。</span><span class="sxs-lookup"><span data-stu-id="2abd3-229">When the `|DataDirectory|` (enclosed in pipe symbols) substitution string is used, ADO.NET verifies that the resolved path is supported.</span></span> <span data-ttu-id="2abd3-230">例如，不允許在 `DataDirectory` 後面使用 ".."。</span><span class="sxs-lookup"><span data-stu-id="2abd3-230">For example, ".." is not allowed behind `DataDirectory`.</span></span> <span data-ttu-id="2abd3-231">用來解析 Web 應用程式根運算子的相同檢查 (`~`) 是由進程裝載 ASP.NET 所執行。</span><span class="sxs-lookup"><span data-stu-id="2abd3-231">That same check for resolving the Web application root operator (`~`) is performed by the process hosting ASP.NET.</span></span> <span data-ttu-id="2abd3-232">IIS 會執行這項檢查。不過，IIS 以外的主應用程式可能不會確認是否支援已解析的路徑。</span><span class="sxs-lookup"><span data-stu-id="2abd3-232">IIS performs this check; however, hosts other than IIS may not verify that the resolved path is supported.</span></span> <span data-ttu-id="2abd3-233">您應該知道部署 Entity Framework 應用程式的主機行為。</span><span class="sxs-lookup"><span data-stu-id="2abd3-233">You should know the behavior of the host on which you deploy an Entity Framework application.</span></span>  
  
#### <a name="do-not-make-assumptions-about-resolved-path-names"></a><span data-ttu-id="2abd3-234">請勿針對已解析的路徑名稱提出任何假設。</span><span class="sxs-lookup"><span data-stu-id="2abd3-234">Do not make assumptions about resolved path names.</span></span>  

 <span data-ttu-id="2abd3-235">雖然根運算子 (`~`) 和 `DataDirectory` 替代字串解析的值，在應用程式的執行時間中應該保持不變，但 Entity Framework 不會限制主機修改這些值。</span><span class="sxs-lookup"><span data-stu-id="2abd3-235">Although the values to which the root operator (`~`) and the `DataDirectory` substitution string resolve should remain constant during the application's runtime, the Entity Framework does not restrict the host from modifying these values.</span></span>  
  
#### <a name="verify-the-path-length-before-deployment"></a><span data-ttu-id="2abd3-236">在部署之前確認路徑長度。</span><span class="sxs-lookup"><span data-stu-id="2abd3-236">Verify the path length before deployment.</span></span>  

 <span data-ttu-id="2abd3-237">部署 Entity Framework 應用程式之前，您應該確定根運算子 (~) 和 `DataDirectory` 替代字串的值未超過作業系統中路徑長度的限制。</span><span class="sxs-lookup"><span data-stu-id="2abd3-237">Before deploying an Entity Framework application, you should ensure that the values of the root operator (~) and `DataDirectory` substitution string do not exceed the limits of the path length in the operating system.</span></span> <span data-ttu-id="2abd3-238">ADO.NET 資料提供者不會確定路徑長度是否在有效的限制內。</span><span class="sxs-lookup"><span data-stu-id="2abd3-238">ADO.NET data providers do not ensure that the path length is within valid limits.</span></span>  
  
## <a name="security-considerations-for-adonet-metadata"></a><span data-ttu-id="2abd3-239">ADO.NET 中繼資料的安全性考量</span><span class="sxs-lookup"><span data-stu-id="2abd3-239">Security Considerations for ADO.NET Metadata</span></span>  

 <span data-ttu-id="2abd3-240">下列安全性考量會在產生和使用模型與對應檔時適用。</span><span class="sxs-lookup"><span data-stu-id="2abd3-240">The following security considerations apply when generating and working with model and mapping files.</span></span>  
  
#### <a name="do-not-expose-sensitive-information-through-logging"></a><span data-ttu-id="2abd3-241">請勿透過記錄公開機密資訊。</span><span class="sxs-lookup"><span data-stu-id="2abd3-241">Do not expose sensitive information through logging.</span></span>  

<span data-ttu-id="2abd3-242">ADO.NET 中繼資料服務元件不會記錄任何私用資訊。</span><span class="sxs-lookup"><span data-stu-id="2abd3-242">ADO.NET metadata service components do not log any private information.</span></span> <span data-ttu-id="2abd3-243">如果存在由於存取限制而無法傳回的結果，資料庫管理系統和檔案系統應該會傳回零筆結果，而非引發可能包含機密資訊的例外狀況。</span><span class="sxs-lookup"><span data-stu-id="2abd3-243">If there are results that cannot be returned because of access restrictions, database management systems and file systems should return zero results instead of raising an exception that could contain sensitive information.</span></span>  
  
#### <a name="do-not-accept-metadataworkspace-objects-from-untrusted-sources"></a><span data-ttu-id="2abd3-244">請勿接受來自未受信任來源的 MetadataWorkspace 物件。</span><span class="sxs-lookup"><span data-stu-id="2abd3-244">Do not accept MetadataWorkspace objects from untrusted sources.</span></span>  

 <span data-ttu-id="2abd3-245">應用程式不應該接受來自未受信任來源之 <xref:System.Data.Metadata.Edm.MetadataWorkspace> 類別的執行個體 (Instance)。</span><span class="sxs-lookup"><span data-stu-id="2abd3-245">Applications should not accept instances of the <xref:System.Data.Metadata.Edm.MetadataWorkspace> class from untrusted sources.</span></span> <span data-ttu-id="2abd3-246">您應該改為根據這類來源明確建構並填入工作區 (Workspace)。</span><span class="sxs-lookup"><span data-stu-id="2abd3-246">Instead, you should explicitly construct and populate a workspace from such a source.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="2abd3-247">另請參閱</span><span class="sxs-lookup"><span data-stu-id="2abd3-247">See also</span></span>

- [<span data-ttu-id="2abd3-248">設定 ADO.NET 應用程式的安全性</span><span class="sxs-lookup"><span data-stu-id="2abd3-248">Securing ADO.NET Applications</span></span>](../securing-ado-net-applications.md)
- [<span data-ttu-id="2abd3-249">部署考慮</span><span class="sxs-lookup"><span data-stu-id="2abd3-249">Deployment Considerations</span></span>](deployment-considerations.md)
- [<span data-ttu-id="2abd3-250">遷移考慮</span><span class="sxs-lookup"><span data-stu-id="2abd3-250">Migration Considerations</span></span>](migration-considerations.md)
