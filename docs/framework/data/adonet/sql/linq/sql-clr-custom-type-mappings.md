---
title: SQL-CLR 自訂類型對應
ms.date: 03/30/2017
ms.assetid: d916c7fb-4b56-4214-acbe-5e23365047b2
ms.openlocfilehash: 14d7f8409f93a5414a37a8b1c8e172f53478e817
ms.sourcegitcommit: 5b475c1855b32cf78d2d1bbb4295e4c236f39464
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/24/2020
ms.locfileid: "91155701"
---
# <a name="sql-clr-custom-type-mappings"></a><span data-ttu-id="b7068-102">SQL-CLR 自訂類型對應</span><span class="sxs-lookup"><span data-stu-id="b7068-102">SQL-CLR Custom Type Mappings</span></span>

<span data-ttu-id="b7068-103">當您使用 SQLMetal 命令列工具或物件關聯式設計工具 (O/R 設計工具) 時，系統就會自動指定 SQL Server 與 Common Language Runtime (CLR) 之間的型別對應。</span><span class="sxs-lookup"><span data-stu-id="b7068-103">Type mapping between SQL Server and the common language runtime (CLR) is automatically specified when you use the SQLMetal command-line tool, Object Relational Designer (O/R Designer).</span></span>  
  
 <span data-ttu-id="b7068-104">當沒有執行自訂對應時，這些工具會指派預設類型對應，如 [SQL-CLR 型別對應](sql-clr-type-mapping.md)中所述。</span><span class="sxs-lookup"><span data-stu-id="b7068-104">When no customized mapping is performed, these tools assign default type mappings as described in [SQL-CLR Type Mapping](sql-clr-type-mapping.md).</span></span> <span data-ttu-id="b7068-105">如果您想要建立與這些預設值不同的型別對應，就必須進行一些型別對應的自訂作業。</span><span class="sxs-lookup"><span data-stu-id="b7068-105">If you want to type mappings differently from these defaults, you need to do some customization of the type mappings.</span></span>  
  
 <span data-ttu-id="b7068-106">自訂型別對應時，建議的方法是在中繼 DBML 檔案中進行這些變更。</span><span class="sxs-lookup"><span data-stu-id="b7068-106">When customizing type mappings, the recommended approach is to make the changes in an intermediary DBML file.</span></span> <span data-ttu-id="b7068-107">然後，當您使用 SQLMetal 或 O/R 設計工具來建立程式碼和對應檔案時，就應該使用自訂的 DBML 檔案。</span><span class="sxs-lookup"><span data-stu-id="b7068-107">Then, your customized DBML file should be used when you create you code and mapping files with SQLMetal or O/R Designer.</span></span>  
  
 <span data-ttu-id="b7068-108">一旦您從程式碼和對應檔案具現化 <xref:System.Data.Linq.DataContext> 物件之後，<xref:System.Data.Linq.DataContext.CreateDatabase%2A?displayProperty=nameWithType> 方法就會根據指定的型別對應來建立資料庫。</span><span class="sxs-lookup"><span data-stu-id="b7068-108">Once you instantiate the <xref:System.Data.Linq.DataContext> object from the code and mapping files, the <xref:System.Data.Linq.DataContext.CreateDatabase%2A?displayProperty=nameWithType> method creates a database based on the type mappings that are specified.</span></span> <span data-ttu-id="b7068-109">如果對應中沒有指定任何 CLR `type` 屬性，就會使用預設的型別對應。</span><span class="sxs-lookup"><span data-stu-id="b7068-109">If there are no CLR `type` attributes specified in the mappings, the default type mappings will be used.</span></span>  
  
## <a name="customization-with-sqlmetal-or-or-designer"></a><span data-ttu-id="b7068-110">使用 SQLMetal 或 O/R 設計工具進行自訂</span><span class="sxs-lookup"><span data-stu-id="b7068-110">Customization with SQLMetal or O/R Designer</span></span>  

 <span data-ttu-id="b7068-111">透過 SQLMetal 和 O/R 設計工具，您就可以自動建立在程式碼檔案內部或外部包含型別對應資訊的物件模型 (Object Model)。</span><span class="sxs-lookup"><span data-stu-id="b7068-111">With SQLMetal and O/R Designer, you can automatically create an object model that includes the type mapping information inside or outside the code file.</span></span> <span data-ttu-id="b7068-112">由於這些檔案會由 SQLMetal 或 O/R 設計工具所覆寫，所以每次您重新建立對應時，指定自訂型別對應的建議方法是自訂 DBML 檔案。</span><span class="sxs-lookup"><span data-stu-id="b7068-112">Because these files are overwritten by SQLMetal or O/R Designer, each time you recreate your mappings, the recommended approach to specifying custom type mappings is to customize a DBML file.</span></span>  
  
 <span data-ttu-id="b7068-113">若要使用 SQLMetal 或 O/R 設計工具來自訂型別對應，請先產生 DBML 檔案。</span><span class="sxs-lookup"><span data-stu-id="b7068-113">To customize type mappings with SQLMetal or O/R Designer, first generate a DBML file.</span></span> <span data-ttu-id="b7068-114">然後，在產生程式碼檔案或對應檔案之前，修改 DBML 檔案，以便識別所需的型別對應。</span><span class="sxs-lookup"><span data-stu-id="b7068-114">Then, before generating the code file or mapping file, modify the DBML file to identify the desired type mappings.</span></span> <span data-ttu-id="b7068-115">您必須透過 SQLMetal 來手動變更 DBML 檔案中的 `Type` 和 `DbType` 屬性，以便進行型別對應自訂作業。</span><span class="sxs-lookup"><span data-stu-id="b7068-115">With SQLMetal, you have to manually change the `Type` and `DbType` attributes in the DBML file to make your type mapping customizations.</span></span> <span data-ttu-id="b7068-116">使用 O/R 設計工具時，您可以在此設計工具內部進行變更。</span><span class="sxs-lookup"><span data-stu-id="b7068-116">With O/R Designer, you can make your changes within the Designer.</span></span> <span data-ttu-id="b7068-117">如需使用 O/R 設計工具的詳細資訊，請參閱 [Visual Studio 中的 LINQ to SQL 工具](/visualstudio/data-tools/linq-to-sql-tools-in-visual-studio2)。</span><span class="sxs-lookup"><span data-stu-id="b7068-117">For more information about using the O/R Designer, see [LINQ to SQL Tools in Visual Studio](/visualstudio/data-tools/linq-to-sql-tools-in-visual-studio2).</span></span>  
  
> [!NOTE]
> <span data-ttu-id="b7068-118">在資料庫之間來回轉譯時，某些型別對應可能會造成溢位或資料遺失的例外狀況 (Exception)。</span><span class="sxs-lookup"><span data-stu-id="b7068-118">Some type mappings may result in overflow or data loss exceptions while translating to or from the database.</span></span> <span data-ttu-id="b7068-119">在進行任何自訂之前，請仔細檢查 [SQL CLR 型別對應](sql-clr-type-mapping.md) 中的型別對應執行時間行為矩陣。</span><span class="sxs-lookup"><span data-stu-id="b7068-119">Carefully review the Type Mapping Run-time Behavior Matrix in [SQL-CLR Type Mapping](sql-clr-type-mapping.md) before making any customizations.</span></span>  
  
 <span data-ttu-id="b7068-120">為了讓 SQLMetal 或 O/R 設計工具能夠辨識型別對應自訂項目，在產生程式碼檔案或外部對應檔案時，您必須確定這些工具提供在自訂 DBML 檔案的路徑中。</span><span class="sxs-lookup"><span data-stu-id="b7068-120">In order for your type mapping customizations to be recognized by SQLMetal or O/R Designer, you need to make sure that these tools are supplied with the path to your custom DBML file when you generate your code file or external mapping file.</span></span> <span data-ttu-id="b7068-121">雖然不是型別對應項目所需的作業，不過建議您一定要分隔型別對應資訊與程式碼檔案，並且產生其他外部型別對應檔案。</span><span class="sxs-lookup"><span data-stu-id="b7068-121">Although not required for type mapping customization, it is recommended that you always separate your type mapping information from your code file and generate the additional external type mapping file.</span></span> <span data-ttu-id="b7068-122">這樣做將會保留一些彈性，讓您不需要重新編譯程式碼檔案。</span><span class="sxs-lookup"><span data-stu-id="b7068-122">Doing so will leave some flexibility by not requiring that the code file be recompiled.</span></span>  
  
## <a name="incorporating-database-changes"></a><span data-ttu-id="b7068-123">合併資料庫變更</span><span class="sxs-lookup"><span data-stu-id="b7068-123">Incorporating Database Changes</span></span>  

 <span data-ttu-id="b7068-124">當資料庫變更時，您必須更新 DBML 檔案來反映這些變更。</span><span class="sxs-lookup"><span data-stu-id="b7068-124">When your database changes, you will need to update your DBML file to reflect those changes.</span></span> <span data-ttu-id="b7068-125">其中一種更新方式是自動建立新的 DBML 檔案，然後重新進行型別對應自訂作業。</span><span class="sxs-lookup"><span data-stu-id="b7068-125">One way to do this is to automatically create a new DBML file and then re-do your type mapping customizations.</span></span> <span data-ttu-id="b7068-126">或者，您可以比較新 DBML 檔案與自訂 DBML 檔案之間的差異，然後手動更新自訂 DBML 檔案來反映資料庫變更。</span><span class="sxs-lookup"><span data-stu-id="b7068-126">Alternatively, you could compare the differences between your new DBML file and your customized DBML file and update your custom DBML file manually to reflect the database change.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="b7068-127">另請參閱</span><span class="sxs-lookup"><span data-stu-id="b7068-127">See also</span></span>

- [<span data-ttu-id="b7068-128">SQL-CLR 類型對應</span><span class="sxs-lookup"><span data-stu-id="b7068-128">SQL-CLR Type Mapping</span></span>](sql-clr-type-mapping.md)
- [<span data-ttu-id="b7068-129">LINQ to SQL 中的程式碼產生</span><span class="sxs-lookup"><span data-stu-id="b7068-129">Code Generation in LINQ to SQL</span></span>](code-generation-in-linq-to-sql.md)
