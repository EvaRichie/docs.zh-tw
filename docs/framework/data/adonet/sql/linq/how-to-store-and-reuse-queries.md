---
title: 作法：儲存和重複使用查詢
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: a012bd79-1809-45e3-adea-0229532396cc
ms.openlocfilehash: aae1cf3faf2ecb3d8e9511390cdaa1e004905bea
ms.sourcegitcommit: 5b475c1855b32cf78d2d1bbb4295e4c236f39464
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/24/2020
ms.locfileid: "91197088"
---
# <a name="how-to-store-and-reuse-queries"></a><span data-ttu-id="02771-102">作法：儲存和重複使用查詢</span><span class="sxs-lookup"><span data-stu-id="02771-102">How to: Store and Reuse Queries</span></span>

<span data-ttu-id="02771-103">當您的應用程式會多次執行結構類似的查詢時，您藉由編譯查詢一次並使用不同的參數加以執行數次，通常可以提高效能。</span><span class="sxs-lookup"><span data-stu-id="02771-103">When you have an application that executes structurally similar queries many times, you can often increase performance by compiling the query one time and executing it several times with different parameters.</span></span> <span data-ttu-id="02771-104">例如，應用程式可能必須擷取位於特定城市的所有客戶，該城市是使用者於執行階段在表單中指定。</span><span class="sxs-lookup"><span data-stu-id="02771-104">For example, an application might have to retrieve all the customers who are in a particular city, where the city is specified at runtime by the user in a form.</span></span> [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] <span data-ttu-id="02771-105">針對此目的，支援使用 *已編譯的查詢* 。</span><span class="sxs-lookup"><span data-stu-id="02771-105">supports the use of *compiled queries* for this purpose.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="02771-106">這種模式的使用方式代表已編譯查詢的最常見用途。</span><span class="sxs-lookup"><span data-stu-id="02771-106">This pattern of usage represents the most common use for compiled queries.</span></span> <span data-ttu-id="02771-107">其他方法也有可能。</span><span class="sxs-lookup"><span data-stu-id="02771-107">Other approaches are possible.</span></span> <span data-ttu-id="02771-108">例如，在可擴充設計工具所產生之程式碼的部分類別中，已編譯查詢可以儲存為靜態成員。</span><span class="sxs-lookup"><span data-stu-id="02771-108">For example, compiled queries can be stored as static members on a partial class that extends the code generated by the designer.</span></span>  
  
## <a name="example"></a><span data-ttu-id="02771-109">範例</span><span class="sxs-lookup"><span data-stu-id="02771-109">Example</span></span>  

 <span data-ttu-id="02771-110">在許多情況下，您會想要跨越執行緒界限重複使用查詢。</span><span class="sxs-lookup"><span data-stu-id="02771-110">In many scenarios you might want to reuse the queries across thread boundaries.</span></span> <span data-ttu-id="02771-111">在此情況下，以靜態變數儲存已編譯查詢特別有效。</span><span class="sxs-lookup"><span data-stu-id="02771-111">In such cases, storing the compiled queries in static variables is especially effective.</span></span> <span data-ttu-id="02771-112">下列程式碼範例採用了設計用來儲存已編譯查詢的 `Queries` 類別，並採用表示強型別 <xref:System.Data.Linq.DataContext> 的 Northwind 類別。</span><span class="sxs-lookup"><span data-stu-id="02771-112">The following code example assumes a `Queries` class designed to store compiled queries, and assumes a Northwind class that represents a strongly typed <xref:System.Data.Linq.DataContext>.</span></span>  
  
 [!code-csharp[DLinqQuerying#6](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqQuerying/cs/Program.cs#6)]
 [!code-vb[DLinqQuerying#6](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DLinqQuerying/vb/Module1.vb#6)]  
  
 [!code-csharp[DLinqQuerying#7](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqQuerying/cs/Program.cs#7)]
 [!code-vb[DLinqQuerying#7](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DLinqQuerying/vb/Module1.vb#7)]  
  
## <a name="example"></a><span data-ttu-id="02771-113">範例</span><span class="sxs-lookup"><span data-stu-id="02771-113">Example</span></span>  

 <span data-ttu-id="02771-114">您目前無法將 (儲存在靜態變數中，) 傳回 *匿名型別*的查詢，因為類型沒有可提供做為泛型引數的名稱。</span><span class="sxs-lookup"><span data-stu-id="02771-114">You cannot currently store (in static variables) queries that return an *anonymous type*, because type has no name to provide as a generic argument.</span></span> <span data-ttu-id="02771-115">下列範例顯示如何藉由建立可表示結果的型別並以它做為泛型引數，來解決這個問題。</span><span class="sxs-lookup"><span data-stu-id="02771-115">The following example shows how you can work around the issue by creating a type that can represent the result, and then use it as a generic argument.</span></span>  
  
 [!code-csharp[DLinqQuerying#8](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqQuerying/cs/Program.cs#8)]
 [!code-vb[DLinqQuerying#8](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DLinqQuerying/vb/Module1.vb#8)]  
  
## <a name="see-also"></a><span data-ttu-id="02771-116">另請參閱</span><span class="sxs-lookup"><span data-stu-id="02771-116">See also</span></span>

- <xref:System.Data.Linq.CompiledQuery>
- [<span data-ttu-id="02771-117">查詢概念</span><span class="sxs-lookup"><span data-stu-id="02771-117">Query Concepts</span></span>](query-concepts.md)
- [<span data-ttu-id="02771-118">查詢資料庫</span><span class="sxs-lookup"><span data-stu-id="02771-118">Querying the Database</span></span>](querying-the-database.md)
