---
title: Mpgo.exe (Managed 特性指引最佳化工具)
description: '使用 Mpgo.exe，即 Managed 特性指引優化工具。 使用此工具，將原生映射產生器所建立的原生映射元件優化 ( # A0) 。'
ms.date: 03/30/2017
helpviewer_keywords:
- Mpgo.exe
- training scenarios, generating profiles with
- Managed Profile Guided Optimization Tool
- Ngen.exe
- Ngen.exe, profilers and native images
ms.assetid: f6976502-a000-4fbe-aaf5-a7aab9ce4ec2
ms.openlocfilehash: f8830b13cb64c737525f5399beb244aeb6d9817f
ms.sourcegitcommit: d8020797a6657d0fbbdff362b80300815f682f94
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/24/2020
ms.locfileid: "95721890"
---
# <a name="mpgoexe-managed-profile-guided-optimization-tool"></a><span data-ttu-id="ac4a8-104">Mpgo.exe (Managed 特性指引最佳化工具)</span><span class="sxs-lookup"><span data-stu-id="ac4a8-104">Mpgo.exe (Managed Profile Guided Optimization Tool)</span></span>

<span data-ttu-id="ac4a8-105">Managed 特性指引最佳化工具 (Mpgo.exe) 是一項命令列工具，它會使用常見的使用者情節最佳化[原生映像產生器 (Ngen.exe)](ngen-exe-native-image-generator.md) 所建立的原生映像組件。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-105">The Managed Profile Guided Optimization Tool (Mpgo.exe) is a command-line tool that uses common end-user scenarios to optimize the native image assemblies that are created by the [Native Image Generator (Ngen.exe)](ngen-exe-native-image-generator.md).</span></span> <span data-ttu-id="ac4a8-106">此工具可讓您執行產生分析資料的訓練情節。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-106">This tool enables you to run training scenarios that generate profile data.</span></span> <span data-ttu-id="ac4a8-107">[原生映像產生器 (Ngen.exe)](ngen-exe-native-image-generator.md) 會使用這項資料最佳化其產生的原生映像應用程式組件。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-107">The [Native Image Generator (Ngen.exe)](ngen-exe-native-image-generator.md) uses this data to optimize its generated native image application assemblies.</span></span> <span data-ttu-id="ac4a8-108">訓練情節是指嘗試執行應用程式的預期使用方式。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-108">A training scenario is a trial run of an expected use of your application.</span></span> <span data-ttu-id="ac4a8-109">Mpgo.exe 會隨 Visual Studio Ultimate 2012 (含) 以後版本提供。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-109">Mpgo.exe is available in Visual Studio Ultimate 2012 and later versions.</span></span> <span data-ttu-id="ac4a8-110">從 Visual Studio 2013 開始，您也可以使用 Mpgo.exe 將 Windows 8 x 商店應用程式優化。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-110">Starting with Visual Studio 2013, you can also use Mpgo.exe to optimize Windows 8.x Store apps.</span></span>

<span data-ttu-id="ac4a8-111">特性指引最佳化會從訓練情節收集資料並使用該資料最佳化原生映像的配置，藉此改善應用程式啟動時間、記憶體使用率 (工作組大小) 以及輸送量。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-111">Profile-guided optimization improves application startup time, memory utilization (working set size), and throughput by gathering data from training scenarios and using it to optimize the layout of native images.</span></span>

<span data-ttu-id="ac4a8-112">當 Intermediate Language (IL) 組件的啟動時間和工作組大小發生效能問題時，建議您先使用 Ngen.exe 消除 Just-in-Time (JIT) 編譯成本和促進程式碼共用。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-112">When you encounter performance issues with startup time and working set size for Intermediate Language (IL) assemblies, we recommend that you first use Ngen.exe to eliminate just-in-time (JIT) compilation costs and to facilitate code sharing.</span></span> <span data-ttu-id="ac4a8-113">如果您需要進一步改進，可以使用 Mpgo.exe 進一步最佳化您的應用程式。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-113">If you need additional improvements, you can then use Mpgo.exe to further optimize your application.</span></span> <span data-ttu-id="ac4a8-114">您可以使用非最佳化原生映像組件的效能資料做為評估效能改善的基準。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-114">You can use the performance data from the un-optimized native image assemblies as a baseline to evaluate the performance gains.</span></span> <span data-ttu-id="ac4a8-115">使用 Mpgo.exe 能夠縮短冷啟動時間和縮小工作組大小。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-115">Using Mpgo.exe may result in faster cold startup times and a smaller working set size.</span></span> <span data-ttu-id="ac4a8-116">Mpgo.exe 會將資訊加入至 Ngen.exe 用來建立最佳化原生映像組件的 IL 組件。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-116">Mpgo.exe adds information to IL assemblies that Ngen.exe uses to create optimized native image assemblies.</span></span> <span data-ttu-id="ac4a8-117">如需詳細資訊，請參閱 .NET 部落格中的 [Improving Launch Performance for your Desktop Applications](https://devblogs.microsoft.com/dotnet/improving-launch-performance-for-your-desktop-applications/) (改善桌面應用程式的啟動效能) 文章。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-117">For more information, see the entry [Improving Launch Performance for your Desktop Applications](https://devblogs.microsoft.com/dotnet/improving-launch-performance-for-your-desktop-applications/) in the .NET blog.</span></span>

<span data-ttu-id="ac4a8-118">此工具會自動與 Visual Studio 一起安裝。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-118">This tool is automatically installed with Visual Studio.</span></span> <span data-ttu-id="ac4a8-119">若要執行這項工具，請透過系統管理員認證使用 [Visual Studio 開發人員命令提示字元] (或 Windows 7 中的 [Visual Studio 命令提示字元])，然後在命令提示字元中鍵入下列內容。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-119">To run the tool, use the Developer Command Prompt for Visual Studio (or the Visual Studio Command Prompt in Windows 7) with administrator credentials, and type the following at the command prompt.</span></span> <span data-ttu-id="ac4a8-120">如需詳細資訊，請參閱[命令提示字元](developer-command-prompt-for-vs.md)。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-120">For more information, see [Command Prompts](developer-command-prompt-for-vs.md).</span></span>

<span data-ttu-id="ac4a8-121">針對桌面應用程式：</span><span class="sxs-lookup"><span data-stu-id="ac4a8-121">For desktop apps:</span></span>

```console
mpgo –Scenario <command> [-Import <directory>] –AssemblyList <assembly1>  <assembly2> ... -OutDir <directory> [options]
```

<span data-ttu-id="ac4a8-122">針對 Windows 8. x 商店應用程式：</span><span class="sxs-lookup"><span data-stu-id="ac4a8-122">For Windows 8.x Store apps:</span></span>

## <a name="syntax"></a><span data-ttu-id="ac4a8-123">語法</span><span class="sxs-lookup"><span data-stu-id="ac4a8-123">Syntax</span></span>

```console
mpgo –Scenario <packageName> -AppID <appId> -Timeout <seconds>
```

## <a name="parameters"></a><span data-ttu-id="ac4a8-124">參數</span><span class="sxs-lookup"><span data-stu-id="ac4a8-124">Parameters</span></span>
 <span data-ttu-id="ac4a8-125">Mpgo.exe 的所有引數都不區分大小寫。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-125">All arguments to Mpgo.exe are case-insensitive.</span></span> <span data-ttu-id="ac4a8-126">命令前面會加上虛線。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-126">Commands are prefixed with a dash.</span></span>

> [!NOTE]
> <span data-ttu-id="ac4a8-127">您可以使用 `–Scenario` 或 `–Import` 做為必要的命令，但兩者不能同時使用。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-127">You can use either `–Scenario` or `–Import` as a required command, but not both.</span></span> <span data-ttu-id="ac4a8-128">如果您指定 `–Reset` 選項，將不會使用任何必要參數。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-128">None of the required parameters are used if you specify the `–Reset` option.</span></span>

|<span data-ttu-id="ac4a8-129">必要參數</span><span class="sxs-lookup"><span data-stu-id="ac4a8-129">Required parameter</span></span>|<span data-ttu-id="ac4a8-130">描述</span><span class="sxs-lookup"><span data-stu-id="ac4a8-130">Description</span></span>|
|------------------------|-----------------|
|<span data-ttu-id="ac4a8-131">`-Scenario` \<*command*></span><span class="sxs-lookup"><span data-stu-id="ac4a8-131">`-Scenario` \<*command*></span></span><br /><br /> <span data-ttu-id="ac4a8-132">– 或 –</span><span class="sxs-lookup"><span data-stu-id="ac4a8-132">—or—</span></span><br /><br /> <span data-ttu-id="ac4a8-133">`-Scenario` \<*packageName*></span><span class="sxs-lookup"><span data-stu-id="ac4a8-133">`-Scenario` \<*packageName*></span></span><br /><br /> <span data-ttu-id="ac4a8-134">-或-</span><span class="sxs-lookup"><span data-stu-id="ac4a8-134">-or-</span></span><br /><br /> <span data-ttu-id="ac4a8-135">`-Import` \<*directory*></span><span class="sxs-lookup"><span data-stu-id="ac4a8-135">`-Import` \<*directory*></span></span>|<span data-ttu-id="ac4a8-136">若是桌面應用程式，請使用 `–Scenario` 指定執行您要最佳化之應用程式的命令，包括任何命令列引數。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-136">For desktop apps, use `–Scenario` to specify the command to run the application you want to optimize, including any command-line arguments.</span></span> <span data-ttu-id="ac4a8-137">如果 *「命令」* 指定的路徑包含空格，請在前後加上三組雙引號。例如：`mpgo.exe -scenario """C:\My App\myapp.exe""" -assemblylist """C:\My App\myapp.exe""" -outdir "C:\optimized files"`。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-137">Use three sets of double quotation marks around *command* if it specifies a path that includes spaces; for example: `mpgo.exe -scenario """C:\My App\myapp.exe""" -assemblylist """C:\My App\myapp.exe""" -outdir "C:\optimized files"`.</span></span> <span data-ttu-id="ac4a8-138">不使用雙引號。如果 *「命令」* 包含空格就無法正確運作。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-138">Do not use double quotation marks; they will not work correctly if *command* includes spaces.</span></span><br /><br /> <span data-ttu-id="ac4a8-139">-或-</span><span class="sxs-lookup"><span data-stu-id="ac4a8-139">-or-</span></span><br /><br /> <span data-ttu-id="ac4a8-140">若為 Windows 8. x 儲存區應用程式，請使用 `–Scenario` 指定您要產生設定檔資訊的套件。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-140">For Windows 8.x Store apps, use `–Scenario` to specify the package that you want to generate profile information for.</span></span> <span data-ttu-id="ac4a8-141">如果您指定套件顯示名稱或套件系列名稱而不是完整套件名稱，Mpgo.exe 在只有一個套件相符的情況下，將選取與您所提供名稱相符的套件。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-141">If you specify the package display name or the package family name instead of the full package name, Mpgo.exe will select the package that matches the name you provided if there is only one match.</span></span> <span data-ttu-id="ac4a8-142">如果有多個套件與指定的名稱相符，Mpgo.exe 將會提示您選擇一個套件。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-142">If multiple packages match the specified name, Mpgo.exe will prompt you to choose a package.</span></span><br /><br /> <span data-ttu-id="ac4a8-143">– 或 –</span><span class="sxs-lookup"><span data-stu-id="ac4a8-143">—or—</span></span><br /><br /> <span data-ttu-id="ac4a8-144">使用 `-Import` 可指定應該使用先前最佳化之組件的最佳化資料來最佳化 `-AssemblyList` 中的組件。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-144">Use `-Import` to specify that optimization data from previously optimized assemblies should be used to optimize the assemblies in `-AssemblyList`.</span></span> <span data-ttu-id="ac4a8-145">*「目錄」* 可指定包含先前最佳化之檔案的目錄。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-145">*directory* specifies the directory that contains the previously optimized files.</span></span> <span data-ttu-id="ac4a8-146">`–AssemblyList` 或 `–AssemblyListFile` 中指定的組件是新版組件，其將使用匯入檔案的資料進行最佳化。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-146">The assemblies specified in `–AssemblyList` or `–AssemblyListFile` are the new versions of the assemblies to be optimized using the data from the imported files.</span></span> <span data-ttu-id="ac4a8-147">使用舊版組件的最佳化資料可讓您最佳化新版組件，而不需重新執行情節。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-147">Using optimization data from older version of assemblies enables you to optimize newer versions of assemblies without re-running the scenario.</span></span>  <span data-ttu-id="ac4a8-148">不過，如果匯入的組件和目標組件包含的程式碼相當不同，則最佳化資料將沒有作用。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-148">However, if the imported and target assemblies include significantly different code, the optimization data will be ineffective.</span></span> <span data-ttu-id="ac4a8-149">在 `–AssemblyList` 或 `–AssemblyListFile` 中指定的組件名稱，必須出現在 `–Import`*目錄* 所指定的目錄中。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-149">The assembly names specified in `–AssemblyList` or `–AssemblyListFile` must be present in the directory specified by `–Import`*directory*.</span></span> <span data-ttu-id="ac4a8-150">如果 *「目錄」* 指定的路徑包含空格，請在前後加上三組雙引號。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-150">Use three sets of double quotation marks around *directory* if it specifies a path that includes spaces.</span></span><br /><br /> <span data-ttu-id="ac4a8-151">您必須指定 `–Scenario` 或 `–Import`，但兩者不能同時指定。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-151">You must specify either `–Scenario` or `–Import`, but not both parameters.</span></span>|
|<span data-ttu-id="ac4a8-152">`-OutDir` \<*directory*></span><span class="sxs-lookup"><span data-stu-id="ac4a8-152">`-OutDir` \<*directory*></span></span>|<span data-ttu-id="ac4a8-153">放置最佳化組件的目錄。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-153">The directory in which to place the optimized assemblies.</span></span> <span data-ttu-id="ac4a8-154">如果輸出目錄資料夾中已有組件，則會建立新的複本，並將索引編號附加至其名稱，例如： *組件名稱*-1.exe。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-154">If an assembly already exists in the output directory folder, a new copy is created and an index number is appended to its name; for example: *assemblyname*-1.exe.</span></span> <span data-ttu-id="ac4a8-155">如果 *「目錄」* 指定的路徑包含空格，請在前後加上雙引號。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-155">Use double quotation marks around *directory* if it specifies a path that contains spaces.</span></span>|
|<span data-ttu-id="ac4a8-156">`-AssemblyList` \<*assembly1 assembly2 ...*></span><span class="sxs-lookup"><span data-stu-id="ac4a8-156">`-AssemblyList` \<*assembly1 assembly2 ...*></span></span><br /><br /> <span data-ttu-id="ac4a8-157">– 或 –</span><span class="sxs-lookup"><span data-stu-id="ac4a8-157">—or—</span></span><br /><br /> <span data-ttu-id="ac4a8-158">`-AssemblyListFile` \<*file*></span><span class="sxs-lookup"><span data-stu-id="ac4a8-158">`-AssemblyListFile` \<*file*></span></span>|<span data-ttu-id="ac4a8-159">您要收集其相關設定檔資訊的空格分隔組件清單 (包括 .exe 和 .dll 檔)。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-159">A list of assemblies (including .exe and .dll files), separated by spaces, that you want collect profile information about.</span></span> <span data-ttu-id="ac4a8-160">您可以指定 `C:\Dir\*.dll` 或 `*.dll`以選取指定或目前工作目錄中的所有組件。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-160">You can specify `C:\Dir\*.dll` or `*.dll` to select all the assemblies in the designated or current working directory.</span></span> <span data-ttu-id="ac4a8-161">如需詳細資訊，請參閱＜備註＞一節。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-161">See the Remarks section for more information.</span></span><br /><br /> <span data-ttu-id="ac4a8-162">– 或 –</span><span class="sxs-lookup"><span data-stu-id="ac4a8-162">—or—</span></span><br /><br /> <span data-ttu-id="ac4a8-163">包含您要收集其相關設定檔資訊之組件清單的文字檔，每行列出一個組件。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-163">A text file that contains the list of assemblies you want to collect profile information about, listed one assembly per line.</span></span> <span data-ttu-id="ac4a8-164">如果組件名稱開頭是連字號 (-)，請使用組件檔清單或重新命名組件。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-164">If an assembly name begins with a hyphen (-), use an assembly file list or rename the assembly.</span></span>|
|<span data-ttu-id="ac4a8-165">`-AppID` \<*appId*></span><span class="sxs-lookup"><span data-stu-id="ac4a8-165">`-AppID` \<*appId*></span></span>|<span data-ttu-id="ac4a8-166">所指定套件中的應用程式 ID。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-166">The ID of the application in the specified package.</span></span> <span data-ttu-id="ac4a8-167">如果您使用萬用字元 (\*) ，Mpgo.exe 將會嘗試列舉封裝中的 appid，而且會切換回 \<*package_family_name*> ！應用程式失敗時。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-167">If you use the wildcard (\*), Mpgo.exe will try to enumerate the AppIDs in the package and will fall back to \<*package_family_name*>!App if it fails.</span></span> <span data-ttu-id="ac4a8-168">如果您指定的字串前面加上驚嘆號 (!)，Mpgo.exe 將串連套件系列名稱與提供的引數。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-168">If you specify a string that is prefixed by an exclamation point (!), Mpgo.exe will concatenate the package family name with the argument provided.</span></span>|
|<span data-ttu-id="ac4a8-169">`-Timeout` \<*seconds*></span><span class="sxs-lookup"><span data-stu-id="ac4a8-169">`-Timeout` \<*seconds*></span></span>|<span data-ttu-id="ac4a8-170">允許 Windows 8. x 儲存區應用程式在應用程式結束之前執行的時間量。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-170">The amount of time to allow the Windows 8.x Store app to run before the app exits.</span></span>|

|<span data-ttu-id="ac4a8-171">選擇性參數</span><span class="sxs-lookup"><span data-stu-id="ac4a8-171">Optional parameter</span></span>|<span data-ttu-id="ac4a8-172">描述</span><span class="sxs-lookup"><span data-stu-id="ac4a8-172">Description</span></span>|
|------------------------|-----------------|
|`-64bit`|<span data-ttu-id="ac4a8-173">檢測 64 位元系統的組件。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-173">Instruments the assemblies for 64-bit systems.</span></span>  <span data-ttu-id="ac4a8-174">即使您的組件本身宣告為 64 位元，您仍必須為 64 位元組件指定此參數。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-174">You must specify this parameter for 64-bit assemblies, even if your assembly declares itself as 64 bit.</span></span>|
|<span data-ttu-id="ac4a8-175">`-ExeConfig` \<*filename*></span><span class="sxs-lookup"><span data-stu-id="ac4a8-175">`-ExeConfig` \<*filename*></span></span>|<span data-ttu-id="ac4a8-176">指定您的情節用來提供版本和載入器資訊的組態檔。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-176">Specifies the configuration file that your scenario uses to provide version and loader information.</span></span>|
|`-f`|<span data-ttu-id="ac4a8-177">在二進位組件中強制包含分析資料，即使組件已簽署也一樣。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-177">Forces the inclusion of the profile data in a binary assembly, even if it's signed.</span></span>  <span data-ttu-id="ac4a8-178">如果組件已簽署，則必須重新簽署，否則，組件將無法載入及執行。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-178">If the assembly is signed, it must be re-signed; otherwise, the assembly will fail to load and run.</span></span>|
|`-Reset`|<span data-ttu-id="ac4a8-179">重設環境，以確保中止的程式碼剖析工作階段不會影響您的組件，然後退出。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-179">Resets the environment to make certain that an aborted profiling session doesn't affect your assemblies, and then quits.</span></span> <span data-ttu-id="ac4a8-180">根據預設，在程式碼剖析工作階段之前與之後，環境都會重設。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-180">The environment is reset by default before and after a profiling session.</span></span>|
|<span data-ttu-id="ac4a8-181">`-Timeout` \<*time in seconds*></span><span class="sxs-lookup"><span data-stu-id="ac4a8-181">`-Timeout` \<*time in seconds*></span></span>|<span data-ttu-id="ac4a8-182">以秒為單位指定程式碼剖析期間。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-182">Specifies the profiling duration in seconds.</span></span> <span data-ttu-id="ac4a8-183">使用比您觀察所得的 GUI 應用程式啟動時間稍微長一點的值。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-183">Use a value that is slightly more than your observed startup times for GUI applications.</span></span> <span data-ttu-id="ac4a8-184">在逾時期間結束時，雖然應用程式繼續執行，但是會記錄分析資料。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-184">At the end of the time-out period, the profile data is recorded although the application continues to run.</span></span> <span data-ttu-id="ac4a8-185">如果您未設定此選項，程式碼剖析將會繼續，直到應用程式關閉為止，而且此時才會記錄資料。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-185">If you don't set this option, profiling will continue until application shutdown, at which time the data will be recorded.</span></span>|
|`-LeaveNativeImages`|<span data-ttu-id="ac4a8-186">指定執行情節之後不應移除檢測的原生映像。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-186">Specifies that the instrumented native images shouldn't be removed after running the scenario.</span></span> <span data-ttu-id="ac4a8-187">此選項主要是在您要取得針對執行的情節指定的應用程式時使用。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-187">This option is primarily used when you're getting the application that you specified for the scenario running.</span></span> <span data-ttu-id="ac4a8-188">它會防止 Mpgo.exe 後續執行後重新建立原生映像。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-188">It will prevent the recreation of native images for subsequent runs of Mpgo.exe.</span></span> <span data-ttu-id="ac4a8-189">如果您指定此選項，當您完成執行應用程式時，可能會有失去關聯的原生映像留在快取中。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-189">When you have finished running your application, there may be orphaned native images in the cache if you specify this option.</span></span> <span data-ttu-id="ac4a8-190">在這種情況下，請使用相同的案例與組件清單執行 Mpgo.exe，並使用 `–RemoveNativeImages` 參數移除這些原生映像。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-190">In this case, run Mpgo.exe with the same scenario and assembly list and use the `–RemoveNativeImages` parameter to remove these native images.</span></span>|
|`-RemoveNativeImages`|<span data-ttu-id="ac4a8-191">從已指定 `–LeaveNativeImages` 的回合進行清理。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-191">Cleans up from a run where `–LeaveNativeImages` was specified.</span></span> <span data-ttu-id="ac4a8-192">如果指定了 `-RemoveNativeImages`，Mpgo.exe 就會忽略除了 `-64bit` 和 `–AssemblyList` 以外的所有引數，並會在移除所有已檢測的原生映像之後結束。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-192">If you specify `-RemoveNativeImages`, Mpgo.exe ignores any arguments except `-64bit` and `–AssemblyList`, and exits after removing all instrumented native images.</span></span>|

## <a name="remarks"></a><span data-ttu-id="ac4a8-193">備註</span><span class="sxs-lookup"><span data-stu-id="ac4a8-193">Remarks</span></span>
 <span data-ttu-id="ac4a8-194">您可以在命令列上多次使用 `–AssemblyList` 和 `- AssemblyListFile`。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-194">You can use both `–AssemblyList` and `- AssemblyListFile` multiple times on the command line.</span></span>

 <span data-ttu-id="ac4a8-195">如果您在指定組件時未指定完整路徑名稱，Mpgo.exe 將在目前目錄中尋找。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-195">If you do not specify full path names when specifying assemblies, Mpgo.exe looks in the current directory.</span></span> <span data-ttu-id="ac4a8-196">如果您指定了不正確的路徑，Mpgo.exe 就會顯示錯誤訊息，但仍繼續產生其他組件的資料。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-196">If you specify an incorrect path, Mpgo.exe displays an error message but continues to generate data for other assemblies.</span></span> <span data-ttu-id="ac4a8-197">如果您指定的組件不是在訓練情節期間載入，則不會產生該組件的訓練資料。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-197">If you specify an assembly that is not loaded during the training scenario, no training data is generated for that assembly.</span></span>

 <span data-ttu-id="ac4a8-198">如果清單中的某個組件位於全域組件快取中，則不會更新該組件使其包含設定檔資訊。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-198">If an assembly in the list is in the global assembly cache, it will not be updated to contain the profile information.</span></span>  <span data-ttu-id="ac4a8-199">請從全域組件快取中將它移除，以便收集設定檔資訊。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-199">Remove it from the global assembly cache to collect profile information.</span></span>

 <span data-ttu-id="ac4a8-200">建議您只對大型 Managed 應用程式使用 Ngen.exe 和 Mpgo.exe，因為預先編譯原生映像的優點通常是在執行階段消除大量 JIT 編譯時才會看見。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-200">The use of Ngen.exe and Mpgo.exe is recommended only for large managed applications, because the benefit of precompiled native images is typically seen only when it eliminates significant JIT compilation at run time.</span></span> <span data-ttu-id="ac4a8-201">在不會耗用太多工作組的 "Hello World" 樣式應用程式上執行 Mpgo.exe 不會提供任何好處，Mpgo.exe 甚至可能無法成功收集分析資料。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-201">Running Mpgo.exe on "Hello World" style applications that aren’t working-set intensive will not provide any benefits, and Mpgo.exe may even fail to gather profile data.</span></span>

> [!NOTE]
> <span data-ttu-id="ac4a8-202">不建議您將 Ngen.exe 和 Mpgo.exe 用於 ASP.NET 應用程式和 Windows Communication Foundation (WCF) 服務。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-202">Ngen.exe and Mpgo.exe are not recommended for ASP.NET applications and Windows Communication Foundation (WCF) services.</span></span>

## <a name="to-use-mpgoexe"></a><span data-ttu-id="ac4a8-203">若要使用 Mpgo.exe</span><span class="sxs-lookup"><span data-stu-id="ac4a8-203">To Use Mpgo.exe</span></span>

1. <span data-ttu-id="ac4a8-204">使用已安裝 Visual Studio Ultimate 2012 和您的應用程式的電腦。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-204">Use a computer that has the Visual Studio Ultimate 2012 and your application installed.</span></span>

2. <span data-ttu-id="ac4a8-205">以系統管理員身分執行 Mpgo.exe 及必要的參數。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-205">Run Mpgo.exe as an administrator with the necessary parameters.</span></span>  <span data-ttu-id="ac4a8-206">請參閱下一節了解範例命令。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-206">See the next section for sample commands.</span></span>

     <span data-ttu-id="ac4a8-207">最佳化中繼語言 (IL) 組件會建立在 `–OutDir` 參數所指定的資料夾中 (在範例中，此為 `C:\Optimized` 資料夾)。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-207">The optimized intermediate language (IL) assemblies are created in the folder specified by the `–OutDir` parameter (in the examples, this is the `C:\Optimized` folder).</span></span>

3. <span data-ttu-id="ac4a8-208">將 Ngen.exe 使用的 IL 組件取代為新的 IL 組件，該組件包含 `–OutDir` 所指定之目錄中的設定檔資訊。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-208">Replace the IL assemblies you used for Ngen.exe  with the new IL assemblies that contain the profile information from the directory specified by `–OutDir`.</span></span>

4. <span data-ttu-id="ac4a8-209">應用程式設定 (使用 Mpgo.exe 提供的映像) 將安裝最佳化的原生映像。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-209">The application setup (using the images provided by Mpgo.exe) will install optimized native images.</span></span>

## <a name="suggested-workflow"></a><span data-ttu-id="ac4a8-210">建議的工作流程</span><span class="sxs-lookup"><span data-stu-id="ac4a8-210">Suggested Workflow</span></span>

1. <span data-ttu-id="ac4a8-211">使用 Mpgo.exe 與 `–Scenario` 參數建立一組最佳化的 IL 組件。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-211">Create a set of optimized IL assemblies by using Mpgo.exe with the `–Scenario` parameter.</span></span>

2. <span data-ttu-id="ac4a8-212">將最佳化的 IL 組件簽入原始檔控制中。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-212">Check the optimized IL assemblies into source control.</span></span>

3. <span data-ttu-id="ac4a8-213">在建置流程中，呼叫 Mpgo.exe 並使用 `–Import` 參數做為建置後步驟，以產生要傳遞至 Ngen.exe 的最佳化 IL 映像。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-213">In the build process, call Mpgo.exe with the `–Import` parameter as a post-build step to generate optimized IL images to pass to Ngen.exe.</span></span>

 <span data-ttu-id="ac4a8-214">這個程序可確保所有組件都擁有最佳化資料。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-214">This process ensures that all assemblies have optimization data.</span></span> <span data-ttu-id="ac4a8-215">如果您經常簽入更新的最佳化組件 (步驟 1 和 2)，則產品開發期間的整體效能數字將會更一致。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-215">If you check in updated optimized assemblies (steps 1 and 2) more frequently, the performance numbers will be more consistent throughout product development.</span></span>

## <a name="using-mpgoexe-from-visual-studio"></a><span data-ttu-id="ac4a8-216">從 Visual Studio 使用 Mpgo.exe</span><span class="sxs-lookup"><span data-stu-id="ac4a8-216">Using Mpgo.exe from Visual Studio</span></span>
 <span data-ttu-id="ac4a8-217">您可以從 Visual Studio 執行 Mpgo.exe (請參閱[如何：指定建置事件 (C#)](/visualstudio/ide/how-to-specify-build-events-csharp) 一文)，但有下列限制：</span><span class="sxs-lookup"><span data-stu-id="ac4a8-217">You can run Mpgo.exe from Visual Studio (see the article [How to: Specify Build Events (C#)](/visualstudio/ide/how-to-specify-build-events-csharp)) with the following restrictions:</span></span>

- <span data-ttu-id="ac4a8-218">因為 Visual Studio 巨集預設也會使用結尾斜線標記，所以您無法使用前後加上引號且包含結尾斜線標記的路徑 </span><span class="sxs-lookup"><span data-stu-id="ac4a8-218">You cannot use quoted paths with trailing slash marks, because Visual Studio macros also use trailing slash marks by default.</span></span> <span data-ttu-id="ac4a8-219">例如， (`–OutDir "C:\Output Folder\"` 無效。 ) 若要解決這項限制，您可以將尾端斜線 escape。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-219">(For example, `–OutDir "C:\Output Folder\"` is invalid.) To work around this restriction, you can escape the trailing slash.</span></span> <span data-ttu-id="ac4a8-220">(例如，請改用 `-OutDir "$(OutDir)\"`。)</span><span class="sxs-lookup"><span data-stu-id="ac4a8-220">(For example, use `-OutDir "$(OutDir)\"` instead.)</span></span>

- <span data-ttu-id="ac4a8-221">根據預設，Mpgo.exe 不在 Visual Studio 組建路徑上。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-221">By default, Mpgo.exe is not on the Visual Studio build path.</span></span> <span data-ttu-id="ac4a8-222">您必須將路徑加入至 Visual Studio，或是在 Mpgo 命令列上指定完整路徑。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-222">You must either add the path to Visual Studio or specify the full path on the Mpgo command line.</span></span> <span data-ttu-id="ac4a8-223">您可以在 Visual Studio 的建置後事件中使用 `–Scenario` 或 `–Import` 參數。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-223">You can use either the `–Scenario` or the `–Import` parameter in the post-build event in Visual Studio.</span></span> <span data-ttu-id="ac4a8-224">但一般的處理序會從 Visual Studio 開發人員命令提示字元中使用一次 `–Scenario`，然後在每次建置之後，再使用 `–Import` 更新最佳化組件；例如：`"C:\Program Files\Microsoft Visual Studio 11.0\Team Tools\Performance Tools\mpgo.exe" -import "$(OutDir)tmp" -assemblylist "$(TargetPath)" -outdir "$(OutDir)\"`。</span><span class="sxs-lookup"><span data-stu-id="ac4a8-224">However, the typical process is to use `–Scenario` one time from a Developer Command Prompt for Visual Studio, and then use `–Import` to update the optimized assemblies after each build; for example:  `"C:\Program Files\Microsoft Visual Studio 11.0\Team Tools\Performance Tools\mpgo.exe" -import "$(OutDir)tmp" -assemblylist "$(TargetPath)" -outdir "$(OutDir)\"`.</span></span>

<a name="samples"></a>
## <a name="examples"></a><span data-ttu-id="ac4a8-225">範例</span><span class="sxs-lookup"><span data-stu-id="ac4a8-225">Examples</span></span>
 <span data-ttu-id="ac4a8-226">Visual Studio 開發人員命令提示字元中的下列 Mpgo.exe 命令會最佳化稅務應用程式：</span><span class="sxs-lookup"><span data-stu-id="ac4a8-226">The following Mpgo.exe command from a Developer Command Prompt for Visual Studio optimizes a tax application:</span></span>

```console
mpgo –scenario "C:\MyApp\MyTax.exe /params par" –AssemblyList Mytax.dll MyTaxUtil2011.dll –OutDir C:\Optimized –TimeOut 15
```

 <span data-ttu-id="ac4a8-227">下列 Mpgo.exe 命令會最佳化音效應用程式：</span><span class="sxs-lookup"><span data-stu-id="ac4a8-227">The following Mpgo.exe command optimizes a sound application:</span></span>

```console
mpgo –scenario "C:\MyApp\wav2wma.exe –input song1.wav –output song1.wma" –AssemblyList transcode.dll –OutDir C:\Optimized –TimeOut 15
```

 <span data-ttu-id="ac4a8-228">下列 Mpgo.exe 命令會使用先前最佳化組件的資料最佳化新版的組件：</span><span class="sxs-lookup"><span data-stu-id="ac4a8-228">The following Mpgo.exe command uses data from previously optimized assemblies to optimize newer versions of the assemblies:</span></span>

```console
mpgo.exe -import "C:\Optimized" -assemblylist "C:\MyApp\MyTax.dll" "C:\MyApp\MyTaxUtil2011.dll" -outdir C:\ReOptimized
```

## <a name="see-also"></a><span data-ttu-id="ac4a8-229">另請參閱</span><span class="sxs-lookup"><span data-stu-id="ac4a8-229">See also</span></span>

- [<span data-ttu-id="ac4a8-230">Ngen.exe (原生映射產生器) </span><span class="sxs-lookup"><span data-stu-id="ac4a8-230">Ngen.exe (Native Image Generator)</span></span>](ngen-exe-native-image-generator.md)
- [<span data-ttu-id="ac4a8-231">命令提示字元</span><span class="sxs-lookup"><span data-stu-id="ac4a8-231">Command Prompts</span></span>](developer-command-prompt-for-vs.md)
- [<span data-ttu-id="ac4a8-232">改善桌面應用程式的啟動效能</span><span class="sxs-lookup"><span data-stu-id="ac4a8-232">Improving Launch Performance for your Desktop Applications</span></span>](https://devblogs.microsoft.com/dotnet/improving-launch-performance-for-your-desktop-applications/)
- [<span data-ttu-id="ac4a8-233">.NET Framework 4.5 的效能改進總覽</span><span class="sxs-lookup"><span data-stu-id="ac4a8-233">An Overview of Performance Improvements in .NET Framework 4.5</span></span>](/archive/msdn-magazine/2012/april/clr-an-overview-of-performance-improvements-in-net-4-5)
