---
title: '非同步傳回類型 (c # ) '
description: '瞭解非同步方法可以在 c # 中使用的傳回型別，以及每種類型的程式碼範例和其他資源。'
ms.date: 08/19/2020
ms.assetid: ddb2539c-c898-48c1-ad92-245e4a996df8
ms.openlocfilehash: 71e560ed8ee0cae14da396e5ea2f3ab29611ebab
ms.sourcegitcommit: 9c45035b781caebc63ec8ecf912dc83fb6723b1f
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/25/2020
ms.locfileid: "88811492"
---
# <a name="async-return-types-c"></a><span data-ttu-id="9b492-103">非同步傳回類型 (c # ) </span><span class="sxs-lookup"><span data-stu-id="9b492-103">Async return types (C#)</span></span>

<span data-ttu-id="9b492-104">非同步方法可有下列傳回型別：</span><span class="sxs-lookup"><span data-stu-id="9b492-104">Async methods can have the following return types:</span></span>

- <span data-ttu-id="9b492-105">執行作業但不傳回任何值的非同步方法為 <xref:System.Threading.Tasks.Task>。</span><span class="sxs-lookup"><span data-stu-id="9b492-105"><xref:System.Threading.Tasks.Task>, for an async method that performs an operation but returns no value.</span></span>
- <span data-ttu-id="9b492-106">傳回值的非同步方法為 <xref:System.Threading.Tasks.Task%601>。</span><span class="sxs-lookup"><span data-stu-id="9b492-106"><xref:System.Threading.Tasks.Task%601>, for an async method that returns a value.</span></span>
- <span data-ttu-id="9b492-107">處理常式為 `void`。</span><span class="sxs-lookup"><span data-stu-id="9b492-107">`void`, for an event handler.</span></span>
- <span data-ttu-id="9b492-108">自 C# 7.0 開始，任何具有可存取 `GetAwaiter` 方法的型別。</span><span class="sxs-lookup"><span data-stu-id="9b492-108">Starting with C# 7.0, any type that has an accessible `GetAwaiter` method.</span></span> <span data-ttu-id="9b492-109">`GetAwaiter` 方法傳回的物件必須實作 <xref:System.Runtime.CompilerServices.ICriticalNotifyCompletion?displayProperty=nameWithType> 介面。</span><span class="sxs-lookup"><span data-stu-id="9b492-109">The object returned by the `GetAwaiter` method must implement the <xref:System.Runtime.CompilerServices.ICriticalNotifyCompletion?displayProperty=nameWithType> interface.</span></span>
- <span data-ttu-id="9b492-110">從 c # 8.0 開始， <xref:System.Collections.Generic.IAsyncEnumerable%601> 適用于傳回 *非同步資料流程*的非同步方法。</span><span class="sxs-lookup"><span data-stu-id="9b492-110">Starting with C# 8.0, <xref:System.Collections.Generic.IAsyncEnumerable%601>, for an async method that returns an *async stream*.</span></span>

<span data-ttu-id="9b492-111">如需非同步方法的詳細資訊，請參閱 [使用 async 和 await 進行非同步程式設計 (c # ) ](./index.md)。</span><span class="sxs-lookup"><span data-stu-id="9b492-111">For more information about async methods, see [Asynchronous programming with async and await (C#)](./index.md).</span></span>

<span data-ttu-id="9b492-112">另外還有一些 Windows 工作負載特有的類型：</span><span class="sxs-lookup"><span data-stu-id="9b492-112">Several other types also exist that are specific to Windows workloads:</span></span>

- <span data-ttu-id="9b492-113"><xref:System.Windows.Threading.DispatcherOperation>，適用于僅限 Windows 的非同步作業。</span><span class="sxs-lookup"><span data-stu-id="9b492-113"><xref:System.Windows.Threading.DispatcherOperation>, for async operations limited to Windows.</span></span>
- <span data-ttu-id="9b492-114"><xref:Windows.Foundation.IAsyncAction>，適用于 UWP 中不會傳回值的非同步動作。</span><span class="sxs-lookup"><span data-stu-id="9b492-114"><xref:Windows.Foundation.IAsyncAction>, for async actions in UWP that do not return a value.</span></span>
- <span data-ttu-id="9b492-115"><xref:Windows.Foundation.IAsyncActionWithProgress%601>，適用于 UWP 中報告進度但未傳回值的非同步動作。</span><span class="sxs-lookup"><span data-stu-id="9b492-115"><xref:Windows.Foundation.IAsyncActionWithProgress%601>, for async actions in UWP that report progress but do not return a value.</span></span>
- <span data-ttu-id="9b492-116"><xref:Windows.Foundation.IAsyncOperation%601>，適用于 UWP 中傳回值的非同步作業。</span><span class="sxs-lookup"><span data-stu-id="9b492-116"><xref:Windows.Foundation.IAsyncOperation%601>, for async operations in UWP that return a value.</span></span>
- <span data-ttu-id="9b492-117"><xref:Windows.Foundation.IAsyncOperationWithProgress%602>，適用于 UWP 中的非同步作業，可報告進度並傳回值。</span><span class="sxs-lookup"><span data-stu-id="9b492-117"><xref:Windows.Foundation.IAsyncOperationWithProgress%602>, for async operations in UWP that report progress and return a value.</span></span>

## <a name="task-return-type"></a><span data-ttu-id="9b492-118">工作傳回類型</span><span class="sxs-lookup"><span data-stu-id="9b492-118">Task return type</span></span>

<span data-ttu-id="9b492-119">不包含 `return` 陳述式的非同步方法，或包含不會傳回運算元的 `return` 陳述式的非同步方法，通常具有傳回型別 <xref:System.Threading.Tasks.Task>。</span><span class="sxs-lookup"><span data-stu-id="9b492-119">Async methods that don't contain a `return` statement or that contain a `return` statement that doesn't return an operand usually have a return type of <xref:System.Threading.Tasks.Task>.</span></span> <span data-ttu-id="9b492-120">這類方法如果以同步方式執行，會傳回 `void`。</span><span class="sxs-lookup"><span data-stu-id="9b492-120">Such methods return `void` if they run synchronously.</span></span> <span data-ttu-id="9b492-121">如果您針對非同步方法使用 <xref:System.Threading.Tasks.Task> 傳回型別，則除非被呼叫的非同步方法完成，否則呼叫的方法可以使用 `await` 運算子暫止呼叫端完成。</span><span class="sxs-lookup"><span data-stu-id="9b492-121">If you use a <xref:System.Threading.Tasks.Task> return type for an async method, a calling method can use an `await` operator to suspend the caller's completion until the called async method has finished.</span></span>

<span data-ttu-id="9b492-122">在下列範例中， `WaitAndApologizeAsync` 方法不包含 `return` 語句，因此方法會傳回 <xref:System.Threading.Tasks.Task> 物件。</span><span class="sxs-lookup"><span data-stu-id="9b492-122">In the following example, the `WaitAndApologizeAsync` method doesn't contain a `return` statement, so the method returns a <xref:System.Threading.Tasks.Task> object.</span></span> <span data-ttu-id="9b492-123">傳回可 `Task` 等候 `WaitAndApologizeAsync` 。</span><span class="sxs-lookup"><span data-stu-id="9b492-123">Returning a `Task` enables `WaitAndApologizeAsync` to be awaited.</span></span> <span data-ttu-id="9b492-124"><xref:System.Threading.Tasks.Task>型別不包含 `Result` 屬性，因為它沒有傳回值。</span><span class="sxs-lookup"><span data-stu-id="9b492-124">The <xref:System.Threading.Tasks.Task> type doesn't include a `Result` property because it has no return value.</span></span>

:::code language="csharp" source="snippets/async-return-types/async-returns2.cs" id="TaskReturn":::

<span data-ttu-id="9b492-125">`WaitAndApologizeAsync` 是透過使用 await 陳述式而非 await 運算式成為等候的，類似同步 void 傳回方法的呼叫陳述式。</span><span class="sxs-lookup"><span data-stu-id="9b492-125">`WaitAndApologizeAsync` is awaited by using an await statement instead of an await expression, similar to the calling statement for a synchronous void-returning method.</span></span> <span data-ttu-id="9b492-126">在此情況下，await 運算子的應用不會產生值。</span><span class="sxs-lookup"><span data-stu-id="9b492-126">The application of an await operator in this case doesn't produce a value.</span></span> <span data-ttu-id="9b492-127">若要澄清詞彙語句和運算式，請參閱下表：</span><span class="sxs-lookup"><span data-stu-id="9b492-127">To clarify the terms statement and expression, refer to the table below:</span></span>

| <span data-ttu-id="9b492-128">Await 種類</span><span class="sxs-lookup"><span data-stu-id="9b492-128">Await kind</span></span> | <span data-ttu-id="9b492-129">範例</span><span class="sxs-lookup"><span data-stu-id="9b492-129">Example</span></span>                                      | <span data-ttu-id="9b492-130">類型</span><span class="sxs-lookup"><span data-stu-id="9b492-130">Type</span></span>                                   |
|------------|----------------------------------------------|----------------------------------------|
| <span data-ttu-id="9b492-131">引數</span><span class="sxs-lookup"><span data-stu-id="9b492-131">Statement</span></span>  | `await SomeTaskMethodAsync()`                | <xref:System.Threading.Tasks.Task>     |
| <span data-ttu-id="9b492-132">運算式</span><span class="sxs-lookup"><span data-stu-id="9b492-132">Expression</span></span> | `T result = await SomeTaskMethodAsync<T>();` | <xref:System.Threading.Tasks.Task%601> |

<span data-ttu-id="9b492-133">您可以將的呼叫與 `WaitAndApologizeAsync` await 運算子的應用程式分開，如下列程式碼所示。</span><span class="sxs-lookup"><span data-stu-id="9b492-133">You can separate the call to `WaitAndApologizeAsync` from the application of an await operator, as the following code shows.</span></span> <span data-ttu-id="9b492-134">不過，請記住，`Task` 沒有 `Result` 屬性，且將 await 運算子套用至 `Task` 時不會產生任何值。</span><span class="sxs-lookup"><span data-stu-id="9b492-134">However, remember that a `Task` doesn't have a `Result` property, and that no value is produced when an await operator is applied to a `Task`.</span></span>

<span data-ttu-id="9b492-135">下列程式碼隔開呼叫 `WaitAndApologizeAsync` 方法與等候方法傳回的工作。</span><span class="sxs-lookup"><span data-stu-id="9b492-135">The following code separates calling the `WaitAndApologizeAsync` method from awaiting the task that the method returns.</span></span>

:::code language="csharp" source="snippets/async-return-types/async-returns2a.cs" id="AwaitTask":::

## <a name="tasktresult-return-type"></a><span data-ttu-id="9b492-136">工作傳回 \<TResult\> 類型</span><span class="sxs-lookup"><span data-stu-id="9b492-136">Task\<TResult\> return type</span></span>

<span data-ttu-id="9b492-137">傳回 <xref:System.Threading.Tasks.Task%601> 型別用於非同步方法，其中包含運算元為的 [return](../../../language-reference/keywords/return.md) 語句 `TResult` 。</span><span class="sxs-lookup"><span data-stu-id="9b492-137">The <xref:System.Threading.Tasks.Task%601> return type is used for an async method that contains a [return](../../../language-reference/keywords/return.md) statement in which the operand is `TResult`.</span></span>

<span data-ttu-id="9b492-138">在下列範例中， `GetLeisureHoursAsync` 方法包含會傳回 `return` 整數的語句。</span><span class="sxs-lookup"><span data-stu-id="9b492-138">In the following example, the `GetLeisureHoursAsync` method contains a `return` statement that returns an integer.</span></span> <span data-ttu-id="9b492-139">因此，方法宣告必須指定 `Task<int>` 傳回型別。</span><span class="sxs-lookup"><span data-stu-id="9b492-139">Therefore, the method declaration must specify a return type of `Task<int>`.</span></span> <span data-ttu-id="9b492-140">非同步方法是傳回之作業的 <xref:System.Threading.Tasks.Task.FromResult%2A> 預留位置 <xref:System.DateTime.DayOfWeek> 。</span><span class="sxs-lookup"><span data-stu-id="9b492-140">The <xref:System.Threading.Tasks.Task.FromResult%2A> async method is a placeholder for an operation that returns a <xref:System.DateTime.DayOfWeek>.</span></span>

:::code language="csharp" source="snippets/async-return-types/async-returns1.cs" id="LeisureHours":::

<span data-ttu-id="9b492-141">從 `ShowTodaysInfo` 方法的 await 運算式內呼叫 `GetLeisureHoursAsync` 時，await 運算式會擷取儲存在 `GetLeisureHours` 方法所傳回之工作中的整數值 (`leisureHours` 的值)。</span><span class="sxs-lookup"><span data-stu-id="9b492-141">When `GetLeisureHoursAsync` is called from within an await expression in the `ShowTodaysInfo` method, the await expression retrieves the integer value (the value of `leisureHours`) that's stored in the task returned by the `GetLeisureHours` method.</span></span> <span data-ttu-id="9b492-142">如需 await 運算式的詳細資訊，請參閱 [await](../../../language-reference/operators/await.md)。</span><span class="sxs-lookup"><span data-stu-id="9b492-142">For more information about await expressions, see [await](../../../language-reference/operators/await.md).</span></span>

<span data-ttu-id="9b492-143">`await` `Task<T>` `GetLeisureHoursAsync` 如下列程式碼所示，您可以進一步瞭解如何從的應用程式分隔呼叫，以抓取的結果 `await` 。</span><span class="sxs-lookup"><span data-stu-id="9b492-143">You can better understand how `await` retrieves the result from a `Task<T>` by separating the call to `GetLeisureHoursAsync` from the application of `await`, as the following code shows.</span></span> <span data-ttu-id="9b492-144">呼叫不會立即等候的 `GetLeisureHoursAsync` 方法，會傳回 `Task<int>`，如您所預期的方法宣告。</span><span class="sxs-lookup"><span data-stu-id="9b492-144">A call to method `GetLeisureHoursAsync` that isn't immediately awaited returns a `Task<int>`, as you would expect from the declaration of the method.</span></span> <span data-ttu-id="9b492-145">在範例中，工作會指派給 `getLeisureHoursTask` 變數。</span><span class="sxs-lookup"><span data-stu-id="9b492-145">The task is assigned to the `getLeisureHoursTask` variable in the example.</span></span> <span data-ttu-id="9b492-146">因為 `getLeisureHoursTask` 是 <xref:System.Threading.Tasks.Task%601>，所以它包含 `TResult` 類型的 <xref:System.Threading.Tasks.Task%601.Result> 屬性。</span><span class="sxs-lookup"><span data-stu-id="9b492-146">Because `getLeisureHoursTask` is a <xref:System.Threading.Tasks.Task%601>, it contains a <xref:System.Threading.Tasks.Task%601.Result> property of type `TResult`.</span></span> <span data-ttu-id="9b492-147">在本例中，`TResult` 代表整數類型。</span><span class="sxs-lookup"><span data-stu-id="9b492-147">In this case, `TResult` represents an integer type.</span></span> <span data-ttu-id="9b492-148">當 `await` 套用至 `getLeisureHoursTask` 時，await 運算式評估為 `getLeisureHoursTask` 之 <xref:System.Threading.Tasks.Task%601.Result%2A> 屬性的內容。</span><span class="sxs-lookup"><span data-stu-id="9b492-148">When `await` is applied to `getLeisureHoursTask`, the await expression evaluates to the contents of the <xref:System.Threading.Tasks.Task%601.Result%2A> property of `getLeisureHoursTask`.</span></span> <span data-ttu-id="9b492-149">值會指派給 `ret` 變數。</span><span class="sxs-lookup"><span data-stu-id="9b492-149">The value is assigned to the `ret` variable.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="9b492-150"><xref:System.Threading.Tasks.Task%601.Result%2A> 屬性是封鎖的屬性。</span><span class="sxs-lookup"><span data-stu-id="9b492-150">The <xref:System.Threading.Tasks.Task%601.Result%2A> property is a blocking property.</span></span> <span data-ttu-id="9b492-151">如果您嘗試在其工作完成之前先存取它，目前使用中的執行緒會封鎖，直到工作完成並且有可用的值為止。</span><span class="sxs-lookup"><span data-stu-id="9b492-151">If you try to access it before its task is finished, the thread that's currently active is blocked until the task completes and the value is available.</span></span> <span data-ttu-id="9b492-152">在大部分情況下，您應該使用 `await` 來存取值，而不是直接存取屬性。</span><span class="sxs-lookup"><span data-stu-id="9b492-152">In most cases, you should access the value by using `await` instead of accessing the property directly.</span></span>
>
> <span data-ttu-id="9b492-153">先前的範例抓取了屬性的值 <xref:System.Threading.Tasks.Task%601.Result%2A> 來封鎖主執行緒，讓 `Main` 方法可以在 `message` 應用程式結束之前將輸出到主控台。</span><span class="sxs-lookup"><span data-stu-id="9b492-153">The previous example retrieved the value of the <xref:System.Threading.Tasks.Task%601.Result%2A> property to block the main thread so that the `Main` method could print the `message` to the console before the application ended.</span></span>

:::code language="csharp" source="snippets/async-return-types/async-returns1a.cs" id="StoreTask":::

## <a name="void-return-type"></a><span data-ttu-id="9b492-154"> Void 傳回型別</span><span class="sxs-lookup"><span data-stu-id="9b492-154">Void return type</span></span>

<span data-ttu-id="9b492-155">您在非同步事件處理常式中使用 `void` 傳回型別，這需要 `void` 傳回型別。</span><span class="sxs-lookup"><span data-stu-id="9b492-155">You use the `void` return type in asynchronous event handlers, which require a `void` return type.</span></span> <span data-ttu-id="9b492-156">對於不傳回值的事件處理常式以外的方法，您應該要改傳回 <xref:System.Threading.Tasks.Task>，因為傳回 `void` 的非同步方法不能是等候的。</span><span class="sxs-lookup"><span data-stu-id="9b492-156">For methods other than event handlers that don't return a value, you should return a <xref:System.Threading.Tasks.Task> instead, because an async method that returns `void` can't be awaited.</span></span> <span data-ttu-id="9b492-157">這類方法的任何呼叫端都必須繼續完成，而不需等待來電的非同步方法完成。</span><span class="sxs-lookup"><span data-stu-id="9b492-157">Any caller of such a method must continue to completion without waiting for the called async method to finish.</span></span> <span data-ttu-id="9b492-158">呼叫端必須獨立于非同步方法所產生的任何值或例外狀況。</span><span class="sxs-lookup"><span data-stu-id="9b492-158">The caller must be independent of any values or exceptions that the async method generates.</span></span>

<span data-ttu-id="9b492-159">傳回 void 的非同步方法的呼叫端無法攔截方法擲回的例外狀況，而這類未處理的例外狀況可能會導致您的應用程式失敗。</span><span class="sxs-lookup"><span data-stu-id="9b492-159">The caller of a void-returning async method can't catch exceptions thrown from the method, and such unhandled exceptions are likely to cause your application to fail.</span></span> <span data-ttu-id="9b492-160">如果傳回或的方法擲 <xref:System.Threading.Tasks.Task> 回 <xref:System.Threading.Tasks.Task%601> 例外狀況，則例外狀況會儲存在傳回的工作中。</span><span class="sxs-lookup"><span data-stu-id="9b492-160">If a method that returns a <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601> throws an exception, the exception is stored in the returned task.</span></span> <span data-ttu-id="9b492-161">等候工作時，會重新擲回例外狀況。</span><span class="sxs-lookup"><span data-stu-id="9b492-161">The exception is rethrown when the task is awaited.</span></span> <span data-ttu-id="9b492-162">因此，請確定任何可能會產生例外狀況的非同步方法具有傳回型別 <xref:System.Threading.Tasks.Task> 或 <xref:System.Threading.Tasks.Task%601>，且會等候對方法的呼叫。</span><span class="sxs-lookup"><span data-stu-id="9b492-162">Therefore, make sure that any async method that can produce an exception has a return type of <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601> and that calls to the method are awaited.</span></span>

<span data-ttu-id="9b492-163">如需如何在非同步方法中攔截例外狀況的詳細資訊，請參閱[try-catch](../../../language-reference/keywords/try-catch.md)文章的[非同步方法中的例外](../../../language-reference/keywords/try-catch.md#exceptions-in-async-methods)狀況一節。</span><span class="sxs-lookup"><span data-stu-id="9b492-163">For more information about how to catch exceptions in async methods, see the [Exceptions in async methods](../../../language-reference/keywords/try-catch.md#exceptions-in-async-methods) section of the [try-catch](../../../language-reference/keywords/try-catch.md) article.</span></span>

<span data-ttu-id="9b492-164">下列範例示範非同步事件處理常式的行為。</span><span class="sxs-lookup"><span data-stu-id="9b492-164">The following example shows the behavior of an async event handler.</span></span> <span data-ttu-id="9b492-165">在範例程式碼中，非同步事件處理常式必須讓主執行緒知道它完成的時間。</span><span class="sxs-lookup"><span data-stu-id="9b492-165">In the example code, an async event handler must let the main thread know when it finishes.</span></span> <span data-ttu-id="9b492-166">然後主執行緒可以等候非同步事件處理常式完成，再結束程式。</span><span class="sxs-lookup"><span data-stu-id="9b492-166">Then the main thread can wait for an async event handler to complete before exiting the program.</span></span>

:::code language="csharp" source="snippets/async-return-types/async-returns3.cs":::

## <a name="generalized-async-return-types-and-valuetasktresult"></a><span data-ttu-id="9b492-167">通用的非同步傳回型別和 ValueTask\<TResult\></span><span class="sxs-lookup"><span data-stu-id="9b492-167">Generalized async return types and ValueTask\<TResult\></span></span>

<span data-ttu-id="9b492-168">自 C# 7.0 開始，非同步方法可以傳回具有可存取 `GetAwaiter` 方法的任何型別。</span><span class="sxs-lookup"><span data-stu-id="9b492-168">Starting with C# 7.0, an async method can return any type that has an accessible `GetAwaiter` method.</span></span>

<span data-ttu-id="9b492-169">因為 <xref:System.Threading.Tasks.Task> 和 <xref:System.Threading.Tasks.Task%601> 是參考型別，所以效能關鍵路徑中的記憶體配置，會對效能造成不良影響，特別是當配置出現在緊密迴圈中時。</span><span class="sxs-lookup"><span data-stu-id="9b492-169">Because <xref:System.Threading.Tasks.Task> and <xref:System.Threading.Tasks.Task%601> are reference types, memory allocation in performance-critical paths, particularly when allocations occur in tight loops, can adversely affect performance.</span></span> <span data-ttu-id="9b492-170">支援通用的傳回型別，表示您可以傳回輕量型的實值型別，而不是參考型別，以避免額外的記憶體配置。</span><span class="sxs-lookup"><span data-stu-id="9b492-170">Support for generalized return types means that you can return a lightweight value type instead of a reference type to avoid additional memory allocations.</span></span>

<span data-ttu-id="9b492-171">.NET 提供 <xref:System.Threading.Tasks.ValueTask%601?displayProperty=nameWithType> 結構作為通用工作傳回值的輕量級實作。</span><span class="sxs-lookup"><span data-stu-id="9b492-171">.NET provides the <xref:System.Threading.Tasks.ValueTask%601?displayProperty=nameWithType> structure as a lightweight implementation of a generalized task-returning value.</span></span> <span data-ttu-id="9b492-172">若要使用 <xref:System.Threading.Tasks.ValueTask%601?displayProperty=nameWithType> 類型，您必須將 `System.Threading.Tasks.Extensions` NuGet 套件新增至專案。</span><span class="sxs-lookup"><span data-stu-id="9b492-172">To use the <xref:System.Threading.Tasks.ValueTask%601?displayProperty=nameWithType> type, you must add the `System.Threading.Tasks.Extensions` NuGet package to your project.</span></span> <span data-ttu-id="9b492-173">下列範例會使用 <xref:System.Threading.Tasks.ValueTask%601> 結構，擷取擲兩次骰子的值。</span><span class="sxs-lookup"><span data-stu-id="9b492-173">The following example uses the <xref:System.Threading.Tasks.ValueTask%601> structure to retrieve the value of two dice rolls.</span></span>

:::code language="csharp" source="snippets/async-return-types/async-valuetask.cs":::

## <a name="async-streams-with-iasyncenumerablet"></a><span data-ttu-id="9b492-174">使用 IAsyncEnumerable 的非同步資料流程\<T\></span><span class="sxs-lookup"><span data-stu-id="9b492-174">Async streams with IAsyncEnumerable\<T\></span></span>

<span data-ttu-id="9b492-175">從 c # 8.0 開始，非同步方法可能會傳回以表示的 *非同步資料流程* <xref:System.Collections.Generic.IAsyncEnumerable%601> 。</span><span class="sxs-lookup"><span data-stu-id="9b492-175">Starting with C# 8.0, an async method may return an *async stream*, represented by <xref:System.Collections.Generic.IAsyncEnumerable%601>.</span></span> <span data-ttu-id="9b492-176">非同步資料流程會提供一種方法，以列舉在具有重複非同步呼叫的區塊中產生專案時，從資料流程讀取的專案。</span><span class="sxs-lookup"><span data-stu-id="9b492-176">An async stream provides a way to enumerate items read from a stream when elements are generated in chunks with repeated asynchronous calls.</span></span> <span data-ttu-id="9b492-177">下列範例顯示會產生非同步資料流程的非同步方法：</span><span class="sxs-lookup"><span data-stu-id="9b492-177">The following example shows an async method that generates an async stream:</span></span>

:::code language="csharp" source="snippets/async-return-types/AsyncStreams.cs" id="GenerateAsyncStream":::

<span data-ttu-id="9b492-178">上述範例會以非同步方式讀取字串中的行。</span><span class="sxs-lookup"><span data-stu-id="9b492-178">The preceding example reads lines from a string asynchronously.</span></span> <span data-ttu-id="9b492-179">讀取每一行之後，程式碼就會列舉字串中的每個字。</span><span class="sxs-lookup"><span data-stu-id="9b492-179">Once each line is read, the code enumerates each word in the string.</span></span> <span data-ttu-id="9b492-180">呼叫端會使用語句來列舉每個字 `await foreach` 。</span><span class="sxs-lookup"><span data-stu-id="9b492-180">Callers would enumerate each word using the `await foreach` statement.</span></span> <span data-ttu-id="9b492-181">當方法需要以非同步方式從來源字串讀取下一行時，方法就會等候。</span><span class="sxs-lookup"><span data-stu-id="9b492-181">The method awaits when it needs to asynchronously read the next line from the source string.</span></span>

## <a name="see-also"></a><span data-ttu-id="9b492-182">另請參閱</span><span class="sxs-lookup"><span data-stu-id="9b492-182">See also</span></span>

- <xref:System.Threading.Tasks.Task.FromResult%2A>
- [<span data-ttu-id="9b492-183">在非同步工作完成時進行處理</span><span class="sxs-lookup"><span data-stu-id="9b492-183">Process asynchronous tasks as they complete</span></span>](start-multiple-async-tasks-and-process-them-as-they-complete.md)
- [<span data-ttu-id="9b492-184">使用 async 和 await 進行非同步程式設計 (c # ) </span><span class="sxs-lookup"><span data-stu-id="9b492-184">Asynchronous programming with async and await (C#)</span></span>](index.md)
- [<span data-ttu-id="9b492-185">async</span><span class="sxs-lookup"><span data-stu-id="9b492-185">async</span></span>](../../../language-reference/keywords/async.md)
- [<span data-ttu-id="9b492-186">await</span><span class="sxs-lookup"><span data-stu-id="9b492-186">await</span></span>](../../../language-reference/operators/await.md)
