---
title: 適用于雲端原生應用程式的 Azure 安全性
description: 架構適用于 Azure 的雲端原生 .NET 應用程式 |適用于雲端原生應用程式的 Azure 安全性
ms.date: 05/13/2020
ms.openlocfilehash: a39b64477eb9e896c6603e5609ede653bfee1e07
ms.sourcegitcommit: 27db07ffb26f76912feefba7b884313547410db5
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 05/19/2020
ms.locfileid: "83614249"
---
# <a name="azure-security-for-cloud-native-apps"></a><span data-ttu-id="bf2e8-103">適用于雲端原生應用程式的 Azure 安全性</span><span class="sxs-lookup"><span data-stu-id="bf2e8-103">Azure security for cloud-native apps</span></span>

<span data-ttu-id="bf2e8-104">與傳統應用程式相比，雲端原生應用程式可以更輕鬆且更容易受到保護。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-104">Cloud-native applications can be both easier and more difficult to secure than traditional applications.</span></span> <span data-ttu-id="bf2e8-105">就缺點而言，您必須保護更小的應用程式，並將更多的能源用於建立安全性基礎結構。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-105">On the downside, you need to secure more smaller applications and dedicate more energy to build out the security infrastructure.</span></span> <span data-ttu-id="bf2e8-106">在大部分服務部署中，程式設計語言和樣式的本質上，也表示您需要特別注意來自許多不同提供者的安全性佈告欄。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-106">The heterogeneous nature of programming languages and styles in most service deployments also means you need to pay more attention to security bulletins from many different providers.</span></span>

<span data-ttu-id="bf2e8-107">另一方面，較小的服務（每個都有自己的資料存放區）會限制攻擊的範圍。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-107">On the flip side, smaller services, each with their own data store, limit the scope of an attack.</span></span> <span data-ttu-id="bf2e8-108">如果攻擊者危害一個系統，攻擊者可能會更難以跳到另一個系統，而不是在整合型應用程式中。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-108">If an attacker compromises one system, it's probably more difficult for the attacker to make the jump to another system than it is in a monolithic application.</span></span> <span data-ttu-id="bf2e8-109">進程界限是強式界限。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-109">Process boundaries are strong boundaries.</span></span> <span data-ttu-id="bf2e8-110">此外，如果資料庫備份流失，則損毀會更有限制，因為該資料庫只包含資料的子集，而且不太可能包含個人資料。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-110">Also, if a database backup leaks, then the damage is more limited, as that database contains only a subset of data and is unlikely to contain personal data.</span></span>

## <a name="threat-modeling"></a><span data-ttu-id="bf2e8-111">威脅分析模型</span><span class="sxs-lookup"><span data-stu-id="bf2e8-111">Threat modeling</span></span>

<span data-ttu-id="bf2e8-112">無論優點是否超過雲端原生應用程式的缺點，都必須遵循相同的整體安全性思維。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-112">No matter if the advantages outweigh the disadvantages of cloud-native applications, the same holistic security mindset must be followed.</span></span> <span data-ttu-id="bf2e8-113">安全性和安全思考必須屬於開發和營運案例的每個步驟。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-113">Security and secure thinking must be part of every step of the development and operations story.</span></span> <span data-ttu-id="bf2e8-114">在規劃應用程式時，請詢問下列問題：</span><span class="sxs-lookup"><span data-stu-id="bf2e8-114">When planning an application ask questions like:</span></span>

- <span data-ttu-id="bf2e8-115">這項資料遺失的影響為何？</span><span class="sxs-lookup"><span data-stu-id="bf2e8-115">What would be the impact of this data being lost?</span></span>
- <span data-ttu-id="bf2e8-116">如何限制插入此服務的錯誤資料損毀？</span><span class="sxs-lookup"><span data-stu-id="bf2e8-116">How can we limit the damage from bad data being injected into this service?</span></span>
- <span data-ttu-id="bf2e8-117">誰應該擁有此資料的存取權？</span><span class="sxs-lookup"><span data-stu-id="bf2e8-117">Who should have access to this data?</span></span>
- <span data-ttu-id="bf2e8-118">有關于開發和發行程式的稽核原則嗎？</span><span class="sxs-lookup"><span data-stu-id="bf2e8-118">Are there auditing policies in place around the development and release process?</span></span>

<span data-ttu-id="bf2e8-119">這些問題都是一個稱為[威脅模型](https://docs.microsoft.com/azure/security/azure-security-threat-modeling-tool)化程式的一部分。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-119">All these questions are part of a process called [threat modeling](https://docs.microsoft.com/azure/security/azure-security-threat-modeling-tool).</span></span> <span data-ttu-id="bf2e8-120">此程式會嘗試回答問題，其中包括系統的威脅、威脅的可能性，以及可能的損害。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-120">This process tries to answer the question of what threats there are to the system, how likely the threats are, and the potential damage from them.</span></span>

<span data-ttu-id="bf2e8-121">一旦建立了威脅清單之後，您必須決定是否值得緩和。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-121">Once the list of threats has been established, you need to decide whether they're worth mitigating.</span></span> <span data-ttu-id="bf2e8-122">有時候威脅的代價不高，因此不太可能需要花費能源來進行規劃。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-122">Sometimes a threat is so unlikely and expensive to plan for that it isn't worth spending energy on it.</span></span> <span data-ttu-id="bf2e8-123">比方說，某些狀態層級動作專案可能會將變更插入至數百萬個裝置所使用之進程的設計。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-123">For instance, some state level actor could inject changes into the design of a process that is used by millions of devices.</span></span> <span data-ttu-id="bf2e8-124">現在，我們不會在[環 3](https://en.wikipedia.org/wiki/Protection_ring)中執行特定的程式碼，而是在 ring 0 中執行該程式碼。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-124">Now, instead of running a certain piece of code in [Ring 3](https://en.wikipedia.org/wiki/Protection_ring), that code is run in Ring 0.</span></span> <span data-ttu-id="bf2e8-125">這可讓惡意探索略過虛擬機器，並在裸機機器上執行攻擊程式碼，以允許在該硬體上執行的所有虛擬機器上進行攻擊。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-125">This allows an exploit that can bypass the hypervisor and run the attack code on the bare metal machines, allowing attacks on all the virtual machines that are running on that hardware.</span></span>

<span data-ttu-id="bf2e8-126">更改過的處理器在沒有 microscope 的情況下，很容易偵測到該處理器的晶片設計上有其深入知識。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-126">The altered processors are difficult to detect without a microscope and advanced knowledge of the on silicon design of that processor.</span></span> <span data-ttu-id="bf2e8-127">這種情況不太可能發生，降低成本，因此可能沒有威脅模型會建議為它建立惡意探索保護。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-127">This scenario is unlikely to happen and expensive to mitigate, so probably no threat model would recommend building exploit protection for it.</span></span>

<span data-ttu-id="bf2e8-128">較可能的威脅（例如，中斷的存取控制允許 `Id` 增量攻擊（以 `Id=2` URL 取代為 `Id=3` ）或 SQL 插入式，對於建立保護更為吸引人。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-128">More likely threats, such as broken access controls permitting `Id` incrementing attacks (replacing `Id=2` with `Id=3` in the URL) or SQL injection, are more attractive to build protections against.</span></span> <span data-ttu-id="bf2e8-129">這些威脅的緩和措施相當合理，可以建立並防止斑點公司信譽的尷尬安全性漏洞。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-129">The mitigations for these threats are quite reasonable to build and prevent embarrassing security holes that smear the company's reputation.</span></span>

## <a name="principle-of-least-privilege"></a><span data-ttu-id="bf2e8-130">最低權限原則</span><span class="sxs-lookup"><span data-stu-id="bf2e8-130">Principle of least privilege</span></span>

<span data-ttu-id="bf2e8-131">電腦安全性性的一項初步概念是最低許可權（POLP）的原則。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-131">One of the founding ideas in computer security is the Principle of Least Privilege (POLP).</span></span> <span data-ttu-id="bf2e8-132">它實際上是任何形式安全性的基本概念，也就是數位或實體。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-132">It's actually a foundational idea in most any form of security be it digital or physical.</span></span> <span data-ttu-id="bf2e8-133">簡而言之，原則是任何使用者或程式都應該擁有最少的許可權來執行其工作。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-133">In short, the principle is that any user or process should have the smallest number of rights possible to execute its task.</span></span>

<span data-ttu-id="bf2e8-134">例如，假設有一個銀行的出納員：存取 safe 是不尋常的活動。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-134">As an example, think of the tellers at a bank: accessing the safe is an uncommon activity.</span></span> <span data-ttu-id="bf2e8-135">因此，平均取款無法自行開啟安全。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-135">So, the average teller can't open the safe themselves.</span></span> <span data-ttu-id="bf2e8-136">若要取得存取權，他們必須透過負責執行額外安全性檢查的銀行經理來提升其要求。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-136">To gain access, they need to escalate their request through a bank manager, who performs additional security checks.</span></span>

<span data-ttu-id="bf2e8-137">在電腦系統中，很棒的例子就是連接到資料庫的使用者權限。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-137">In a computer system, a fantastic example is the rights of a user connecting to a database.</span></span> <span data-ttu-id="bf2e8-138">在許多情況下，都有一個用來建立資料庫結構和執行應用程式的單一使用者帳戶。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-138">In many cases, there's a single user account used to both build the database structure and run the application.</span></span> <span data-ttu-id="bf2e8-139">除了在極端情況下，執行應用程式的帳戶不需要更新架構資訊的能力。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-139">Except in extreme cases, the account running the application doesn't need the ability to update schema information.</span></span> <span data-ttu-id="bf2e8-140">應該有數個帳戶可提供不同層級的許可權。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-140">There should be several accounts that provide different levels of privilege.</span></span> <span data-ttu-id="bf2e8-141">應用程式應該只使用授與讀取和寫入權限給資料表中之資料的許可權層級。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-141">The application should only use the permission level that grants read and write access to the data in the tables.</span></span> <span data-ttu-id="bf2e8-142">這種保護措施可以排除目標為卸載資料庫資料表或引進惡意觸發程式的攻擊。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-142">This kind of protection would eliminate attacks that aimed to drop database tables or introduce malicious triggers.</span></span>

<span data-ttu-id="bf2e8-143">幾乎每個建立雲端原生應用程式的部分都可以因記住最低許可權的原則而受益。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-143">Almost every part of building a cloud-native application can benefit from remembering the principle of least privilege.</span></span> <span data-ttu-id="bf2e8-144">在角色型存取控制（RBAC）中設定防火牆、網路安全性群組、角色和範圍時，您可以在播放時找到它。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-144">You can find it at play when setting up firewalls, network security groups, roles, and scopes in Role-based access control (RBAC).</span></span>

## <a name="penetration-testing"></a><span data-ttu-id="bf2e8-145">滲透測試</span><span class="sxs-lookup"><span data-stu-id="bf2e8-145">Penetration testing</span></span>

<span data-ttu-id="bf2e8-146">隨著應用程式變得更複雜，攻擊媒介的數目也會以驚人的速率增加。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-146">As applications become more complicated the number of attack vectors increases at an alarming rate.</span></span> <span data-ttu-id="bf2e8-147">威脅分析模型的缺陷在於，它通常是由同一個建立系統的人員所執行。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-147">Threat modeling is flawed in that it tends to be executed by the same people building the system.</span></span> <span data-ttu-id="bf2e8-148">就像許多開發人員在構思使用者互動，然後建立無法使用的使用者介面一樣，大部分的開發人員都難以看到每個攻擊的向量。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-148">In the same way that many developers have trouble envisioning user interactions and then build unusable user interfaces, most developers have difficulty seeing every attack vector.</span></span> <span data-ttu-id="bf2e8-149">建立系統的開發人員也可能無法在攻擊方法中精通，而且也錯過了重要的事。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-149">It's also possible that the developers building the system aren't well versed in attack methodologies and miss something crucial.</span></span>

<span data-ttu-id="bf2e8-150">滲透測試或「畫筆測試」牽涉到外部執行者嘗試攻擊系統。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-150">Penetration testing or "pen testing" involves bringing in external actors to attempt to attack the system.</span></span> <span data-ttu-id="bf2e8-151">這些攻擊者可能是外部諮詢公司或其他開發人員，從企業的其他部分獲得良好的安全性知識。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-151">These attackers may be an external consulting company or other developers with good security knowledge from another part of the business.</span></span> <span data-ttu-id="bf2e8-152">他們會提供全權委託來嘗試破壞系統。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-152">They're given carte blanche to attempt to subvert the system.</span></span> <span data-ttu-id="bf2e8-153">它們經常會發現需要修補的大量安全性漏洞。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-153">Frequently, they'll find extensive security holes that need to be patched.</span></span> <span data-ttu-id="bf2e8-154">有時候，攻擊向量將會是完全非預期的東西，像是利用對 CEO 的網路釣魚攻擊。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-154">Sometimes the attack vector will be something totally unexpected like exploiting a phishing attack against the CEO.</span></span>

<span data-ttu-id="bf2e8-155">Azure 本身會持續從[Microsoft 內部的駭客小組](https://azure.microsoft.com/resources/videos/red-vs-blue-internal-security-penetration-testing-of-microsoft-azure/)進行攻擊。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-155">Azure itself is constantly undergoing attacks from a [team of hackers inside Microsoft](https://azure.microsoft.com/resources/videos/red-vs-blue-internal-security-penetration-testing-of-microsoft-azure/).</span></span> <span data-ttu-id="bf2e8-156">多年來，他們一直以來都是找出數十個潛在的嚴重攻擊媒介，先將它們關閉後再從外部惡意探索。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-156">Over the years, they've been the first to find dozens of potentially catastrophic attack vectors, closing them before they can be exploited externally.</span></span> <span data-ttu-id="bf2e8-157">目標越吸引人，永久性的執行者會嘗試利用它，而且在世界上有幾個目標比 Azure 更有吸引力。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-157">The more tempting a target, the more likely that eternal actors will attempt to exploit it and there are a few targets in the world more tempting than Azure.</span></span>

## <a name="monitoring"></a><span data-ttu-id="bf2e8-158">監視</span><span class="sxs-lookup"><span data-stu-id="bf2e8-158">Monitoring</span></span>

<span data-ttu-id="bf2e8-159">如果攻擊者嘗試滲透應用程式，應該會有一些警告。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-159">Should an attacker attempt to penetrate an application, there should be some warning of it.</span></span> <span data-ttu-id="bf2e8-160">通常，您可以藉由檢查服務的記錄來找出攻擊。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-160">Frequently, attacks can be spotted by examining the logs from services.</span></span> <span data-ttu-id="bf2e8-161">攻擊會留下可在成功前發現的各種跡象徵兆。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-161">Attacks leave telltale signs that can be spotted before they succeed.</span></span> <span data-ttu-id="bf2e8-162">比方說，嘗試猜測密碼的攻擊者會對登入系統發出許多要求。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-162">For instance, an attacker attempting to guess a password will make many requests to a login system.</span></span> <span data-ttu-id="bf2e8-163">以登入系統為中心的監視可以偵測出與一般存取模式不相關的奇怪模式。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-163">Monitoring around the login system can detect weird patterns that are out of line with the typical access pattern.</span></span> <span data-ttu-id="bf2e8-164">這項監視可以轉換成警示，進而提醒作業人員啟用某種類型的對策。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-164">This monitoring can be turned into an alert that can, in turn, alert an operations person to activate some sort of countermeasure.</span></span> <span data-ttu-id="bf2e8-165">高度成熟的監視系統甚至可能會根據這些偏差主動新增規則來封鎖要求或節流回應，而採取動作。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-165">A highly mature monitoring system might even take action based on these deviations proactively adding rules to block requests or throttle responses.</span></span>

## <a name="securing-the-build"></a><span data-ttu-id="bf2e8-166">保護組建</span><span class="sxs-lookup"><span data-stu-id="bf2e8-166">Securing the build</span></span>

<span data-ttu-id="bf2e8-167">通常會忽略安全性的一個位置，就是在建立程式的過程中。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-167">One place where security is often overlooked is around the build process.</span></span> <span data-ttu-id="bf2e8-168">不只應該組建執行安全性檢查，例如掃描不安全的程式碼或簽入認證，但組建本身應該是安全的。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-168">Not only should the build run security checks, such as scanning for insecure code or checked-in credentials, but the build itself should be secure.</span></span> <span data-ttu-id="bf2e8-169">如果組建伺服器遭到入侵，它會提供絕佳的向量，讓您將任意程式碼引進產品中。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-169">If the build server is compromised, then it provides a fantastic vector for introducing arbitrary code into the product.</span></span>

<span data-ttu-id="bf2e8-170">想像一下，攻擊者想要竊取登入 web 應用程式的使用者密碼。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-170">Imagine that an attacker is looking to steal the passwords of people signing into a web application.</span></span> <span data-ttu-id="bf2e8-171">他們可能會引進一個組建步驟，修改已簽出的程式碼，以將任何登入要求鏡像至另一部伺服器。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-171">They could introduce a build step that modifies the checked-out code to mirror any login request to another server.</span></span> <span data-ttu-id="bf2e8-172">下一次程式碼完成組建時，它會以無訊息模式更新。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-172">The next time code goes through the build, it's silently updated.</span></span> <span data-ttu-id="bf2e8-173">原始程式碼弱點掃描不會在組建之前執行，因此不會攔截此程式碼。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-173">The source code vulnerability scanning won't catch this as it runs before the build.</span></span> <span data-ttu-id="bf2e8-174">同樣地，任何人都不會在程式碼審核中攔截它，因為組建伺服器上有即時的組建步驟。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-174">Equally, nobody will catch it in a code review because the build steps live on the build server.</span></span> <span data-ttu-id="bf2e8-175">被利用的程式碼會進入生產環境，讓它能夠收集密碼。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-175">The exploited code will go to production where it can harvest passwords.</span></span> <span data-ttu-id="bf2e8-176">可能不會有任何組建程式變更的 audit 記錄檔，或至少沒有任何人監控該 audit。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-176">Probably there's no audit log of the build process changes, or at least nobody monitoring the audit.</span></span>

<span data-ttu-id="bf2e8-177">這是看似低價值目標的最佳範例，可以用來中斷系統。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-177">This is a perfect example of a seemingly low value target that can be used to break into the system.</span></span> <span data-ttu-id="bf2e8-178">一旦攻擊者入侵系統的周邊，他們就可以開始找出方法，將其許可權提升到他們想要的任何地方都可能造成真正的傷害。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-178">Once an attacker breaches the perimeter of the system, they can start working on finding ways to elevate their permissions to the point that they can cause real harm anywhere they like.</span></span>

## <a name="building-secure-code"></a><span data-ttu-id="bf2e8-179">建立安全的程式碼</span><span class="sxs-lookup"><span data-stu-id="bf2e8-179">Building secure code</span></span>

<span data-ttu-id="bf2e8-180">.NET Framework 已經是非常安全的架構。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-180">.NET Framework is already a quite secure framework.</span></span> <span data-ttu-id="bf2e8-181">它可避免非受控碼的某些陷阱，例如離開陣列的結尾。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-181">It avoids some of the pitfalls of unmanaged code, such as walking off the ends of arrays.</span></span> <span data-ttu-id="bf2e8-182">致力於在發現安全性漏洞時進行修正。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-182">Work is actively done to fix security holes as they're discovered.</span></span> <span data-ttu-id="bf2e8-183">甚至還有一個[bug 豐富程式](https://www.microsoft.com/msrc/bounty)，可讓研究人員找出架構中的問題並回報，而不是利用它們。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-183">There's even a [bug bounty program](https://www.microsoft.com/msrc/bounty) that pays researchers to find issues in the framework and report them instead of exploiting them.</span></span>

<span data-ttu-id="bf2e8-184">有許多方法可讓 .NET 程式碼更安全。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-184">There are many ways to make .NET code more secure.</span></span> <span data-ttu-id="bf2e8-185">遵循適用于 .NET 的[安全](https://docs.microsoft.com/dotnet/standard/security/secure-coding-guidelines)程式碼撰寫方針一文的指導方針，是確保程式碼從頭開始安全的合理步驟。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-185">Following guidelines such as the [Secure coding guidelines for .NET](https://docs.microsoft.com/dotnet/standard/security/secure-coding-guidelines) article is a reasonable step to take to ensure that the code is secure from the ground up.</span></span> <span data-ttu-id="bf2e8-186">[OWASP 前10名](https://owasp.org/www-project-top-ten/)是建立安全程式碼的另一個寶貴指南。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-186">The [OWASP top 10](https://owasp.org/www-project-top-ten/) is another invaluable guide to build secure code.</span></span>

<span data-ttu-id="bf2e8-187">建立程式是放置掃描工具以偵測原始程式碼中的問題，再使其進入生產環境的最佳位置。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-187">The build process is a good place to put scanning tools to detect problems in source code before they make it into production.</span></span> <span data-ttu-id="bf2e8-188">大部分的專案都會相依于某些其他封裝。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-188">Most every project has dependencies on some other packages.</span></span> <span data-ttu-id="bf2e8-189">可以掃描過時套件的工具，將會在夜間組建中攔截問題。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-189">A tool that can scan for outdated packages will catch problems in a nightly build.</span></span> <span data-ttu-id="bf2e8-190">即使在建立 Docker 映射時，檢查並確定基底映射並不會有已知的弱點，會很有説明。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-190">Even when building Docker images, it's useful to check and make sure that the base image doesn't have known vulnerabilities.</span></span> <span data-ttu-id="bf2e8-191">另一個要檢查的事項是沒有人不慎簽入認證。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-191">Another thing to check is that nobody has accidentally checked in credentials.</span></span>

## <a name="built-in-security"></a><span data-ttu-id="bf2e8-192">內建安全性</span><span class="sxs-lookup"><span data-stu-id="bf2e8-192">Built-in security</span></span>

<span data-ttu-id="bf2e8-193">Azure 的設計是為了平衡大部分使用者的可用性和安全性。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-193">Azure is designed to balance usability and security for the majority of users.</span></span> <span data-ttu-id="bf2e8-194">不同的使用者會有不同的安全性需求，因此他們需要微調其雲端安全性的方法。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-194">Different users are going to have different security requirements, so they need to fine-tune their approach to cloud security.</span></span> <span data-ttu-id="bf2e8-195">Microsoft 在[信任中心](https://azure.microsoft.com/support/trust-center/)發佈了大量的安全性資訊。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-195">Microsoft publishes a great deal of security information in the [Trust Center](https://azure.microsoft.com/support/trust-center/).</span></span> <span data-ttu-id="bf2e8-196">對於想要瞭解內建攻擊緩和技術如何工作的專業人員，這項資源應該是第一次停止。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-196">This resource should be the first stop for those professionals interested in understanding how the built-in attack mitigation technologies work.</span></span>

<span data-ttu-id="bf2e8-197">在 Azure 入口網站內， [Azure Advisor](https://azure.microsoft.com/services/advisor/)是持續掃描環境並提出建議的系統。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-197">Within the Azure portal, the [Azure Advisor](https://azure.microsoft.com/services/advisor/) is a system that is constantly scanning an environment and making recommendations.</span></span> <span data-ttu-id="bf2e8-198">其中一些建議是為了節省使用者的金錢而設計，但其他則是設計來識別可能不安全的設定，例如讓儲存體容器開放給世界，而不受虛擬網路保護。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-198">Some of these recommendations are designed to save users money, but others are designed to identify potentially insecure configurations, such as having a storage container open to the world and not protected by a Virtual Network.</span></span>

## <a name="azure-network-infrastructure"></a><span data-ttu-id="bf2e8-199">Azure 網路基礎結構</span><span class="sxs-lookup"><span data-stu-id="bf2e8-199">Azure network infrastructure</span></span>

<span data-ttu-id="bf2e8-200">在內部部署環境中，有一項絕佳的能源是專門用來設定網路功能。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-200">In an on-premises deployment environment, a great deal of energy is dedicated to setting up networking.</span></span> <span data-ttu-id="bf2e8-201">設定路由器、交換器和這類工作是複雜的工作。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-201">Setting up routers, switches, and the such is complicated work.</span></span> <span data-ttu-id="bf2e8-202">網路可讓特定資源與其他資源通訊，並在某些情況下防止存取。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-202">Networks allow certain resources to talk to other resources and prevent access in some cases.</span></span> <span data-ttu-id="bf2e8-203">經常的網路規則是限制從開發環境存取生產環境的機會，因為這會造成一半開發的程式碼執行困難並刪除資料 swath。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-203">A frequent network rule is to restrict access to the production environment from the development environment on the off chance that a half-developed piece of code runs awry and deletes a swath of data.</span></span>

<span data-ttu-id="bf2e8-204">在預設情況下，大部分的 PaaS Azure 資源僅具有最基本和寬鬆的網路設定。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-204">Out of the box, most PaaS Azure resources have only the most basic and permissive networking setup.</span></span> <span data-ttu-id="bf2e8-205">例如，網際網路上的任何人都可以存取應用程式服務。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-205">For instance, anybody on the Internet can access an app service.</span></span> <span data-ttu-id="bf2e8-206">新的 SQL Server 實例通常會受到限制，因此外部方無法存取它們，但 Azure 本身所使用的 IP 位址範圍則是允許的。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-206">New SQL Server instances typically come restricted, so that external parties can't access them, but the IP address ranges used by Azure itself are permitted through.</span></span> <span data-ttu-id="bf2e8-207">因此，雖然 SQL server 受到外部威脅的保護，但攻擊者只需要設定 Azure 橋頭，讓他們能夠對 Azure 上的所有 SQL 實例發動攻擊。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-207">So, while the SQL server is protected from external threats, an attacker only needs to set up an Azure bridgehead from where they can launch attacks against all SQL instances on Azure.</span></span>

<span data-ttu-id="bf2e8-208">幸好，大部分的 Azure 資源都可以放入 Azure 虛擬網路，以允許更精細的存取控制。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-208">Fortunately, most Azure resources can be placed into an Azure Virtual Network that allows finer grained access control.</span></span> <span data-ttu-id="bf2e8-209">與內部部署網路建立從較大世界保護之私人網路的方式類似，虛擬網路是位於 Azure 網路內的私人 IP 位址孤島。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-209">Similar to the way that on-premises networks establish private networks that are protected from the wider world, virtual networks are islands of private IP addresses that are located within the Azure network.</span></span>

![圖 9-1 Azure 中的虛擬網路](./media/virtual-network.png)

<span data-ttu-id="bf2e8-211">**圖 9-1**.</span><span class="sxs-lookup"><span data-stu-id="bf2e8-211">**Figure 9-1**.</span></span> <span data-ttu-id="bf2e8-212">Azure 中的虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-212">A virtual network in Azure.</span></span>

<span data-ttu-id="bf2e8-213">與內部部署網路有防火牆管理網路存取的相同方式，您可以在虛擬網路的界限建立類似的防火牆。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-213">In the same way that on-premises networks have a firewall governing access to the network, you can establish a similar firewall at the boundary of the virtual network.</span></span> <span data-ttu-id="bf2e8-214">根據預設，虛擬網路上的所有資源仍可與網際網路通訊。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-214">By default, all the resources on a virtual network can still talk to the Internet.</span></span> <span data-ttu-id="bf2e8-215">這只是需要某種形式的明確防火牆例外的連入連線。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-215">It's only incoming connections that require some form of explicit firewall exception.</span></span>

<span data-ttu-id="bf2e8-216">建立網路之後，就可以將儲存體帳戶之類的內部資源設定為只允許也在虛擬網路上的資源存取。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-216">With the network established, internal resources like storage accounts can be set up to only allow for access by resources that are also on the Virtual Network.</span></span> <span data-ttu-id="bf2e8-217">此防火牆會提供額外的安全性等級，如果該儲存體帳戶的金鑰洩露，攻擊者就無法連線到它來入侵洩露的金鑰。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-217">This firewall provides an extra level of security, should the keys for that storage account be leaked, attackers wouldn't be able to connect to it to exploit the leaked keys.</span></span> <span data-ttu-id="bf2e8-218">這是最低許可權原則的另一個範例。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-218">This is another example of the principle of least privilege.</span></span>

<span data-ttu-id="bf2e8-219">Azure Kubernetes 叢集中的節點可以參與虛擬網路，就像其他 Azure 的原生資源一樣。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-219">The nodes in an Azure Kubernetes cluster can participate in a virtual network just like other resources that are more native to Azure.</span></span> <span data-ttu-id="bf2e8-220">這種功能稱為[Azure Container 網路介面](https://github.com/Azure/azure-container-networking/blob/master/docs/cni.md)。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-220">This functionality is called [Azure Container Networking Interface](https://github.com/Azure/azure-container-networking/blob/master/docs/cni.md).</span></span> <span data-ttu-id="bf2e8-221">實際上，它會在虛擬網路內配置虛擬機器和容器映射所要配置的子網。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-221">In effect, it allocates a subnet within the virtual network on which virtual machines and container images are allocated.</span></span>

<span data-ttu-id="bf2e8-222">繼續說明最低許可權原則的路徑，而不是虛擬網路中的每個資源都必須與其他資源溝通。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-222">Continuing down the path of illustrating the principle of least privilege, not every resource within a Virtual Network needs to talk to every other resource.</span></span> <span data-ttu-id="bf2e8-223">比方說，在透過儲存體帳戶和 SQL 資料庫提供 Web API 的應用程式中，資料庫和儲存體帳戶不太可能需要彼此通訊。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-223">For instance, in an application that provides a web API over a storage account and a SQL database, it's unlikely that the database and the storage account need to talk to one another.</span></span> <span data-ttu-id="bf2e8-224">它們之間的任何資料共用都會經過 web 應用程式。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-224">Any data sharing between them would go through the web application.</span></span> <span data-ttu-id="bf2e8-225">因此，[網路安全性群組（NSG）](https://docs.microsoft.com/azure/virtual-network/security-overview)可用來拒絕這兩個服務之間的流量。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-225">So, a [network security group (NSG)](https://docs.microsoft.com/azure/virtual-network/security-overview) could be used to deny traffic between the two services.</span></span>

<span data-ttu-id="bf2e8-226">拒絕資源間通訊的原則可能會令人討厭，特別是來自使用 Azure 的背景，而不會有流量限制。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-226">A policy of denying communication between resources can be annoying to implement, especially coming from a background of using Azure without traffic restrictions.</span></span> <span data-ttu-id="bf2e8-227">在某些其他雲端上，網路安全性群組的概念更為普遍。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-227">On some other clouds, the concept of network security groups is much more prevalent.</span></span> <span data-ttu-id="bf2e8-228">例如，AWS 上的預設原則是資源無法彼此通訊，直到 NSG 中的規則啟用為止。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-228">For instance, the default policy on AWS is that resources can't communicate among themselves until enabled by rules in an NSG.</span></span> <span data-ttu-id="bf2e8-229">雖然開發的速度較慢，但更嚴格的環境會提供更安全的預設值。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-229">While slower to develop this, more restrictive environment provides a more secure default.</span></span> <span data-ttu-id="bf2e8-230">使用適當的 DevOps 做法，特別是使用[Azure Resource Manager 或 Terraform](infrastructure-as-code.md)來管理許可權，可以讓您更輕鬆地控制規則。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-230">Making use of proper DevOps practices, especially using [Azure Resource Manager or Terraform](infrastructure-as-code.md) to manage permissions can make controlling the rules easier.</span></span>

<span data-ttu-id="bf2e8-231">在設定內部部署與雲端資源之間的通訊時，虛擬網路也很有用。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-231">Virtual Networks can also be useful when setting up communication between on-premises and cloud resources.</span></span> <span data-ttu-id="bf2e8-232">虛擬私人網路可用來將兩個網路緊密地連結在一起。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-232">A virtual private network can be used to seamlessly attach the two networks together.</span></span> <span data-ttu-id="bf2e8-233">這可讓您在所有使用者都在現場的案例中，執行沒有任何閘道的虛擬網路。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-233">This allows running a virtual network without any sort of gateway for scenarios where all the users are on-site.</span></span> <span data-ttu-id="bf2e8-234">有一些技術可以用來建立此網路。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-234">There are a number of technologies that can be used to establish this network.</span></span> <span data-ttu-id="bf2e8-235">最簡單的是使用可在許多路由器和 Azure 之間建立的[站對站 VPN](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways?toc=%2fazure%2fvirtual-network%2ftoc.json#s2smulti) 。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-235">The simplest is to use a [site-to-site VPN](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways?toc=%2fazure%2fvirtual-network%2ftoc.json#s2smulti) that can be established between many routers and Azure.</span></span> <span data-ttu-id="bf2e8-236">流量會透過網際網路進行加密，並以每個位元組的相同成本與任何其他流量進行通道處理。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-236">Traffic is encrypted and tunneled over the Internet at the same cost per byte as any other traffic.</span></span> <span data-ttu-id="bf2e8-237">針對需要更多頻寬或更多安全性的案例，Azure 提供了一種稱為「[快速路由](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways?toc=%2fazure%2fvirtual-network%2ftoc.json#ExpressRoute)」的服務，其使用內部部署網路與 Azure 之間的私用電路。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-237">For scenarios where more bandwidth or more security is desirable, Azure offers a service called [Express Route](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways?toc=%2fazure%2fvirtual-network%2ftoc.json#ExpressRoute) that uses a private circuit between an on-premises network and Azure.</span></span> <span data-ttu-id="bf2e8-238">成本更高且難以建立，但也更安全。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-238">It's more costly and difficult to establish but also more secure.</span></span>

## <a name="role-based-access-control-for-restricting-access-to-azure-resources"></a><span data-ttu-id="bf2e8-239">用於限制 Azure 資源存取權的角色型存取控制</span><span class="sxs-lookup"><span data-stu-id="bf2e8-239">Role-based access control for restricting access to Azure resources</span></span>

<span data-ttu-id="bf2e8-240">RBAC 是一種系統，可為在 Azure 中執行的應用程式提供身分識別。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-240">RBAC is a system that provides an identity to applications running in Azure.</span></span> <span data-ttu-id="bf2e8-241">應用程式可以使用此身分識別來存取資源，而不是使用金鑰或密碼。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-241">Applications can access resources using this identity instead of or in addition to using keys or passwords.</span></span>

## <a name="security-principals"></a><span data-ttu-id="bf2e8-242">安全性主體</span><span class="sxs-lookup"><span data-stu-id="bf2e8-242">Security Principals</span></span>

<span data-ttu-id="bf2e8-243">RBAC 中的第一個元件是安全性主體。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-243">The first component in RBAC is a security principal.</span></span> <span data-ttu-id="bf2e8-244">安全性主體可以是使用者、群組、服務主體或受控識別。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-244">A security principal can be a user, group, service principal, or managed identity.</span></span>

![圖9-2 不同類型的安全性主體](./media/rbac-security-principal.png)

<span data-ttu-id="bf2e8-246">**圖 9-2**：</span><span class="sxs-lookup"><span data-stu-id="bf2e8-246">**Figure 9-2**.</span></span> <span data-ttu-id="bf2e8-247">不同類型的安全性主體。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-247">Different types of security principals.</span></span>

- <span data-ttu-id="bf2e8-248">使用者-在 Azure Active Directory 中具有帳戶的任何使用者都是使用者。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-248">User - Any user who has an account in Azure Active Directory is a user.</span></span>
- <span data-ttu-id="bf2e8-249">群組-Azure Active Directory 的使用者集合。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-249">Group - A collection of users from Azure Active Directory.</span></span> <span data-ttu-id="bf2e8-250">身為群組的成員，使用者除了其本身之外，還會接受該群組的角色。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-250">As a member of a group, a user takes on the roles of that group in addition to their own.</span></span>
- <span data-ttu-id="bf2e8-251">服務主體-用來執行服務或應用程式的安全性身分識別。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-251">Service principal - A security identity under which services or applications run.</span></span>
- <span data-ttu-id="bf2e8-252">受控識別-由 Azure 管理的 Azure Active Directory 身分識別。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-252">Managed identity - An Azure Active Directory identity managed by Azure.</span></span> <span data-ttu-id="bf2e8-253">受控識別通常會在開發雲端應用程式時使用，以管理用來向 Azure 服務進行驗證的認證。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-253">Managed identities are typically used when developing cloud applications that manage the credentials for authenticating to Azure services.</span></span>

<span data-ttu-id="bf2e8-254">安全性主體可以套用至大部分的資源。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-254">The security principal can be applied to most any resource.</span></span> <span data-ttu-id="bf2e8-255">這表示您可以將安全性主體指派給在 Azure Kubernetes 內執行的容器，讓它能夠存取儲存在 Key Vault 中的秘密。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-255">This means that it's possible to assign a security principal to a container running within Azure Kubernetes, allowing it to access secrets stored in Key Vault.</span></span> <span data-ttu-id="bf2e8-256">Azure 函式可以採取許可權，讓它與 Active Directory 實例交談，以驗證呼叫使用者的 JWT。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-256">An Azure Function could take on a permission allowing it to talk to an Active Directory instance to validate a JWT for a calling user.</span></span> <span data-ttu-id="bf2e8-257">一旦使用服務主體啟用服務，就可以使用角色和範圍，以細微的方式管理其許可權。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-257">Once services are enabled with a service principal, their permissions can be managed granularly using roles and scopes.</span></span>

## <a name="roles"></a><span data-ttu-id="bf2e8-258">角色</span><span class="sxs-lookup"><span data-stu-id="bf2e8-258">Roles</span></span>

<span data-ttu-id="bf2e8-259">安全性主體可能會採用許多角色，或使用更 sartorial 的比喻，而磨損許多職。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-259">A security principal can take on many roles or, using a more sartorial analogy, wear many hats.</span></span> <span data-ttu-id="bf2e8-260">每個角色都會定義一系列的許可權，例如「從 Azure 服務匯流排端點讀取訊息」。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-260">Each role defines a series of permissions such as "Read messages from Azure Service Bus endpoint".</span></span> <span data-ttu-id="bf2e8-261">安全性主體的有效許可權集合是指派給安全性主體所擁有之所有角色的擁有權限組合。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-261">The effective permission set of a security principal is the combination of all the permissions assigned to all the roles that security principal has.</span></span> <span data-ttu-id="bf2e8-262">Azure 有大量的內建角色，使用者可以定義自己的角色。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-262">Azure has a large number of built-in roles and users can define their own roles.</span></span>

![圖 9-3 RBAC 角色定義](./media/rbac-role-definition.png)

<span data-ttu-id="bf2e8-264">**圖 9-3**。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-264">**Figure 9-3**.</span></span> <span data-ttu-id="bf2e8-265">RBAC 角色定義。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-265">RBAC role definitions.</span></span>

<span data-ttu-id="bf2e8-266">內建在 Azure 中，也有許多高階角色，例如擁有者、參與者、讀者和使用者帳戶管理員。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-266">Built into Azure are also a number of high-level roles such as Owner, Contributor, Reader, and User Account Administrator.</span></span> <span data-ttu-id="bf2e8-267">使用擁有者角色時，安全性主體可以存取所有資源，並將許可權指派給其他人。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-267">With the Owner role, a security principal can access all resources and assign permissions to others.</span></span> <span data-ttu-id="bf2e8-268">參與者具有與所有資源相同的存取層級，但無法指派許可權。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-268">A contributor has the same level of access to all resources but they can't assign permissions.</span></span> <span data-ttu-id="bf2e8-269">讀者只能查看現有的 Azure 資源，而使用者帳戶系統管理員可以管理對 Azure 資源的存取。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-269">A Reader can only view existing Azure resources and a User Account Administrator can manage access to Azure resources.</span></span>

<span data-ttu-id="bf2e8-270">較細微的內建角色（例如[DNS 區域參與者](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#dns-zone-contributor)）具有僅限單一服務的許可權。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-270">More granular built-in roles such as [DNS Zone Contributor](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#dns-zone-contributor) have rights limited to a single service.</span></span> <span data-ttu-id="bf2e8-271">安全性主體可以接受任意數目的角色。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-271">Security principals can take on any number of roles.</span></span>

## <a name="scopes"></a><span data-ttu-id="bf2e8-272">範圍</span><span class="sxs-lookup"><span data-stu-id="bf2e8-272">Scopes</span></span>

<span data-ttu-id="bf2e8-273">角色可以套用至 Azure 內受限制的一組資源。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-273">Roles can be applied to a restricted set of resources within Azure.</span></span> <span data-ttu-id="bf2e8-274">例如，將範圍套用至先前從服務匯流排佇列讀取的範例，您可以將許可權縮小為單一佇列：「從 Azure 服務匯流排端點讀取訊息」 `blah.servicebus.windows.net/queue1`</span><span class="sxs-lookup"><span data-stu-id="bf2e8-274">For instance, applying scope to the previous example of reading from a Service Bus queue, you can narrow the permission to a single queue: "Read messages from Azure Service Bus endpoint `blah.servicebus.windows.net/queue1`"</span></span>

<span data-ttu-id="bf2e8-275">範圍可以縮小為單一資源，也可以套用至整個資源群組、訂用帳戶，甚至是管理群組。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-275">The scope can be as narrow as a single resource or it can be applied to an entire resource group, subscription, or even management group.</span></span>

<span data-ttu-id="bf2e8-276">測試安全性主體是否具有特定許可權時，會將角色和範圍的組合納入考慮。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-276">When testing if a security principal has a certain permission, the combination of role and scope are taken into account.</span></span> <span data-ttu-id="bf2e8-277">這種組合提供強大的授權機制。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-277">This combination provides a powerful authorization mechanism.</span></span>

## <a name="deny"></a><span data-ttu-id="bf2e8-278">拒絕</span><span class="sxs-lookup"><span data-stu-id="bf2e8-278">Deny</span></span>

<span data-ttu-id="bf2e8-279">先前，RBAC 只允許「允許」規則。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-279">Previously, only "allow" rules were permitted for RBAC.</span></span> <span data-ttu-id="bf2e8-280">這種行為會使某些範圍變得複雜，而無法建立。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-280">This behavior made some scopes complicated to build.</span></span> <span data-ttu-id="bf2e8-281">例如，允許所有儲存體帳戶的安全性主體存取權，但其中一個需要授與明確許可權給可能無止盡的儲存體帳戶清單。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-281">For instance, allowing a security principal access to all storage accounts except one required granting explicit permission to a potentially endless list of storage accounts.</span></span> <span data-ttu-id="bf2e8-282">每次建立新的儲存體帳戶時，都必須將其新增至此帳戶清單。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-282">Every time a new storage account was created, it would have to be added to this list of accounts.</span></span> <span data-ttu-id="bf2e8-283">這會增加不需要的管理額外負荷。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-283">This added management overhead that certainly wasn't desirable.</span></span>

<span data-ttu-id="bf2e8-284">拒絕規則的優先順序高於允許規則。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-284">Deny rules take precedence over allow rules.</span></span> <span data-ttu-id="bf2e8-285">現在表示相同的「全部允許但一個」範圍，可以表示為兩個規則：「全部允許」和「拒絕此特定一項」。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-285">Now representing the same "allow all but one" scope could be represented as two rules "allow all" and "deny this one specific one".</span></span> <span data-ttu-id="bf2e8-286">拒絕規則不僅易於管理，還允許拒絕所有人的存取，以提供更安全的資源。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-286">Deny rules not only ease management but allow for resources that are extra secure by denying access to everybody.</span></span>

## <a name="checking-access"></a><span data-ttu-id="bf2e8-287">檢查存取權</span><span class="sxs-lookup"><span data-stu-id="bf2e8-287">Checking access</span></span>

<span data-ttu-id="bf2e8-288">您可以想像，擁有大量的角色和範圍，可以讓您瞭解服務主體的有效許可權非常困難。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-288">As you can imagine, having a large number of roles and scopes can make figuring out the effective permission of a service principal quite difficult.</span></span> <span data-ttu-id="bf2e8-289">堆積拒絕規則的基礎，只是為了增加複雜性。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-289">Piling deny rules on top of that, only serves to increase the complexity.</span></span> <span data-ttu-id="bf2e8-290">幸運的是，有一個許可權計算機可以顯示任何服務主體的有效許可權。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-290">Fortunately, there's a permissions calculator that can show the effective permissions for any service principal.</span></span> <span data-ttu-id="bf2e8-291">通常會在入口網站的 [IAM] 索引標籤下找到，如圖10-3 所示。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-291">It's typically found under the IAM tab in the portal, as shown in Figure 10-3.</span></span>

![圖9-4 應用程式服務的許可權計算機](./media/check-rbac.png)

<span data-ttu-id="bf2e8-293">**圖 9-4**。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-293">**Figure 9-4**.</span></span> <span data-ttu-id="bf2e8-294">App service 的許可權計算機。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-294">Permission calculator for an app service.</span></span>

## <a name="securing-secrets"></a><span data-ttu-id="bf2e8-295">保護秘密</span><span class="sxs-lookup"><span data-stu-id="bf2e8-295">Securing secrets</span></span>

<span data-ttu-id="bf2e8-296">密碼和憑證是攻擊者常見的攻擊媒介。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-296">Passwords and certificates are a common attack vector for attackers.</span></span> <span data-ttu-id="bf2e8-297">密碼破解硬體可以執行暴力密碼破解攻擊，並試著每秒猜測數十億個密碼。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-297">Password-cracking hardware can do a  brute-force attack and try to guess billions of passwords per second.</span></span> <span data-ttu-id="bf2e8-298">因此，用來存取資源的密碼是強式的，而且有很多不同的字元。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-298">So it's important that the passwords that are used to access resources are strong, with a large variety of characters.</span></span> <span data-ttu-id="bf2e8-299">這些密碼就是幾乎不可能記住的密碼類型。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-299">These passwords are exactly the kind of passwords that are near impossible to remember.</span></span> <span data-ttu-id="bf2e8-300">幸運的是，Azure 中的密碼實際上不需要由任何人知道。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-300">Fortunately, the passwords in Azure don't actually need to be known by any human.</span></span>

<span data-ttu-id="bf2e8-301">許多安全性[專家會建議](https://www.troyhunt.com/password-managers-dont-have-to-be-perfect-they-just-have-to-be-better-than-not-having-one/)使用密碼管理員來保留您自己的密碼，是最佳的方法。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-301">Many security [experts suggest](https://www.troyhunt.com/password-managers-dont-have-to-be-perfect-they-just-have-to-be-better-than-not-having-one/) that using a password manager to keep your own passwords is the best approach.</span></span> <span data-ttu-id="bf2e8-302">雖然它會將您的密碼集中在一個位置，但它也允許使用高度複雜的密碼，並確保它們對每個帳戶都是唯一的。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-302">While it centralizes your passwords in one location, it also allows using highly complex passwords and ensuring they're unique for each account.</span></span> <span data-ttu-id="bf2e8-303">Azure 中存在相同的系統：秘密的集中存放區。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-303">The same system exists within Azure: a central store for secrets.</span></span>

## <a name="azure-key-vault"></a><span data-ttu-id="bf2e8-304">Azure 金鑰保存庫</span><span class="sxs-lookup"><span data-stu-id="bf2e8-304">Azure Key Vault</span></span>

<span data-ttu-id="bf2e8-305">Azure Key Vault 提供集中的位置來儲存資料庫、API 金鑰和憑證等專案的密碼。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-305">Azure Key Vault provides a centralized location to store passwords for things such as databases, API keys, and certificates.</span></span> <span data-ttu-id="bf2e8-306">一旦將秘密輸入保存庫之後，就不會再次顯示它，而且解壓縮和查看的命令會特意複雜。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-306">Once a secret is entered into the Vault, it's never shown again and the commands to extract and view it are purposefully complicated.</span></span> <span data-ttu-id="bf2e8-307">Safe 中的資訊會使用軟體加密或 FIPS 140-2 Level 2 驗證的硬體安全性模組來保護。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-307">The information in the safe is protected using either software encryption or FIPS 140-2 Level 2 validated Hardware Security Modules.</span></span>

<span data-ttu-id="bf2e8-308">金鑰保存庫的存取權是透過 Rbac 提供，這表示不只有任何使用者都可以存取保存庫中的資訊。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-308">Access to the key vault is provided through RBACs, meaning that not just any user can access the information in the vault.</span></span> <span data-ttu-id="bf2e8-309">假設 web 應用程式希望存取儲存在 Azure Key Vault 中的資料庫連接字串。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-309">Say a web application wishes to access the database connection string stored in Azure Key Vault.</span></span> <span data-ttu-id="bf2e8-310">若要取得存取權，應用程式必須使用服務主體來執行。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-310">To gain access, applications need to run using a service principal.</span></span> <span data-ttu-id="bf2e8-311">在此假設角色下，他們可以從 safe 讀取秘密。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-311">Under this assumed role, they can read the secrets from the safe.</span></span> <span data-ttu-id="bf2e8-312">有一些不同的安全性設定可進一步限制應用程式對保存庫的存取權，使其無法更新秘密，但只能讀取它們。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-312">There are a number of different security settings that can further limit the access that an application has to the vault, so that it can't update secrets but only read them.</span></span>

<span data-ttu-id="bf2e8-313">可以監視金鑰保存庫的存取權，以確保只有預期的應用程式會存取保存庫。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-313">Access to the key vault can be monitored to ensure that only the expected applications are accessing the vault.</span></span> <span data-ttu-id="bf2e8-314">記錄可以整合回 Azure 監視器，並在發生未預期的狀況時，解除鎖定設定警示的功能。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-314">The logs can be integrated back into Azure Monitor, unlocking the ability to set up alerts when unexpected conditions are encountered.</span></span>

## <a name="kubernetes"></a><span data-ttu-id="bf2e8-315">Kubernetes</span><span class="sxs-lookup"><span data-stu-id="bf2e8-315">Kubernetes</span></span>

<span data-ttu-id="bf2e8-316">在 Kubernetes 中，有一項類似的服務可維護少量的秘密資訊。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-316">Within Kubernetes, there's a similar service for maintaining small pieces of secret information.</span></span> <span data-ttu-id="bf2e8-317">Kubernetes 秘密可以透過一般 `kubectl` 可執行檔來設定。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-317">Kubernetes Secrets can be set via the typical `kubectl` executable.</span></span>

<span data-ttu-id="bf2e8-318">建立秘密就像尋找要儲存之值的 base64 版本一樣簡單：</span><span class="sxs-lookup"><span data-stu-id="bf2e8-318">Creating a secret is as simple as finding the base64 version of the values to be stored:</span></span>

```console
echo -n 'admin' | base64
YWRtaW4=
echo -n '1f2d1e2e67df' | base64
MWYyZDFlMmU2N2Rm
```

<span data-ttu-id="bf2e8-319">然後將它新增至名為的秘密檔案，例如 `secret.yml` ，如下列範例所示：</span><span class="sxs-lookup"><span data-stu-id="bf2e8-319">Then adding it to a secrets file named `secret.yml` for example that looks similar to the following example:</span></span>

```yml
apiVersion: v1
kind: Secret
metadata:
  name: mysecret
type: Opaque
data:
  username: YWRtaW4=
  password: MWYyZDFlMmU2N2Rm
```

<span data-ttu-id="bf2e8-320">最後，您可以藉由執行下列命令，將此檔案載入至 Kubernetes：</span><span class="sxs-lookup"><span data-stu-id="bf2e8-320">Finally, this file can be loaded into Kubernetes by running the following command:</span></span>

```console
kubectl apply -f ./secret.yaml
```

<span data-ttu-id="bf2e8-321">然後，這些秘密可以掛接到磁片區，或透過環境變數公開給容器進程。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-321">These secrets can then be mounted into volumes or exposed to container processes through environment variables.</span></span> <span data-ttu-id="bf2e8-322">建立應用程式的[12 因素應用](https://12factor.net/)程式方法建議使用最低的一般分母，將設定傳輸至應用程式。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-322">The [Twelve-factor app](https://12factor.net/) approach to building applications suggests using the lowest common denominator to transmit settings to an application.</span></span> <span data-ttu-id="bf2e8-323">環境變數是最低的公分母，因為不論作業系統或應用程式為何都可支援。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-323">Environment variables are the lowest common denominator, because they're supported no matter the operating system or application.</span></span>

<span data-ttu-id="bf2e8-324">使用內建 Kubernetes 秘密的替代方法，是從 Kubernetes 中存取 Azure Key Vault 中的秘密。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-324">An alternative to use the built-in Kubernetes secrets is to access the secrets in Azure Key Vault from within Kubernetes.</span></span> <span data-ttu-id="bf2e8-325">若要這麼做，最簡單的方法是將 RBAC 角色指派給想要載入秘密的容器。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-325">The simplest way to do this is to assign an RBAC role to the container looking to load secrets.</span></span> <span data-ttu-id="bf2e8-326">然後，應用程式可以使用 Azure Key Vault Api 來存取秘密。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-326">The application can then use the Azure Key Vault APIs to access the secrets.</span></span> <span data-ttu-id="bf2e8-327">不過，這種方法需要修改程式碼，而且不會遵循使用環境變數的模式。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-327">However, this approach requires modifications to the code and doesn't follow the pattern of using environment variables.</span></span> <span data-ttu-id="bf2e8-328">相反地，您可以透過使用[Azure Key Vault Injector](https://mrdevops.io/introducing-azure-key-vault-to-kubernetes-931f82364354)，將值插入容器中。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-328">Instead, it's possible to inject values into a container through the use of the [Azure Key Vault Injector](https://mrdevops.io/introducing-azure-key-vault-to-kubernetes-931f82364354).</span></span> <span data-ttu-id="bf2e8-329">這種方法實際上比直接使用 Kubernetes 秘密更安全，因為叢集上的使用者可以存取它們。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-329">This approach is actually more secure than using the Kubernetes secrets directly, as they can be accessed by users on the cluster.</span></span>

## <a name="encryption-in-transit-and-at-rest"></a><span data-ttu-id="bf2e8-330">傳輸中和待用加密</span><span class="sxs-lookup"><span data-stu-id="bf2e8-330">Encryption in transit and at rest</span></span>

<span data-ttu-id="bf2e8-331">無論是在磁片上，還是在各種不同的服務之間傳輸，都必須確保資料的安全。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-331">Keeping data safe is important whether it's on disk or transiting between various different services.</span></span> <span data-ttu-id="bf2e8-332">避免資料流程失的最有效方式，是將它加密成不容易被其他人讀取的格式。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-332">The most effective way to keep data from leaking is to encrypt it into a format that can't be easily read by others.</span></span> <span data-ttu-id="bf2e8-333">Azure 支援各種不同的加密選項。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-333">Azure supports a wide range of encryption options.</span></span>

### <a name="in-transit"></a><span data-ttu-id="bf2e8-334">傳輸中</span><span class="sxs-lookup"><span data-stu-id="bf2e8-334">In transit</span></span>

<span data-ttu-id="bf2e8-335">有數種方式可加密 Azure 網路上的流量。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-335">There are several ways to encrypt traffic on the network in Azure.</span></span> <span data-ttu-id="bf2e8-336">Azure 服務的存取權通常是透過使用傳輸層安全性（TLS）的連線來完成。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-336">The access to Azure services is typically done over connections that use Transport Layer Security (TLS).</span></span> <span data-ttu-id="bf2e8-337">例如，所有與 Azure Api 的連線都需要 TLS 連線。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-337">For instance, all the connections to the Azure APIs require TLS connections.</span></span> <span data-ttu-id="bf2e8-338">同樣地，您可以限制 Azure 儲存體中的端點連線只能透過 TLS 加密連線來使用。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-338">Equally, connections to endpoints in Azure storage can be restricted to work only over TLS encrypted connections.</span></span>

<span data-ttu-id="bf2e8-339">TLS 是一個複雜的通訊協定，而且只知道連線使用 TLS 並不足以確保安全性。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-339">TLS is a complicated protocol and simply knowing that the connection is using TLS isn't sufficient to ensure security.</span></span> <span data-ttu-id="bf2e8-340">比方說，TLS 1.0 是若長期偏不安全的，TLS 1.1 也不是那麼好。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-340">For instance, TLS 1.0 is chronically insecure, and TLS 1.1 isn't much better.</span></span> <span data-ttu-id="bf2e8-341">即使在 TLS 版本內，還有各種不同的設定，可讓連接更容易解密。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-341">Even within the versions of TLS, there are various settings that can make the connections easier to decrypt.</span></span> <span data-ttu-id="bf2e8-342">最佳做法是檢查並查看伺服器連接是否使用最新且設定完善的通訊協定。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-342">The best course of action is to check and see if the server connection is using up-to-date and well configured protocols.</span></span>

<span data-ttu-id="bf2e8-343">這項檢查可以透過外部服務來完成，例如 SSL 實驗室的 SSL 伺服器測試。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-343">This check can be done by an external service such as SSL labs' SSL Server Test.</span></span> <span data-ttu-id="bf2e8-344">針對一般 Azure 端點的測試回合（在此案例中為服務匯流排端點），會產生近乎完美的分數。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-344">A test run against a typical Azure endpoint, in this case a service bus endpoint, yields a near perfect score of A.</span></span>

<span data-ttu-id="bf2e8-345">即使是 Azure SQL 資料庫等服務，也會使用 TLS 加密來防止資料隱藏。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-345">Even services like Azure SQL databases use TLS encryption to keep data hidden.</span></span> <span data-ttu-id="bf2e8-346">使用 TLS 對傳輸中的資料進行加密的有趣部分是，即使是 Microsoft，也無法在執行 TLS 的電腦之間接聽連接。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-346">The interesting part about encrypting the data in transit using TLS is that it isn't possible, even for Microsoft, to listen in on the connection between computers running TLS.</span></span> <span data-ttu-id="bf2e8-347">這對於擔心其資料可能會有比標準攻擊者更多資源的 Microsoft 適當或甚至是狀態動作專案的公司而言，是非常舒適的。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-347">This should provide comfort for companies concerned that their data may be at risk from Microsoft proper or even a state actor with more resources than the standard attacker.</span></span>

![圖 9-5 SSL 實驗室報表顯示服務匯流排端點的分數。](./media/ssl-report.png)

<span data-ttu-id="bf2e8-349">**圖 9-5**。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-349">**Figure 9-5**.</span></span> <span data-ttu-id="bf2e8-350">SSL 實驗室報表，顯示服務匯流排端點的分數。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-350">SSL labs report showing a score of A for a Service Bus endpoint.</span></span>

<span data-ttu-id="bf2e8-351">雖然此層級的加密不會對所有時間都足夠，但它應該會激發 Azure TLS 連線相當安全的信心。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-351">While this level of encryption isn't going to be sufficient for all time, it should inspire confidence that Azure TLS connections are quite secure.</span></span> <span data-ttu-id="bf2e8-352">Azure 會在加密改善時繼續發展其安全性標準。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-352">Azure will continue to evolve its security standards as encryption improves.</span></span> <span data-ttu-id="bf2e8-353">瞭解安全性標準和更新 Azure 的情況，是很好的方式。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-353">It's nice to know that there's somebody watching the security standards and updating Azure as they improve.</span></span>

### <a name="at-rest"></a><span data-ttu-id="bf2e8-354">待用</span><span class="sxs-lookup"><span data-stu-id="bf2e8-354">At rest</span></span>

<span data-ttu-id="bf2e8-355">在任何應用程式中，資料會放在磁片上的幾個地方。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-355">In any application, there are a number of places where data rests on disk.</span></span> <span data-ttu-id="bf2e8-356">應用程式程式碼本身是從某種儲存機制載入。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-356">The application code itself is loaded from some storage mechanism.</span></span> <span data-ttu-id="bf2e8-357">大部分的應用程式也會使用某種類型的資料庫，例如 SQL Server、Cosmos DB，或甚至是出乎意料的價格有效率表格儲存體。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-357">Most applications also use some kind of database such as SQL Server, Cosmos DB, or even the amazingly price-efficient Table Storage.</span></span> <span data-ttu-id="bf2e8-358">這些資料庫全都使用大量加密的儲存體，以確保具有適當許可權的應用程式以外的任何人都可以讀取您的資料。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-358">These databases all use heavily encrypted storage to ensure that nobody other than the applications with proper permissions can read your data.</span></span> <span data-ttu-id="bf2e8-359">即使系統操作員也無法讀取已加密的資料。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-359">Even the system operators can't read data that has been encrypted.</span></span> <span data-ttu-id="bf2e8-360">因此，客戶可以確保其秘密資訊保持機密。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-360">So customers can remain confident their secret information remains secret.</span></span>

### <a name="storage"></a><span data-ttu-id="bf2e8-361">儲存體</span><span class="sxs-lookup"><span data-stu-id="bf2e8-361">Storage</span></span>

<span data-ttu-id="bf2e8-362">許多 Azure 的基礎都是 Azure 儲存體引擎。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-362">The underpinning of much of Azure is the Azure Storage engine.</span></span> <span data-ttu-id="bf2e8-363">虛擬機器磁片會裝載在 Azure 儲存體上。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-363">Virtual machine disks are mounted on top of Azure Storage.</span></span> <span data-ttu-id="bf2e8-364">Azure Kubernetes Services 會在 Azure 儲存體上裝載的虛擬機器上執行。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-364">Azure Kubernetes Services run on virtual machines that, themselves, are hosted on Azure Storage.</span></span> <span data-ttu-id="bf2e8-365">即使是無伺服器技術（例如 Azure Functions 應用程式和 Azure 容器實例），也會用盡屬於 Azure 儲存體一部分的磁片。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-365">Even serverless technologies, such as Azure Functions Apps and Azure Container Instances, run out of disk that is part of Azure Storage.</span></span>

<span data-ttu-id="bf2e8-366">如果 Azure 儲存體已妥善加密，則它會提供其他所有專案的基礎，也會進行加密。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-366">If Azure Storage is well encrypted, then it provides for a foundation for most everything else to also be encrypted.</span></span> <span data-ttu-id="bf2e8-367">Azure 儲存體[是](https://docs.microsoft.com/azure/storage/common/storage-service-encryption)使用[FIPS 140-2](https://en.wikipedia.org/wiki/FIPS_140)相容的[256 位 AES](https://en.wikipedia.org/wiki/Advanced_Encryption_Standard)進行加密。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-367">Azure Storage [is encrypted](https://docs.microsoft.com/azure/storage/common/storage-service-encryption) with [FIPS 140-2](https://en.wikipedia.org/wiki/FIPS_140) compliant [256-bit AES](https://en.wikipedia.org/wiki/Advanced_Encryption_Standard).</span></span> <span data-ttu-id="bf2e8-368">這是一項知名的加密技術，在過去20年或多年來廣泛的學術審查。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-368">This is a well-regarded encryption technology having been the subject of extensive academic scrutiny over the last 20 or so years.</span></span> <span data-ttu-id="bf2e8-369">目前並沒有任何已知的實際攻擊，讓某人不知道金鑰就能讀取 AES 所加密的資料。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-369">At present, there's no known practical attack that would allow someone without knowledge of the key to read data encrypted by AES.</span></span>

<span data-ttu-id="bf2e8-370">根據預設，用來加密 Azure 儲存體的金鑰是由 Microsoft 所管理。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-370">By default, the keys used for encrypting Azure Storage are managed by Microsoft.</span></span> <span data-ttu-id="bf2e8-371">有廣泛的保護措施，以確保能夠防止惡意存取這些金鑰。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-371">There are extensive protections in place to ensure to prevent malicious access to these keys.</span></span> <span data-ttu-id="bf2e8-372">不過，具有特殊加密需求的使用者也可以提供自己在 Azure Key Vault 中管理的[儲存體金鑰](https://docs.microsoft.com/azure/storage/common/storage-encryption-keys-powershell)。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-372">However, users with particular encryption requirements can also [provide their own storage keys](https://docs.microsoft.com/azure/storage/common/storage-encryption-keys-powershell) that are managed in Azure Key Vault.</span></span> <span data-ttu-id="bf2e8-373">這些金鑰可以隨時撤銷，這會使用無法存取的方式，有效地轉譯儲存體帳戶的內容。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-373">These keys can be revoked at any time, which would effectively render the contents of the Storage account using them inaccessible.</span></span>

<span data-ttu-id="bf2e8-374">虛擬機器使用加密的儲存體，但您可以使用 Windows 上的 BitLocker 或 Linux 上的 DM Crypt，來提供另一層的加密。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-374">Virtual machines use encrypted storage, but it's possible to provide another layer of encryption by using technologies like BitLocker on Windows or DM-Crypt on Linux.</span></span> <span data-ttu-id="bf2e8-375">這些技術的意思是，即使磁片映射從存放裝置流失，它還是不可能讀取它。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-375">These technologies mean that even if the disk image was leaked off of storage, it would remain near impossible to read it.</span></span>

### <a name="azure-sql"></a><span data-ttu-id="bf2e8-376">Azure SQL</span><span class="sxs-lookup"><span data-stu-id="bf2e8-376">Azure SQL</span></span>

<span data-ttu-id="bf2e8-377">裝載在 Azure SQL 上的資料庫使用稱為[透明資料加密（TDE）](/sql/relational-databases/security/encryption/transparent-data-encryption)的技術，以確保資料保持加密。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-377">Databases hosted on Azure SQL use a technology called [Transparent Data Encryption (TDE)](/sql/relational-databases/security/encryption/transparent-data-encryption) to ensure data remains encrypted.</span></span> <span data-ttu-id="bf2e8-378">預設會在所有新建立的 SQL 資料庫上啟用此功能，但必須針對舊版資料庫手動啟用。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-378">It's enabled by default on all newly created SQL databases, but must be enabled manually for legacy databases.</span></span> <span data-ttu-id="bf2e8-379">TDE 不僅會執行資料庫的即時加密和解密，還會執行備份和交易記錄。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-379">TDE executes real-time encryption and decryption of not just the database, but also the backups and transaction logs.</span></span>

<span data-ttu-id="bf2e8-380">加密參數會儲存在資料庫中， `master` 而且在啟動時，會將其餘作業讀入記憶體中。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-380">The encryption parameters are stored in the `master` database and, on startup, are read into memory for the remaining operations.</span></span> <span data-ttu-id="bf2e8-381">這表示 `master` 資料庫必須保持未加密狀態。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-381">This means that the `master` database must remain unencrypted.</span></span> <span data-ttu-id="bf2e8-382">實際的金鑰是由 Microsoft 管理。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-382">The actual key is managed by Microsoft.</span></span> <span data-ttu-id="bf2e8-383">不過，具有嚴格安全性需求的使用者可能會在 Key Vault 中提供自己的金鑰，與 Azure 儲存體的方式大致相同。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-383">However, users with exacting security requirements may provide their own key in Key Vault in much the same way as is done for Azure Storage.</span></span> <span data-ttu-id="bf2e8-384">Key Vault 提供這類服務的金鑰輪替和撤銷。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-384">The Key Vault provides for such services as key rotation and revocation.</span></span>

<span data-ttu-id="bf2e8-385">TDS 的「透明」部分來自于不需要用戶端變更即可使用加密資料庫的事實。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-385">The "Transparent" part of TDS comes from the fact that there aren't client changes needed to use an encrypted database.</span></span> <span data-ttu-id="bf2e8-386">雖然這種方法可提供良好的安全性，但洩漏資料庫密碼就足以讓使用者能夠解密資料。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-386">While this approach provides for good security, leaking the database password is enough for users to be able to decrypt the data.</span></span> <span data-ttu-id="bf2e8-387">還有另一種方法可加密資料庫中的個別資料行或資料表。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-387">There's another approach that encrypts individual columns or tables in a database.</span></span> <span data-ttu-id="bf2e8-388">[Always Encrypted](https://docs.microsoft.com/azure/sql-database/sql-database-always-encrypted-azure-key-vault)可確保在沒有時間點，加密的資料會以純文字顯示在資料庫內。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-388">[Always Encrypted](https://docs.microsoft.com/azure/sql-database/sql-database-always-encrypted-azure-key-vault) ensures that at no point the encrypted data appears in plain text inside the database.</span></span>

<span data-ttu-id="bf2e8-389">設定此加密層需要在 SQL Server Management Studio 中透過 wizard 執行，以選取加密的類型，以及在 Key Vault 儲存相關聯金鑰的位置。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-389">Setting up this tier of encryption requires running through a wizard in SQL Server Management Studio to select the sort of encryption and where in Key Vault to store the associated keys.</span></span>

![圖9-6 選取要使用 Always Encrypted 加密之資料表中的資料行](./media/always-encrypted.png)

<span data-ttu-id="bf2e8-391">**圖 9-6**。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-391">**Figure 9-6**.</span></span> <span data-ttu-id="bf2e8-392">選取要使用 Always Encrypted 加密之資料表中的資料行。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-392">Selecting columns in a table to be encrypted using Always Encrypted.</span></span>

<span data-ttu-id="bf2e8-393">從這些加密資料行讀取資訊的用戶端應用程式必須進行特殊的額度，才能讀取加密的資料。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-393">Client applications that read information from these encrypted columns need to make special allowances to read encrypted data.</span></span> <span data-ttu-id="bf2e8-394">連接字串需要使用進行更新 `Column Encryption Setting=Enabled` ，而且必須從 Key Vault 抓取用戶端認證。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-394">Connection strings need to be updated with `Column Encryption Setting=Enabled` and client credentials must be retrieved from the Key Vault.</span></span> <span data-ttu-id="bf2e8-395">接著，必須使用資料行加密金鑰來可能遭受 SQL Server 用戶端。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-395">The SQL Server client must then be primed with the column encryption keys.</span></span> <span data-ttu-id="bf2e8-396">完成後，其餘的動作會使用 SQL 用戶端的標準介面。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-396">Once that is done, the remaining actions use the standard interfaces to SQL Client.</span></span> <span data-ttu-id="bf2e8-397">也就是說，以 SQL 用戶端為基礎的 Dapper 和 Entity Framework 之類的工具，在沒有變更的情況下仍可繼續工作。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-397">That is, tools like Dapper and Entity Framework, which are built on top of SQL Client, will continue to work without changes.</span></span> <span data-ttu-id="bf2e8-398">每一種語言都可能尚未提供每個 SQL Server 驅動程式的 Always Encrypted。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-398">Always Encrypted may not yet be available for every SQL Server driver on every language.</span></span>

<span data-ttu-id="bf2e8-399">TDE 和 Always Encrypted 的組合，這兩者都可以與用戶端特定的金鑰搭配使用，以確保甚至支援最嚴格的加密需求。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-399">The combination of TDE and Always Encrypted, both of which can be used with client-specific keys, ensures that even the most exacting encryption requirements are supported.</span></span>

### <a name="cosmos-db"></a><span data-ttu-id="bf2e8-400">Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="bf2e8-400">Cosmos DB</span></span>

<span data-ttu-id="bf2e8-401">Cosmos DB 是 Microsoft 在 Azure 中提供的最新資料庫。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-401">Cosmos DB is the newest database provided by Microsoft in Azure.</span></span> <span data-ttu-id="bf2e8-402">它是從頭開始建立的，並記住安全性和密碼編譯。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-402">It has been built from the ground up with security and cryptography in mind.</span></span> <span data-ttu-id="bf2e8-403">AES-256 位加密對於所有 Cosmos DB 資料庫而言都是標準的，而且無法停用。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-403">AES-256bit encryption is standard for all Cosmos DB databases and can't be disabled.</span></span> <span data-ttu-id="bf2e8-404">結合 TLS 1.2 的通訊需求時，整個儲存體解決方案都會加密。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-404">Coupled with the TLS 1.2 requirement for communication, the entire storage solution is encrypted.</span></span>

![圖 9-7 Cosmos DB 內的資料加密流程](./media/cosmos-encryption.png)

<span data-ttu-id="bf2e8-406">**圖 9-7**。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-406">**Figure 9-7**.</span></span> <span data-ttu-id="bf2e8-407">Cosmos DB 內的資料加密流程。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-407">The flow of data encryption within Cosmos DB.</span></span>

<span data-ttu-id="bf2e8-408">雖然 Cosmos DB 並不提供提供客戶加密金鑰的能力，但小組也已經完成許多工作，以確保它維持符合 PCI DSS 的規範。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-408">While Cosmos DB doesn't provide for supplying customer encryption keys, there has been significant work done by the team to ensure it remains PCI-DSS compliant without that.</span></span> <span data-ttu-id="bf2e8-409">Cosmos DB 也不支援任何類似 Azure SQL Always Encrypted 的單一資料行加密。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-409">Cosmos DB also doesn't support any sort of single column encryption similar to Azure SQL's Always Encrypted yet.</span></span>

## <a name="keeping-secure"></a><span data-ttu-id="bf2e8-410">保持安全</span><span class="sxs-lookup"><span data-stu-id="bf2e8-410">Keeping secure</span></span>

<span data-ttu-id="bf2e8-411">Azure 擁有發行高度安全產品所需的所有工具。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-411">Azure has all the tools necessary to release a highly secure product.</span></span> <span data-ttu-id="bf2e8-412">不過，連鎖的鏈只會與最弱的連結一樣強。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-412">However, a chain is only as strong as its weakest link.</span></span> <span data-ttu-id="bf2e8-413">如果部署在 Azure 之上的應用程式不是以適當的安全性思維和良好的安全性審核來開發，則它們會變成鏈中的弱式連結。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-413">If the applications deployed on top of Azure aren't developed with a proper security mindset and good security audits, then they become the weak link in the chain.</span></span> <span data-ttu-id="bf2e8-414">有許多絕佳的靜態分析工具、加密程式庫和安全性作法，可以用來確保安裝在 Azure 上的軟體與 Azure 本身一樣安全。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-414">There are many great static analysis tools, encryption libraries, and security practices that can be used to ensure that the software installed on Azure is as secure as Azure itself.</span></span> <span data-ttu-id="bf2e8-415">範例包括[靜態分析工具](https://www.whitesourcesoftware.com/)、[加密程式庫](https://www.libressl.org/)和[安全性實務](https://azure.microsoft.com/resources/videos/red-vs-blue-internal-security-penetration-testing-of-microsoft-azure/)。</span><span class="sxs-lookup"><span data-stu-id="bf2e8-415">Examples include [static analysis tools](https://www.whitesourcesoftware.com/), [encryption libraries](https://www.libressl.org/), and [security practices](https://azure.microsoft.com/resources/videos/red-vs-blue-internal-security-penetration-testing-of-microsoft-azure/).</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="bf2e8-416">[上一個](security.md) 
>[下一步](devops.md)</span><span class="sxs-lookup"><span data-stu-id="bf2e8-416">[Previous](security.md)
[Next](devops.md)</span></span>
