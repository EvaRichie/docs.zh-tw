---
title: 可檢視性模式
description: 雲端原生應用程式的可檢視性模式
ms.date: 08/10/2020
ms.openlocfilehash: 2a6ef0e58f1e20667167042614768b099f640858
ms.sourcegitcommit: 27a15a55019f6b5f2733961738babe94aec0def3
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 09/15/2020
ms.locfileid: "90539849"
---
# <a name="observability-patterns"></a><span data-ttu-id="f5a7e-103">可檢視性模式</span><span class="sxs-lookup"><span data-stu-id="f5a7e-103">Observability patterns</span></span>

<span data-ttu-id="f5a7e-104">就像是為了協助應用程式中的程式碼配置而開發的一樣，也會以可靠的方式來操作應用程式的模式。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-104">Just as patterns have been developed to aid in the layout of code in applications, there are patterns for operating applications in a reliable way.</span></span> <span data-ttu-id="f5a7e-105">維護應用程式的三個實用模式已出現： **記錄**、 **監視**和 **警示**。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-105">Three useful patterns in maintaining applications have emerged: **logging**, **monitoring**, and **alerts**.</span></span>

## <a name="when-to-use-logging"></a><span data-ttu-id="f5a7e-106">使用記錄的時機</span><span class="sxs-lookup"><span data-stu-id="f5a7e-106">When to use logging</span></span>

<span data-ttu-id="f5a7e-107">無論我們有多小心，應用程式幾乎一律會在生產環境中以非預期的方式表現。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-107">No matter how careful we are, applications almost always behave in unexpected ways in production.</span></span> <span data-ttu-id="f5a7e-108">當使用者報告應用程式的問題時，可以在問題發生時查看應用程式的狀況。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-108">When users report problems with an application, it's useful to be able to see what was going on with the app when the problem occurred.</span></span> <span data-ttu-id="f5a7e-109">當應用程式正在執行時，其中一種最嘗試的方法和真正的方法，就是讓應用程式寫下其執行的工作。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-109">One of the most tried and true ways of capturing information about what an application is doing while it's running is to have the application write down what it's doing.</span></span> <span data-ttu-id="f5a7e-110">此進程稱為記錄。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-110">This process is known as logging.</span></span> <span data-ttu-id="f5a7e-111">在生產環境中發生任何失敗或問題時，目標應該是在非生產環境中重現發生失敗的情況。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-111">Anytime failures or problems occur in production, the goal should be to reproduce the conditions under which the failures occurred, in a non-production environment.</span></span> <span data-ttu-id="f5a7e-112">備妥適當的記錄功能，可讓開發人員遵循此藍圖，以在可以測試和實驗的環境中重複發生問題。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-112">Having good logging in place provides a roadmap for developers to follow in order to duplicate problems in an environment that can be tested and experimented with.</span></span>

### <a name="challenges-when-logging-with-cloud-native-applications"></a><span data-ttu-id="f5a7e-113">使用雲端原生應用程式進行記錄時的挑戰</span><span class="sxs-lookup"><span data-stu-id="f5a7e-113">Challenges when logging with cloud-native applications</span></span>

<span data-ttu-id="f5a7e-114">在傳統的應用程式中，記錄檔通常會儲存在本機電腦上。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-114">In traditional applications, log files are typically stored on the local machine.</span></span> <span data-ttu-id="f5a7e-115">事實上，在類似 Unix 的作業系統上，有一個資料夾結構定義來保存任何記錄，通常是在底下 `/var/log` 。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-115">In fact, on Unix-like operating systems, there's a folder structure defined to hold any logs, typically under `/var/log`.</span></span>

<span data-ttu-id="f5a7e-116">![在整合型應用程式中記錄至檔案。 ](./media/single-monolith-logging.png)
**圖 7-1**。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-116">![Logging to a file in a monolithic app.](./media/single-monolith-logging.png)
**Figure 7-1**.</span></span> <span data-ttu-id="f5a7e-117">在整合型應用程式中記錄至檔案。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-117">Logging to a file in a monolithic app.</span></span>

<span data-ttu-id="f5a7e-118">在單一機器上記錄至一般檔案的實用性，在雲端環境中會大幅降低。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-118">The usefulness of logging to a flat file on a single machine is vastly reduced in a cloud environment.</span></span> <span data-ttu-id="f5a7e-119">產生記錄檔的應用程式可能無法存取本機磁片，或本機磁片可能會有高度暫時性的情況，因為容器會在實體機器周圍隨機進行。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-119">Applications producing logs may not have access to the local disk or the local disk may be highly transient as containers are shuffled around physical machines.</span></span> <span data-ttu-id="f5a7e-120">即使是在多個節點之間輕鬆擴充整合型應用程式，也可能使找出適當的檔案型記錄檔變得很困難。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-120">Even simple scaling up of monolithic applications across multiple nodes can make it challenging to locate the appropriate file-based log file.</span></span>

<span data-ttu-id="f5a7e-121">![在已調整的整合型應用程式中記錄至檔案。 ](./media/multiple-node-monolith-logging.png)
**圖 7-2**。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-121">![Logging to files in a scaled monolithic app.](./media/multiple-node-monolith-logging.png)
**Figure 7-2**.</span></span> <span data-ttu-id="f5a7e-122">在已調整的整合型應用程式中記錄至檔案。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-122">Logging to files in a scaled monolithic app.</span></span>

<span data-ttu-id="f5a7e-123">使用微服務架構開發的雲端原生應用程式也會對以檔案為基礎的記錄器造成一些挑戰。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-123">Cloud-native applications developed using a microservices architecture also pose some challenges for file-based loggers.</span></span> <span data-ttu-id="f5a7e-124">使用者要求現在可能會跨越在不同電腦上執行的多個服務，而且可能包含無伺服器功能，完全無法存取本機檔案系統。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-124">User requests may now span multiple services that are run on different machines and may include serverless functions with no access to a local file system at all.</span></span> <span data-ttu-id="f5a7e-125">將來自使用者或會話的記錄與這些服務和機器之間的記錄相互關聯相當困難。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-125">It would be very challenging to correlate the logs from a user or a session across these many services and machines.</span></span>

<span data-ttu-id="f5a7e-126">![記錄至微服務應用程式中的本機檔案。 ](./media/local-log-file-per-service.png)
**圖 7-3**。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-126">![Logging to local files in a microservices app.](./media/local-log-file-per-service.png)
**Figure 7-3**.</span></span> <span data-ttu-id="f5a7e-127">記錄至微服務應用程式中的本機檔案。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-127">Logging to local files in a microservices app.</span></span>

<span data-ttu-id="f5a7e-128">最後，某些雲端原生應用程式中的使用者數目很高。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-128">Finally, the number of users in some cloud-native applications is high.</span></span> <span data-ttu-id="f5a7e-129">假設每位使用者在登入應用程式時，都會產生一百行記錄訊息。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-129">Imagine that each user generates a hundred lines of log messages when they log into an application.</span></span> <span data-ttu-id="f5a7e-130">在隔離的情況下，這是可管理的，但會將超過100000的使用者和記錄的數量變得夠大，因為需要特製化工具來支援有效使用記錄檔。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-130">In isolation, that is manageable, but multiply that over 100,000 users and the volume of logs becomes large enough that specialized tools are needed to support effective use of the logs.</span></span>

### <a name="logging-in-cloud-native-applications"></a><span data-ttu-id="f5a7e-131">雲端原生應用程式中的記錄</span><span class="sxs-lookup"><span data-stu-id="f5a7e-131">Logging in cloud-native applications</span></span>

<span data-ttu-id="f5a7e-132">每種程式設計語言都有可允許寫入記錄檔的工具，而寫入這些記錄的額外負荷通常很低。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-132">Every programming language has tooling that permits writing logs, and typically the overhead for writing these logs is low.</span></span> <span data-ttu-id="f5a7e-133">許多記錄程式庫都提供記錄不同類型的嚴重性，可在執行時間進行調整。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-133">Many of the logging libraries provide logging different kinds of criticalities, which can be tuned at run time.</span></span> <span data-ttu-id="f5a7e-134">例如，Serilog 連結 [庫](https://serilog.net/) 是適用于 .net 的熱門結構化記錄程式庫，可提供下列記錄層級：</span><span class="sxs-lookup"><span data-stu-id="f5a7e-134">For instance, the [Serilog library](https://serilog.net/) is a popular structured logging library for .NET that provides the following logging levels:</span></span>

* <span data-ttu-id="f5a7e-135">「詳細資訊」</span><span class="sxs-lookup"><span data-stu-id="f5a7e-135">Verbose</span></span>
* <span data-ttu-id="f5a7e-136">偵錯</span><span class="sxs-lookup"><span data-stu-id="f5a7e-136">Debug</span></span>
* <span data-ttu-id="f5a7e-137">資訊</span><span class="sxs-lookup"><span data-stu-id="f5a7e-137">Information</span></span>
* <span data-ttu-id="f5a7e-138">警告</span><span class="sxs-lookup"><span data-stu-id="f5a7e-138">Warning</span></span>
* <span data-ttu-id="f5a7e-139">錯誤</span><span class="sxs-lookup"><span data-stu-id="f5a7e-139">Error</span></span>
* <span data-ttu-id="f5a7e-140">嚴重</span><span class="sxs-lookup"><span data-stu-id="f5a7e-140">Fatal</span></span>

<span data-ttu-id="f5a7e-141">這些不同的記錄層級會在記錄中提供細微的資料細微性。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-141">These different log levels provide granularity in logging.</span></span> <span data-ttu-id="f5a7e-142">當應用程式在生產環境中正常運作時，可能會將它設定為只記錄重要的訊息。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-142">When the application is functioning properly in production, it may be configured to only log important messages.</span></span> <span data-ttu-id="f5a7e-143">當應用程式的行為不正常時，會增加記錄層級，以收集更詳細的記錄檔。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-143">When the application is misbehaving, then the log level can be increased so more verbose logs are gathered.</span></span> <span data-ttu-id="f5a7e-144">這會平衡效能，以簡化偵錯工具的效能。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-144">This balances performance against ease of debugging.</span></span>

<span data-ttu-id="f5a7e-145">記錄工具的高效能和詳細資訊的 tunability，應該鼓勵開發人員經常記錄。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-145">The high performance of logging tools and the tunability of verbosity should encourage developers to log frequently.</span></span> <span data-ttu-id="f5a7e-146">許多人偏好記錄每個方法的進入和離開模式。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-146">Many favor a pattern of logging the entry and exit of each method.</span></span> <span data-ttu-id="f5a7e-147">這種方法聽起來可能像麻煩，不過開發人員很少會想要進行較少的記錄。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-147">This approach may sound like overkill, but it's infrequent that developers will wish for less logging.</span></span> <span data-ttu-id="f5a7e-148">事實上，為了將記錄新增至有問題的方法時，執行部署的唯一目的並不罕見。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-148">In fact, it's not uncommon to perform deployments for the sole purpose of adding logging around a problematic method.</span></span> <span data-ttu-id="f5a7e-149">錯誤記錄太多，而且沒有太少。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-149">Err on the side of too much logging and not on too little.</span></span> <span data-ttu-id="f5a7e-150">您可以使用某些工具來自動提供這類記錄。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-150">Some tools can be used to automatically provide this kind of logging.</span></span>

<span data-ttu-id="f5a7e-151">由於在雲端原生應用程式中使用以檔案為基礎之記錄的相關挑戰，因此偏好使用集中式記錄。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-151">Because of the challenges associated with using file-based logs in cloud-native apps, centralized logs are preferred.</span></span> <span data-ttu-id="f5a7e-152">記錄檔是由應用程式收集，並隨附于記錄和儲存記錄的中央記錄應用程式。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-152">Logs are collected by the applications and shipped to a central logging application which indexes and stores the logs.</span></span> <span data-ttu-id="f5a7e-153">此類別的系統每天可以內嵌數十 gb 的記錄。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-153">This class of system can ingest tens of gigabytes of logs every day.</span></span>

<span data-ttu-id="f5a7e-154">建立橫跨許多服務的記錄時，請遵循一些標準實務，也會很有説明。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-154">It's also helpful to follow some standard practices when building logging that spans many services.</span></span> <span data-ttu-id="f5a7e-155">例如，在冗長的互動開始時產生相互 [關聯識別碼](https://blog.rapid7.com/2016/12/23/the-value-of-correlation-ids/) ，然後將它記錄在與該互動相關的每個訊息中，可讓您更輕鬆地搜尋所有相關訊息。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-155">For instance, generating a [correlation ID](https://blog.rapid7.com/2016/12/23/the-value-of-correlation-ids/) at the start of a lengthy interaction, and then logging it in each message that is related to that interaction, makes it easier to search for all related messages.</span></span> <span data-ttu-id="f5a7e-156">其中一個只需要尋找單一訊息，然後將相互關聯識別碼解壓縮以找出所有相關訊息。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-156">One need only find a single message and extract the correlation ID to find all the related messages.</span></span> <span data-ttu-id="f5a7e-157">另一個範例是確保每個服務的記錄格式都相同，無論使用哪種語言或記錄程式庫。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-157">Another example is ensuring that the log format is the same for every service, whatever the language or logging library it uses.</span></span> <span data-ttu-id="f5a7e-158">這種標準化可讓您更輕鬆地讀取記錄。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-158">This standardization makes reading logs much easier.</span></span> <span data-ttu-id="f5a7e-159">圖7-4 示範微服務架構如何在其工作流程中運用集中式記錄。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-159">Figure 7-4 demonstrates how a microservices architecture can leverage centralized logging as part of its workflow.</span></span>

<span data-ttu-id="f5a7e-160">![來自各種來源的記錄會內嵌到集中式記錄存放區。 ](./media/centralized-logging.png)
**圖 7-4**。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-160">![Logs from various sources are ingested into a centralized log store.](./media/centralized-logging.png)
**Figure 7-4**.</span></span> <span data-ttu-id="f5a7e-161">來自各種來源的記錄會內嵌到集中式記錄存放區。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-161">Logs from various sources are ingested into a centralized log store.</span></span>

## <a name="challenges-with-detecting-and-responding-to-potential-app-health-issues"></a><span data-ttu-id="f5a7e-162">偵測及回應潛在應用程式健康情況問題的挑戰</span><span class="sxs-lookup"><span data-stu-id="f5a7e-162">Challenges with detecting and responding to potential app health issues</span></span>

<span data-ttu-id="f5a7e-163">有些應用程式不是要徑任務。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-163">Some applications aren't mission critical.</span></span> <span data-ttu-id="f5a7e-164">也許它們只能在內部使用，而當發生問題時，使用者可以聯繫負責的小組，而且可以重新開機應用程式。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-164">Maybe they're only used internally, and when a problem occurs, the user can contact the team responsible and the application can be restarted.</span></span> <span data-ttu-id="f5a7e-165">不過，客戶通常會對他們取用的應用程式產生更高的期望。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-165">However, customers often have higher expectations for the applications they consume.</span></span> <span data-ttu-id="f5a7e-166">您應該知道應用程式在使用者執行 *之前* ，或在使用者通知您之前發生問題。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-166">You should know when problems occur with your application *before* users do, or before users notify you.</span></span> <span data-ttu-id="f5a7e-167">否則，當您注意到在您的應用程式或甚至是您的組織中 deriding 的社交媒體貼文時，第一次知道問題的原因可能是您。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-167">Otherwise, the first you know about a problem may be when you notice an angry deluge of social media posts deriding your application or even your organization.</span></span>

<span data-ttu-id="f5a7e-168">您可能需要考慮的一些案例包括：</span><span class="sxs-lookup"><span data-stu-id="f5a7e-168">Some scenarios you may need to consider include:</span></span>

- <span data-ttu-id="f5a7e-169">您應用程式中的一項服務會保持失敗並重新啟動，因而導致間歇性的回應緩慢。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-169">One service in your application keeps failing and restarting, resulting in intermittent slow responses.</span></span>
- <span data-ttu-id="f5a7e-170">在當日的某些時間，您的應用程式回應時間很慢。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-170">At some times of the day, your application's response time is slow.</span></span>
- <span data-ttu-id="f5a7e-171">在最近的部署之後，資料庫上的負載就會 tripled。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-171">After a recent deployment, load on the database has tripled.</span></span>

<span data-ttu-id="f5a7e-172">適當地實行，監視可讓您知道將會導致問題的狀況，讓您在基礎條件產生任何重大的使用者影響之前解決這些問題。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-172">Implemented properly, monitoring can let you know about conditions that will lead to problems, letting you address underlying conditions before they result in any significant user impact.</span></span>

### <a name="monitoring-cloud-native-apps"></a><span data-ttu-id="f5a7e-173">監視雲端原生應用程式</span><span class="sxs-lookup"><span data-stu-id="f5a7e-173">Monitoring cloud-native apps</span></span>

<span data-ttu-id="f5a7e-174">某些集中式記錄系統採用其他角色來收集純記錄以外的遙測資料。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-174">Some centralized logging systems take on an additional role of collecting telemetry outside of pure logs.</span></span> <span data-ttu-id="f5a7e-175">他們可以收集計量，例如執行資料庫查詢的時間、從 web 伺服器進行的平均回應時間，甚至是作業系統所報告的 CPU 負載平均和記憶體壓力。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-175">They can collect metrics, such as time to run a database query, average response time from a web server, and even CPU load averages and memory pressure as reported by the operating system.</span></span> <span data-ttu-id="f5a7e-176">這些系統可結合記錄，全面瞭解系統中節點的健全狀況，以及整體的應用程式。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-176">In conjunction with the logs, these systems can provide a holistic view of the health of nodes in the system and the application as a whole.</span></span>

<span data-ttu-id="f5a7e-177">監視工具的計量收集功能也可以從應用程式內以手動方式進行饋送。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-177">The metric-gathering capabilities of the monitoring tools can also be fed manually from within the application.</span></span> <span data-ttu-id="f5a7e-178">特別感興趣的商務流程（例如註冊或訂購的新使用者）可以進行檢測，使其在中央監視系統中遞增計數器。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-178">Business flows that are of particular interest such as new users signing up or orders being placed, may be instrumented such that they increment a counter in the central monitoring system.</span></span> <span data-ttu-id="f5a7e-179">這會將監視工具解除鎖定，不僅能監視應用程式的健康情況，還能監視企業的健康情況。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-179">This unlocks the monitoring tools to not only monitor the health of the application but the health of the business.</span></span>

<span data-ttu-id="f5a7e-180">您可以在記錄匯總工具中建立查詢，以尋找特定的統計資料或模式，然後以圖形形式顯示在自訂儀表板上。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-180">Queries can be constructed in the log aggregation tools to look for certain statistics or patterns, which can then be displayed in graphical form, on custom dashboards.</span></span> <span data-ttu-id="f5a7e-181">小組通常會投資大量的現成顯示器，以旋轉與應用程式相關的統計資料。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-181">Frequently, teams will invest in large, wall-mounted displays that rotate through the statistics related to an application.</span></span> <span data-ttu-id="f5a7e-182">如此一來，就可以輕鬆地在發生問題時加以查看。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-182">This way, it's simple to see the problems as they occur.</span></span>

<span data-ttu-id="f5a7e-183">無論應用程式是單一進程整合型應用程式或分散式微服務架構，雲端原生監視工具都能提供應用程式的即時遙測和見解。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-183">Cloud-native monitoring tools provide real-time telemetry and insight into apps regardless of whether they're single-process monolithic applications or distributed microservice architectures.</span></span> <span data-ttu-id="f5a7e-184">其中包含的工具可讓您從應用程式收集資料，以及用來查詢和顯示應用程式健康情況相關資訊的工具。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-184">They include tools that allow collection of data from the app as well as tools for querying and displaying information about the app's health.</span></span>

## <a name="challenges-with-reacting-to-critical-problems-in-cloud-native-apps"></a><span data-ttu-id="f5a7e-185">在雲端原生應用程式中回應重大問題的挑戰</span><span class="sxs-lookup"><span data-stu-id="f5a7e-185">Challenges with reacting to critical problems in cloud-native apps</span></span>

<span data-ttu-id="f5a7e-186">如果您需要對應用程式的問題做出反應，您需要某種方式來警示適當的人員。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-186">If you need to react to problems with your application, you need some way to alert the right personnel.</span></span> <span data-ttu-id="f5a7e-187">這是第三個雲端原生應用程式可檢視性模式，而且取決於記錄和監視。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-187">This is the third cloud-native application observability pattern and depends on logging and monitoring.</span></span> <span data-ttu-id="f5a7e-188">您的應用程式必須準備好進行記錄，以允許診斷問題，而在某些情況下則會送入監視工具。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-188">Your application needs to have logging in place to allow problems to be diagnosed, and in some cases to feed into monitoring tools.</span></span> <span data-ttu-id="f5a7e-189">它需要監視，才能在單一位置匯總應用程式計量和健全狀況資料。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-189">It needs monitoring to aggregate application metrics and health data in one place.</span></span> <span data-ttu-id="f5a7e-190">一旦建立之後，就可以建立規則，以在某些計量超出可接受的層級時觸發警示。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-190">Once this has been established, rules can be created that will trigger alerts when certain metrics fall outside of acceptable levels.</span></span>

<span data-ttu-id="f5a7e-191">一般而言，警示會在監視之上分層，讓某些條件觸發適當的警示，以通知小組成員有緊急問題。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-191">Generally, alerts are layered on top of monitoring such that certain conditions trigger appropriate alerts to notify team members of urgent problems.</span></span> <span data-ttu-id="f5a7e-192">某些可能需要警示的案例包括：</span><span class="sxs-lookup"><span data-stu-id="f5a7e-192">Some scenarios that may require alerts include:</span></span>

- <span data-ttu-id="f5a7e-193">您應用程式的其中一個服務在停機1分鐘後沒有回應。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-193">One of your application's services is not responding after 1 minute of downtime.</span></span>
- <span data-ttu-id="f5a7e-194">您的應用程式傳回不成功的 HTTP 回應給超過1% 的要求。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-194">Your application is returning unsuccessful HTTP responses to more than 1% of requests.</span></span>
- <span data-ttu-id="f5a7e-195">您應用程式的金鑰端點平均回應時間超過2000毫秒。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-195">Your application's average response time for key endpoints exceeds 2000 ms.</span></span>

### <a name="alerts-in-cloud-native-apps"></a><span data-ttu-id="f5a7e-196">雲端原生應用程式中的警示</span><span class="sxs-lookup"><span data-stu-id="f5a7e-196">Alerts in cloud-native apps</span></span>

<span data-ttu-id="f5a7e-197">您可以針對監視工具製作查詢，以尋找已知的失敗狀況。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-197">You can craft queries against the monitoring tools to look for known failure conditions.</span></span> <span data-ttu-id="f5a7e-198">例如，查詢可以搜尋傳入的記錄，以取得 HTTP 狀態碼500的指示，這表示 web 伺服器有問題。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-198">For instance, queries could search through the incoming logs for indications of HTTP status code 500, which indicates a problem on a web server.</span></span> <span data-ttu-id="f5a7e-199">一旦偵測到上述其中一種情況，就可以將電子郵件或 SMS 傳送給原始服務的擁有者，以開始調查。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-199">As soon as one of these is detected, then an e-mail or an SMS could be sent to the owner of the originating service who can begin to investigate.</span></span>

<span data-ttu-id="f5a7e-200">不過，通常單一500錯誤並不足以判斷是否發生問題。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-200">Typically, though, a single 500 error isn't enough to determine that a problem has occurred.</span></span> <span data-ttu-id="f5a7e-201">這可能表示使用者輸入錯誤的密碼或輸入了一些格式不正確的資料。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-201">It could mean that a user mistyped their password or entered some malformed data.</span></span> <span data-ttu-id="f5a7e-202">當偵測到大於500錯誤的平均數目時，才會引發警示查詢。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-202">The alert queries can be crafted to only fire when a larger than average number of 500 errors are detected.</span></span>

<span data-ttu-id="f5a7e-203">警示中最具破壞性的模式之一，是引發過多的警示讓人們調查。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-203">One of the most damaging patterns in alerting is to fire too many alerts for humans to investigate.</span></span> <span data-ttu-id="f5a7e-204">服務擁有者很快就會降低了戒心至先前調查的錯誤，並且發現無害。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-204">Service owners will rapidly become desensitized to errors that they've previously investigated and found to be benign.</span></span> <span data-ttu-id="f5a7e-205">然後，當發生 true 錯誤時，就會在數百個誤報的雜訊中遺失。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-205">Then, when true errors occur, they'll be lost in the noise of hundreds of false positives.</span></span> <span data-ttu-id="f5a7e-206">[完成 Wolf](https://en.wikipedia.org/wiki/The_Boy_Who_Cried_Wolf)的 parable 會經常被告知孩子，以警告他們這項危險。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-206">The parable of the [Boy Who Cried Wolf](https://en.wikipedia.org/wiki/The_Boy_Who_Cried_Wolf) is frequently told to children to warn them of this very danger.</span></span> <span data-ttu-id="f5a7e-207">請務必確定引發的警示會指出真正的問題。</span><span class="sxs-lookup"><span data-stu-id="f5a7e-207">It's important to ensure that the alerts that do fire are indicative of a real problem.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="f5a7e-208">[上一個](monitoring-health.md) 
>[下一步](logging-with-elastic-stack.md)</span><span class="sxs-lookup"><span data-stu-id="f5a7e-208">[Previous](monitoring-health.md)
[Next](logging-with-elastic-stack.md)</span></span>
