---
title: 'CA1031：不攔截一般例外狀況類型 (程式碼分析) '
description: 瞭解程式碼分析規則 CA1031：不要攔截一般例外狀況類型
ms.date: 11/04/2016
ms.topic: reference
f1_keywords:
- CA1031
- DoNotCatchGeneralExceptionTypes
helpviewer_keywords:
- CA1031
- DoNotCatchGeneralExceptionTypes
author: gewarren
ms.author: gewarren
dev_langs:
- CSharp
- VB
ms.openlocfilehash: 8cf705ec704f5afa6d962b7c22b6f60565a9f697
ms.sourcegitcommit: e301979e3049ce412d19b094c60ed95b316a8f8c
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 12/16/2020
ms.locfileid: "97594666"
---
# <a name="ca1031-do-not-catch-general-exception-types"></a><span data-ttu-id="8138c-103">CA1031:不要攔截一般例外狀況類型</span><span class="sxs-lookup"><span data-stu-id="8138c-103">CA1031: Do not catch general exception types</span></span>

| <span data-ttu-id="8138c-104">Item</span><span class="sxs-lookup"><span data-stu-id="8138c-104">Item</span></span>                                     | <span data-ttu-id="8138c-105">值</span><span class="sxs-lookup"><span data-stu-id="8138c-105">Value</span></span>            |
|------------------------------------------|------------------|
| <span data-ttu-id="8138c-106">RuleId</span><span class="sxs-lookup"><span data-stu-id="8138c-106">RuleId</span></span>                                   | <span data-ttu-id="8138c-107">CA1031</span><span class="sxs-lookup"><span data-stu-id="8138c-107">CA1031</span></span>           |
| <span data-ttu-id="8138c-108">類別</span><span class="sxs-lookup"><span data-stu-id="8138c-108">Category</span></span>                                 | <span data-ttu-id="8138c-109">Microsoft. 設計</span><span class="sxs-lookup"><span data-stu-id="8138c-109">Microsoft.Design</span></span> |
| <span data-ttu-id="8138c-110">修正程式中斷或未中斷</span><span class="sxs-lookup"><span data-stu-id="8138c-110">Fix is breaking or non-breaking</span></span> | <span data-ttu-id="8138c-111">非中斷</span><span class="sxs-lookup"><span data-stu-id="8138c-111">Non-breaking</span></span>     |

## <a name="cause"></a><span data-ttu-id="8138c-112">原因</span><span class="sxs-lookup"><span data-stu-id="8138c-112">Cause</span></span>

<span data-ttu-id="8138c-113">一般例外狀況（例如 <xref:System.Exception?displayProperty=fullName> 或 <xref:System.SystemException?displayProperty=fullName> ）會在語句中捕捉 `catch` ，或使用一般 catch 子句（例如） `catch()` 。</span><span class="sxs-lookup"><span data-stu-id="8138c-113">A general exception such as <xref:System.Exception?displayProperty=fullName> or <xref:System.SystemException?displayProperty=fullName> is caught in a `catch` statement, or a general catch clause such as `catch()` is used.</span></span>

<span data-ttu-id="8138c-114">根據預設，此規則只會旗標攔截一般例外狀況類型，但這是 [可](#configure-code-to-analyze)設定的。</span><span class="sxs-lookup"><span data-stu-id="8138c-114">By default, this rule only flags general exception types being caught, but this is [configurable](#configure-code-to-analyze).</span></span>

## <a name="rule-description"></a><span data-ttu-id="8138c-115">規則描述</span><span class="sxs-lookup"><span data-stu-id="8138c-115">Rule description</span></span>

<span data-ttu-id="8138c-116">不應該攔截一般例外狀況。</span><span class="sxs-lookup"><span data-stu-id="8138c-116">General exceptions should not be caught.</span></span>

## <a name="how-to-fix-violations"></a><span data-ttu-id="8138c-117">如何修正違規</span><span class="sxs-lookup"><span data-stu-id="8138c-117">How to fix violations</span></span>

<span data-ttu-id="8138c-118">若要修正此規則的違規情形，請攔截更明確的例外狀況，或重新擲回一般例外狀況做為區塊中的最後一個語句 `catch` 。</span><span class="sxs-lookup"><span data-stu-id="8138c-118">To fix a violation of this rule, catch a more specific exception, or rethrow the general exception as the last statement in the `catch` block.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="8138c-119">隱藏警告的時機</span><span class="sxs-lookup"><span data-stu-id="8138c-119">When to suppress warnings</span></span>

<span data-ttu-id="8138c-120">請勿隱藏此規則的警告。</span><span class="sxs-lookup"><span data-stu-id="8138c-120">Do not suppress a warning from this rule.</span></span> <span data-ttu-id="8138c-121">攔截一般例外狀況類型可以隱藏程式庫使用者的執行時間問題，並且可以使調試更困難。</span><span class="sxs-lookup"><span data-stu-id="8138c-121">Catching general exception types can hide run-time problems from the library user and can make debugging more difficult.</span></span>

> [!NOTE]
> <span data-ttu-id="8138c-122">從 .NET Framework 4 開始，common language runtime (CLR) 不再提供作業系統和 managed 程式碼中發生的損毀狀態例外狀況（例如 Windows 中的存取違規），以由 managed 程式碼處理。</span><span class="sxs-lookup"><span data-stu-id="8138c-122">Starting with .NET Framework 4, the common language runtime (CLR) no longer delivers corrupted state exceptions that occur in the operating system and managed code, such as access violations in Windows, to be handled by managed code.</span></span> <span data-ttu-id="8138c-123">如果您想要在 .NET Framework 4 或更新版本中編譯應用程式，並維護損毀狀態例外狀況的處理，您可以將 <xref:System.Runtime.ExceptionServices.HandleProcessCorruptedStateExceptionsAttribute> 屬性套用至處理損毀狀態例外狀況的方法。</span><span class="sxs-lookup"><span data-stu-id="8138c-123">If you want to compile an application in .NET Framework 4 or later versions and maintain handling of corrupted state exceptions, you can apply the <xref:System.Runtime.ExceptionServices.HandleProcessCorruptedStateExceptionsAttribute> attribute to the method that handles the corrupted state exception.</span></span>

## <a name="configure-code-to-analyze"></a><span data-ttu-id="8138c-124">設定要分析的程式碼</span><span class="sxs-lookup"><span data-stu-id="8138c-124">Configure code to analyze</span></span>

<span data-ttu-id="8138c-125">使用下列選項來設定您的程式碼基底要執行此規則的部分。</span><span class="sxs-lookup"><span data-stu-id="8138c-125">Use the following option to configure which parts of your codebase to run this rule on.</span></span>

- [<span data-ttu-id="8138c-126">不允許的例外狀況類型名稱</span><span class="sxs-lookup"><span data-stu-id="8138c-126">Disallowed exception type names</span></span>](#disallowed-exception-type-names)

<span data-ttu-id="8138c-127">您可以只針對此規則、所有規則或此類別中的所有規則設定此選項， (設計) 。</span><span class="sxs-lookup"><span data-stu-id="8138c-127">You can configure this option for just this rule, for all rules, or for all rules in this category (Design).</span></span> <span data-ttu-id="8138c-128">如需詳細資訊，請參閱程式 [代碼品質規則配置選項](../code-quality-rule-options.md)。</span><span class="sxs-lookup"><span data-stu-id="8138c-128">For more information, see [Code quality rule configuration options](../code-quality-rule-options.md).</span></span>

### <a name="disallowed-exception-type-names"></a><span data-ttu-id="8138c-129">不允許的例外狀況類型名稱</span><span class="sxs-lookup"><span data-stu-id="8138c-129">Disallowed exception type names</span></span>

<span data-ttu-id="8138c-130">您可以設定不允許攔截哪些例外狀況類型。</span><span class="sxs-lookup"><span data-stu-id="8138c-130">You can configure which exception types are disallowed from being caught.</span></span> <span data-ttu-id="8138c-131">例如，若要指定規則應以旗標 `catch` 處理常式 `NullReferenceException` ，請將下列機碼值組新增至專案中的 *editorconfig* 檔案：</span><span class="sxs-lookup"><span data-stu-id="8138c-131">For example, to specify that the rule should flag `catch` handlers with `NullReferenceException`, add the following key-value pair to an *.editorconfig* file in your project:</span></span>

```ini
dotnet_code_quality.CA1031.disallowed_symbol_names = NullReferenceException
```

<span data-ttu-id="8138c-132">選項值中允許的類型名稱格式 (以 `|`) 分隔：</span><span class="sxs-lookup"><span data-stu-id="8138c-132">Allowed type name formats in the option value (separated by `|`):</span></span>

- <span data-ttu-id="8138c-133">僅限類型名稱 (包含名稱的所有符號，不論包含的類型或命名空間為何) </span><span class="sxs-lookup"><span data-stu-id="8138c-133">Type name only (includes all symbols with the name, regardless of the containing type or namespace)</span></span>
- <span data-ttu-id="8138c-134">符號的 [檔識別碼格式](../../../csharp/programming-guide/xmldoc/processing-the-xml-file.md#id-strings) 中具有前置詞的完整名稱 `T:` 。</span><span class="sxs-lookup"><span data-stu-id="8138c-134">Fully qualified names in the symbol's [documentation ID format](../../../csharp/programming-guide/xmldoc/processing-the-xml-file.md#id-strings) with a `T:` prefix.</span></span>

<span data-ttu-id="8138c-135">範例：</span><span class="sxs-lookup"><span data-stu-id="8138c-135">Examples:</span></span>

| <span data-ttu-id="8138c-136">選項值</span><span class="sxs-lookup"><span data-stu-id="8138c-136">Option Value</span></span> | <span data-ttu-id="8138c-137">摘要</span><span class="sxs-lookup"><span data-stu-id="8138c-137">Summary</span></span> |
| --- | --- |
|`dotnet_code_quality.CA1031.disallowed_symbol_names = ExceptionType` | <span data-ttu-id="8138c-138">符合編譯中名稱為 ' ExceptionType ' 的所有符號</span><span class="sxs-lookup"><span data-stu-id="8138c-138">Matches all symbols named 'ExceptionType' in the compilation</span></span>
|`dotnet_code_quality.CA1031.disallowed_symbol_names = ExceptionType1|ExceptionType2` | <span data-ttu-id="8138c-139">符合編譯中名稱為 ' ExceptionType1 ' 或 ' ExceptionType2 ' 的所有符號</span><span class="sxs-lookup"><span data-stu-id="8138c-139">Matches all symbols named either 'ExceptionType1' or 'ExceptionType2' in the compilation</span></span>
|`dotnet_code_quality.CA1031.disallowed_symbol_names = T:NS.ExceptionType` | <span data-ttu-id="8138c-140">符合指定的完整名稱之名稱為 ' ExceptionType ' 的特定類型。</span><span class="sxs-lookup"><span data-stu-id="8138c-140">Matches specific types named 'ExceptionType' with given fully qualified name.</span></span>
|`dotnet_code_quality.CA1031.disallowed_symbol_names = T:NS1.ExceptionType1|T:NS1.ExceptionType2` | <span data-ttu-id="8138c-141">符合名為 ' ExceptionType1 ' 和 ' ExceptionType2 ' 的類型，並具有各自的完整限定名稱</span><span class="sxs-lookup"><span data-stu-id="8138c-141">Matches types named 'ExceptionType1' and 'ExceptionType2' with respective fully qualified names</span></span>

<span data-ttu-id="8138c-142">您可以只針對此規則、所有規則或此類別中的所有規則設定這些選項， (設計) 。</span><span class="sxs-lookup"><span data-stu-id="8138c-142">You can configure these options for just this rule, for all rules, or for all rules in this category (Design).</span></span> <span data-ttu-id="8138c-143">如需詳細資訊，請參閱程式 [代碼品質規則配置選項](../code-quality-rule-options.md)。</span><span class="sxs-lookup"><span data-stu-id="8138c-143">For more information, see [Code quality rule configuration options](../code-quality-rule-options.md).</span></span>

## <a name="example"></a><span data-ttu-id="8138c-144">範例</span><span class="sxs-lookup"><span data-stu-id="8138c-144">Example</span></span>

<span data-ttu-id="8138c-145">下列範例顯示違反此規則的型別，以及正確實作為區塊的型別 `catch` 。</span><span class="sxs-lookup"><span data-stu-id="8138c-145">The following example shows a type that violates this rule and a type that correctly implements the `catch` block.</span></span>

:::code language="vb" source="snippets/vb/all-rules/ca1031-do-not-catch-general-exception-types_1.vb":::

:::code language="csharp" source="snippets/csharp/all-rules/ca1031.cs" id="snippet1":::

## <a name="related-rules"></a><span data-ttu-id="8138c-146">相關規則</span><span class="sxs-lookup"><span data-stu-id="8138c-146">Related rules</span></span>

[<span data-ttu-id="8138c-147">CA2200:必須重新擲回以保存堆疊詳細資料</span><span class="sxs-lookup"><span data-stu-id="8138c-147">CA2200: Rethrow to preserve stack details</span></span>](ca2200.md)
